<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Advanced Econometrics with Examples - 8&nbsp; Endogeniety I: IV and 2SLS</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./gls.html" rel="next">
<link href="./ols.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ols.html">Linear Models</a></li><li class="breadcrumb-item"><a href="./endog.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Endogeniety I: IV and 2SLS</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Advanced Econometrics with Examples</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preliminaries</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Statistical Theory</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./estimators.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Finite Sample Properties of Estimators</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./asymptotics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Asymptotic Properties of Estimators</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Hypothesis Testing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exp_fam.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Exponential Families</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stochastic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Stochastic Processes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./adv_asymptotics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Advanced Asymptotics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ols.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">The Classical Linear Model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./endog.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Endogeniety I: IV and 2SLS</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gls.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Generalized Least Squares</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./simul.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Endogeniety II: Simultaneity and Multiple Regressions</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Estimation Frameworks</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./extremum.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Extremum Estimators</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gmm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">The Generalized Method of Moments</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Maximum Likelihood Estimation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Basic Microeconometrics and Time Series</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./binary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Binary Choice</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./panel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Panel Data I: The Basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./time_series.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Basic Time Series</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Advanced Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nonpar.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Nonparametrics I: Distribution and Density Estimation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nonpar_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Nonparametrics II: Functional Forms</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./semipar.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Semiparametrics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sieve.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Sieve Estimation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./partial_id.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Partial Identification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./endog_nonlinear.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Endogeniety III: Nonlinear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./weak_inst.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Endogeniety IV: Weak Instruments</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Microeconometrics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./discrete_choice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Discrete Choice</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tobit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Tobit</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./survival.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Survival Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./count.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Count Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mixed.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Mixed and Multilevel Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./GLM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Generalized Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./panel2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Panel Methods II</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Time Series</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./time_math.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Math Review</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">
 <span class="menu-text">Causal Inference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./causal1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Potential Outcomes Model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./matching.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Matching Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rdd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Regression Discontinuity Design</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./did.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Difference in Differences</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./LATE.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Non-Compliance and LATE</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hetero.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Heterogeneous Treatment Effects</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">
 <span class="menu-text">More Statistical Theory</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bayes1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Bayesian Estimation I: Theory</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bayes2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Bayesian Estimation II: Computation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bayes3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Bayesian Estimation III: Applications</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./modelselection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">Model Selection</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./robust.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">42</span>&nbsp; <span class="chapter-title">Robust Statistics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="true">
 <span class="menu-text">Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./learning_theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">43</span>&nbsp; <span class="chapter-title">Statistical Learning Theory</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ML1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">44</span>&nbsp; <span class="chapter-title">Supervised Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ML2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">45</span>&nbsp; <span class="chapter-title">Dimmension Reduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ML3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">46</span>&nbsp; <span class="chapter-title">Unsupervised Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ML4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">47</span>&nbsp; <span class="chapter-title">Text Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ML5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">48</span>&nbsp; <span class="chapter-title">ML meets Causal Inference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#omitted-variables-and-measurement-error" id="toc-omitted-variables-and-measurement-error" class="nav-link active" data-scroll-target="#omitted-variables-and-measurement-error"><span class="header-section-number">8.1</span> Omitted Variables and Measurement Error</a></li>
  <li><a href="#an-updated-linear-model-identification-and-the-iv-estimator" id="toc-an-updated-linear-model-identification-and-the-iv-estimator" class="nav-link" data-scroll-target="#an-updated-linear-model-identification-and-the-iv-estimator"><span class="header-section-number">8.2</span> An Updated Linear Model, Identification, and the IV estimator</a></li>
  <li><a href="#properties-of-the-iv-estimator" id="toc-properties-of-the-iv-estimator" class="nav-link" data-scroll-target="#properties-of-the-iv-estimator"><span class="header-section-number">8.3</span> Properties of the IV Estimator</a></li>
  <li><a href="#many-instruments-2sls" id="toc-many-instruments-2sls" class="nav-link" data-scroll-target="#many-instruments-2sls"><span class="header-section-number">8.4</span> Many Instruments, 2SLS</a></li>
  <li><a href="#testing-hypotheses" id="toc-testing-hypotheses" class="nav-link" data-scroll-target="#testing-hypotheses"><span class="header-section-number">8.5</span> Testing Hypotheses</a>
  <ul class="collapse">
  <li><a href="#durbinwuhausman-test" id="toc-durbinwuhausman-test" class="nav-link" data-scroll-target="#durbinwuhausman-test"><span class="header-section-number">8.5.1</span> Durbin–Wu–Hausman Test</a></li>
  <li><a href="#sarganhansen-test" id="toc-sarganhansen-test" class="nav-link" data-scroll-target="#sarganhansen-test"><span class="header-section-number">8.5.2</span> Sargan–Hansen Test</a></li>
  </ul></li>
  <li><a href="#examplereplication" id="toc-examplereplication" class="nav-link" data-scroll-target="#examplereplication"><span class="header-section-number">8.6</span> Example/Replication</a></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading"><span class="header-section-number">8.7</span> Further Reading</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ols.html">Linear Models</a></li><li class="breadcrumb-item"><a href="./endog.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Endogeniety I: IV and 2SLS</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Endogeniety I: IV and 2SLS</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Our first departure from the classical linear model <span class="math inline">\(\mathcal P_\text{LM}\)</span> will come in the form of dropping the assumption that <span class="math inline">\(\text{E}\left[\mathbf{X}'\boldsymbol{\varepsilon}\right] = \mathbf{0}\)</span>, i.e our regressors are endogenous. This situation is rather serious, as it prevents the linear model from being identified. Furthermore, the problem is common in applications. There are three main sources of endogeneity:</p>
<ol type="1">
<li>Omitted variables</li>
<li>Measurement error</li>
<li>Simultaneity</li>
</ol>
<p>For now we’ll consider the first two, and discuss the third on in Section @ref(endogeniety-ii-simultaneous-equation-models). Fortunately, we can address endogeneity with the instrumental variables estimator (a special case of which is the two-stage least squares estimator).</p>
<section id="omitted-variables-and-measurement-error" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="omitted-variables-and-measurement-error"><span class="header-section-number">8.1</span> Omitted Variables and Measurement Error</h2>
<div id="exm-ex1" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.1</strong></span> Recall the Example @ref(exm:endogex) where we considered a model relating income to education and other determinants of salary. Suppose the true model is <span class="math display">\[ \log(income_i) = \beta_1 + \beta_2\cdot educ_i + \beta_3 \cdot experiance_i + \varepsilon_i,\]</span> where <span class="math inline">\(\varepsilon_i\)</span> are the unobserved factors impacting salary, <span class="math inline">\(educ_i\)</span> measure years of post-secondary education, <span class="math inline">\(experiance_i\)</span> measures years of work experience, and <span class="math inline">\(\text{Cov}\left(educ, experiance\right) &lt; 0\)</span> (the longer you go to school, the less work experience you tend to have). Now suppose we incorrectly specify the model <span class="math display">\[ \log(income_i) = \gamma_1 + \gamma_2\cdot educ_i + u_i,\]</span> where <span class="math inline">\(u_i\)</span> are all other factors impacting salary. We’ve omitted <span class="math inline">\(experiance_i\)</span> as a regressor, so it’s implicitly included in <span class="math inline">\(u_i\)</span>: <span class="math display">\[ u_i =  \beta_3 \cdot experiance_i + \varepsilon_i.\]</span> We no longer satisfy the assumption <span class="math inline">\(\text{E}\left[\mathbf{X}'\boldsymbol{\varepsilon}\right] = \mathbf{0}\)</span>, as <span class="math inline">\(\text{Cov}\left(educ_i, u_i\right) \neq 0\)</span> because <span class="math inline">\(\text{Cov}\left(educ, experiance\right) &lt; 0\)</span>. What happens if we go ahead and attempt to estimate <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span> anyway? Set <span class="math inline">\(\boldsymbol{\beta}= [1,3,2]'\)</span>, and <span class="math inline">\(\varepsilon_i \overset{iid}{\sim}N(0,1)\)</span>.</p>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-2_7ba65f5c14c6e624c6ad5f06d12864fa">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"functions/sim_linear_model.r"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">10</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>Sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="sc">-</span><span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.5</span>, <span class="dv">5</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">sim_linear_model</span>(</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>),</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">1000</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_vec =</span> <span class="fu">c</span>(rmvnorm, rnorm),</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_params_list =</span> <span class="fu">list</span>(<span class="fu">list</span>(mu, Sigma), <span class="fu">list</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x2, <span class="at">data =</span> results<span class="sc">$</span>observed_data) <span class="sc">%&gt;%</span> </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-3_0802a58eeae5106d369a7c027ec7b817">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">22.557776</td>
<td style="text-align: right;">0.4552041</td>
<td style="text-align: right;">49.55530</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">x2</td>
<td style="text-align: right;">2.579096</td>
<td style="text-align: right;">0.1061940</td>
<td style="text-align: right;">24.28665</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The true parameters don’t even fall within the 95% confidence intervals centered at our estimates.</p>
</div>
<p>In general, suppose <span class="math display">\[\mathbf{Y}= [\mathbb{X},\mathbb{Z}][\boldsymbol{\beta}, \boldsymbol \delta]' + \boldsymbol{\varepsilon}= \mathbb{X}\boldsymbol{\beta}+ \mathbb{Z}\boldsymbol \delta + \boldsymbol{\varepsilon},\]</span> where we attempt to estimate <span class="math inline">\(\boldsymbol{\beta}\)</span> via <span class="math inline">\(\hat{\boldsymbol\beta}_\text{OLS} \)</span> despite omitting regressors <span class="math inline">\(\mathbf Z\)</span> from our model, and all our Gauss-Markov assumptions are met. Note that <span class="math inline">\(\boldsymbol{\beta}\)</span> is still identified, as <span class="math inline">\(\text{E}\left[\mathbf{X}'\boldsymbol{\varepsilon}\right] = \mathbf{0}\)</span>. <span class="math display">\[\begin{align*}
\hat{\boldsymbol\beta}_\text{OLS,OV} &amp; = (\mathbb{X}'\mathbb{X})^{-1}\mathbb{X}'\mathbf{Y}\\
&amp; = (\mathbb{X}'\mathbb{X})^{-1}\mathbb{X}'(\mathbb{X}\boldsymbol{\beta}+ \mathbb{Z}\boldsymbol \delta + \boldsymbol{\varepsilon})\\
&amp; = \boldsymbol{\beta}+ (\mathbb{X}'\mathbb{X})^{-1}\mathbb{X}'\mathbb{Z}\boldsymbol\delta  + (\mathbb{X}'\mathbb{X})^{-1}\mathbb{X}'\boldsymbol{\varepsilon}.
\end{align*}\]</span> Our estimator is now inconsistent: <span class="math display">\[\begin{align*}
\mathop{\mathrm{plim}}\hat{\boldsymbol\beta}_\text{OLS,OV} &amp; = \boldsymbol{\beta}+ \mathop{\mathrm{plim}}\left[(\mathbb{X}'\mathbb{X})^{-1}\mathbb{X}'\mathbb{Z}\boldsymbol\delta\right] + \mathop{\mathrm{plim}}\left[(\mathbb{X}'\mathbb{X})^{-1}\right]\underbrace{\mathop{\mathrm{plim}}\left[\mathbb{X}'\boldsymbol{\varepsilon}\right]}_\mathbf{0}\\
&amp; =  \boldsymbol{\beta}+ \mathop{\mathrm{plim}}\left[(\mathbb{X}'\mathbb{X})^{-1}\mathbb{X}'\mathbb{Z}\boldsymbol\delta\right].
\end{align*}\]</span></p>
<p>This phenomenon is referred to as <strong><em>omitted variable bias (OVB)</em></strong>. The use of the word “bias” here is a bit misleading, but follows from an interpretation of inconsistency as a persistent bias despite <span class="math inline">\(n\to\infty\)</span></p>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.2 (OVB with a Simple Linear Model)</strong></span> Suppose our linear model is <span class="math inline">\(Y = \alpha + \beta X+ \gamma Z + \varepsilon\)</span>, and we attempt to estimate <span class="math inline">\((\beta_0,\beta_1)\)</span> with <span class="math inline">\(\hat{\boldsymbol\beta}_\text{OLS,OV} \)</span>. In this case, <span class="math display">\[\begin{align*}
\hat \beta_\text{OLS,OV} &amp; =\frac{\sum_{i=1}^n (X_i -\bar X)(Y_i - \bar Y)}{\sum_{i=1}^n (X_i -\bar X)^2}\\ &amp; = \frac{\sum_{i=1}^n (X_i -\bar X)[(\alpha + \beta X+ \gamma Z + \varepsilon) - \bar Y]}{\sum_{i=1}^n (X_i -\bar X)^2}\\ &amp; = \beta + \frac{\sum_{i=1}^n (X_i -\bar X)(Z_i - \bar Z)}{\sum_{i=1}^n (X_i -\bar X)^2}\\ &amp; = \beta + \gamma \cdot \frac{\sum_{i=1}^n (X_i -\bar X)(Z_i-\bar Z)}{\sum_{i=1}^n (X_i -\bar X)^2}.
\end{align*}\]</span> The expectation of this is <span class="math display">\[\hat\beta_\text{OLS,OV} \overset{p}{\to}\beta + \gamma \cdot \mathop{\mathrm{plim}}\frac{n^{-1}\sum_{i=1}^n (X_i -\bar X)(Z_i-\bar Z)}{n^{-1}\sum_{i=1}^n (X_i -\bar X)^2} =\boldsymbol{\beta}+ \gamma \frac{\text{Cov}\left(X,Z\right)}{\text{Var}\left(X\right)} .\]</span></p>
<p>If we let <span class="math inline">\(\alpha = 1\)</span>, <span class="math inline">\(\beta = 2\)</span>, <span class="math inline">\(\gamma = 3\)</span>, and <span class="math inline">\(\text{Var}\left(X\right) = 1\)</span>, then <span class="math display">\[\mathop{\mathrm{plim}}\hat\beta_\text{OLS,OV} = 2 + 3\text{Cov}\left(X,Z\right).\]</span> If we simulate this estimator for different values of <span class="math inline">\(\text{Cov}\left(X,Z\right)\)</span>, taking <span class="math inline">\(n\)</span> to be very large, then we should see our estimates approximately follow the line <span class="math inline">\(2 + 3\text{Cov}\left(X,Z\right)\)</span> when plotted against <span class="math inline">\(\text{Cov}\left(X,Z\right)\)</span>.</p>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-4_7d5f9f82d387500d0d84de40efabf3a0">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>iter <span class="ot">&lt;-</span> <span class="cf">function</span>(cov_xz, var_x, var_z, beta, gamma, n, mu){</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  Sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(var_x, cov_xz, cov_xz, var_z), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">sim_linear_model</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">1</span>, beta, gamma),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> n,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">dist_vec =</span> <span class="fu">c</span>(rmvnorm, rnorm),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">dist_params_list =</span> <span class="fu">list</span>(<span class="fu">list</span>(mu, Sigma), <span class="fu">list</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x2, <span class="at">data =</span> results<span class="sc">$</span>observed_data) <span class="sc">%&gt;%</span> </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">'x2'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cov_xz =</span> cov_xz)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="cf">function</span>(cov_xz_vals, var_x, var_z, beta, gamma, n, mu){</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> cov_xz_vals <span class="sc">%&gt;%</span> </span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(iter, <span class="at">var_x =</span> var_x, <span class="at">var_z =</span> var_z, <span class="at">beta =</span> beta, <span class="at">gamma =</span> gamma, <span class="at">n =</span> n, <span class="at">mu =</span> mu) <span class="sc">%&gt;%</span> </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    bind_rows</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">sim</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)<span class="sc">/</span><span class="dv">50</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="fl">1e6</span>, <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-fig.asp="0.7" data-hash="endog_cache/html/fig-plot701_6facf38dcb1f14393e7d8065a9ddbb45">
<details class="code-fold">
<summary>Show code which generates figure</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>results <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(cov_xz, estimate)) <span class="sc">+</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Cov(X,Z)"</span>, <span class="at">y =</span> <span class="st">"Estimated β"</span>) <span class="sc">+</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot701" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-plot701-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="endog_files/figure-html/fig-plot701-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-plot701-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8.1: f
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>What happens if instead of omitting a variable from a model, our variables happen to be prone to some degree of measurement error? This is a common scenario in the social sciences where collected data is subject to human error, rounding errors, etc. Suppose a true linear model is specified as <span class="math inline">\(\mathbf{Y}= \mathbb{X}^*\boldsymbol{\beta}+ \boldsymbol{\varepsilon}\)</span> for regressors <span class="math inline">\(\mathbf{X}^*\)</span> where <span class="math inline">\(\text{E}\left[\mathbf{X}^{*\prime}\boldsymbol{\varepsilon}\right] = \mathbf{0}\)</span>. Much like how we do not observe realizations of <span class="math inline">\(\boldsymbol{\varepsilon}\)</span>, we do not observe realizations of <span class="math inline">\(\mathbf{X}^*\)</span>, instead observing <span class="math inline">\(\mathbf{X}= \mathbf{X}^* + \mathbf u\)</span> where <span class="math inline">\(\mathbf u\)</span> corresponds to <strong><em>measurement error</em></strong>. We’ll assume that this measurement error is independent of <span class="math inline">\(\boldsymbol{\varepsilon}\)</span>, independent of <span class="math inline">\(\mathbf{X}^*\)</span>, and is mean zero.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Our model can be rewritten as <span class="math display">\[ \mathbf{Y}= \mathbb{X}^*\boldsymbol{\beta}+ \boldsymbol{\varepsilon}= (\mathbf{X}- \mathbf u)\boldsymbol{\beta}+ \boldsymbol{\varepsilon}= \mathbf{X}\boldsymbol{\beta}+ \underbrace{(\boldsymbol{\varepsilon}- \mathbf u\boldsymbol{\beta})}_{\boldsymbol \nu}.\]</span> In this case <span class="math display">\[\text{E}\left[\mathbf{X}\boldsymbol \nu\right] = \text{E}\left[(\mathbf{X}^* + \mathbf u)(\boldsymbol{\varepsilon}- \mathbf u\boldsymbol{\beta})\right] = -\boldsymbol{\beta}\text{E}\left[\mathbf u'\mathbf u\right] = -\boldsymbol{\beta}\text{Var}\left(\mathbf u\right).\]</span> Much like in the case of OVB, <span class="math inline">\(\hat{\boldsymbol\beta}_\text{OLS} \)</span> will be inconsistent.</p>
<p><span class="math display">\[\begin{align*}
\hat{\boldsymbol\beta}_\text{OLS,ME} &amp;= \boldsymbol{\beta}+ (\mathbb{X}'\mathbb{X})^{-1}\mathbb{X}'\boldsymbol{\varepsilon}\\
     &amp; = \boldsymbol{\beta}+ (\mathbb{X}'\mathbb{X})^{-1}\mathbb{X}'(\boldsymbol{\varepsilon}- \mathbf u\boldsymbol{\beta})\\
     &amp; = \boldsymbol{\beta}+ (\mathbb{X}'\mathbb{X})^{-1}\mathbb{X}'\boldsymbol{\varepsilon}- (\mathbb{X}'\mathbb{X})^{-1}\mathbb{X}'\mathbf u\boldsymbol{\beta}\\
\mathop{\mathrm{plim}}\hat{\boldsymbol\beta}_\text{OLS,ME} &amp; = \boldsymbol{\beta}+ \mathop{\mathrm{plim}}(\mathbb{X}'\mathbb{X})^{-1}\mathbb{X}'\boldsymbol{\varepsilon}+ \mathop{\mathrm{plim}}(\mathbb{X}'\mathbb{X})^{-1}\mathbb{X}'\mathbf u\boldsymbol{\beta}\\
  &amp; = \boldsymbol{\beta}+ \mathop{\mathrm{plim}}(\mathbb{X}'\mathbb{X})^{-1}\mathbb{X}'\mathbf u\boldsymbol{\beta}&amp; (\mathop{\mathrm{plim}}\mathbb{X}'\boldsymbol{\varepsilon}= \mathbf{0})
\end{align*}\]</span></p>
<p>For <span class="math inline">\(j\neq 1\)</span> (there won’t be measurement error when <span class="math inline">\(j=1\)</span>, as this is just the regressor of 1 which gives the intercept) this simplifies to</p>
<p><span class="math display">\[ \mathop{\mathrm{plim}}\hat \beta_{\text{OLS,ME},j} = \beta_j \left(\frac{\text{Var}\left(X_j^*\right)}{\text{Var}\left(X_j^*\right) + \text{Var}\left(u_j^*\right)}\right).\]</span> This phenomenon is known as <strong><em>attenuation bias</em></strong>. The term in parentheses will always fall in the interval <span class="math inline">\((0,1)\)</span>, so <span class="math inline">\(\left\lvert\mathop{\mathrm{plim}}\hat \beta_{\text{OLS,ME},j}\right\rvert &lt; \left\lvert\boldsymbol{\beta}_j\right\rvert\)</span>, hence the name attentuation bias.</p>
</section>
<section id="an-updated-linear-model-identification-and-the-iv-estimator" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="an-updated-linear-model-identification-and-the-iv-estimator"><span class="header-section-number">8.2</span> An Updated Linear Model, Identification, and the IV estimator</h2>
<p>In general, if <span class="math inline">\(\text{E}\left[\mathbf{X}'\boldsymbol{\varepsilon}\right] \neq \mathbf{0}\)</span>, then <span class="math inline">\(\boldsymbol{\beta}\)</span> is not identified for the linear model <span class="math inline">\(\mathcal P_\text{LM}\)</span>. Estimation is a non-starter in this case. Even if we had the “perfect” estimate for <span class="math inline">\(\boldsymbol{\beta},\)</span> the parameter may map to multiple elements <span class="math inline">\(P_{\boldsymbol{\beta},\sigma^2}\in  \mathcal P_\text{LM}\)</span>, so it is impossible to determine which model value our data was drawn from. If we drop the assumption <span class="math inline">\(\text{E}\left[\mathbf{X}'\boldsymbol{\varepsilon}\right] \neq \mathbf{0}\)</span> from the linear model, then we’ll need to replace it with some additional assumptions/structure.</p>
<p>While <span class="math inline">\(\text{E}\left[\mathbf{X}'\boldsymbol{\varepsilon}\right] \neq \mathbf{0}\)</span>, <em>perhaps</em> it is the case that there exists some other random vector <span class="math inline">\(\mathbf{Z}\)</span> which does satisfy <span class="math inline">\(\text{E}\left[\mathbf{Z}'\boldsymbol{\varepsilon}\right] = \mathbf{0}\)</span>. Is this helpful – no. For a given model with some structural error <span class="math inline">\(\boldsymbol{\varepsilon}\)</span>, there are nearly infinite candidates for <span class="math inline">\(\mathbf{Z}\)</span> which satisfy this. Consider the model <span class="math display">\[\log(income_i) = \beta_0 + \beta_1\cdot educ_i + \varepsilon_i,\]</span> where <span class="math inline">\(\varepsilon\)</span> are unobserved factors impacting income. What are some random variables <span class="math inline">\(Z\)</span> which are uncorrelated with <span class="math inline">\(\varepsilon\)</span>. A ton! Weather during <span class="math inline">\(i\)</span>’s tenth birthday, <span class="math inline">\(i\)</span>’s first concert, <span class="math inline">\(i\)</span>’s favorite flavor of ice cream, etc. There is an endless list of random variables that are so completely irrelevant to someone’s income, that they are uncorrelated with <span class="math inline">\(\varepsilon\)</span>. This is why <span class="math inline">\(\text{E}\left[\mathbf{Z}'\boldsymbol{\varepsilon}\right] = \mathbf{0}\)</span> is sometimes read as “<span class="math inline">\(\mathbf{Z}\)</span> is orthogonal to <span class="math inline">\(\boldsymbol{\varepsilon}\)</span>.” Not only does it hold in the mathematical sense of the word, but it also holds in the colloquial sense of the word meaning “has nothing to do with.” What we want is <span class="math inline">\(\mathbf{Z}\)</span> to also be correlated with <span class="math inline">\(\mathbf{X}\)</span>, such that <span class="math inline">\(\mathbf{Z}\)</span> is a sort of proxy/surrogate for <span class="math inline">\(\mathbf{X}\)</span> with no direct impact on <span class="math inline">\(\mathbf{Y}\)</span>. We’ll now generalize the linear model to introduce this set of variables <span class="math inline">\(\mathbf{Z}\)</span> in lieu of the assumption <span class="math inline">\(\text{E}\left[\mathbf{X}'\boldsymbol{\varepsilon}\right] \neq \mathbf{0}\)</span>.</p>
<div id="def-" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 8.1</strong></span> The <span style="color:red"><strong><em>(linear) instrumental variables (IV) model</em></strong></span> is defined as <span class="math inline">\(\mathcal P_\text{IV} = \{P_{\boldsymbol{\beta},\sigma^2} \mid \boldsymbol{\beta}\in \mathbb R^{K}, \sigma^2\in\mathbb R\}\)</span>, where <span class="math display">\[\begin{align*}

P_{\boldsymbol{\beta},\sigma^2} &amp;= \left\{F_{\mathbb{X},\mathbb{Z},\boldsymbol{\varepsilon}} \middle|  \begin{matrix}Y= \mathbb{X}\boldsymbol{\beta}+\boldsymbol{\varepsilon}, \ \text{E}\left[\boldsymbol{\varepsilon}'\boldsymbol{\varepsilon}\mid \mathbf{X}\right]=\sigma^2\mathbf I,\ f_{(\mathbb{X},\mathbb{Z})}=\textstyle\prod_{i=1}^n f_{(\mathbf{X}_i,\mathbf{Z}_i)},\\ \text{rank}\left(\text{E}\left[\mathbf{Z}'\mathbf{X}\right]\right) = K,\ \text{E}\left[\boldsymbol{\varepsilon}\mid \mathbb{X}\right] =\boldsymbol \eta,\  \text{E}\left[\boldsymbol{\varepsilon}\mid \mathbb{Z}\right] = \mathbf{0},\ \text{E}\left[\mathbf{Z}'\mathbf{X}\right] \neq \mathbf{0}\end{matrix} \right\},\\
\mathbb{X}&amp; = [\mathbf{X}_1, \cdots, \mathbf{X}_j, \cdots \mathbf{X}_K] = [\mathbf{X}_1, \cdots, \mathbf{X}_i, \cdots \mathbf{X}_n]',\\
\mathbb{Z}&amp; = [\mathbf{Z}_1, \cdots, \mathbf{Z}_j, \cdots \mathbf{Z}_K] = [\mathbf{Z}_1, \cdots, \mathbf{Z}_i, \cdots \mathbf{Z}_n]',\\
\dim(\mathbf{Z}) &amp; = \dim(\mathbf{X}) = K\\
\mathbf{Y}&amp; = [Y_1, \ldots, Y_n].
\end{align*}\]</span> We refer to the random vector <span class="math inline">\(\mathbf{Z}\)</span> as <span style="color:red"><strong><em>instrumental variables (IVs)</em></strong></span>. We have assumed that <span class="math inline">\(\text{E}\left[\boldsymbol{\varepsilon}\mid \mathbb{Z}\right] = \mathbf{0}\)</span>, which subsumes the assumption that <span class="math inline">\(\text{E}\left[\mathbf{Z}'\boldsymbol{\varepsilon}\right] = \mathbf{0}\)</span>. The assumption that <span class="math inline">\(\mathbf{Z}\)</span> is (weakly) exogenous (uncorrelated with <span class="math inline">\(\boldsymbol{\varepsilon}\)</span>) is known as <span style="color:red"><strong><em>instrumental validity</em></strong></span>, while the assumption that <span class="math inline">\(\text{E}\left[\mathbf{X}'\mathbf{Z}\right] \neq \mathbf{0}\)</span> (<span class="math inline">\(\mathbf{Z}\)</span> and <span class="math inline">\(\mathbf{X}\)</span> are correlated) is known as the <span style="color:red"><strong><em>relevance condition</em></strong></span>. The assumption that <span class="math inline">\(\text{E}\left[\mathbf{Z}'\boldsymbol{\varepsilon}\right] = \mathbf{0}\)</span> is also sometimes known as the <span style="color:red"><strong><em>exclusion restriction</em></strong></span> (<span class="math inline">\(\mathbf{Z}\)</span> is excluded from the determinants of <span class="math inline">\(Y\)</span>). Finally, we sometimes refer to <span class="math inline">\(\text{rank}\left(\text{E}\left[\mathbf{Z}'\mathbf{X}\right]\right) = K\)</span> as the <span style="color:red"><strong><em>rank condition</em></strong></span>.</p>
</div>
<p>Instrumental validity and the relevance condition are usually written as: <span class="math display">\[\begin{align*}
\text{Cov}\left(\mathbf{Z},\boldsymbol{\varepsilon}\right)&amp; = \mathbf{0},\\
\text{Cov}\left(\mathbf{X}, \mathbf{Z}\right) &amp;\neq \mathbf{0}.
\end{align*}\]</span> <em>Technically</em>, this is not 100% accurate. The relevance condition is actually a combination of <span class="math inline">\(\text{rank}\left(\text{E}\left[\mathbf{Z}'\mathbf{X}\right]\right) = K\)</span> and <span class="math inline">\(\text{Cov}\left(\mathbf{X}, \mathbf{Z}\right)\neq \mathbf{0}\)</span>. As highlighted by <span class="citation" data-cites="wooldridge2010econometric">Wooldridge (<a href="#ref-wooldridge2010econometric" role="doc-biblioref">2010</a>)</span>, the relevance condition is not “regressors and instruments are uncorrelated”. Instead, it is “instruments and endogenous regressors are partially correlated holding the exogenous regressors fixed.” In other words, the linear projection of the instruments onto all regressors has nontrivial coefficients for endogenous regressors. This is equivalent to <span class="math inline">\(\text{rank}\left(\text{E}\left[\mathbf{Z}'\mathbf{X}\right]\right) = K\)</span> and <span class="math inline">\(\text{Cov}\left(\mathbf{X}, \mathbf{Z}\right)\neq \mathbf{0}\)</span>.</p>
<p>Even if one regressor is endogenous, <span class="math inline">\(\text{E}\left[X_j\boldsymbol{\varepsilon}\right] \neq \mathbf{0}\)</span> for some <span class="math inline">\(j\)</span>, then <span class="math inline">\(\text{E}\left[\mathbf{X}'\boldsymbol{\varepsilon}\right] \neq \mathbf{0}\)</span>. If this is the case, we can simply define a portion of <span class="math inline">\(\mathbf{Z}\)</span> to be the exogenous regressors. Formally, if <span class="math inline">\([X_1,\ldots, X_J]\)</span> are weakly exogenous while <span class="math inline">\([X_{J+1}, \ldots, X_K]\)</span> are endogenous, then define <span class="math inline">\(Z_1 = X_1,\ldots ,Z_J=X_j\)</span>.</p>
<div id="exm-spec1" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.3 (Linear Model as Special Case of IV Model)</strong></span> A special case of the linear IV model is the classical linear model. Just let <span class="math inline">\(\boldsymbol\eta = \mathbf{0}\)</span> and <span class="math inline">\(\mathbf{X}= \mathbf{Z}\)</span>. This fact can be written as <span class="math inline">\(\mathcal P_\text{LM}\subset \mathcal P_\text{IV}\)</span>.</p>
</div>
<p>Whenever we define a new model, we need to make sure our parameters are identified.</p>
<div id="thm-" class="theorem">
<p><span class="theorem-title"><strong>Theorem 8.1 (Identification of Linear IV Model)</strong></span> The linear IV model is identified as a result of the following assumptions: <span class="math inline">\(\text{E}\left[\mathbf{Z}'\boldsymbol{\varepsilon}\right] = \mathbf{0}\)</span>, <span class="math inline">\(\text{E}\left[\mathbf{X}'\mathbf{Z}\right] \neq \mathbf{0}\)</span>, and <span class="math inline">\(\text{rank}\left(\text{E}\left[\mathbf{Z}'\mathbf{X}\right]\right) = K\)</span>.</p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>First we will show <span class="math inline">\(\boldsymbol{\beta}\)</span> is identified. Let <span class="math inline">\(P_{\boldsymbol{\beta},\sigma^2} = P_{\boldsymbol{\beta}^*,\sigma^2}\)</span> for two elements of <span class="math inline">\(\mathcal P_\text{IV}\)</span>, and suppose for a contradiction that <span class="math inline">\(\boldsymbol{\beta}\neq\boldsymbol{\beta}^*\)</span>. We can begin by writing <span class="math inline">\(\boldsymbol{\beta}\)</span>: <span class="math display">\[\begin{align*}
&amp;\text{E}\left[\mathbf{Z}'\boldsymbol{\varepsilon}\right] = \mathbf{0}\\
\implies &amp; \text{E}\left[\mathbf{Z}'(Y-\mathbf{X}\boldsymbol{\beta})\right] = \mathbf{0}&amp; (\boldsymbol{\varepsilon}= (Y-\mathbf{X}\boldsymbol{\beta}))\\
\implies &amp; \text{E}\left[\mathbf{Z}'Y\right]-\boldsymbol{\beta}\text{E}\left[\mathbf{Z}'\mathbf{X}\right]= \mathbf{0}\\
\implies &amp; \text{E}\left[\mathbf{Z}'Y\right] = \boldsymbol{\beta}\text{E}\left[\mathbf{Z}'\mathbf{X}\right]\\
\end{align*}\]</span> By the definition of <span class="math inline">\(\mathcal P_\text{IV}\)</span>, the moments <span class="math inline">\(\text{E}\left[\mathbf{Z}'\mathbf{X}\right]\)</span> and <span class="math inline">\(\text{E}\left[\mathbf{Z}'Y\right]\)</span> are the same for the model values <span class="math inline">\(P_{\boldsymbol{\beta},\sigma^2}\)</span> and <span class="math inline">\(P_{\boldsymbol{\beta}^*,\sigma^2}\)</span>, so <span class="math inline">\(\boldsymbol{\beta}^*\)</span> must also satisfy <span class="math inline">\(\text{E}\left[\mathbf{Z}'Y\right] = \boldsymbol{\beta}\text{E}\left[\mathbf{Z}'\mathbf{X}\right]\)</span>. This contradicts the assumption that <span class="math inline">\(\text{rank}\left(\text{E}\left[\mathbf{Z}'\mathbf{X}\right]\right) = K\)</span>. If <span class="math inline">\(\boldsymbol{\beta}\)</span> is identified, then <span class="math inline">\(\sigma^2\)</span> is as well because we can write it in terms of <span class="math inline">\(\boldsymbol{\beta}\)</span>: <span class="math display">\[ \text{E}\left[(\mathbf{Y}-\mathbb{X}\boldsymbol{\beta})'(\mathbf{Y}-\mathbb{X}\boldsymbol{\beta})\mid \mathbf{X}\right]=\sigma^2\mathbf I.\]</span> <span style="color:white">space</span></p>
</div>
<p>So how do we estimate <span class="math inline">\(\boldsymbol{\beta}\)</span> for the model <span class="math inline">\(\mathcal P_\text{IV}\)</span>? If it wasn’t clear from the examples dealing with OVB and measurement error, the answer is not with <span class="math inline">\(\hat{\boldsymbol\beta}_\text{OLS} \)</span>.</p>
<div id="prp-" class="theorem proposition">
<p><span class="theorem-title"><strong>Proposition 8.1 (Inconsisteny of OLS)</strong></span> If <span class="math inline">\(P_{\boldsymbol{\beta},\sigma^2} \in \mathcal P_\text{IV}\)</span>, then <span class="math inline">\(\hat{\boldsymbol\beta}_\text{OLS} \)</span> is biased and inconsistent. In particular, <span class="math display">\[\begin{align*}
\text{E}\left[\hat{\boldsymbol\beta}_\text{OLS} \mid \mathbf{X}\right] &amp; = \boldsymbol{\beta}+ (\mathbb{X}'\mathbb{X})^{-1}\mathbb{X}\boldsymbol \eta \neq \boldsymbol{\beta},\\
\mathop{\mathrm{plim}}\hat{\boldsymbol\beta}_\text{OLS} &amp; = \boldsymbol{\beta}+ \text{E}\left[\mathbf{X}'\mathbf{X}\right]^{-1}\boldsymbol \gamma \neq \boldsymbol{\beta},\\
\end{align*}\]</span> where <span class="math inline">\(\text{E}\left[\boldsymbol{\varepsilon}\mid \mathbb{X}\right] =\boldsymbol \eta\)</span> and <span class="math inline">\(\text{E}\left[\mathbf{X}'\boldsymbol{\varepsilon}\right] = \boldsymbol \gamma\)</span>.</p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span><span class="math display">\[\begin{align*}
\text{E}\left[\hat{\boldsymbol\beta}_\text{OLS} \mid \mathbb{X}\right] &amp; = \text{E}\left[\boldsymbol{\beta}+(\mathbb{X}'\mathbb{X})^{-1}\mathbb{X}'\boldsymbol{\varepsilon}\mid \mathbb{X}\right]\\
&amp; = \boldsymbol{\beta}+ (\mathbb{X}'\mathbb{X})^{-1}\mathbb{X}'\text{E}\left[\boldsymbol{\varepsilon}\mid \mathbb{X}\right]\\
&amp; = \boldsymbol{\beta}+ (\mathbb{X}'\mathbb{X})^{-1}\mathbb{X}'\boldsymbol \eta\\
\mathop{\mathrm{plim}}\hat{\boldsymbol\beta}_\text{OLS} &amp; = \boldsymbol{\beta}+ \mathop{\mathrm{plim}}\left[\left(\frac{1}{n}\sum_{i=1}^n\mathbf{X}_i'\mathbf{X}_i\right)^{-1}\left(\frac{1}{n}\sum_{i=1}^n\mathbf{X}_i'\varepsilon_i\right)\right]\\
&amp; = \boldsymbol{\beta}+ \mathop{\mathrm{plim}}\left(\frac{1}{n}\sum_{i=1}^n\mathbf{X}_i'\mathbf{X}_i\right)^{-1}\mathop{\mathrm{plim}}\left(\frac{1}{n}\sum_{i=1}^n\mathbf{X}_i'\varepsilon_i\right) &amp; (\text{Slutsky's Theorem})\\
&amp; = \boldsymbol{\beta}+ \text{E}\left[\mathbf{X}'\mathbf{X}\right]^{-1}\text{E}\left[\mathbf{X}'\boldsymbol{\varepsilon}\right] &amp; (\text{LLN})\\
&amp; = \boldsymbol{\beta}+ \text{E}\left[\mathbf{X}'\mathbf{X}\right]^{-1}\boldsymbol \gamma
\end{align*}\]</span> <span style="color:white">space</span></p>
</div>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.4</strong></span> Let’s verify that <span class="math inline">\(\hat{\boldsymbol\beta}_\text{OLS} \)</span> is inconsistent. Suppose <span class="math inline">\(\mathbb{X}= (\mathbf 1, X)\)</span> where <span class="math inline">\((X,\varepsilon)\overset{iid}{\sim}N(\boldsymbol \mu, \boldsymbol{\Sigma})\)</span> for <span class="math inline">\(\boldsymbol \mu = [0,1]'\)</span> <span class="math display">\[\boldsymbol{\Sigma}= \begin{bmatrix}5&amp;2\\2&amp;1  \end{bmatrix}.\]</span> We have <span class="math display">\[\begin{align*}
\text{E}\left[X\varepsilon\right] &amp;= \text{Cov}\left(X,\varepsilon\right) + \underbrace{\text{E}\left[X\right]}_0\underbrace{\text{E}\left[\varepsilon\right]}_1 = 2.
\end{align*}\]</span> Therefore <span class="math display">\[\begin{align*}
\boldsymbol \gamma &amp;= \text{E}\left[\mathbb{X}'\boldsymbol{\varepsilon}\right] = \begin{bmatrix}\text{E}\left[1\boldsymbol{\varepsilon}\right]\\\text{E}\left[X\boldsymbol{\varepsilon}\right] \end{bmatrix} = \begin{bmatrix}1\\2 \end{bmatrix}
\end{align*}\]</span></p>
<p>If we draw realizations <code>x</code> and <code>e</code> of <span class="math inline">\((X,\varepsilon)\)</span>, we should find that <code>colMeans(X*e)</code> should be approximately <span class="math inline">\([1,2]'\)</span> by the LLN.</p>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-6_b477fb75996527834639d7abcd2a1970">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"functions/sim_endog_linear_model.r"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>Sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">sim_endog_linear_model</span>(</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fl">1e5</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_vec =</span> <span class="fu">c</span>(rmvnorm),</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_params_list =</span> <span class="fu">list</span>(<span class="fu">list</span>(mu, Sigma))</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="fu">colMeans</span>(results<span class="sc">$</span>X<span class="sc">*</span>results<span class="sc">$</span>e)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      x1       x2 
1.001027 2.008658 </code></pre>
</div>
</div>
<p>Let’s now calculate <span class="math inline">\(\mathop{\mathrm{plim}}\hat{\boldsymbol\beta}_\text{OLS} \)</span>. <span class="math display">\[\begin{align*}
\text{E}\left[\mathbf{X}'\mathbf{X}\right]^{-1} &amp;= \begin{bmatrix}\text{E}\left[1\right] &amp; \text{E}\left[X\right] \\ \text{E}\left[X\right] &amp; \text{E}\left[X^2\right] \end{bmatrix}^{-1} = \begin{bmatrix}1 &amp; 0 \\ 0 &amp; \text{Var}\left(X\right) \end{bmatrix}^{-1} = \begin{bmatrix}1 &amp; 0 \\ 0 &amp; 5 \end{bmatrix}^{-1}  =  \begin{bmatrix}1 &amp; 0 \\ 0 &amp; 0.2 \end{bmatrix}\\
\mathop{\mathrm{plim}}\hat{\boldsymbol\beta}_\text{OLS} &amp; = \boldsymbol{\beta}+ \text{E}\left[\mathbf{X}'\mathbf{X}\right]^{-1}\boldsymbol \gamma= \boldsymbol{\beta}+ \begin{bmatrix}1 &amp; 0 \\ 0 &amp; 0.2 \end{bmatrix}\begin{bmatrix}1\\2 \end{bmatrix}= \boldsymbol{\beta}+ \begin{bmatrix}1\\0.4 \end{bmatrix}
\end{align*}\]</span> If we let <span class="math inline">\(\boldsymbol{\beta}= [1,2']\)</span> we should see our estimates converge to <span class="math inline">\([2, 2.4]'\)</span> as <span class="math inline">\(n\to\infty\)</span>.</p>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-7_4fb06b749d47ce3f21e6d15cf5c42390">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>iter <span class="ot">&lt;-</span> <span class="cf">function</span>(k, model){</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> model<span class="sc">$</span>observed_data <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">&lt;=</span> k) <span class="sc">%&gt;%</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x2, <span class="at">data =</span> .) <span class="sc">%&gt;%</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>      term, </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>      estimate</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">sample_size =</span> k) <span class="sc">%&gt;%</span>  </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="cf">function</span>(n_vals, n, beta, dist_vec, dist_params_list, t){</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">sim_endog_linear_model</span>(beta, n, dist_vec, dist_params_list)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> n_vals <span class="sc">%&gt;%</span> </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(iter, <span class="at">model =</span> model) <span class="sc">%&gt;%</span> </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">iter_num =</span> t) </span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>outer_sim <span class="ot">&lt;-</span> <span class="cf">function</span>(N, n_vals, n, beta, dist_vec, dist_params_list){</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>N <span class="sc">%&gt;%</span> </span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(sim, <span class="at">n_vals =</span> n_vals, <span class="at">n =</span> n, <span class="at">beta =</span> beta, <span class="at">dist_vec =</span> dist_vec, <span class="at">dist_params_list =</span> dist_params_list) <span class="sc">%&gt;%</span> </span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">outer_sim</span>(</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fl">1e3</span>, </span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_vals =</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>)<span class="sc">*</span><span class="dv">20</span>, </span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fl">1e3</span>, </span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_vec =</span> <span class="fu">c</span>(rmvnorm),</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_params_list =</span> <span class="fu">list</span>(<span class="fu">list</span>(mu, Sigma))</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-fig.asp="0.7" data-hash="endog_cache/html/fig-plot702_457f7605bee28eb7f80b616cd67edf0b">
<details class="code-fold">
<summary>Show code which generates figure</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>results <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">True Value</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">case_when</span>(</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>      term <span class="sc">==</span> <span class="st">"(Intercept)"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>      term <span class="sc">==</span> <span class="st">"x2"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Limit</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">case_when</span>(</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>      term <span class="sc">==</span> <span class="st">"(Intercept)"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>      term <span class="sc">==</span> <span class="st">"x2"</span> <span class="sc">~</span> <span class="fl">2.4</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">term =</span> <span class="fu">case_when</span>(</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>      term <span class="sc">==</span> <span class="st">"(Intercept)"</span> <span class="sc">~</span> <span class="st">"β1"</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>      term <span class="sc">==</span> <span class="st">"x2"</span> <span class="sc">~</span> <span class="st">"β2"</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Estimate =</span> estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">!</span><span class="fu">c</span>(term, sample_size, iter_num)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">line_group =</span> <span class="fu">paste0</span>(iter_num, name)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(sample_size, value, <span class="at">color =</span> name)) <span class="sc">+</span> </span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> line_group, <span class="at">size =</span> name)) <span class="sc">+</span> </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>term) <span class="sc">+</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Sample Size, n"</span>, <span class="at">y =</span> <span class="st">"Estimates"</span>, <span class="at">color =</span><span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span> </span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">size=</span><span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot702" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-plot702-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="endog_files/figure-html/fig-plot702-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-plot702-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8.2: f
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>An interesting feature of this problem is that our estimator for the intercept term <span class="math inline">\(\beta_1\)</span> was inconsistent even though the corresponding regressor (the trivial random variable <span class="math inline">\(X_1 = 1\)</span>) is exogenous. In general, the inconsistency of <span class="math inline">\(\hat{\boldsymbol\beta}_\text{OLS} \)</span> in the presence of endogeneity is not limited to the parameters associated with endogenous variables, and will impact each parameter <span class="math inline">\(\beta_j\)</span>.</p>
<p>Instead of using <span class="math inline">\(\hat{\boldsymbol\beta}_\text{OLS} \)</span>, we need an estimator which makes use of the exogenous variables <span class="math inline">\(\mathbf{Z}\)</span>. There are several different ways to motivate this estimator, so we’ll go over four particularly approaches which reach the same conclusion.</p>
<ol type="1">
<li>For <span class="math inline">\(\mathcal P_\text{IV}\)</span> we can write the true population parameter as <span class="math inline">\(\boldsymbol{\beta}= \text{E}\left[\mathbf{Z}'\mathbf{X}\right]^{-1}\text{E}\left[\mathbf{Z}'Y\right]\)</span>. We can appeal to the analogy-principle here just like we did when deriving <span class="math inline">\(\hat{\boldsymbol\beta}_\text{OLS} \)</span>. It stands to reason that the estimator defined by the analogous samples will provide consistent estimates of <span class="math inline">\(\boldsymbol{\beta}\)</span> by the LLN. This estimator is <span class="math display">\[\hat {\boldsymbol{\beta}}= \left(\frac{1}{n}\sum_{i=1}^n\mathbf{Z}_i'\mathbf{X}_i\right)^{-1}\left(\frac{1}{n}\sum_{i=1}^n\mathbf{Z}_iY_i\right) = (\mathbb{Z}'\mathbb{X})^{-1}\mathbb{Z}'\mathbf{Y}.\]</span></li>
<li>Another way of tackling the problem relates to marginal effects and is presented by <span class="citation" data-cites="cameron2005microeconometrics">Cameron and Trivedi (<a href="#ref-cameron2005microeconometrics" role="doc-biblioref">2005</a>)</span>. This will be a little informal and is only to build intuition. In an abuse of notation, we’ll write marginal effects as <span class="math inline">\(\frac{\partial Y}{\partial \mathbf{X}}\)</span>. Ideally, we want <span class="math inline">\(\beta_j = \frac{\partial Y}{\partial X_j}\)</span> for each <span class="math inline">\(j\)</span>. This way, when we estimate <span class="math inline">\(\boldsymbol{\beta}\)</span>, we estimate the marginal effect of <span class="math inline">\(\mathbf{X}\)</span> on <span class="math inline">\(Y\)</span>. Unfortunately, we cannot estimate this directly with <span class="math inline">\(\mathbf{X}\)</span> as <span class="math display">\[ \frac{\partial Y}{\partial X_j} = \beta_j + \frac{\partial \varepsilon}{\partial X_j} \implies \beta_j \neq \frac{\partial Y}{\partial X_j}.\]</span> If we appeal to the chain rule, we can vary <span class="math inline">\(X_j\)</span> via our instruments <span class="math inline">\(\mathbf{Z}\)</span>: <span class="math display">\[\begin{align*}
&amp;\frac{\partial Y}{\partial \mathbf{Z}} = \frac{\partial Y}{\partial X_j} \frac{\partial X_j}{\partial \mathbf{Z}} \\
\implies &amp; \frac{\partial Y}{\partial X_j} = \frac{\partial Y/\partial \mathbf{Z}}{\partial X_j/\partial \mathbf{Z}}
\end{align*}\]</span> where <span class="math inline">\(\frac{\partial Y}{\partial \mathbf{Z}}\)</span> holds <span class="math inline">\(\varepsilon\)</span> constant as <span class="math inline">\(\text{Cov}\left(\mathbf{Z}, \boldsymbol{\varepsilon}\right) = \mathbf{0}\)</span>. The marginal effects <span class="math inline">\(\frac{\partial X_j}{\partial \mathbf{Z}}\)</span> and <span class="math inline">\(\frac{\partial Y}{\partial \mathbf{Z}}\)</span> correspond to the parameters in the linear projection models of <span class="math inline">\(\mathbf{Z}\)</span> on <span class="math inline">\(X_j\)</span> and <span class="math inline">\(Y\)</span>.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> These parameters are given by OLS estimates <span class="math inline">\((\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}\mathbf{X}_j\)</span> and <span class="math inline">\((\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}\mathbf{Y}\)</span>, respectively, so <span class="math display">\[ \hat\beta_j = \frac{(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbf{Y}}{(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}\mathbf{X}_j}.\]</span> If we do this for all regressors <span class="math inline">\(\mathbf{X}\)</span>, then <span class="math display">\[ \hat{\boldsymbol{\beta}} = \frac{(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbf{Y}}{(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}\mathbb{X}} =  (\mathbb{Z}'\mathbb{X})^{-1}\mathbb{Z}'\mathbf{Y}\]</span></li>
<li>We can take a graphical approach given by <span class="citation" data-cites="pearl2009causality">Pearl (<a href="#ref-pearl2009causality" role="doc-biblioref">2009</a>)</span> with the simple IV model with one endogenous regressor <span class="math inline">\(X\)</span> and one instrument <span class="math inline">\(Z\)</span>. Suppose we have <span class="math inline">\(Y = \beta_1 + \beta_2 X + \varepsilon\)</span>, where <span class="math inline">\(\text{Cov}\left(X,\varepsilon\right) \neq 0\)</span>, along with <span class="math inline">\(\text{Cov}\left(Z,X\right) \neq 0\)</span> and <span class="math inline">\(\text{Cov}\left(Z,\varepsilon\right) = 0\)</span> for some instrument <span class="math inline">\(Z\)</span>. These relationships can be illustrated in the form of a directed acyclic graph (DAG).</li>
</ol>
<div class="cell" data-layout-align="center" data-fig.asp="0.5" data-hash="endog_cache/html/fig-plot703_8313c7899076d0a039ceedeb8025473c">
<details class="code-fold">
<summary>Show code which generates figure</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"figures/iv_dag.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot703" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-plot703-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/iv_dag.png" class="img-fluid quarto-figure quarto-figure-center figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-plot703-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8.3: f
</figcaption>
</figure>
</div>
</div>
</div>
<p>We can think of the paths which illustrate causation as being multiplicative in the sense that <span class="math inline">\(\text{Cov}\left(Z,X\right)\cdot \beta_2 = \text{Cov}\left(Z,Y\right)\)</span>, where <span class="math inline">\(\beta_2\)</span> is a “conversion rate” between changes in <span class="math inline">\(X\)</span> via <span class="math inline">\(Z\)</span> and changes in <span class="math inline">\(Y\)</span> via <span class="math inline">\(Z\)</span> (just like the chain rule approach). This implies <span class="math inline">\(\beta_2 = \text{Cov}\left(Z,Y\right)/\text{Cov}\left(Z,X\right)\)</span>, so <span class="math display">\[ \hat\beta_2 = \frac{\widehat{\text{Cov}}(Z,Y)}{\widehat{\text{Cov}}(Z,X)}.\]</span> This happens to be a special case of <span class="math inline">\(\hat{\boldsymbol{\beta}}=  (\mathbb{Z}'\mathbb{X})^{-1}\mathbb{Z}'\mathbf{Y}\)</span>.</p>
<ol start="4" type="1">
<li>Another approach in the context of the simple linear model takes advantage of a simple substitution. <span class="math display">\[ \text{Cov}\left(Y,Z\right) = \text{Cov}\left(\beta_1 + \beta_2 X + \varepsilon, Z\right) = \underbrace{\text{Cov}\left(\beta_1, Z\right)}_0 + \beta_2\text{Cov}\left(X,Z\right) + \underbrace{\text{Cov}\left(Z,\varepsilon\right)}_0 = \beta_2\text{Cov}\left(X,Z\right).\]</span> This is the same result we arrived at using the DAG.</li>
</ol>
<p>With all roads leading to Rome, we can define this estimator.</p>
<div id="def-" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 8.2</strong></span> The <span style="color:red"><strong><em>instrumental variables (IV) estimator</em></strong></span> is defined as <span class="math display">\[\begin{align*}
\hat{\boldsymbol\beta}_\text{IV} (\mathbb{X},\mathbb{Z},\mathbf{Y})= (\mathbb{Z}'\mathbb{X})^{-1}(\mathbb{Z}'\mathbf{Y})= \left(\frac{1}{n}\sum_{i=1}^n\mathbf{Z}_i'\mathbf{X}_i\right)^{-1}\left(\frac{1}{n}\sum_{i=1}^n\mathbf{Z}_iY_i\right)
\end{align*}\]</span> An realization of this estimator (an estimate) is <span class="math display">\[\begin{align*}
\hat{\mathbf b}_\text{IV} = \hat{\boldsymbol{\beta}}_\text{IV}(\mathbf{X},\mathbf{Z},\mathbf{y}) &amp;= (\mathbf{Z}'\mathbf{X})^{-1}(\mathbf{Z}'\mathbf{y})= \left(\frac{1}{n}\sum_{i=1}^n\mathbf{z}_i'\mathbf{z}_i\right)^{-1}\left(\frac{1}{n}\sum_{i=1}^n\mathbf{z}_iy_i\right)
\end{align*}\]</span> and will exist when the inverse <span class="math inline">\((\mathbf{Z}'\mathbf{X})^{-1}\)</span> exists.</p>
</div>
<div id="exm-refex" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.5</strong></span> Suppose <span class="math inline">\((X, Z, \varepsilon) \sim N(\boldsymbol \mu,\boldsymbol{\Sigma})\)</span> where <span class="math display">\[\begin{align*}
\boldsymbol \mu &amp; = [10,10,0]',\\
\boldsymbol{\Sigma}&amp; = \begin{bmatrix}20 &amp; 5 &amp; 1\\5&amp;20&amp;0\\1&amp;0&amp;1 \end{bmatrix},
\end{align*}\]</span> and <span class="math inline">\(Y = 1 + 3X + \varepsilon\)</span>. Let’s simulate a sample of size <span class="math inline">\(n=1000\)</span> from this model <span class="math inline">\(P_{\boldsymbol{\beta},\sigma^2} \in \mathcal P_\text{IV}\)</span>, and then calculate <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span>.</p>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-10_e1bc5db321f43d8d536e6feb5593477d">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">sim_endog_linear_model</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>),</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">1000</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_vec =</span> <span class="fu">c</span>(rmvnorm),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_params_list =</span> <span class="fu">list</span>(</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">0</span>), </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">5</span>,<span class="dv">1</span>, <span class="dv">5</span>,<span class="dv">20</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We should confirm that our drawn sample satisfies the assumptions of the IV model.</p>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-11_18f4e810906003d17aeef6698fab249e">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>results<span class="sc">$</span>sim_draws <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>x1, <span class="sc">-</span>z1) <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cov</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          x2          z2          e
x2 20.566712  6.06566300 1.05517270
z2  6.065663 21.94107444 0.04045295
e   1.055173  0.04045295 0.94783104</code></pre>
</div>
</div>
<p>Now let’s calculate <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span>, keeping in mind that <span class="math inline">\(\mathbb{Z}\)</span> is comprised of the instrument <span class="math inline">\(Z\)</span> <em>and</em> the exogenous random variable <span class="math inline">\(1\)</span> which gives the intercept term.</p>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-12_66855522af84b1ff3232c38850855d3c">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>IV <span class="ot">&lt;-</span> <span class="cf">function</span>(y, X, Z){</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  K <span class="ot">&lt;-</span> <span class="fu">ncol</span>(X)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">ncol</span>(Z) <span class="sc">!=</span> K) {<span class="fu">stop</span>(<span class="st">"K instruments required"</span>)}</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">det</span>(<span class="fu">t</span>(Z) <span class="sc">%*%</span> X) <span class="sc">==</span> <span class="dv">0</span>) {<span class="fu">stop</span>(<span class="st">"rank(Z'X) &lt; K"</span>)}</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">parameter =</span> <span class="fu">paste</span>(<span class="st">"β"</span>, <span class="dv">1</span><span class="sc">:</span>K, <span class="st">" estimate"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">estimate =</span> <span class="fu">as.numeric</span>(<span class="fu">solve</span>(<span class="fu">t</span>(Z) <span class="sc">%*%</span> X) <span class="sc">%*%</span> <span class="fu">t</span>(Z) <span class="sc">%*%</span> y)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="fu">IV</span>(results<span class="sc">$</span>y, results<span class="sc">$</span>X, results<span class="sc">$</span>Z) <span class="sc">%&gt;%</span> </span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">parameter</th>
<th style="text-align: right;">estimate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">β1 estimate</td>
<td style="text-align: right;">0.9794175</td>
</tr>
<tr class="even">
<td style="text-align: left;">β2 estimate</td>
<td style="text-align: right;">3.0066692</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="exm-spec2" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.6 (OLS is a Special Case of IV)</strong></span> In Example @ref(exm:spec1) we saw that <span class="math inline">\(\mathcal P_\text{LM}\subset\mathcal P_\text{IV}\)</span>. In the event <span class="math inline">\(P_{\boldsymbol{\beta},\sigma^2} \in \mathcal P_\text{LM}\)</span>, i.e <span class="math inline">\(\mathbb{Z}= \mathbb{X}\)</span> and , then <span class="math display">\[ \hat{\boldsymbol\beta}_\text{IV} = (\mathbb{Z}'\mathbb{X})^{-1}(\mathbb{Z}'\mathbf{Y}) = (\mathbb{X}'\mathbb{X})^{-1}(\mathbb{X}'\mathbf{Y}) = \hat{\boldsymbol\beta}_\text{OLS} .\]</span></p>
</div>
</section>
<section id="properties-of-the-iv-estimator" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="properties-of-the-iv-estimator"><span class="header-section-number">8.3</span> Properties of the IV Estimator</h2>
<p>One of the reasons OLS is so special is because we’re able to characterize its finite sample properties with the Gauss-Markov theorem. This is the exception rather than the rule when assessing estimators. In most cases, we can only arrive at tractable results in the form of an estimator’s asymptotic properties. Is this the case with <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span>? Let’s see if <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span> satisfies our “baseline” finite sample property of unbiasedness. <span class="math display">\[\begin{align*}
\text{E}\left[\hat{\boldsymbol\beta}_\text{IV} \right] &amp;= \text{E}\left[\text{E}\left[\hat{\boldsymbol\beta}_\text{IV} \mid \mathbb{X}, \mathbb{Z}\right]\right]\\
        &amp; =  \text{E}\left[\text{E}\left[(\mathbb{Z}'\mathbb{X})^{-1}(\mathbb{Z}'\mathbf{Y}) \mid \mathbb{X}, \mathbb{Z}\right]\right]\\
        &amp;=\text{E}\left[\text{E}\left[(\mathbb{Z}'\mathbb{X})^{-1}(\mathbb{Z}'(\mathbb{X}\boldsymbol{\beta}+ \boldsymbol{\varepsilon})) \mid \mathbb{X}, \mathbb{Z}\right]\right]\\
        &amp;=\boldsymbol{\beta}+ \text{E}\left[(\mathbb{Z}'\mathbb{X})^{-1}\mathbb{Z}'\text{E}\left[\boldsymbol{\varepsilon}\mid \mathbb{X}, \mathbb{Z}\right]\right]\\
        &amp; \neq \boldsymbol{\beta}
\end{align*}\]</span> In general, <span class="math inline">\(\text{E}\left[\boldsymbol{\varepsilon}\mid \mathbb{X}, \mathbb{Z}\right] \neq \mathbf{0}\)</span>, so <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span> has a bias.</p>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.7 (IV Estimator is Biased)</strong></span> Return to the model from Example @ref(exm:refex), but let <span class="math inline">\(n = 10\)</span>. If we simulate the bias of <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span> using 10,000 simulations, we can confirm that <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span> is biased.</p>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-13_757a6787f4ebd8800eb5a50c772b40ef">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>iter <span class="ot">&lt;-</span> <span class="cf">function</span>(beta, n, dist_vec, dist_params_list, t){</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">sim_endog_linear_model</span>(beta, n, dist_vec, dist_params_list)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">IV</span>(results<span class="sc">$</span>y, results<span class="sc">$</span>X, results<span class="sc">$</span>Z) <span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">iter_num =</span> t) <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cbind</span>(<span class="at">true_value =</span> beta)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="cf">function</span>(N, beta, n, dist_vec, dist_params_list){</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>N <span class="sc">%&gt;%</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(iter, <span class="at">beta =</span> beta, <span class="at">n =</span> n, <span class="at">dist_vec =</span> dist_vec, <span class="at">dist_params_list =</span> dist_params_list) <span class="sc">%&gt;%</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">sim</span>(</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fl">1e4</span>,</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>),</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">10</span>,</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_vec =</span> <span class="fu">c</span>(rmvnorm),</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_params_list =</span> <span class="fu">list</span>(</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">0</span>),</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">5</span>,<span class="dv">1</span>, <span class="dv">5</span>,<span class="dv">20</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>results <span class="sc">%&gt;%</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(parameter) <span class="sc">%&gt;%</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">bias =</span> <span class="fu">mean</span>(<span class="fu">abs</span>(estimate <span class="sc">-</span> true_value)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  parameter    bias
  &lt;chr&gt;       &lt;dbl&gt;
1 β1 estimate 20.7 
2 β2 estimate  1.95</code></pre>
</div>
</div>
<p>Okay, but is this really an issue? In most settings we would have a sample size much larger than <span class="math inline">\(n = 10\)</span>. Let’s repeat this experiment with <span class="math inline">\(n = 1000\)</span> and see what happens to our estimator’s bias.</p>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-14_b9a1a853363b2aebdcd9179497d50157">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">sim</span>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fl">1e4</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>),</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fl">1e3</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_vec =</span> <span class="fu">c</span>(rmvnorm),</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_params_list =</span> <span class="fu">list</span>(</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">0</span>),</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">5</span>,<span class="dv">1</span>, <span class="dv">5</span>,<span class="dv">20</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>results <span class="sc">%&gt;%</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(parameter) <span class="sc">%&gt;%</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">bias =</span> <span class="fu">mean</span>(<span class="fu">abs</span>(estimate <span class="sc">-</span> true_value))) <span class="sc">%&gt;%</span> </span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">parameter</th>
<th style="text-align: right;">bias</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">β1 estimate</td>
<td style="text-align: right;">0.2288429</td>
</tr>
<tr class="even">
<td style="text-align: left;">β2 estimate</td>
<td style="text-align: right;">0.0227246</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The bias has been reduced dramatically.</p>
</div>
<p>While <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span> is biased, it seems as if it is asymptotically unbiased. Instead of proving this directly, we’ll actually show that <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span> is root-N CAN, a sufficient condition for asymptotic unbiasedness. Before tackling that, let’s prove that <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span> is consistent directly. One of the reasons we opted to not estimate <span class="math inline">\(\boldsymbol{\beta}\)</span> via <span class="math inline">\(\hat{\boldsymbol\beta}_\text{OLS} \)</span> was that <span class="math inline">\(\hat{\boldsymbol\beta}_\text{OLS} \)</span> is not consistent for <span class="math inline">\(\mathcal P_\text{IV}\)</span>, so it shouldn’t be a surprise that <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span> is consistent.</p>
<div id="prp-" class="theorem proposition">
<p><span class="theorem-title"><strong>Proposition 8.2 (IV Estimator is Consistent)</strong></span> If <span class="math inline">\(P_{\boldsymbol{\beta},\sigma^2}\in \mathcal P_\text{IV}\)</span>, then <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \overset{p}{\to}\boldsymbol{\beta}\)</span>.</p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span><span class="math display">\[\begin{align*}
\hat{\boldsymbol\beta}_\text{IV} &amp;= \left(\frac{1}{n}\sum_{i=1}^n\mathbf{Z}_i'\mathbf{X}_i\right)^{-1}\left(\frac{1}{n}\sum_{i=1}^n\mathbf{Z}_iY_i\right)\\
    &amp; = \left(\frac{1}{n}\sum_{i=1}^n\mathbf{Z}_i'\mathbf{X}_i\right)^{-1}\left(\frac{1}{n}\sum_{i=1}^n\mathbf{Z}_i[\mathbf{X}_i\boldsymbol{\beta}+ \varepsilon_i]\right)\\
    &amp; = \underbrace{\left(\frac{1}{n}\sum_{i=1}^n\mathbf{Z}_i'\mathbf{X}_i\right)^{-1}\left(\frac{1}{n}\sum_{i=1}^n\mathbf{Z}_i'\mathbf{X}_i\right)}_1\boldsymbol{\beta}+ \left(\frac{1}{n}\sum_{i=1}^n\mathbf{Z}_i'\mathbf{X}_i\right)^{-1}\left(\frac{1}{n}\sum_{i=1}^n\mathbf{Z}_i'\varepsilon_i\right)\\
    &amp; = \boldsymbol{\beta}+ \left(\frac{1}{n}\sum_{i=1}^n\mathbf{Z}_i'\mathbf{X}_i\right)^{-1}\left(\frac{1}{n}\sum_{i=1}^n\mathbf{Z}_i'\varepsilon_i\right)\\
\mathop{\mathrm{plim}}\hat{\boldsymbol\beta}_\text{IV} &amp; = \boldsymbol{\beta}+ \mathop{\mathrm{plim}}\left(\frac{1}{n}\sum_{i=1}^n\mathbf{Z}_i'\mathbf{X}_i\right)^{-1}\cdot \mathop{\mathrm{plim}}\left(\frac{1}{n}\sum_{i=1}^n\mathbf{Z}_i'\varepsilon_i\right) &amp; (\text{Slutsky's theorem})\\
&amp; = \boldsymbol{\beta}+ \mathop{\mathrm{plim}}\left(\frac{1}{n}\sum_{i=1}^n\mathbf{Z}_i'\mathbf{X}_i\right)^{-1}\cdot \text{E}\left[\mathbf{Z}'\boldsymbol{\varepsilon}\right] &amp; (\text{LLN})\\
&amp; = \boldsymbol{\beta}+ \mathop{\mathrm{plim}}\left(\frac{1}{n}\sum_{i=1}^n\mathbf{Z}_i'\mathbf{X}_i\right)^{-1}\cdot \mathbf{0}&amp; (\text{E}\left[\mathbf{Z}'\boldsymbol{\varepsilon}\right] = \mathbf{0})\\
&amp; = \boldsymbol{\beta}
\end{align*}\]</span> <span style="color:white">space</span></p>
</div>
<div id="thm-" class="theorem">
<p><span class="theorem-title"><strong>Theorem 8.2 (IV Estimator is Root-n CAN)</strong></span> If <span class="math inline">\(P_{\boldsymbol{\beta}, \sigma^2} \in \mathcal P_\text{IV}\)</span>, then <span class="math display">\[\hat{\boldsymbol\beta}_\text{IV} \overset{a}{\sim}N\left(\boldsymbol{\beta}, \sigma^2\text{E}\left[\mathbb{Z}'\mathbb{X}\right]^{-1}\text{E}\left[\mathbb{Z}'\mathbb{Z}\right]\text{E}\left[\mathbb{X}'\mathbb{Z}\right]^{-1}\right) =  N\left(\boldsymbol{\beta}, \frac{\sigma^2}{n}\text{E}\left[\mathbf{Z}'\mathbf{X}\right]^{-1}\text{E}\left[\mathbf{Z}'\mathbf{Z}\right]\text{E}\left[\mathbf{X}'\mathbf{Z}\right]^{-1} \right)\]</span></p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>The proof is almost identical to that of Theorem @ref(thm:asymols).</p>
<p><span class="math display">\[\begin{align*}
\sqrt n(\hat{\boldsymbol\beta}_\text{IV} - \boldsymbol{\beta}) &amp; = \sqrt{n}\left[\boldsymbol{\beta}+ \left(\frac{1}{n}\sum_{i=1}^n\mathbf{Z}_i'\mathbf{X}_i\right)^{-1}\left(\frac{1}{n}\sum_{i=1}^n\mathbf{Z}_i'\varepsilon_i\right) - \boldsymbol{\beta}\right]\\
&amp; = \left(\frac{1}{n}\sum_{i=1}^n\mathbf{Z}_i'\mathbf{X}_i\right)^{-1}\sqrt{n}\left(\frac{1}{n}\sum_{i=1}^n\mathbf{Z}_i'\varepsilon_i - \mathbf{0}\right)\\
&amp; =\left(\frac{1}{n}\sum_{i=1}^n\mathbf{Z}_i'\mathbf{X}_i\right)^{-1}\sqrt{n}\left(\frac{1}{n}\sum_{i=1}^n\mathbf{Z}_i'\varepsilon_i - \text{E}\left[\mathbf{Z}_i\varepsilon_i\right] \right) &amp; (\text{E}\left[\mathbf{Z}'\varepsilon\right] = \mathbf{0}) \\
&amp; = \underbrace{\left(\frac{1}{n}\sum_{i=1}^n\mathbf{Z}_i'\mathbf{X}_i\right)^{-1}}_{\overset{p}{\to}\text{E}\left[\mathbf{Z}'\mathbf{X}\right]^{-1}} \underbrace{\sqrt{n}\left(\frac{1}{n}\sum_{i=1}^n\mathbf{Z}_i'\varepsilon_i - \text{E}\left[\mathbf{Z}_i\varepsilon_i\right] \right)}_{\overset{d}{\to}N\left(\text{E}\left[\mathbf{Z}_i\varepsilon_i\right], \text{Var}\left(\textstyle \sum \mathbf{X}_i\varepsilon_i\right)/n\right)} &amp; (\text{LLN and CLT})\\
&amp;\overset{d}{\to}\text{E}\left[\mathbf{Z}'\mathbf{X}\right]^{-1}\cdot N\left(\text{E}\left[\mathbf{Z}_i\varepsilon_i\right], \text{Var}\left(\textstyle \sum \mathbf{Z}_i\varepsilon_i\right)/n\right) &amp; (\text{Slutsky's Theorem})\\
&amp; = \text{E}\left[\mathbf{Z}'\mathbf{X}\right]^{-1}\cdot N\left(\mathbf{0}, \sigma^2\text{E}\left[\mathbf{Z}'\mathbf{Z}\right]\right) \\
&amp; = \text{E}\left[\mathbf{Z}'\mathbf{X}\right]^{-1}\cdot N\left(\mathbf{0}, \sigma^2\text{E}\left[\mathbf{Z}'\mathbf{Z}\right]\right)\\
&amp; = N\left(\mathbf{0}, \text{E}\left[\mathbf{Z}'\mathbf{X}\right]^{-1}\sigma^2\text{E}\left[\mathbf{Z}'\mathbf{Z}\right]\left[\text{E}\left[\mathbf{Z}'\mathbf{X}\right]^{-1}\right]'\right)\\
&amp; = N\left(\mathbf{0}, \text{E}\left[\mathbf{Z}'\mathbf{X}\right]^{-1}\sigma^2\text{E}\left[\mathbf{Z}'\mathbf{Z}\right]\text{E}\left[\mathbf{X}'\mathbf{Z}\right]^{-1}\right).
\end{align*}\]</span> This implies that <span class="math display">\[\hat{\boldsymbol\beta}_\text{IV} \overset{a}{\sim}N\left(\boldsymbol{\beta}, \frac{\sigma^2}{n}\text{E}\left[\mathbf{Z}'\mathbf{X}\right]^{-1}\text{E}\left[\mathbf{Z}'\mathbf{Z}\right]\text{E}\left[\mathbf{X}'\mathbf{Z}\right]^{-1} \right).\]</span> If desired, we can write the asymptotic variance in terms of matrices <span class="math inline">\(\mathbb{X}\)</span> and <span class="math inline">\(\mathbb{Z}\)</span>: <span class="math display">\[\begin{align*}
\text{Avar}\left(\hat{\boldsymbol\beta}_\text{IV} \right) &amp; = \frac{\sigma^2}{n}\text{E}\left[\mathbf{Z}'\mathbf{X}\right]^{-1}\text{E}\left[\mathbf{Z}'\mathbf{Z}\right]\text{E}\left[\mathbf{X}'\mathbf{Z}\right]^{-1}\\
&amp; = \frac{\sigma^2}{n}\left[\frac{\text{E}\left[\mathbb{Z}'\mathbb{X}\right]}{n}\right]^{-1}\left[\frac{\text{E}\left[\mathbb{Z}'\mathbb{Z}\right]}{n}\right]\left[\frac{\text{E}\left[\mathbb{X}'\mathbb{Z}\right]}{n}\right]^{-1} \\
&amp; = n^2\cdot\frac{1}{n}\cdot\frac{\sigma^2}{n}\text{E}\left[\mathbb{Z}'\mathbb{X}\right]^{-1}\text{E}\left[\mathbb{Z}'\mathbb{Z}\right]\text{E}\left[\mathbb{X}'\mathbb{Z}\right]^{-1}\\
&amp; = \sigma^2\text{E}\left[\mathbb{Z}'\mathbb{X}\right]^{-1}\text{E}\left[\mathbb{Z}'\mathbb{Z}\right]\text{E}\left[\mathbb{X}'\mathbb{Z}\right]^{-1}
\end{align*}\]</span> <span style="color:white">space</span></p>
</div>
<div id="cor-" class="theorem corollary">
<p><span class="theorem-title"><strong>Corollary 8.1 (IV Estimator is Asymptotically Unbiased)</strong></span> If <span class="math inline">\(P_{\boldsymbol{\beta}, \sigma^2} \in \mathcal P_\text{IV}\)</span>, then <span class="math display">\[ \lim_{n\to\infty}\text{Bias}(\hat{\boldsymbol\beta}_\text{IV} ) = 0.\]</span></p>
</div>
<p>In order to appeal to the asymptotic distribution of <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span> to perform inference, we need a consistent estimator of the asymptotic variance. Fortunately, we can take nearly the same exact approach we took with <span class="math inline">\(\hat{\boldsymbol\beta}_\text{OLS} \)</span>.</p>
<div id="prp-" class="theorem proposition">
<p><span class="theorem-title"><strong>Proposition 8.3 (Estimation of IV Variance)</strong></span> Define the estimator <span class="math display">\[\begin{align*}
S^2 &amp;=  \frac{\hat{\mathbf{e}}'\hat{\mathbf{e}}}{n-K}\\
\hat{\mathbf{e}} &amp;= \mathbf{Y}- \mathbb{X}\hat{\boldsymbol\beta}_\text{IV}
\end{align*}\]</span> in the context of the linear IV model. Then:</p>
<ol type="1">
<li><span class="math inline">\(S^2\)</span> is an unbiased for <span class="math inline">\(\text{Var}\left(\boldsymbol{\varepsilon}\mid\mathbf{X}\right) = \sigma^2\)</span>.</li>
<li><span class="math inline">\(S^2\)</span> is a consistent estimator <span class="math inline">\(\text{Var}\left(\boldsymbol{\varepsilon}\mid\mathbf{X}\right) = \sigma^2\)</span>.</li>
<li>The estimator <span class="math inline">\(\widehat{\text{Avar}}(\hat{\boldsymbol\beta}_\text{IV} ) = S^2(\mathbb{Z}'\mathbb{X})^{-1}(\mathbb{Z}'\mathbb{Z})(\mathbb{X}'\mathbb{Z})^{-1}\)</span> is a consistent estimator for <span class="math inline">\({\text{Avar}}(\hat{\boldsymbol\beta}_\text{IV} )\)</span>.</li>
</ol>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>The proof is nearly identical to that of Proposition @ref(prp:olsvar).</p>
</div>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.8 (Coding Exercise)</strong></span> R has no base function which implements <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span>, so let’s write our own. For reference, we can compare our results with those given by <code>ivreg()</code> from the <code>AER</code> (applied econometrics in R) package.</p>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-15_fcc5f3453c079cf42db509748ffbc534">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>IV <span class="ot">&lt;-</span> <span class="cf">function</span>(y, X, Z){</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#determine dimensions, perform IV</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(y)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  K <span class="ot">&lt;-</span> <span class="fu">coalesce</span>(<span class="fu">ncol</span>(X), <span class="dv">1</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">coalesce</span>(<span class="fu">ncol</span>(Z), <span class="dv">1</span>) <span class="sc">!=</span> K) {<span class="fu">stop</span>(<span class="st">"K instruments required"</span>)}</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">det</span>(<span class="fu">t</span>(Z) <span class="sc">%*%</span> X) <span class="sc">==</span> <span class="dv">0</span>) {<span class="fu">stop</span>(<span class="st">"rank(Z'X) &lt; K"</span>)}</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  hat_beta <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">t</span>(Z) <span class="sc">%*%</span> X) <span class="sc">%*%</span> <span class="fu">t</span>(Z) <span class="sc">%*%</span> y </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#use IV estimates to calculate residuals and estimate SEs</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> (y<span class="sc">-</span>X <span class="sc">%*%</span> hat_beta)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  S2 <span class="ot">&lt;-</span> ((<span class="fu">t</span>(res) <span class="sc">%*%</span> res)<span class="sc">/</span>(n <span class="sc">-</span> K)) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>() </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  var_hat <span class="ot">&lt;-</span> (S2) <span class="sc">*</span>  <span class="fu">solve</span>(<span class="fu">t</span>(Z) <span class="sc">%*%</span> X) <span class="sc">%*%</span> (<span class="fu">t</span>(Z) <span class="sc">%*%</span> Z) <span class="sc">%*%</span> <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> Z) </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  se_hat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(var_hat))</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#t-stat, confidence intervals, p values</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  t <span class="ot">&lt;-</span> hat_beta<span class="sc">/</span>se_hat</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  lower_CI <span class="ot">&lt;-</span> hat_beta <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>)<span class="sc">*</span>se_hat</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  upper_CI <span class="ot">&lt;-</span> hat_beta <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>)<span class="sc">*</span>se_hat</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  p_val <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pt</span>(t, n<span class="sc">-</span>K))</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">#combine everything into one table to return</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">parameter =</span> <span class="fu">paste0</span>(<span class="st">"β"</span>, <span class="dv">1</span><span class="sc">:</span>K),</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">estimate =</span> hat_beta,</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">std_error =</span> se_hat,</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">t_stat =</span> t,</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower_95_CI =</span> lower_CI,</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper_95_CI =</span> upper_CI,</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_value =</span> p_val</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s estimate the model from Example @ref(exm:refex) using <code>ivreg()</code>.</p>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-16_1c78515c53d6a1725bf1feba0c967dde">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">sim_endog_linear_model</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>),</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">1000</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_vec =</span> <span class="fu">c</span>(rmvnorm),</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_params_list =</span> <span class="fu">list</span>(</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">0</span>), </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">5</span>,<span class="dv">1</span>, <span class="dv">5</span>,<span class="dv">20</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ivreg</span>(y <span class="sc">~</span> x2 <span class="sc">|</span> z2, <span class="at">data =</span> results<span class="sc">$</span>observed_data) <span class="sc">%&gt;%</span> </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">0.7757286</td>
<td style="text-align: right;">0.2587745</td>
<td style="text-align: right;">2.997701</td>
<td style="text-align: right;">0.0027876</td>
</tr>
<tr class="even">
<td style="text-align: left;">x2</td>
<td style="text-align: right;">3.0240754</td>
<td style="text-align: right;">0.0254462</td>
<td style="text-align: right;">118.842121</td>
<td style="text-align: right;">0.0000000</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Now we can use our function and verify that the outputs are the same.</p>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-17_a55542483ca88f09467cd9ce3a6d307b">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">IV</span>(results<span class="sc">$</span>y, results<span class="sc">$</span>X, results<span class="sc">$</span>Z) <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 14%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">parameter</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std_error</th>
<th style="text-align: right;">t_stat</th>
<th style="text-align: right;">lower_95_CI</th>
<th style="text-align: right;">upper_95_CI</th>
<th style="text-align: right;">p_value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">β1</td>
<td style="text-align: right;">0.7757286</td>
<td style="text-align: right;">0.2587745</td>
<td style="text-align: right;">2.997701</td>
<td style="text-align: right;">0.268540</td>
<td style="text-align: right;">1.282917</td>
<td style="text-align: right;">0.002787606</td>
</tr>
<tr class="even">
<td style="text-align: left;">β2</td>
<td style="text-align: right;">3.0240754</td>
<td style="text-align: right;">0.0254462</td>
<td style="text-align: right;">118.842121</td>
<td style="text-align: right;">2.974202</td>
<td style="text-align: right;">3.073949</td>
<td style="text-align: right;">0.000000000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.9 (Intuition behind Asymptotic Variance)</strong></span> In Example @ref(exm:csvarols) we provided some intuition as to how <span class="math inline">\(\text{Var}\left(\hat{\boldsymbol\beta}_\text{OLS} \right) = \frac{\sigma^2}{n} \text{E}\left[\mathbf{X}'\mathbf{X}\right]^{-1}\)</span> changed in response to changes in <span class="math inline">\(\sigma^2\)</span>, <span class="math inline">\(n\)</span>, and components of <span class="math inline">\(\text{E}\left[\mathbf{X}'\mathbf{X}\right]\)</span>. The variance of <span class="math inline">\(\hat{\boldsymbol\beta}_\text{OLS} \)</span> is smaller for large samples and when the error term <span class="math inline">\(\boldsymbol{\varepsilon}\)</span> has a small variance. The more variance we have in our regressors (which is related to <span class="math inline">\(\text{E}\left[\mathbf{X}'\mathbf{X}\right]^{-1}\)</span>), the more efficient our estimator. So what is the intuition behind <span class="math inline">\(\text{Avar}\left(\hat{\boldsymbol\beta}_\text{IV} \right) =\frac{\sigma^2}{n}\text{E}\left[\mathbf{Z}'\mathbf{X}\right]^{-1}\text{E}\left[\mathbf{Z}'\mathbf{Z}\right]\text{E}\left[\mathbf{X}'\mathbf{Z}\right]^{-1}\)</span>? Three things should look familiar. The variance increases with increases in <span class="math inline">\(\sigma^2\)</span> and decreases with increases in <span class="math inline">\(n\)</span>. Consider the model <span class="math inline">\(Y = X\beta + \varepsilon\)</span> when we instrument for <span class="math inline">\(X\)</span> with <span class="math inline">\(Z\)</span>, such that <span class="math display">\[\text{Avar}\left(\hat{\boldsymbol\beta}_\text{IV} \right) =\frac{\sigma^2}{n}\frac{\text{E}\left[Z^2\right]}{\text{E}\left[ZX\right]^2} = \frac{\text{Var}\left(Z\right) + \text{E}\left[Z\right]^2}{[\text{Cov}\left(X,Z\right) + \text{E}\left[Z\right]\text{E}\left[X\right]]^2}.\]</span> Holding the average of <span class="math inline">\(Z\)</span> and <span class="math inline">\(X\)</span> fixed, we see that the asymptotic variance of our estimator increases with linearly with <span class="math inline">\(\text{Var}\left(Z\right)\)</span>, and decreases quadratically as <span class="math inline">\(\text{Cov}\left(X,Z\right)\)</span>. The latter of these facts shouldn’t be surprising. The larger <span class="math inline">\(\text{Cov}\left(X,Z\right)\)</span>, the more relevant (“stronger”) our instrument <span class="math inline">\(Z\)</span> is, and the better our estimates. If we simplify this example even further by assuming <span class="math inline">\(\text{E}\left[X\right]=\text{E}\left[Z\right]=0\)</span> and <span class="math inline">\(\text{Var}\left(X\right) = \text{Var}\left(Z\right)=1\)</span>, then <span class="math display">\[\text{Avar}\left(\hat{\boldsymbol\beta}_\text{IV} \right) = \frac{1}{\text{Cov}\left(X,Z\right)^2} = \left(\frac{\text{Cov}\left(X,Z\right)}{1\cdot 1} \right)^{-2} = \left(\frac{\text{Cov}\left(X,Z\right)}{\sigma_Y\cdot \sigma_X} \right)^{-2} = \rho_{X,Z}^{-2}.\]</span> The asympotitc variance of our estimator is inversely proportional to the correlation of <span class="math inline">\(X\)</span> and <span class="math inline">\(Z\)</span>.</p>
</div>
</section>
<section id="many-instruments-2sls" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="many-instruments-2sls"><span class="header-section-number">8.4</span> Many Instruments, 2SLS</h2>
<p>When defining <span class="math inline">\(\mathcal P_\text{IV}\)</span>, we assumed <span class="math inline">\(\dim(\mathbf{Z}) = \dim(\mathbf{X}) = K\)</span>. What happens if we have <span class="math inline">\(L = \dim(\mathbf{Z}) &gt; \dim(\mathbf{X}) = K\)</span>? Let’s consider a special case first.</p>
<div id="exm-ref3" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.10 (OLS vs.&nbsp;IV)</strong></span> Consider a model <span class="math inline">\(\mathbf{Y}= \mathbb{X}\boldsymbol{\beta}+ \boldsymbol{\varepsilon}\)</span> which satisfies the Gauss-Markov assumption, <em>but</em> also specifies the existence of <span class="math inline">\(K\)</span> separate instrumental variables <span class="math inline">\(\mathbf{Z}\)</span>. In other words, we have <span class="math inline">\(2K\)</span> instruments in the form of <span class="math inline">\(\mathbf{X}\)</span> and <span class="math inline">\(\mathbf{Z}\)</span>. Should we estimate <span class="math inline">\(\boldsymbol{\beta}\)</span> via OLS (equivalent to IV using <span class="math inline">\(\mathbf{X}\)</span> as instruments for <span class="math inline">\(\mathbf{X}\)</span>), or should we estimate <span class="math inline">\(\boldsymbol{\beta}\)</span> via IV using <span class="math inline">\(\mathbf{Z}\)</span>? It may be tempting to pick the latter. What if we are confident that <span class="math inline">\(\mathbf{Z}\)</span> are valid instruments, but aren’t positive that <span class="math inline">\(\mathbf{X}\)</span> is exogenous. If we estimated <span class="math inline">\(\boldsymbol{\beta}\)</span> with <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} = (\mathbb{Z}'\mathbb{X})^{-1}\mathbb{Z}'\mathbf{Y}\)</span>, then we would be playing it safe and not risk inconsistent estimates via <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} '=(\mathbb{X}'\mathbb{X})^{-1}\mathbb{X}'\mathbf{Y}= \hat{\boldsymbol\beta}_\text{OLS} \)</span>. Unfortunately this approach has a cost in the form of variance/standard errors. <span class="math display">\[\begin{align*}
\text{Avar}(\hat{\boldsymbol\beta}_\text{IV} ) &amp;= \sigma^2\text{E}\left[\mathbb{Z}'\mathbb{X}\right]^{-1}\text{E}\left[\mathbb{Z}'\mathbb{Z}\right]\text{E}\left[\mathbb{X}'\mathbb{Z}\right]^{-1}\\
\text{Avar}(\hat{\boldsymbol\beta}_\text{IV} ') &amp;= \text{Avar}(\hat{\boldsymbol\beta}_\text{OLS} ) = \sigma^2\text{E}\left[\mathbb{X}'\mathbb{X}\right]^{-1} &amp; (\mathbb{X}= \mathbb{Z})
\end{align*}\]</span> The difference <span class="math inline">\(\text{Avar}(\hat{\boldsymbol\beta}_\text{IV} ) - \text{Avar}(\hat{\boldsymbol\beta}_\text{OLS} )\)</span> is PSD, so <span class="math display">\[ \text{se}\left(\hat\beta_{\text{IV},j}'\right) = \text{se}\left(\hat\beta_{\text{OLS},j}\right) &lt; \text{se}\left(\hat\beta_{\text{IV},j}\right).\]</span> As the next simulation shows, this difference can be fairly large.</p>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-18_8dddd8cbc68254bbbe0b8ca9741b267a">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>iter <span class="ot">&lt;-</span> <span class="cf">function</span>(beta, n, dist_vec, dist_params_list, t){</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">sim_endog_linear_model</span>(beta, n, dist_vec, dist_params_list)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  OLS_results <span class="ot">&lt;-</span> <span class="fu">IV</span>(model<span class="sc">$</span>y, model<span class="sc">$</span>X, model<span class="sc">$</span>X) <span class="sc">%&gt;%</span> </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>      parameter, </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>      estimate</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">estimator =</span> <span class="st">"OLS"</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  IV_results <span class="ot">&lt;-</span> <span class="fu">IV</span>(model<span class="sc">$</span>y, model<span class="sc">$</span>X, model<span class="sc">$</span>Z) <span class="sc">%&gt;%</span> </span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>      parameter, </span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>      estimate</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">estimator =</span> <span class="st">"IV"</span>)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> OLS_results <span class="sc">%&gt;%</span> </span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(IV_results) <span class="sc">%&gt;%</span> </span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">iter_num =</span> t)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="cf">function</span>(N, beta, n, dist_vec, dist_params_list){</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>N <span class="sc">%&gt;%</span> </span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(iter, <span class="at">beta =</span> beta, <span class="at">n =</span> n, <span class="at">dist_vec =</span> dist_vec, <span class="at">dist_params_list =</span> dist_params_list) <span class="sc">%&gt;%</span> </span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">sim</span>(</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fl">1e5</span>,</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">100</span>,</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_vec =</span> <span class="fu">c</span>(rmvnorm),</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_params_list =</span> <span class="fu">list</span>(</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">0</span>), </span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">5</span>,<span class="dv">0</span>, <span class="dv">5</span>,<span class="dv">20</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-fig.asp="0.7" data-hash="endog_cache/html/fig-plot704_05625397606b28a04ec11b1adb180dd5">
<details class="code-fold">
<summary>Show code which generates figure</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>results <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(estimate)) <span class="sc">+</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..), <span class="at">bins =</span> <span class="dv">70</span>, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="fu">vars</span>(estimator), <span class="fu">vars</span>(parameter)) <span class="sc">+</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="fl">0.5</span>,<span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Estimates"</span>, <span class="at">y =</span> <span class="st">"Density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot704" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-plot704-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="endog_files/figure-html/fig-plot704-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-plot704-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8.4: f
</figcaption>
</figure>
</div>
</div>
</div>
<p>If we calculate the simulated standard errors of our estimators, we find that using <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span> results in nearly a four fold decrease in standard error.</p>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-20_6b33610b0b8f06f34073a96e7e1b7261">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>results <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(estimator, parameter) <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">std =</span> <span class="fu">sd</span>(estimate)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> parameter, <span class="at">values_from =</span> std) <span class="sc">%&gt;%</span> </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">estimator</th>
<th style="text-align: right;">β1</th>
<th style="text-align: right;">β2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">IV</td>
<td style="text-align: right;">1.658917</td>
<td style="text-align: right;">1.6593947</td>
</tr>
<tr class="even">
<td style="text-align: left;">OLS</td>
<td style="text-align: right;">0.102984</td>
<td style="text-align: right;">0.0226919</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="exm-ex4" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.11 (IV vs… IV?)</strong></span> Suppose <span class="math inline">\(Y = X + \varepsilon\)</span> for an endogenous <span class="math inline">\(X\)</span>. Fortunately, we have two instruments <span class="math inline">\(Z_1\)</span> and <span class="math inline">\(Z_2\)</span>. Which instrument do we use to estimate <span class="math inline">\(\beta = 1\)</span>. At first the answer seems simple – just estimate the model using each instrument separately, and then pick the estimates with the lower standard error.</p>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-21_aa09800dca3079f7323f9f54cae379aa">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>compare_two_ivs <span class="ot">&lt;-</span> <span class="cf">function</span>(beta, n, dist_vec, dist_params_list){</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">sim_endog_linear_model</span>(beta, n, dist_vec, dist_params_list)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Exclude intercepts </span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  first_iv <span class="ot">&lt;-</span> <span class="fu">IV</span>(model<span class="sc">$</span>y, model<span class="sc">$</span>X[,<span class="sc">-</span><span class="dv">1</span>], model<span class="sc">$</span>Z[,<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>      parameter,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>      std_error</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">instrument =</span> <span class="st">"Z1"</span>,</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">parameter =</span> <span class="st">"β"</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Exclude intercepts </span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  second_iv <span class="ot">&lt;-</span> <span class="fu">IV</span>(model<span class="sc">$</span>y, model<span class="sc">$</span>X[,<span class="sc">-</span><span class="dv">1</span>], model<span class="sc">$</span>Z[,<span class="dv">3</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>      parameter,</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>      std_error</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">instrument =</span> <span class="st">"Z2"</span>,</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">parameter =</span> <span class="st">"β"</span>)</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(first_iv, second_iv)</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="fu">compare_two_ivs</span>(</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">50</span>,</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_vec =</span> <span class="fu">c</span>(rmvnorm),</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_params_list =</span> <span class="fu">list</span>(</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="fl">0.3</span>, <span class="dv">0</span>, <span class="fl">0.5</span>, <span class="fl">0.3</span>, <span class="dv">1</span>, <span class="dv">0</span>,<span class="fl">0.5</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">4</span>)</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">parameter</th>
<th style="text-align: right;">std_error</th>
<th style="text-align: left;">instrument</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">β</td>
<td style="text-align: right;">0.3187212</td>
<td style="text-align: left;">Z1</td>
</tr>
<tr class="even">
<td style="text-align: left;">β</td>
<td style="text-align: right;">0.1626397</td>
<td style="text-align: left;">Z2</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>So we should use the instrument <span class="math inline">\(Z_2\)</span>! Or are we forgetting some other instruments? Consider <span class="math inline">\(Z_3 = aZ_1 + bZ_2\)</span>. <span class="math display">\[\begin{align*}
\text{E}\left[Z_3\varepsilon\right] &amp; = \text{E}\left[(aZ_1 + bZ_2)\varepsilon\right] = a\underbrace{\text{E}\left[Z_1\varepsilon\right]}_0 + b\underbrace{\text{E}\left[Z_2\varepsilon\right]}_0 = 0\\
\text{E}\left[Z_3X\right] &amp; = \text{E}\left[(aZ_1 + bZ_2)X\right] = a\underbrace{\text{E}\left[Z_1X\right]}_{\neq 0} + b\underbrace{\text{E}\left[Z_2X\right]}_{\neq 0} \neq 0
\end{align*}\]</span> It turns out that <em>any</em> linear combination of instruments is a valid instrument. There are an infinite number of candidates for instruments, so what do we do? Let’s simulate some standard errors and see if we can notice patterns between them and the choice of instruments. We’ll restrict our attention to instruments in the set <span class="math inline">\(\{aZ_1 + (1-a)Z_2\mid a\in\mathbb{R}\}\)</span> to simplify visualizations. We will calculate the <span class="math inline">\(\text{Var}\left(\hat{\boldsymbol\beta}_\text{IV} \mid \mathbb{X},\ \mathbb{Z}\right)\)</span> for a fixed sample drawn from <span class="math inline">\((X,Z_1,Z_2,\varepsilon)\overset{iid}{\sim}N(\boldsymbol \mu, \boldsymbol{\Sigma})\)</span> where</p>
<p><span class="math display">\[\begin{align*}
\boldsymbol \mu &amp; = [0,0,0,0]',\\
\boldsymbol{\Sigma}&amp; = \begin{bmatrix}1 &amp; 0.5 &amp; 0.5 &amp; 0.5\\0.5&amp;1&amp;0.3&amp;0\\0.5&amp;0.3&amp;1&amp;0\\0.5&amp;0&amp;0&amp;1 \end{bmatrix}.
\end{align*}\]</span></p>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-22_2f4881e3abd62c1943a581d75a622647">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>iter <span class="ot">&lt;-</span> <span class="cf">function</span>(model, a){</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  model<span class="sc">$</span>Z[,<span class="dv">2</span>] <span class="ot">&lt;-</span> a<span class="sc">*</span>model<span class="sc">$</span>Z[,<span class="dv">2</span>] <span class="sc">+</span> (<span class="dv">1</span><span class="sc">-</span>a)<span class="sc">*</span>model<span class="sc">$</span>Z[,<span class="dv">3</span>]</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">IV</span>(model<span class="sc">$</span>y, model<span class="sc">$</span>X[,<span class="sc">-</span><span class="dv">1</span>], model<span class="sc">$</span>Z[,<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>      parameter,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>      std_error</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">a =</span> a)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="cf">function</span>(a_vals, beta, n, dist_vec, dist_params_list){</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">sim_endog_linear_model</span>(beta, n, dist_vec, dist_params_list)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> a_vals <span class="sc">%&gt;%</span> </span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(iter, <span class="at">model =</span> model) <span class="sc">%&gt;%</span> </span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">sim</span>(</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">a_vals =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="at">length =</span> <span class="dv">500</span>),</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">50</span>,</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_vec =</span> <span class="fu">c</span>(rmvnorm),</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_params_list =</span> <span class="fu">list</span>(</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="fl">0.3</span>, <span class="dv">0</span>, <span class="fl">0.5</span>, <span class="fl">0.3</span>, <span class="dv">1</span>, <span class="dv">0</span>,<span class="fl">0.5</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">4</span>)</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-fig.asp="0.7" data-hash="endog_cache/html/fig-plot705_872cd9bafb24d5c930a9a0433b134b89">
<details class="code-fold">
<summary>Show code which generates figure</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>results <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(a, std_error)) <span class="sc">+</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"a"</span>, <span class="at">y =</span> <span class="st">"Standard Error of IV Estimator with Z = a*Z1+(1-a)Z2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot705" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-plot705-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="endog_files/figure-html/fig-plot705-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-plot705-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8.5: f
</figcaption>
</figure>
</div>
</div>
</div>
<p>Certain linear combinations have lower standard errors than others, so we’ll need to think of some method of finding the best possible instruments given a set.</p>
</div>
<p>Before considering this problem in general, let’s extend the IV model to allow for more instruments than regressors.</p>
<div id="def-" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 8.3</strong></span> The <span style="color:red"><strong><em>(linear) instrumental variables (IV) model</em></strong></span> is defined as <span class="math inline">\(\mathcal P_\text{IV} = \{P_{\boldsymbol{\beta},\sigma^2} \mid \boldsymbol{\beta}\in \mathbb R^{K}, \sigma^2\in\mathbb R\}\)</span>, where <span class="math display">\[\begin{align*}
P_{\boldsymbol{\beta},\sigma^2} &amp;= \{F_{\mathbb{X},\mathbb{Z},\boldsymbol{\varepsilon}} \mid\ \text{rank}\left(\text{E}\left[\mathbf{Z}'\mathbf{Z}\right]\right) = L,\ \text{rank}\left(\text{E}\left[\mathbf{Z}'\mathbf{X}\right]\right) = K, \ldots  \},\\
\mathbb{X}&amp; = [\mathbf{X}_1, \cdots, \mathbf{X}_j, \cdots \mathbf{X}_K] = [\mathbf{X}_1, \cdots, \mathbf{X}_i, \cdots \mathbf{X}_n]',\\
\mathbb{Z}&amp; = [\mathbf{Z}_1, \cdots, \mathbf{Z}_j, \cdots \mathbf{Z}_L] = [\mathbf{Z}_1, \cdots, \mathbf{Z}_i, \cdots \mathbf{Z}_n]',\\
\dim(\mathbf{Z}) &amp; = L,\\
\dim(\mathbf{X}) &amp;= K,\\
\mathbf{Y}&amp; = [Y_1, \ldots, Y_n].
\end{align*}\]</span> A necessary condition for the rank condition <span class="math inline">\(\text{rank}\left(\text{E}\left[\mathbf{Z}'\mathbf{X}\right]\right) = K\)</span> is the <span style="color:red"><strong><em>order condition</em></strong></span>, <span class="math inline">\(L\ge K\)</span>. In the event <span class="math inline">\(L = K\)</span> we say the model is <span style="color:red"><strong><em>exactly identified</em></strong></span>. If <span class="math inline">\(L &gt; K\)</span>, the model is <span style="color:red"><strong><em>over-identified</em></strong></span>.</p>
</div>
<p>When <span class="math inline">\(L=K\)</span> this is just the original IV model, and we know how to estimate this with <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span>. In the event <span class="math inline">\(L &gt; K\)</span>, the model is still identified, as we haven’t modified the identifying assumptions that <span class="math inline">\(\text{E}\left[\mathbf{Z}'\boldsymbol{\varepsilon}\right] = \mathbf{0}\)</span>, <span class="math inline">\(\text{E}\left[\mathbf{X}'\mathbf{Z}\right] \neq \mathbf{0}\)</span>, and <span class="math inline">\(\text{rank}\left(\text{E}\left[\mathbf{Z}'\mathbf{X}\right]\right) = K\)</span>. In fact, our model would still be identified if we discarded <span class="math inline">\(L - K\)</span> instruments! This is where the term “over-identified” comes from, and as far as “problems” go, it’s not a bad problem to have. We have so many instruments, that we have an infinite number of ways to estimate the model!</p>
<p>In general, any linear combination of instruments <span class="math inline">\(Z_1,\ldots, Z_L\)</span> is also an instrument. We can only use <span class="math inline">\(K\)</span> instruments with the estimator <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span>, so we want to find the <span class="math inline">\(K\)</span> linear combinations of our instruments (some of which could reduce to a single <span class="math inline">\(Z_j\)</span>) which give us the most efficient estimator. The <span class="math inline">\(K\)</span> linear combinations of the <span class="math inline">\(L\)</span> instruments can be expressed as a <span class="math inline">\(L\times K\)</span> matrix <span class="math inline">\(\mathbf{F}\)</span> which gives instruments <span class="math inline">\(\mathbf{Z}\mathbf{F}\)</span>. If we elect to use the new instruments <span class="math inline">\(\mathbf{Z}\mathbf{F}\)</span>, the IV estimator becomes <span class="math display">\[\hat{\boldsymbol\beta}_\text{IV} = [(\mathbb{Z}\mathbf{F})'\mathbb{X}]^{-1}[(\mathbb{Z}\mathbf{F})'\mathbf{Y}].\]</span> The problem of selecting <span class="math inline">\(\mathbf{F}\)</span> such that we maximize the efficiency of <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span> is given as:<br>
<span class="math display">\[\mathop{\mathrm{argmin}}_{\mathbf{F}}\ \text{Avar}(\hat{\boldsymbol\beta}_\text{IV} ) = \mathop{\mathrm{argmin}}_{\mathbf{F}}\ \sigma^2\text{E}\left[(\mathbb{Z}\mathbf{F})'\mathbb{X}\right]^{-1}\text{E}\left[(\mathbb{Z}\mathbf{F})'(\mathbb{Z}\mathbf{F})\right]\text{E}\left[\mathbb{X}'(\mathbb{Z}\mathbf{F})\right]^{-1}.\]</span> Solving this looks like a miserable time, so let’s stop appealing directly to math and consider what we’re <em>actually</em> doing here. We’re looking for the “best” instruments. It stands to reason that “good” instruments will be those that have more explanatory power with respect to the endogenous regressors <span class="math inline">\(\mathbf{X}\)</span> than others. So given draws of <span class="math inline">\((\mathbf{Z},\mathbf{X})\)</span>, how can we determine the best way to predict/explain <span class="math inline">\(\mathbf{X}\)</span> given <span class="math inline">\(\mathbf{Y}\)</span> — by estimating the linear projection associated with <span class="math inline">\((\mathbf{Z},\mathbf{X})\)</span> via OLS! For each <span class="math inline">\(j = 1,\ldots,K\)</span> we have <span class="math display">\[\begin{align*}
\hat{\boldsymbol\beta}_\text{OLS} ^j &amp;= (\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbf{X}_j &amp; (j = 1,\ldots, K)
\end{align*}\]</span> where <span class="math inline">\(\hat{\boldsymbol\beta}_\text{OLS} ^j\)</span> define the instrument formed from linear combinations of <span class="math inline">\(Z_1,\ldots, Z_L\)</span> which has the most predictive power for <span class="math inline">\(X_j\)</span>: <span class="math display">\[\begin{align*}
\hat X_j &amp;= \mathbf{Z}\hat{\boldsymbol\beta}_\text{OLS} ^j = \hat\beta_1^jZ_1 + \hat\beta_2^jZ_2 + \cdots + \hat\beta_L^jZ_L &amp; (j = 1,\ldots, K)
\end{align*}\]</span> Written compactly using matrices, we have <span class="math display">\[\begin{align*}
\hat{\mathbf{X}} &amp;=  \mathbf{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbb{X},\\
\hat{\mathbb{X}} &amp;=  \mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbb{X},
\end{align*}\]</span> where <span class="math inline">\(\hat{\mathbf{X}}\)</span> is a random vector of instruments, and <span class="math inline">\(\hat{\mathbb{X}}\)</span> is <span class="math inline">\(n\)</span> random vectors <span class="math inline">\(\hat{\mathbf{X}}\)</span> “stacked” to form a random matrix. If we elect to use these instruments to estimate our model, then <span class="math display">\[ \hat{\boldsymbol\beta}_\text{IV} = [(\mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbb{X})'\mathbb{X}]^{-1}[(\mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbb{X})'\mathbf{Y}].\]</span> This estimator is a special case of <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span> where we have determined the <span class="math inline">\(K\)</span> instruments via linear projection, and is known as two-stage least squares.</p>
<div id="def-" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 8.4</strong></span> The <span style="color:red"><strong><em>two-stage least squares (2SLS) estimator</em></strong></span> is defined as <span class="math display">\[\begin{align*}
\hat{\boldsymbol\beta}_\text{2SLS} (\mathbb{X}, \mathbb{Z}, \mathbf{Y}) &amp;= [\mathbb{X}'\mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbb{X}]^{-1}\mathbb{X}'\mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbf{Y}= [\hat{\mathbb{X}}'\mathbb{X}]^{-1}\hat{\mathbb{X}}'\mathbf{Y},\\
                 \hat{\mathbb{X}} &amp;=  \mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbb{X}.   
\end{align*}\]</span> Calculating <span class="math inline">\(\hat{\mathbb{X}}\)</span> via OLS is referred to as the <span style="color:red"><strong><em>first stage</em></strong></span>, while calculating <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span> using <span class="math inline">\(\hat{\mathbb{X}}\)</span> is the <span style="color:red"><strong><em>second stage</em></strong></span>. It can be useful to define the projection matrix associated with the first stage, <span class="math display">\[\begin{align*}
\mathbb P_{\mathbb{Z}} &amp;= \mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\\
\hat{\mathbb{X}} &amp; = \mathbb P_{\mathbb{Z}}\mathbb{X}.
\end{align*}\]</span></p>
</div>
<p>The name “two-stage least squares” can be a bit misleading depending on how it is presented. It’s very common to think of each stage of 2SLS as an application of OLS. In the first stage we perform OLS to calculate the instruments <span class="math inline">\(\hat{\mathbf{X}}\)</span>, and then regress <span class="math inline">\(Y\)</span> on <span class="math inline">\(\hat{\mathbf{X}}\)</span> via OLS in the second stage. At first these seems at odds with our definition, because the second stage relies on the IV estimator, but it is equivalent in a sense. We’ll explore this in depth in Example @ref(exm:se).</p>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.12 (OLS as 2SLS)</strong></span> Consider the situation from Example @ref(exm:ref3) where <span class="math inline">\(\mathbf{X}\)</span> is comprised of entirely exogenous regressors. In this case our vector of instruments is actually a <span class="math inline">\(L+K\)</span> vector <span class="math inline">\([\mathbf{X},\mathbf{Z}]\)</span>. Instead of directly calculating <span class="math display">\[\begin{align*}
\hat{\mathbb{X}} &amp;= [\mathbb{X}, \mathbb{Z}]([\mathbb{X}, \mathbb{Z}]'[\mathbb{X}, \mathbb{Z}])^{-1}[\mathbb{X}, \mathbb{Z}]'\mathbb{X},\\
\end{align*}\]</span> we can intuit the result of the first stage. If we regress <span class="math inline">\(X_j\)</span> on <span class="math inline">\(X_1,\ldots, X_j,\ldots,Z_1,\ldots,Z_L\)</span>, then all coefficients should be zero except that associated with the independent variable <span class="math inline">\(X_j\)</span> which will be 1. Therefore the OLS estimates from stage one should be a <span class="math inline">\(L \times K\)</span> matrix where the first <span class="math inline">\(K\)</span> rows are a diagonal matrix of <span class="math inline">\(1\)</span>’s and the bottom <span class="math inline">\(L - K\)</span> rows are 0. If we multiply <span class="math inline">\([\mathbb{X}, \mathbb{Z}]\)</span> by this, then we have <span class="math display">\[ \hat{\mathbb{X}} = \mathbf 1\mathbb{X}+ \mathbf{0}\mathbb{Z}= \mathbb{X}.\]</span> This gives <span class="math display">\[ \hat{\boldsymbol\beta}_\text{2SLS} = [\hat{\mathbb{X}}'\mathbb{X}]^{-1}\hat{\mathbb{X}}'\mathbf{Y}= [{\mathbb{X}}'\mathbb{X}]^{-1}{\mathbb{X}}'\mathbf{Y}= \hat{\boldsymbol\beta}_\text{OLS} .\]</span></p>
</div>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.13 (Exactly Identified Case)</strong></span> In the event that <span class="math inline">\(L = K\)</span>, there is no</p>
</div>
<p>Because <span class="math inline">\(\hat{\boldsymbol\beta}_\text{2SLS} \)</span> is just a special case of <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span> using instruments <span class="math inline">\(\hat{\mathbb{X}}\)</span>, the properties of <span class="math inline">\(\hat{\boldsymbol\beta}_\text{2SLS} \)</span> follow directly from those of <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span>.</p>
<div id="thm-" class="theorem">
<p><span class="theorem-title"><strong>Theorem 8.3 (IV Estimator is Root-n CAN)</strong></span> If <span class="math inline">\(P_{\boldsymbol{\beta}, \sigma^2} \in \mathcal P_\text{IV}\)</span>, then <span class="math inline">\(\hat{\boldsymbol\beta}_\text{2SLS} \overset{p}{\to}\boldsymbol{\beta}\)</span> and <span class="math display">\[\hat{\boldsymbol\beta}_\text{2SLS} \overset{a}{\sim}N\left(\boldsymbol{\beta}, \sigma^2\text{E}\left[\hat{\mathbb{X}}'\hat{\mathbb{X}}\right]^{-1}\right) =  N\left(\boldsymbol{\beta}, \frac{\sigma^2}{n}\text{E}\left[\hat{\mathbf{X}}'\hat{\mathbf{X}}\right]^{-1}\right).\]</span></p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>We know that <span class="math inline">\(\hat{\boldsymbol\beta}_\text{2SLS} \)</span> is Root-n CAN because <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span> is. All we need to show is that the asymptotic variance simplifies to the given expression when using instruments <span class="math inline">\(\hat{\mathbf{X}}\)</span>. <span class="math display">\[\begin{align*}
\text{Avar}(\hat{\boldsymbol\beta}_\text{2SLS} ) &amp;= \sigma^2\text{E}\left[\hat{\mathbb{X}}\mathbb{X}\right]^{-1}\text{E}\left[\hat{\mathbb{X}}\hat{\mathbb{X}}\right]\text{E}\left[\mathbb{X}'\hat{\mathbb{X}}\right]^{-1}\\
&amp; = \sigma^2\text{E}\left[[\mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbb{X}]'\mathbb{X}\right]^{-1}\text{E}\left[[\mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbb{X}]'[\mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbb{X}]\right]\text{E}\left[\mathbb{X}'[\mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbb{X}]\right]^{-1}\\
&amp; = \sigma^2\text{E}\left[\mathbb{X}'\mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbb{X}\right]^{-1}\text{E}[\mathbb{X}'\mathbb{Z}\underbrace{(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbb{Z}}_{\mathbf I}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbb{X}]\text{E}\left[\mathbb{X}'\mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbb{X}\right]^{-1}\\
&amp; = \sigma^2\text{E}[\mathbb{X}'\underbrace{\mathbb{Z}\mathbb{Z}^{-1}}_{\mathbf I}\underbrace{(\mathbb{Z}')^{-1}\mathbb{Z}'}_{\mathbf I}\mathbb{X}]^{-1}\text{E}[\mathbb{X}'\underbrace{\mathbb{Z}\mathbb{Z}^{-1}}_{\mathbf I}\underbrace{(\mathbb{Z}')^{-1}\mathbb{Z}'}_{\mathbf I}\mathbb{X}]\text{E}\left[\mathbb{X}'\mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbb{X}\right]^{-1}\\
&amp; = \sigma^2\underbrace{\text{E}[\mathbb{X}'\mathbb{X}]^{-1}\text{E}[\mathbb{X}'\mathbb{X}]}_{\mathbf I}\text{E}\left[\mathbb{X}'\mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbb{X}\right]^{-1}\\
&amp; = \sigma^2\text{E}\left[\mathbb{X}'[\mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}']'\mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbb{X}\right]^{-1} &amp; (\mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\text{ sym. and idem.}) \\
&amp; = \sigma^2\text{E}\left[[\mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbb{X}]'[\mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbb{X}]\right]^{-1}\\
&amp; = \sigma^2\text{E}\left[\hat{\mathbb{X}}'\hat{\mathbb{X}}\right]^{-1} &amp; (\hat{\mathbb{X}} = \mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbb{X})
\end{align*}\]</span></p>
</div>
<p>The motivation for introducing <span class="math inline">\(\hat{\boldsymbol\beta}_\text{2SLS} \)</span> was not all choices of instruments being equal with respect to efficiency, and perhaps the instruments which result from projecting <span class="math inline">\(\mathbf{X}\)</span> onto <span class="math inline">\(\mathbf{Z}\)</span> result in an IV estimator which is more efficient than most others. This IV estimator is not just more efficient that most others, it is <em>the</em> most efficient IV estimator. The proof of this is adapted from <span class="citation" data-cites="wooldridge2010econometric">Wooldridge (<a href="#ref-wooldridge2010econometric" role="doc-biblioref">2010</a>)</span>.</p>
<div id="thm-eff2" class="theorem">
<p><span class="theorem-title"><strong>Theorem 8.4 (2SLS is Asymptotically Efficient)</strong></span> If <span class="math inline">\(P_{\boldsymbol{\beta}, \sigma^2} \in \mathcal P_\text{IV}\)</span>, then <span class="math inline">\(\hat{\boldsymbol\beta}_\text{2SLS} \)</span> is efficient in the class of <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span> estimators calculated using instruments linear in <span class="math inline">\(\mathbf{Z}\)</span>.</p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>Suppose <span class="math inline">\(\tilde{\boldsymbol{\beta}}\)</span> is some arbitrary IV estimator which is linear in instruments <span class="math inline">\(\mathbf{Z}\)</span>. The instruments for this estimator can be written as <span class="math inline">\(\tilde{\mathbf{X}} = \mathbf{Z}\mathbf{F}\)</span> for some <span class="math inline">\(L\times K\)</span> matrix <span class="math inline">\(\mathbf{F}\)</span>. We want to show that <span class="math inline">\(\text{Avar}\left(\hat{\boldsymbol\beta}_\text{2SLS} \right)\)</span> is “less than” <span class="math inline">\(\text{Avar}\left(\tilde{\boldsymbol{\beta}}\right)\)</span>. Both of these objects are matrices, so “less” than translates to the difference being PSD. This difference is <span class="math display">\[\begin{align*}
\text{Avar}\left(\tilde{\boldsymbol{\beta}}\right) - \text{Avar}\left(\hat{\boldsymbol\beta}_\text{2SLS} \right) &amp; =\frac{\sigma^2}{n}\text{E}\left[\tilde{\mathbf{X}}'\mathbf{X}\right]^{-1}\text{E}\left[\tilde{\mathbf{X}}'\tilde{\mathbf{X}}\right]\text{E}\left[\mathbf{X}'\tilde{\mathbf{X}}\right]^{-1} -  \frac{\sigma^2}{n}\text{E}\left[\hat{\mathbf{X}}'\hat{\mathbf{X}}\right]^{-1}\\&amp; = \frac{\sigma^2}{n}\left[\text{E}\left[\tilde{\mathbf{X}}'\mathbf{X}\right]^{-1}\text{E}\left[\tilde{\mathbf{X}}'\tilde{\mathbf{X}}\right]\text{E}\left[\mathbf{X}'\tilde{\mathbf{X}}\right]^{-1} - \text{E}\left[\hat{\mathbf{X}}'\hat{\mathbf{X}}\right]^{-1}\right]\\
&amp; = \frac{\sigma^2}{n}\left[\left[\text{E}\left[\tilde{\mathbf{X}}'\mathbf{X}\right]\text{E}\left[\tilde{\mathbf{X}}'\tilde{\mathbf{X}}\right]^{-1}\text{E}\left[\mathbf{X}'\tilde{\mathbf{X}}\right]\right]^{-1} - \text{E}\left[\hat{\mathbf{X}}'\hat{\mathbf{X}}\right]^{-1}\right] &amp; (\text{properties of inversion})
\end{align*}\]</span> Accounting for the bracketed term being the difference of two inverted matrices, this matrix will be PSD if and only if the following is PSD: <span class="math display">\[\begin{equation}
\text{E}\left[\hat{\mathbf{X}}'\hat{\mathbf{X}}\right] - \text{E}\left[\tilde{\mathbf{X}}'\mathbf{X}\right]\text{E}\left[\tilde{\mathbf{X}}'\tilde{\mathbf{X}}\right]^{-1}\text{E}\left[\mathbf{X}'\tilde{\mathbf{X}}\right]  (\#eq:diff).
\end{equation}\]</span></p>
<p>We can show this by relying on a certain “trick”. Define the difference between the regressors <span class="math inline">\(\mathbf{X}\)</span> and 2SLS instruments <span class="math inline">\(\hat{\mathbf{X}}\)</span> as <span class="math inline">\(\mathbf r = \hat{\mathbf{X}} -  \mathbf{X}\)</span>. This remainder term <span class="math inline">\(\mathbf r\)</span> is uncorrelated with <span class="math inline">\(\mathbf{Z}\)</span>: <span class="math display">\[\begin{align*}
\text{E}\left[\mathbf{Z}'\mathbf r\right] &amp; = \text{E}\left[\mathbf{Z}'\hat{\mathbf{X}}\right] - \text{E}\left[\mathbf{Z}'\mathbf{X}\right]\\
&amp; = \text{E}\left[\mathbf{Z}'\mathbf{Z}(\mathbf{Z}'\mathbf{Z})^{-1}\mathbf{Z}'\mathbf{X}\right] - \text{E}\left[\mathbf{Z}'\mathbf{X}\right] &amp; (\hat{\mathbf{X}} = \mathbf{Z}(\mathbf{Z}'\mathbf{Z})^{-1}\mathbf{Z}'\mathbf{X})\\
&amp; = \text{E}\left[\mathbf{Z}'\mathbf{X}\right] - \text{E}\left[\mathbf{Z}'\mathbf{X}\right]\\
&amp; = \mathbf{0}
\end{align*}\]</span> As a result, <span class="math inline">\(\tilde{ \mathbf{X}}\)</span> and <span class="math inline">\(\mathbf r\)</span> are uncorrelated. <span class="math display">\[\text{E}\left[\tilde{ \mathbf{X}}'\mathbf r\right] = \text{E}\left[(\mathbf{Z}\mathbf{F}')\mathbf r\right]= \mathbf F'\underbrace{\text{E}\left[\mathbf{Z}'\mathbf r\right]}_\mathbf{0}= \mathbf{0}\]</span> Now we use these expectations and the definition of <span class="math inline">\(\mathbf r\)</span> to arrive at our “trick”. <span class="math display">\[\begin{align*}
&amp;\text{E}\left[\tilde{ \mathbf{X}}'\mathbf r\right] = \mathbf{0}\\
\implies &amp; \text{E}\left[\tilde{ \mathbf{X}}'(\hat{\mathbf{X}} -  \mathbf{X})\right] = \mathbf{0}&amp; (\mathbf r = \hat{\mathbf{X}} -  \mathbf{X})\\
\implies &amp; \text{E}\left[\tilde{ \mathbf{X}}'\hat{\mathbf{X}}\right] - \text{E}\left[\tilde{ \mathbf{X}}'\mathbf{X}\right] = \mathbf{0}\\
\implies &amp; \text{E}\left[\tilde{ \mathbf{X}}'\hat{\mathbf{X}}\right] = \text{E}\left[\tilde{ \mathbf{X}}'\mathbf{X}\right]
\end{align*}\]</span> Using this equality, we can rewrite the difference in Equation @ref(eq:diff) in terms of <span class="math inline">\(\tilde{\mathbf{X}}\)</span> and <span class="math inline">\(\hat{\mathbf{X}}\)</span> only. <span class="math display">\[\begin{equation}
\text{E}\left[\hat{\mathbf{X}}'\hat{\mathbf{X}}\right] - \text{E}\left[\hat{\mathbf{X}}'\tilde{\mathbf{X}}\right]\text{E}\left[\tilde{\mathbf{X}}'\tilde{\mathbf{X}}\right]^{-1}\text{E}\left[\tilde{\mathbf{X}}'\hat{\mathbf{X}}\right]  (\#eq:diff2).
\end{equation}\]</span> This may seem like a random equation, but it’s very special if you consider the linear projection of <span class="math inline">\(\hat{\mathbf{X}}\)</span> onto <span class="math inline">\(\tilde{\mathbf{X}}\)</span>. This projection is given by the coefficient <span class="math inline">\(\boldsymbol\gamma = \text{E}\left[\tilde{\mathbf{X}}'\tilde{\mathbf{X}}\right]^{-1}\text{E}\left[\tilde{\mathbf{X}}'\hat{\mathbf{X}}\right],\)</span> which happens to show up in @ref(eq:diff2). The errors associated with this linear projection are given as <span class="math inline">\(\boldsymbol \nu = \hat{\mathbf{X}} - \tilde{\mathbf{X}}\boldsymbol\gamma\)</span>, and have an expected value of <span class="math inline">\(\mathbf{0}\)</span> by the definition of <span class="math inline">\(\boldsymbol\gamma\)</span> and linear projection. But what is the expected value of these errors squared?</p>
<p><span class="math display">\[\begin{align*}
\boldsymbol \nu' \boldsymbol \nu&amp; = [\hat{\mathbf{X}} - \tilde{\mathbf{X}}\boldsymbol\gamma]'[\hat{\mathbf{X}} - \tilde{\mathbf{X}}\boldsymbol\gamma]\\
&amp; = \hat{\mathbf{X}}'\hat{\mathbf{X}} - 2\boldsymbol\gamma'\tilde{\mathbf{X}}'\hat{\mathbf{X}} + \boldsymbol\gamma'\tilde{\mathbf{X}}'\tilde{\mathbf{X}}\boldsymbol\gamma\\
\text{E}\left[ \boldsymbol \nu' \boldsymbol \nu\right] &amp; = \text{E}\left[\hat{\mathbf{X}}'\hat{\mathbf{X}}\right] - 2\boldsymbol\gamma'\text{E}\left[\tilde{\mathbf{X}}'\hat{\mathbf{X}}\right] + \boldsymbol\gamma'\text{E}\left[\tilde{\mathbf{X}}'\tilde{\mathbf{X}}\right]\boldsymbol\gamma &amp; (\boldsymbol\gamma \text{ is a constant})\\
&amp; = \text{E}\left[\hat{\mathbf{X}}'\hat{\mathbf{X}}\right] - 2\left[\text{E}\left[\tilde{\mathbf{X}}'\tilde{\mathbf{X}}\right]^{-1}\text{E}\left[\tilde{\mathbf{X}}'\hat{\mathbf{X}}\right]\right]'\text{E}\left[\tilde{\mathbf{X}}'\hat{\mathbf{X}}\right] + \left[\text{E}\left[\tilde{\mathbf{X}}'\tilde{\mathbf{X}}\right]^{-1}\text{E}\left[\tilde{\mathbf{X}}'\hat{\mathbf{X}}\right]\right]'\text{E}\left[\tilde{\mathbf{X}}'\tilde{\mathbf{X}}\right] \left[\text{E}\left[\tilde{\mathbf{X}}'\tilde{\mathbf{X}}\right]^{-1}\text{E}\left[\tilde{\mathbf{X}}'\hat{\mathbf{X}}\right]\right]\\
&amp; = \text{E}\left[\hat{\mathbf{X}}'\hat{\mathbf{X}}\right] - 2\text{E}\left[\tilde{\mathbf{X}}\hat{\mathbf{X}}'\right]\text{E}\left[\tilde{\mathbf{X}}'\tilde{\mathbf{X}}\right]^{-1}\text{E}\left[\tilde{\mathbf{X}}'\hat{\mathbf{X}}\right] + \text{E}\left[\tilde{\mathbf{X}}\hat{\mathbf{X}}'\right]\underbrace{\text{E}\left[\tilde{\mathbf{X}}'\tilde{\mathbf{X}}\right]^{-1}\text{E}\left[\tilde{\mathbf{X}}'\tilde{\mathbf{X}}\right]}_{\mathbf I} \text{E}\left[\tilde{\mathbf{X}}'\tilde{\mathbf{X}}\right]^{-1}\text{E}\left[\tilde{\mathbf{X}}'\hat{\mathbf{X}}\right]\\
&amp; = \text{E}\left[\hat{\mathbf{X}}'\hat{\mathbf{X}}\right] - (2-1)\text{E}\left[\tilde{\mathbf{X}}\hat{\mathbf{X}}'\right]\text{E}\left[\tilde{\mathbf{X}}'\tilde{\mathbf{X}}\right]^{-1}\text{E}\left[\tilde{\mathbf{X}}'\hat{\mathbf{X}}\right] \\
&amp; = \text{E}\left[\hat{\mathbf{X}}'\hat{\mathbf{X}}\right] - \text{E}\left[\hat{\mathbf{X}}'\tilde{\mathbf{X}}\right]\text{E}\left[\tilde{\mathbf{X}}'\tilde{\mathbf{X}}\right]^{-1}\text{E}\left[\tilde{\mathbf{X}}'\hat{\mathbf{X}}\right]
\end{align*}\]</span> Equations @ref(eq:diff) and @ref(eq:diff2) are the expectation of the sum of squared errors associated with the linear projection of <span class="math inline">\(\hat{\mathbf{X}}\)</span> onto <span class="math inline">\(\tilde{\mathbf{X}}\)</span>, meaning the matrix in question must be PSD!<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> This gives the desired result.</p>
</div>
<p>In Section @ref(generalized-method-of-moments) we’ll see another way to show this result that is a bit more intuitive.</p>
<div id="exm-se" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.14 (What’s in A Name?)</strong></span> Let’s estimate the model from @ref(exm:ex4) via 2SLS. We already have defined a function <code>IV()</code> to calculate <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span>, so we can just use pass the instruments <span class="math inline">\(\hat {\mathbf{X}}\)</span> to this function to perform 2SLS.</p>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-24_cb64c46b3362a65a7a573033ad44f4a2">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>TSLS <span class="ot">&lt;-</span> <span class="cf">function</span>(y,X,Z){</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  X_hat <span class="ot">&lt;-</span> Z <span class="sc">%*%</span> <span class="fu">solve</span>(<span class="fu">t</span>(Z) <span class="sc">%*%</span> Z) <span class="sc">%*%</span> <span class="fu">t</span>(Z) <span class="sc">%*%</span> X</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">IV</span>(y, X, X_hat)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For a simulated sample of size <span class="math inline">\(n=50\)</span> let’s estimate the model using <code>TSLS()</code>.</p>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-25_746740faa313e388ac145d827f6cbc91">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">sim_endog_linear_model</span>(<span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">50</span>,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_vec =</span> <span class="fu">c</span>(rmvnorm),</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_params_list =</span> <span class="fu">list</span>(</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">0</span>),</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">30</span>,<span class="dv">7</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">7</span>,<span class="dv">50</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">4</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="fu">TSLS</span>(model<span class="sc">$</span>y, model<span class="sc">$</span>X, model<span class="sc">$</span>Z) <span class="sc">%&gt;%</span> </span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 13%">
<col style="width: 11%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 17%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">parameter</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std_error</th>
<th style="text-align: right;">t_stat</th>
<th style="text-align: right;">lower_95_CI</th>
<th style="text-align: right;">upper_95_CI</th>
<th style="text-align: right;">p_value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">β1</td>
<td style="text-align: right;">1.050035</td>
<td style="text-align: right;">0.1612349</td>
<td style="text-align: right;">6.512454</td>
<td style="text-align: right;">0.7340202</td>
<td style="text-align: right;">1.366049</td>
<td style="text-align: right;">4.115621e-08</td>
</tr>
<tr class="even">
<td style="text-align: left;">β2</td>
<td style="text-align: right;">1.963987</td>
<td style="text-align: right;">0.0738148</td>
<td style="text-align: right;">26.606947</td>
<td style="text-align: right;">1.8193128</td>
<td style="text-align: right;">2.108662</td>
<td style="text-align: right;">0.000000e+00</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This is not the only way we could calculate <span class="math inline">\(\hat{\boldsymbol\beta}_\text{2SLS} \)</span>. Note that <span class="math inline">\(\mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\)</span> is symmetric and idempotent, so <span class="math display">\[\begin{align*}
\hat{\boldsymbol\beta}_\text{2SLS} &amp; = \hat{\boldsymbol\beta}_\text{IV} (\mathbb{X}, \hat{\mathbb{X}}, \mathbf{Y})\\
&amp; = [\hat{\mathbb{X}}'{\mathbb{X}}]^{-1}\hat{\mathbb{X}}'\mathbf{Y}\\
&amp; = [\mathbb{X}'\mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbb{X}]^{-1}\mathbb{X}'\mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbf{Y}\\
&amp; = [\mathbb{X}'[\mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}']\mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbb{X}]^{-1}\mathbb{X}'\mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbf{Y}\\
&amp; = [[\mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbb{X}]'[\mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbb{X}]]^{-1}\mathbb{X}'\mathbb{Z}(\mathbb{Z}'\mathbb{Z})^{-1}\mathbb{Z}'\mathbf{Y}\\
&amp; = [\hat{\mathbb{X}}'\hat{\mathbb{X}}]^{-1}\hat{\mathbb{X}}'\mathbf{Y}\\
&amp; = \hat{\boldsymbol\beta}_\text{OLS} (\hat{\mathbb{X}}, \mathbf{Y}).
\end{align*}\]</span> So we can interpret <span class="math inline">\(\hat{\boldsymbol\beta}_\text{2SLS} \)</span> in one of two ways:</p>
<ol type="1">
<li>Use <span class="math inline">\(\hat{\boldsymbol\beta}_\text{OLS} (\mathbb{Z}, \mathbb{X})\)</span> to calculate <span class="math inline">\(\hat{\mathbb{X}} = \mathbb{Z}\hat{\boldsymbol\beta}_\text{OLS} (\mathbb{Z}, \mathbb{X})\)</span> (stage 1), followed by <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} (\mathbb{X}, \hat{\mathbb{X}}, \mathbf{Y})\)</span> (stage 2). This is how our <code>TSLS()</code> function works.</li>
<li>Use <span class="math inline">\(\hat{\boldsymbol\beta}_\text{OLS} (\mathbb{Z}, \mathbb{X})\)</span> to calculate <span class="math inline">\(\hat{\mathbb{X}} = \mathbb{Z}\hat{\boldsymbol\beta}_\text{OLS} (\mathbb{Z}, \mathbb{X})\)</span> (stage 1), followed by <span class="math inline">\(\hat{\boldsymbol\beta}_\text{OLS} (\hat{\mathbb{X}}, \mathbf{Y})\)</span> (stage 2).</li>
</ol>
<p>The second interpretation is where 2SLS gets its name – we run OLS twice. But what happens when we implement <span class="math inline">\(\hat{\boldsymbol\beta}_\text{2SLS} \)</span> this way?</p>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-26_bc8bc446fb652b4e9fe037e033b967b7">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>stage1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(x2 <span class="sc">~</span> z2 <span class="sc">+</span> z3, <span class="at">data =</span> model<span class="sc">$</span>observed_data)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>X_hat <span class="ot">&lt;-</span> stage1<span class="sc">$</span>fitted.values</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>stage2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(model<span class="sc">$</span>y <span class="sc">~</span> X_hat) </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>stage2 <span class="sc">%&gt;%</span> </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">1.050035</td>
<td style="text-align: right;">1.5500397</td>
<td style="text-align: right;">0.6774244</td>
<td style="text-align: right;">0.5013889</td>
</tr>
<tr class="even">
<td style="text-align: left;">X_hat</td>
<td style="text-align: right;">1.963987</td>
<td style="text-align: right;">0.7096226</td>
<td style="text-align: right;">2.7676503</td>
<td style="text-align: right;">0.0079972</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We get the same exact estimates (which we already showed would be the case), but our standard errors don’t coincide with those given by <code>TSLS()</code>. What is happening here?</p>
<p>When we run <code>lm(y ~ X_hat)</code>, we are estimating the model associated with linear projection model <span class="math inline">\(Y = \hat{\mathbf{X}}\boldsymbol \delta + \nu\)</span>. The function <code>lm()</code> has no way of knowing that this is the second step in an estimation process aimed at estimating the structural linear model <span class="math inline">\(Y = \mathbf{X}\boldsymbol{\beta}+ \varepsilon\)</span>. It just happens that <span class="math inline">\(\hat{\mathbf{X}}\)</span> is defined such that the population parameters satisfy <span class="math inline">\(\boldsymbol \delta = \boldsymbol{\beta}\)</span>. When <code>lm()</code> goes to calculate the standard errors, it calculates the residuals associated with the model <span class="math inline">\(Y = \hat{\mathbf{X}}\boldsymbol \delta + \nu\)</span>. These errors have no structural/economic meaning, and we don’t care about them at all (for this purpose). We really want the residuals associated with the error <span class="math inline">\(\varepsilon\)</span> in the actual IV model <span class="math inline">\(Y = \mathbf{X}\boldsymbol{\beta}+ \varepsilon\)</span>, and these residuals are not the same! <span class="math display">\[ \hat{\mathbf u} = \mathbf{Y}- \hat{\mathbb{X}}\hat{\boldsymbol\beta}_\text{OLS} (\hat{\mathbb{X}}, \mathbf{Y}) \neq \mathbf{Y}- \mathbb{X}\hat{\boldsymbol\beta}_\text{OLS} (\hat{\mathbb{X}}, \mathbf{Y}) = \mathbf{Y}- \mathbb{X}\hat{\boldsymbol\beta}_\text{IV} (\mathbb{X}, \hat{\mathbb{X}}, \mathbf{Y}) = \hat{\mathbf{e}}\]</span> The moral of the story is that when we are calculating the residuals we need to be very deliberate and remember the actual model we are estimating. Fortunately, any statistical software with an implementation for <span class="math inline">\(\hat{\boldsymbol\beta}_\text{2SLS} \)</span> will calculate the correct standard errors, which is why it’s best to not do each step “by hand” if you favor the interpretation of <span class="math inline">\(\hat{\boldsymbol\beta}_\text{2SLS} \)</span> as two OLS regressions.</p>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-27_78e743ac4fdaf0b5ef3ca2206ca59c4f">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ivreg</span>(y <span class="sc">~</span> x2 <span class="sc">|</span> z2 <span class="sc">+</span> z3, <span class="at">data =</span> model<span class="sc">$</span>observed_data) <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">1.050035</td>
<td style="text-align: right;">0.1612349</td>
<td style="text-align: right;">6.512454</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">x2</td>
<td style="text-align: right;">1.963987</td>
<td style="text-align: right;">0.0738148</td>
<td style="text-align: right;">26.606947</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>The example emphasizes something that has been mentioned in passing before. The models estimated in the first and second stage, <span class="math inline">\(\mathbf{X}= \mathbf{Z}\boldsymbol + \gamma\)</span> and <span class="math inline">\(Y = \hat{\mathbf{X}}\boldsymbol \delta + \nu\)</span>, are entirely void of structural meaning. Nevertheless it is useful to us because it expresses the outcome of interest in terms of exogenous variables <span class="math inline">\(\hat{\mathbf{X}}\)</span> and <span class="math inline">\(\mathbf{Z}\)</span>. We refer to such an equation as the <strong><em>reduced form</em></strong> of the structural model <span class="math inline">\(Y = \mathbf{X}\boldsymbol{\beta}+ \boldsymbol{\varepsilon}\)</span>. We’ll talk about this term much more in Section @ref(endogeniety-ii-simultaneous-equation-models).</p>
</section>
<section id="testing-hypotheses" class="level2" data-number="8.5">
<h2 data-number="8.5" class="anchored" data-anchor-id="testing-hypotheses"><span class="header-section-number">8.5</span> Testing Hypotheses</h2>
<p>At this point, we have just assumed we know how to select between the classical linear model <span class="math inline">\(\mathcal P_\text{LM}\)</span> and the linear IV model <span class="math inline">\(\mathcal P_\text{IV}\)</span>, but in practice we want to be able to form hypothesis tests that inform our selection between the two models. In particular we want to be able to test:</p>
<ol type="1">
<li>Are our regressors exogenous, i.e <span class="math inline">\(H_0: \text{E}\left[\mathbf{X}'\boldsymbol{\varepsilon}\right] = \mathbf{0}\)</span>?</li>
<li>Are our instruments valid, i.e…</li>
</ol>
<section id="durbinwuhausman-test" class="level3" data-number="8.5.1">
<h3 data-number="8.5.1" class="anchored" data-anchor-id="durbinwuhausman-test"><span class="header-section-number">8.5.1</span> Durbin–Wu–Hausman Test</h3>
<p>We’ll start with considering tests for exogenous/endogenous regressors. One sign that our model contains endogenous regressors is if there is a significant difference between <span class="math inline">\(\hat{\boldsymbol\beta}_\text{OLS} \)</span> and <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span>. This is why it’s always a good idea to estimate a model with <span class="math inline">\(\hat{\boldsymbol\beta}_\text{OLS} \)</span> even if you think regressors are endogenous. It provides a good reference to compare IV estimates with. In fact, comparing <span class="math inline">\(\hat{\boldsymbol\beta}_\text{OLS} \)</span> and <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span> serve as the basis for one of the most common tests for endogeneity as formalized by <span class="citation" data-cites="hausman1978specification">Hausman (<a href="#ref-hausman1978specification" role="doc-biblioref">1978</a>)</span>.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<p>In the face of endogeneity, <span class="math inline">\(\hat{\boldsymbol\beta}_\text{OLS} \)</span> is an abject failure in light of its inconsistency. Fortunately, <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span> is consistent when <span class="math inline">\(\mathbf{X}\)</span> is endogenous. Furthermore, <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span> is also consistent when <span class="math inline">\(\mathbf{X}\)</span> is exogenous, as the instruments <span class="math inline">\(\mathbf{Z}\)</span> are still valid and relevant. In other words, if <span class="math inline">\(\mathbf{X}\)</span> is exogenous, then <span class="math inline">\(\hat{\boldsymbol\beta}_\text{OLS} \overset{p}{\to}\boldsymbol{\beta}\)</span> <em>and</em> <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \overset{p}{\to}\boldsymbol{\beta}\)</span>, so <span class="math display">\[ \hat{\boldsymbol\beta}_\text{OLS} - \hat{\boldsymbol\beta}_\text{IV} \overset{p}{\to}\mathbf{0}.\]</span> This suggests the following: <span class="math display">\[ H_0: \mathbf{X}\text{ exogenous} \iff H_0:\mathop{\mathrm{plim}}\left(\hat{\boldsymbol\beta}_\text{OLS} - \hat{\boldsymbol\beta}_\text{IV} \right) = \mathbf{0}.\]</span> We can construct a Wald test statistic <span class="math display">\[ W = (\hat{\boldsymbol\beta}_\text{OLS} - \hat{\boldsymbol\beta}_\text{IV} )' \left[\widehat{\text{Avar}}(\hat{\boldsymbol\beta}_\text{OLS} - \hat{\boldsymbol\beta}_\text{IV} ) \right]^{-1}(\hat{\boldsymbol\beta}_\text{OLS} - \hat{\boldsymbol\beta}_\text{IV} ),\]</span> but we will run into a roadblock in the form of <span class="math inline">\(\text{Avar}\left(\hat{\boldsymbol\beta}_\text{OLS} - \hat{\boldsymbol\beta}_\text{IV} \right)\)</span>. If we expand this, we have</p>
<p><span class="math display">\[ \text{Avar}\left(\hat{\boldsymbol\beta}_\text{OLS} - \hat{\boldsymbol\beta}_\text{IV} \right) = \text{Avar}\left(\hat{\boldsymbol\beta}_\text{IV} \right) + \text{Avar}\left(\hat{\boldsymbol\beta}_\text{OLS} \right) - 2\text{Acov}\left(\hat{\boldsymbol\beta}_\text{IV} ,\hat{\boldsymbol\beta}_\text{OLS} \right),\]</span> as <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span> and <span class="math inline">\(\hat{\boldsymbol\beta}_\text{OLS} \)</span> are presumably correlated. We don’t have a formula for the covariance of these estimators handy, and deriving one would be a pain. Fortunately, we don’t have to, because Lemma 2.1 of <span class="citation" data-cites="hausman1978specification">Hausman (<a href="#ref-hausman1978specification" role="doc-biblioref">1978</a>)</span> asserts that the covariance term is such that <span class="math display">\[  \text{Avar}\left(\hat{\boldsymbol\beta}_\text{OLS} - \hat{\boldsymbol\beta}_\text{IV} \right) =  \text{Avar}\left(\hat{\boldsymbol\beta}_\text{IV} \right) - \text{Avar}\left(\hat{\boldsymbol\beta}_\text{OLS} \right)\]</span> due to <span class="math inline">\(\hat{\boldsymbol\beta}_\text{OLS} \)</span> being efficient relative to <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span>.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> This is a particular useful equality, and interesting result in it’s own right. <span class="citation" data-cites="hansen2022econometrics">Hansen (<a href="#ref-hansen2022econometrics" role="doc-biblioref">2022</a>)</span> refers to it as the “Hausman equality”, and gives details about it in Section 8.11. This gives the test statistic <span class="math display">\[\begin{align*}
W &amp;= (\hat{\boldsymbol\beta}_\text{OLS} - \hat{\boldsymbol\beta}_\text{IV} )'\left[\widehat{\text{Avar}}(\hat{\boldsymbol\beta}_\text{IV} ) - \widehat{\text{Avar}}(\hat{\boldsymbol\beta}_\text{OLS} )\right]^{-1} (\hat{\boldsymbol\beta}_\text{OLS} - \hat{\boldsymbol\beta}_\text{IV} ).
\end{align*}\]</span></p>
<p>Unfortunately, the term corresponding to the asymptotic variance will likely fail to be invertible. Unless <span class="math inline">\(\mathbf{X}\)</span> and <span class="math inline">\(\mathbf{Z}\)</span> contain no common variables, some column of <span class="math inline">\((\hat{\mathbb{X}}'\hat{\mathbb{X}})^{-1} - (\mathbb{X}'\mathbb{X})^{-1}\)</span> will be a linear combination of other columns. For example, if our model contains an intercept, than we cannot use this statistic, as <span class="math inline">\(\mathbf{X}\)</span> and <span class="math inline">\(\mathbf{Z}\)</span> will both contain a column of 1’s. This rules out just about every single situation we would ever want to consider. To address this shortcoming, we can take the <a href="https://mathworld.wolfram.com/Moore-PenroseMatrixInverse.html">pseudo-inverse</a> of this matrix.</p>
<p><span class="math display">\[W = (\hat{\boldsymbol\beta}_\text{OLS} - \hat{\boldsymbol\beta}_\text{IV} )'\left[\widehat{\text{Avar}}(\hat{\boldsymbol\beta}_\text{IV} ) - \widehat{\text{Avar}}(\hat{\boldsymbol\beta}_\text{OLS} )\right]^+ (\hat{\boldsymbol\beta}_\text{OLS} - \hat{\boldsymbol\beta}_\text{IV} )\]</span> The hypothesis <span class="math inline">\(\hat{\boldsymbol\beta}_\text{OLS} - \hat{\boldsymbol\beta}_\text{IV} \overset{p}{\to}\mathbf{0}\)</span> is comprised of <span class="math inline">\(K\)</span> separate hypotheses, so it’s tempting to conclude <span class="math inline">\(W\sim \chi_K^2\)</span>. Unfortunately, this will only be the case when <span class="math inline">\(\text{Avar}\left(\hat{\boldsymbol\beta}_\text{IV} \right) - \text{Avar}\left(\hat{\boldsymbol\beta}_\text{OLS} \right)\)</span> is invertible, otherwise we will have <span class="math inline">\(W\sim \chi_q^2\)</span> where <span class="math inline">\(q = \text{rank} \left[ \text{Avar}\left(\hat{\boldsymbol\beta}_\text{IV} \right) - \text{Avar}\left(\hat{\boldsymbol\beta}_\text{OLS} \right) \right]\)</span>.</p>
<div id="thm-" class="theorem">
<p><span class="theorem-title"><strong>Theorem 8.5 (Hausman Specification Test)</strong></span> Given the hypothesis <span class="math inline">\(H_0:\hat{\boldsymbol{\theta}}_e\overset{p}{\to}\boldsymbol{\theta}, \hat{\boldsymbol{\theta}}\overset{p}{\to}\boldsymbol{\theta}\)</span> for some asymptotically efficient estimator <span class="math inline">\(\hat{\boldsymbol{\theta}}_e\)</span>, the <span style="color:red"><strong><em>Hausman statistic</em></strong></span> is defined as <span class="math display">\[H = (\hat{\boldsymbol{\theta}} - \hat{\boldsymbol{\theta}}_e)'\left[\widehat{\text{Avar}}(\hat{\boldsymbol{\theta}}) - \widehat{\text{Avar}}(\hat{\boldsymbol{\theta}}_e)\right]^+ (\hat{\boldsymbol{\theta}} - \hat{\boldsymbol{\theta}}_e).\]</span> Under <span class="math inline">\(H_0\)</span>, <span class="math display">\[ H\sim \chi_q^2\]</span> where <span class="math inline">\(q = \text{rank}\left[\text{Avar}\left( \hat{\boldsymbol{\theta}}\right) - \text{Avar}\left( \hat{\boldsymbol{\theta}}_e\right)\right]\)</span>. The test associated with this statistic is known as the <span style="color:red"><strong><em>Hausman specification test</em></strong></span>.</p>
</div>
<p>The Hausman test is far more general that testing for endogeneity, it just happens that testing for endogeneity is a great application of it. That being said, actually calculating <span class="math inline">\(H\)</span> in the context of <span class="math inline">\(\hat{\boldsymbol\beta}_\text{OLS} \)</span> and <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span> isn’t cut and dried. There are a handful of approaches to this, many of which predate <span class="citation" data-cites="hausman1978specification">Hausman (<a href="#ref-hausman1978specification" role="doc-biblioref">1978</a>)</span> in fact. <span class="citation" data-cites="durbin54">Durbin (<a href="#ref-durbin54" role="doc-biblioref">1954</a>)</span> and <span class="citation" data-cites="wu1973alternative">Wu (<a href="#ref-wu1973alternative" role="doc-biblioref">1973</a>)</span> independently proposed methods of testing <span class="math inline">\(H_0: \mathbf{X}\text{ exogenous}\)</span> based on the idea of contrasting <span class="math inline">\(\hat{\boldsymbol\beta}_\text{OLS} \)</span> with <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span>. The different flavors in test arise from choices about the estimate of <span class="math inline">\(S^2\)</span> used to calculate <span class="math inline">\(\widehat{\text{Avar}}(\hat{\boldsymbol\beta}_\text{IV} )\)</span> and <span class="math inline">\(\widehat{\text{Avar}}(\hat{\boldsymbol\beta}_\text{OLS} )\)</span>, along with whether the intercept term is included in <span class="math inline">\(\mathbf{X}\)</span> and <span class="math inline">\(\mathbf{Z}\)</span>.</p>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.15</strong></span> test</p>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-28_1aabaa1087589b27b697b85152ca7cbc">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>compare_s2 <span class="ot">&lt;-</span> <span class="cf">function</span>(beta, n, dist_vec, dist_params_list, t){</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">sim_endog_linear_model</span>(beta, n, dist_vec, dist_params_list)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  K <span class="ot">&lt;-</span> <span class="fu">ncol</span>(model<span class="sc">$</span>X)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  OLS <span class="ot">&lt;-</span> <span class="fu">lm</span>(model<span class="sc">$</span>y <span class="sc">~</span> model<span class="sc">$</span>X <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  IV <span class="ot">&lt;-</span> <span class="fu">ivreg</span>(model<span class="sc">$</span>y <span class="sc">~</span> model<span class="sc">$</span>X <span class="sc">-</span> <span class="dv">1</span> <span class="sc">|</span> model<span class="sc">$</span>Z <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">S2_IV =</span> <span class="fu">sum</span>(<span class="fu">residuals</span>(IV)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (n <span class="sc">-</span> K),</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">S2_OLS =</span> <span class="fu">sum</span>(<span class="fu">residuals</span>(OLS)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (n <span class="sc">-</span> K),</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">S2_MLE =</span> <span class="fu">sum</span>(<span class="fu">residuals</span>(OLS)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> n,</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter_num =</span> t</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>compare_s2_N_times <span class="ot">&lt;-</span> <span class="cf">function</span>(N, beta, n, dist_vec, dist_params_list){</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>N <span class="sc">%&gt;%</span> </span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(compare_s2, <span class="at">beta =</span> beta, <span class="at">n =</span> n, <span class="at">dist_vec =</span> dist_vec, <span class="at">dist_params_list =</span> dist_params_list) <span class="sc">%&gt;%</span> </span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a><span class="co"># xz_1 &lt;- 0.5</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a><span class="co"># xz_2 &lt;- 0.5</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a><span class="co"># zz &lt;- 0</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a><span class="co"># xe &lt;- 0</span></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a><span class="co"># matrix(c(1, xz_1, xz_2, xe, </span></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a><span class="co">#          xz_1, 1, zz, 0,</span></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a><span class="co">#          xz_2, zz, 1, 0,</span></span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a><span class="co">#          xe, 0, 0, 1), nrow = 4)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-29_2c258b9fb60b7e5e358996ed10e40d5e">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># results %&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_longer(!iter_num) %&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(name) %&gt;%</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     variance = sd(value)</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;% </span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   knitr::kable()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="cor-hausend" class="theorem corollary">
<p><span class="theorem-title"><strong>Corollary 8.2 (Hausman Test for Endogeneity)</strong></span> Given the hypothesis <span class="math inline">\(H_0:\text{E}\left[\mathbf{X}'\boldsymbol{\varepsilon}\right] = \mathbf{0}\)</span> where regressors are partitioned as <span class="math inline">\(\mathbf{X}= [\mathbf{X}_\text{exo},\mathbf{X}_\text{end}]\)</span>, the <span style="color:red"><strong><em>Hausman statistic</em></strong></span> simplifies to <span class="math display">\[H = (\hat{\boldsymbol\beta}_\text{OLS,end} - \hat{\boldsymbol\beta}_\text{IV,end})'\left[\widehat{\text{Avar}}(\hat{\boldsymbol\beta}_\text{IV,end}) - \widehat{\text{Avar}}(\hat{\boldsymbol\beta}_\text{OLS,end})\right]^{-1} (\hat{\boldsymbol\beta}_\text{OLS,end} - \hat{\boldsymbol\beta}_\text{IV,end}).\]</span> Under <span class="math inline">\(H_0\)</span>, <span class="math display">\[ H\sim \chi_q^2\]</span> where <span class="math inline">\(q = \dim(\mathbf{X}_\text{end})\)</span>. I will call the test associated with this statistic is known as the <span style="color:red"><strong><em>Hausman test for endogeneity</em></strong></span>.</p>
</div>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.16</strong></span> Suppose <span class="math inline">\((X, Z, \varepsilon) \sim N(\boldsymbol \mu,\boldsymbol{\Sigma})\)</span> where <span class="math display">\[\begin{align*}
\boldsymbol \mu &amp; = [10,10,0]',\\
\boldsymbol{\Sigma}&amp; = \begin{bmatrix}20 &amp; 5 &amp; 0\\5&amp;20&amp;0\\0&amp;0&amp;1 \end{bmatrix},
\end{align*}\]</span> and <span class="math inline">\(Y = 1 + 3X + \varepsilon\)</span>. We have <span class="math inline">\(\text{Cov}\left(X,\varepsilon\right) = 0\)</span>, so <span class="math inline">\(\text{E}\left[X\varepsilon\right] = 0\)</span> and our model meets the assumptions of the classical linear model (<span class="math inline">\(P_{\boldsymbol{\beta},\sigma^2} \in \mathcal P_\text{LM}\subset\mathcal P_\text{IV}\)</span>). If we draw a sample of size <span class="math inline">\(n = 1,00\)</span>, we can test <span class="math inline">\(H_0:\text{E}\left[X\varepsilon\right] = 0\)</span> using the Hausman statistic calculated using only <span class="math inline">\(\beta_2\)</span> (the slope coefficient). If we repeat this simulation many times, then the distribution of our test statistic should approach <span class="math inline">\(\chi_1^2\)</span>, as <span class="math inline">\(H_0\)</span> is true for our model.</p>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-30_4b59ef306d1fe87d564076979c61deb7">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>DWH_test <span class="ot">&lt;-</span> <span class="cf">function</span>(y, X, Z, end_col){</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  P <span class="ot">&lt;-</span> Z <span class="sc">%*%</span> <span class="fu">solve</span>(<span class="fu">t</span>(Z) <span class="sc">%*%</span> Z) <span class="sc">%*%</span> <span class="fu">t</span>(Z)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  X_hat <span class="ot">&lt;-</span> P <span class="sc">%*%</span> X</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  OLS <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X) <span class="sc">%*%</span> <span class="fu">t</span>(X) <span class="sc">%*%</span> y</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  IV <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">t</span>(X_hat) <span class="sc">%*%</span> X) <span class="sc">%*%</span> <span class="fu">t</span>(X_hat) <span class="sc">%*%</span> y</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  S2_OLS <span class="ot">&lt;-</span> <span class="fu">sum</span>((y <span class="sc">-</span> X <span class="sc">%*%</span> OLS)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (<span class="fu">nrow</span>(X) <span class="sc">-</span> <span class="fu">ncol</span>(X))</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  S2_IV <span class="ot">&lt;-</span> <span class="fu">sum</span>((y <span class="sc">-</span> X <span class="sc">%*%</span> IV)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (<span class="fu">nrow</span>(X) <span class="sc">-</span> <span class="fu">ncol</span>(X))</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  S2_eff <span class="ot">&lt;-</span> <span class="fu">sum</span>((y <span class="sc">-</span> X <span class="sc">%*%</span> OLS)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="fu">nrow</span>(X)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  V_OLS <span class="ot">&lt;-</span> S2_OLS<span class="sc">*</span><span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  V_IV <span class="ot">&lt;-</span> S2_IV<span class="sc">*</span><span class="fu">solve</span>(<span class="fu">t</span>(X_hat) <span class="sc">%*%</span> X_hat)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  H1 <span class="ot">&lt;-</span> <span class="fu">t</span>(IV[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> OLS[<span class="sc">-</span><span class="dv">1</span>]) <span class="sc">%*%</span> <span class="fu">pinv</span>(<span class="fu">as.matrix</span>(V_IV[<span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> V_OLS[<span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>])) <span class="sc">%*%</span> (IV[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> OLS[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  H2 <span class="ot">&lt;-</span> <span class="fu">t</span>(IV <span class="sc">-</span> OLS) <span class="sc">%*%</span> <span class="fu">pinv</span>(V_IV <span class="sc">-</span> V_OLS) <span class="sc">%*%</span> (IV <span class="sc">-</span> OLS)</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  H3 <span class="ot">&lt;-</span> (<span class="fu">t</span>(IV <span class="sc">-</span> OLS) <span class="sc">%*%</span> <span class="fu">pinv</span>(<span class="fu">solve</span>(<span class="fu">t</span>(X_hat) <span class="sc">%*%</span> X_hat) <span class="sc">-</span> <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X)) <span class="sc">%*%</span> (IV <span class="sc">-</span> OLS))<span class="sc">/</span>S2_OLS</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>  H4 <span class="ot">&lt;-</span> (<span class="fu">t</span>(IV <span class="sc">-</span> OLS) <span class="sc">%*%</span> <span class="fu">pinv</span>(<span class="fu">solve</span>(<span class="fu">t</span>(X_hat) <span class="sc">%*%</span> X_hat) <span class="sc">-</span> <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X)) <span class="sc">%*%</span> (IV <span class="sc">-</span> OLS))<span class="sc">/</span>S2_IV</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>  H5 <span class="ot">&lt;-</span> (<span class="fu">t</span>(IV <span class="sc">-</span> OLS) <span class="sc">%*%</span> <span class="fu">pinv</span>(<span class="fu">solve</span>(<span class="fu">t</span>(X_hat) <span class="sc">%*%</span> X_hat) <span class="sc">-</span> <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X)) <span class="sc">%*%</span> (IV <span class="sc">-</span> OLS))<span class="sc">/</span>S2_eff</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>  H6 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> X <span class="sc">+</span> P <span class="sc">%*%</span> X[,end_col] <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="fu">ncol</span>(X) <span class="sc">-</span> <span class="dv">1</span> <span class="sc">+</span> end_col) <span class="sc">%&gt;%</span> </span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">statistic =</span> statistic<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(statistic) <span class="sc">%&gt;%</span> </span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>()</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">stat =</span> <span class="fu">c</span>(H1, H2, H3, H4, H5, H6),</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">include_constant =</span> <span class="fu">c</span>(F, T, T, T, T, <span class="cn">NA</span>),</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">common_S2_value =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">"OLS"</span>, <span class="st">"IV"</span>, <span class="st">"MVE"</span>, <span class="cn">NA</span>),</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">version =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>draw_DWH_test <span class="ot">&lt;-</span> <span class="cf">function</span>(end_col, beta, n, dist_vec, dist_params_list, t){</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">sim_endog_linear_model</span>(beta, n, dist_vec, dist_params_list)</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">DWH_test</span>(model<span class="sc">$</span>y, model<span class="sc">$</span>X, model<span class="sc">$</span>Z, end_col) <span class="sc">%&gt;%</span> </span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">iter_num =</span> t)</span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>draw_N_DWH_test <span class="ot">&lt;-</span> <span class="cf">function</span>(N, end_col, beta, n, dist_vec, dist_params_list){</span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>N <span class="sc">%&gt;%</span> </span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(draw_DWH_test, <span class="at">end_col =</span> end_col, <span class="at">beta =</span> beta, <span class="at">n =</span> n, <span class="at">dist_vec =</span> dist_vec, <span class="at">dist_params_list =</span> dist_params_list) <span class="sc">%&gt;%</span> </span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a><span class="co"># results &lt;- draw_N_DWH_test(</span></span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a><span class="co">#   N = 1e3,</span></span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a><span class="co">#   end_col = 2,</span></span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a><span class="co">#   beta = c(0,3),</span></span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a><span class="co">#   n = 1e3,</span></span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a><span class="co">#   dist_vec = c(rmvnorm),</span></span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a><span class="co">#   dist_params_list = list(</span></span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a><span class="co">#     list(</span></span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a><span class="co">#       mean = c(10, 10, 0),</span></span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a><span class="co">#       sigma = matrix(c(20,5,0, 5,20,0,0,0,3), nrow = 3)</span></span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a><span class="co">#     )</span></span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-65"><a href="#cb31-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-66"><a href="#cb31-66" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb31-67"><a href="#cb31-67" aria-hidden="true" tabindex="-1"></a>S <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">2</span><span class="sc">*</span>k<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb31-68"><a href="#cb31-68" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k) {</span>
<span id="cb31-69"><a href="#cb31-69" aria-hidden="true" tabindex="-1"></a>  S[i, <span class="dv">2</span><span class="sc">*</span>k<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> S[<span class="dv">2</span><span class="sc">*</span>k<span class="sc">+</span><span class="dv">1</span>, i] <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb31-70"><a href="#cb31-70" aria-hidden="true" tabindex="-1"></a>  S[i<span class="sc">+</span>k,i] <span class="ot">&lt;-</span> S[i,i<span class="sc">+</span>k] <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb31-71"><a href="#cb31-71" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-72"><a href="#cb31-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-73"><a href="#cb31-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-74"><a href="#cb31-74" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">sim_endog_linear_model</span>(</span>
<span id="cb31-75"><a href="#cb31-75" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb31-76"><a href="#cb31-76" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fl">1e3</span>,</span>
<span id="cb31-77"><a href="#cb31-77" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_vec =</span> <span class="fu">c</span>(rmvnorm),</span>
<span id="cb31-78"><a href="#cb31-78" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_params_list =</span> <span class="fu">list</span>(</span>
<span id="cb31-79"><a href="#cb31-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb31-80"><a href="#cb31-80" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb31-81"><a href="#cb31-81" aria-hidden="true" tabindex="-1"></a>      <span class="at">sigma =</span> S</span>
<span id="cb31-82"><a href="#cb31-82" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-83"><a href="#cb31-83" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-84"><a href="#cb31-84" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-85"><a href="#cb31-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-86"><a href="#cb31-86" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> model<span class="sc">$</span>y</span>
<span id="cb31-87"><a href="#cb31-87" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> model<span class="sc">$</span>X</span>
<span id="cb31-88"><a href="#cb31-88" aria-hidden="true" tabindex="-1"></a>Z <span class="ot">&lt;-</span> model<span class="sc">$</span>Z</span>
<span id="cb31-89"><a href="#cb31-89" aria-hidden="true" tabindex="-1"></a>P <span class="ot">&lt;-</span> Z <span class="sc">%*%</span> <span class="fu">solve</span>(<span class="fu">t</span>(Z) <span class="sc">%*%</span> Z) <span class="sc">%*%</span> <span class="fu">t</span>(Z)</span>
<span id="cb31-90"><a href="#cb31-90" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb31-91"><a href="#cb31-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-92"><a href="#cb31-92" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(y <span class="sc">~</span> X <span class="sc">+</span> P <span class="sc">%*%</span> X[, <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)] <span class="sc">-</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ X + P %*% X[, c(2, 3, 4)] - 1)

Coefficients:
                    Xx1                      Xx2                      Xx3  
                 1.0225                   1.6667                   1.6667  
                    Xx4  P %*% X[, c(2, 3, 4)]x2  P %*% X[, c(2, 3, 4)]x3  
                 1.6667                  -0.5896                  -0.7273  
P %*% X[, c(2, 3, 4)]x4  
                -0.7962  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>P <span class="sc">%*%</span> X[, <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   x2           x3            x4
   [1,]  0.5886033565  0.587510394 -0.4261059433
   [2,] -0.2471356485 -0.226466846 -0.8235906347
   [3,] -0.0596990855 -0.693126300 -0.1783553080
   [4,]  0.6127954318 -0.828075044 -0.8253552633
   [5,]  0.6747809192  0.105364376 -0.2408934882
   [6,]  0.2066412685  1.259007463 -0.0120729842
   [7,]  1.1296586941  0.112798631  0.3587761825
   [8,]  0.1374868550  0.612470751 -0.8261569241
   [9,]  0.1858408119 -0.350805045  0.0731109167
  [10,] -0.2338751250  0.284546278  0.1727683128
  [11,]  0.4448204320  0.269289847  0.1300906255
  [12,] -0.1117983135  0.287464845 -0.2505362416
  [13,]  0.2243454779 -0.389330735 -0.7225660501
  [14,] -0.0826734041 -0.204170968 -0.0793122062
  [15,]  0.7075839639 -0.237241454  0.8436454190
  [16,] -0.1108678826 -0.288734758  0.4648510319
  [17,]  0.4188646191  0.906871749  0.8669133343
  [18,]  0.6439059972  0.853962666 -1.2398476442
  [19,]  0.3976963261  0.065582141 -1.0647932440
  [20,]  0.0259971430  0.270749813 -0.0107418751
  [21,]  1.5262816966 -0.846028983  0.1048687684
  [22,] -0.7686398781  0.344941590  0.0073019619
  [23,]  0.4055309795  0.012037656 -0.9577901262
  [24,] -0.2643090731  0.621205974 -0.1669402201
  [25,]  0.3238483335 -0.155412442  0.3785523627
  [26,] -0.1812111878 -1.108854785  0.0550864465
  [27,]  0.0463545564 -0.265744483 -0.7018188584
  [28,] -0.1349391394  0.744690609 -0.0205837853
  [29,]  0.2551868834 -0.532412982 -0.1312707482
  [30,]  0.4084534212 -0.563412530 -0.1291947620
  [31,] -0.5106054358 -0.433132686  0.6028064283
  [32,] -0.2640618307  0.612091062 -0.1255834219
  [33,] -0.1757062004  0.125261073 -0.4184188252
  [34,]  0.7787492668  0.391705915 -0.0204692696
  [35,] -0.3608008359  0.825672169 -0.0960386507
  [36,]  0.4104447820  0.047673798 -0.3446474488
  [37,]  0.1150711441  0.070028144 -0.5851386738
  [38,]  0.3133975949  0.881459489 -0.1137537575
  [39,] -0.2327392353 -0.465321770 -0.3374876635
  [40,] -0.2563431986 -0.767392863  0.8625087410
  [41,]  0.7976100478 -0.423327827 -0.3268780082
  [42,] -0.3952868438  0.643454108  0.2782995016
  [43,]  0.0692553850 -0.057895184  0.1509676848
  [44,] -0.5664407804 -0.575729661  0.6979359042
  [45,]  0.4242771945 -0.352256198 -0.1067313586
  [46,] -0.0807410367  0.032185649 -1.0931038559
  [47,] -0.0418572167 -0.181230428 -0.6253949636
  [48,]  0.1868340039  0.676314436  0.0792063979
  [49,]  0.2604364324 -0.374191569  0.3386020660
  [50,] -0.9615135082 -0.516568327  0.0704793328
  [51,] -0.2112322493 -0.053688588  0.3374281357
  [52,] -0.3249351459 -0.039075415  0.1072569932
  [53,] -0.4552258443 -0.214381154  0.0602388021
  [54,] -0.3855798598 -0.490686465  0.4516735580
  [55,]  0.5713229641  0.275354648 -0.1297776374
  [56,] -0.8450400291  0.505431089 -0.0289168506
  [57,] -0.0191721181 -0.114046664 -0.7604800022
  [58,] -0.0707072284  1.069917393  0.5258244252
  [59,] -1.0638891882 -0.195449964 -0.0554850757
  [60,] -0.3136247276  0.555250568  0.2631471338
  [61,] -0.6560714881  0.248705505 -0.2121067029
  [62,]  0.4857965172 -0.015394031  0.1020329886
  [63,] -0.4687880477 -0.758721318  0.0537144529
  [64,] -0.2702194100 -0.064656767 -0.3552598330
  [65,]  0.0224324853  0.115256396 -0.4810727554
  [66,] -0.2704259039  0.101707310 -0.7089959452
  [67,] -1.1045851985 -0.106607455  0.7548176620
  [68,]  0.2169616698  0.632587762  0.3593893160
  [69,]  0.2803508645  0.333194448 -0.6597388904
  [70,]  0.0405547753 -0.173331857 -0.1672252596
  [71,] -1.1545568766 -0.429411786  0.8905475761
  [72,] -0.5671923639 -0.394767931 -0.4934596150
  [73,]  0.5458082987 -1.015108421 -0.2108797046
  [74,] -0.3941981781 -0.345929321 -0.4784923831
  [75,]  1.2344439507  0.468004894  0.4104700018
  [76,]  0.7386548405 -0.342196769 -1.0320368473
  [77,] -1.0793948569  0.091119759  0.1013759323
  [78,] -1.1337676701  0.012670732  0.2078130205
  [79,] -0.1819984852 -0.194158265  0.5628439353
  [80,] -0.0057791495 -0.068339221  0.6259389465
  [81,] -0.8428410015  0.315227499  0.1837765309
  [82,] -0.8401104175 -0.405855927 -0.2987845204
  [83,] -0.0124948927 -0.294279811 -0.3137281021
  [84,] -0.7830493379  0.170362630 -0.7117845605
  [85,]  0.1563860769 -0.182429252  0.0094030729
  [86,]  0.4429940458 -0.049201255  0.5045748850
  [87,] -0.5053511484 -0.345712795 -0.4414635191
  [88,] -0.3530881743  0.136248455  0.1915930303
  [89,] -0.2049125779  0.097271014 -0.0128120231
  [90,] -0.4312283203 -0.011176274  0.3430285415
  [91,] -0.7679576932  0.425114884 -0.5705925127
  [92,] -0.7983307280  0.063211886 -0.9162986618
  [93,]  0.1834218177  0.300329117 -0.0505630011
  [94,] -0.1392557677  0.068146266  0.4729409056
  [95,]  0.2082813307 -0.035416209  0.1725695327
  [96,] -0.8951656436  0.157227676 -0.3424964096
  [97,] -1.1588311725  0.609845336 -0.2454264150
  [98,]  0.7981173857 -0.504433034 -0.6634741420
  [99,]  1.5584752624 -0.791541572  0.0140432506
 [100,] -0.5388583556 -0.450861677  0.1602807023
 [101,]  0.1823505284 -0.114903475  0.6915969057
 [102,] -0.1051252951 -0.080585266  1.0581433559
 [103,] -0.0818280481 -0.153634102  0.3733250758
 [104,]  0.4316957884 -0.111925987  0.7504063542
 [105,]  0.4660034138 -0.377606113 -0.1606289506
 [106,]  1.1954228712  0.470137909 -0.2735576139
 [107,]  0.8031593000  1.022583598  0.2440899284
 [108,] -0.0779729376  0.223737080  0.1148687337
 [109,] -0.1414662703 -0.044178480 -0.2717634989
 [110,] -0.5313528443 -0.227131090  0.4470983317
 [111,]  0.4635277487 -0.162762484 -0.3451633444
 [112,] -0.4697504477 -0.953960123 -0.5624821509
 [113,]  0.0067056434  0.720638257  0.3749779276
 [114,]  0.6340725811 -0.428377873 -0.1965800705
 [115,]  0.6935879801 -0.287892845 -0.7260826764
 [116,]  0.4683411817 -0.793682023 -0.3178508056
 [117,] -0.6492040904 -0.517477734 -0.2338930952
 [118,]  1.0771683371  0.383847510 -0.0109448105
 [119,] -0.3516839339  0.451685678 -0.3220195767
 [120,]  0.0246793098 -0.309967570 -0.2629345539
 [121,] -0.7322723718  0.316924979  0.6149928852
 [122,]  0.0839752221 -0.066815905 -0.9359238264
 [123,] -0.1620065130 -1.133200668 -0.4665972051
 [124,]  0.1804797013  0.533697638 -0.3329018344
 [125,] -0.1983768682 -0.358195827  0.5691556667
 [126,] -0.0216923367 -0.189010111  0.0406295259
 [127,]  1.0029689558 -0.573687753 -0.9694013649
 [128,] -0.5636055513 -0.027273927  0.0591985997
 [129,] -0.2900355611  1.371163530  0.3083218402
 [130,] -0.7242794005 -0.592290073  0.6429673739
 [131,]  0.4872806674  0.153386978 -0.0583256970
 [132,]  0.5944878141  0.406125391  0.2740835194
 [133,] -0.2274973091 -0.687346796 -0.7660021274
 [134,]  0.8337529086  0.318317097  0.2712592527
 [135,]  0.6206404855  1.229140421 -0.3078444558
 [136,]  0.1504218207 -0.119661111  0.3402871976
 [137,]  0.3956151535 -0.759622625 -0.0341991494
 [138,]  0.2311528544 -0.615271999 -0.5236037150
 [139,] -0.5726108424 -0.117711768  0.6402035112
 [140,] -0.3080220702 -0.402419214  0.0113882697
 [141,]  1.4519086366 -0.450182592 -0.4004635820
 [142,]  0.3877307452 -0.089902028 -0.1306417603
 [143,]  0.0540461211 -0.734512753 -0.0558703049
 [144,] -0.3151807736  0.086402381  0.2548936529
 [145,] -0.3377300429  0.167453029  0.2710593347
 [146,]  0.3257879158  0.416145927  0.6003701035
 [147,]  0.0679590475 -0.369203489  0.4356660978
 [148,] -0.7515520486 -0.723320410 -0.0590830875
 [149,]  0.5600211664 -0.009410580  0.3305201488
 [150,]  1.0734372384  0.338920300  0.5670648948
 [151,] -0.7398796765  0.795484756  0.0708872928
 [152,] -0.3847922156  0.609449837  0.1942513843
 [153,] -0.6413884088  0.027659479  0.4275969620
 [154,]  0.0095986321 -0.281577890  0.4237613966
 [155,]  0.1441454275  0.329387253 -0.1078223007
 [156,] -0.7639933981  0.026720052  0.5653202121
 [157,] -0.7699071120 -1.161903396  0.2262995266
 [158,]  0.5326957427  0.371836860 -0.3835793200
 [159,] -0.5739444932 -0.390819285  0.1948858757
 [160,]  0.6295938045 -0.527354710 -0.1464820804
 [161,]  0.3962559516 -0.152775725 -0.3335353459
 [162,] -0.2194086756  0.480593969 -0.3570302805
 [163,]  0.1424675646  0.348171712 -0.2591210316
 [164,] -0.0554753050 -0.732215477 -0.7079682907
 [165,] -0.4214793502 -0.466378674 -0.6328977092
 [166,]  0.6473021422 -0.432073302  1.1849321348
 [167,] -0.0339043017  0.429608207  0.1779778376
 [168,]  0.0726500120 -0.839888951 -0.0084383106
 [169,] -0.4239232120  0.176167247 -0.6647950631
 [170,]  0.3070997351 -0.256764395  0.0816246887
 [171,]  0.8625859557  1.209123575  0.6192171642
 [172,]  0.9844627340 -0.203357061 -0.1046494125
 [173,] -0.5436546939 -0.349824989  0.1783779223
 [174,] -0.2217258783 -0.211558175  0.3309067484
 [175,]  0.1324585981 -0.447370998  0.5341169156
 [176,]  0.1179578569  0.137665697 -0.2281489512
 [177,] -0.0322689509  0.715125893  0.0775959206
 [178,]  0.5735080211 -0.804834442  0.4956169093
 [179,]  0.0066141492  0.131230356  0.4142555973
 [180,]  0.2180169893  0.496639741 -0.6566508082
 [181,] -0.4970284483 -0.401368077  0.4075732340
 [182,] -0.0379284618  0.128295303 -0.4607066660
 [183,]  0.2673105663 -0.353973123 -0.6014635462
 [184,] -0.0071162116  0.048467591  0.5137175845
 [185,]  0.4495583815 -0.618100103  0.3506668896
 [186,]  0.8995975335  0.402248023  0.2993837080
 [187,]  1.1586894048 -0.374071972  0.3858292080
 [188,]  0.5095427911  0.477737117 -0.5147349926
 [189,]  0.0939438878  0.978039256 -0.8130001276
 [190,] -0.4374653591  0.607632821  0.5221304926
 [191,]  0.7701210237 -0.592649325  0.9283137182
 [192,]  0.0063371253 -0.700721957 -0.2832461710
 [193,]  0.0835773583 -0.061676980 -0.0882369220
 [194,]  1.0199212577 -0.148968190 -0.0291805989
 [195,] -0.0413388734  0.171559896 -0.6342472849
 [196,]  0.2460128594  0.709999390  0.3487242810
 [197,]  0.1274022470  0.637138602  0.0891186144
 [198,] -0.1255717260  0.663280237  0.5671920844
 [199,] -0.1392070713 -0.343092128  0.6737849942
 [200,] -0.4637217929 -0.618678776 -0.0547310792
 [201,]  0.9363196679 -0.255806425  0.2467516045
 [202,]  0.0678566041  0.290507432 -0.1155857491
 [203,] -0.6653200334  0.229514380  0.0761124891
 [204,]  1.0449911852 -1.132346633  0.6772642481
 [205,]  0.7131987412 -0.046949631  1.0864299937
 [206,]  1.2962771880 -0.285132395 -0.3404000515
 [207,] -0.1198303338 -0.500475600  0.4237968773
 [208,]  0.1102993331 -0.495648876 -0.7363584623
 [209,] -0.3856354602 -0.365182188  0.1335123020
 [210,] -0.3066420740  0.379628201  0.0409911610
 [211,]  0.2828556287  0.630758035 -0.5761778889
 [212,] -0.0166146008  0.681631188 -0.1157438504
 [213,]  0.3300938627 -0.049635419  0.3391800440
 [214,]  0.0054954194  0.535260636 -0.0224819224
 [215,] -0.5252987461  0.422765454  0.3201877584
 [216,] -0.9729777132  0.063629176 -0.0477597603
 [217,] -0.4502367084 -0.671140097 -0.2176513679
 [218,]  0.1538779156 -0.576805786  0.5116701277
 [219,] -0.4403301925  0.498939534  0.1299129982
 [220,]  0.0879612237 -0.790368535 -0.3979320941
 [221,] -0.2949821861  0.449693534 -0.0675775436
 [222,]  0.1230140833  0.368655337 -0.3079885490
 [223,]  0.1282708614 -0.290047833 -0.1135748388
 [224,]  0.1206381273 -0.344384223  0.6664999116
 [225,] -1.2312795417 -0.714610055 -0.0810478955
 [226,]  0.7715765044 -0.461067301  0.2868349147
 [227,] -0.1508298226 -0.102582309  0.9630495631
 [228,]  0.3579992901 -0.661212535 -0.4225405739
 [229,]  0.3332411831  0.411965847 -0.5161765305
 [230,] -0.1714268745  0.385053622 -0.7221317068
 [231,]  0.6270368407 -1.485452730 -0.5245376226
 [232,] -0.0376123379  0.650247083  0.2874334037
 [233,] -0.3184244755 -0.174211751  0.5043867636
 [234,]  0.2166604630 -1.078366026 -0.0430264908
 [235,]  0.3703280426 -0.058012311  0.2673570682
 [236,]  0.6640778777  0.557733920 -0.2970254080
 [237,]  0.1877156686  0.294579667  0.3192558470
 [238,] -0.6116195421 -0.257447964  0.3313563205
 [239,]  0.1462276794  0.055456971  0.2235020163
 [240,] -0.0402535703 -0.535457056  0.0134546540
 [241,] -0.2728479945 -0.292806777  0.1218008601
 [242,]  0.5851246707  0.162101533  0.0571250455
 [243,] -0.3984492346 -0.130021243 -0.0393458355
 [244,]  0.1855891342 -0.067597882 -0.5430060674
 [245,] -0.8643681827  0.522274086 -0.0434873114
 [246,]  0.1558689095 -0.463380027  1.0156782870
 [247,] -0.2195083097 -0.612317302 -0.8852245109
 [248,]  0.8539392893 -0.180278959  0.0351518771
 [249,]  0.4624480469 -0.021152189 -0.5544657280
 [250,]  0.0105846654 -0.484477827  0.5946232470
 [251,]  0.2150351449 -0.553286350 -0.6019173039
 [252,]  0.0166286941 -0.263142858 -0.4691486547
 [253,] -0.2494850822 -0.301339732  0.9845797863
 [254,] -0.0669696522 -0.329030488  0.9797344934
 [255,]  0.2757115586  0.007232860  0.1393017642
 [256,] -0.4506424282  0.651732954  0.8745777979
 [257,]  0.4279500415  0.144195240 -0.3779352836
 [258,]  0.1401624801  0.093945432  0.2407134407
 [259,]  0.0589102831  0.057916760 -0.2364992291
 [260,]  0.0268827244  1.243588582  0.1145302468
 [261,]  0.4540217746 -0.716065030  0.3149983120
 [262,] -0.4141014507 -0.774448068  0.6046383100
 [263,] -0.8538881496  0.041035279  0.1165054100
 [264,] -0.4478023865  0.089426436  0.9506770839
 [265,] -0.2169987837  0.272624077  0.1874119116
 [266,] -0.2170228589 -0.069296203  0.3162467835
 [267,]  0.0023375138 -0.211113632  0.2396722217
 [268,]  0.4418617477  0.066181818 -0.3539829069
 [269,] -0.4368344464 -0.576907161  0.5433468210
 [270,]  0.9803717532 -0.224508761  0.4048297409
 [271,] -0.0655868233 -0.731596933  0.7287797915
 [272,]  0.1327449012  0.080304283  0.1741450074
 [273,] -0.4857541750  0.371286813  0.8482387455
 [274,]  1.0938596573 -0.720234020 -0.1597099766
 [275,]  1.1344300626 -0.623935883  0.0735748924
 [276,] -0.4918695002  1.380084297 -0.5674001411
 [277,] -0.6296843339 -0.353930287  0.3053773357
 [278,]  0.6984914465 -0.310421503  0.3878776196
 [279,]  0.1941131414 -0.428030652 -0.1593052484
 [280,]  0.6616694228  0.950307338 -0.2929172947
 [281,]  0.1933575245 -0.249536395  0.6596457585
 [282,] -0.0959629270  0.496323021  0.0688344740
 [283,] -0.2882123092  0.031031627  0.3545314430
 [284,]  0.0176879156  0.295225426 -1.1231701904
 [285,] -0.3960505961  0.219848269  0.1550959821
 [286,]  0.2427300198  0.287465161 -0.0106647638
 [287,] -0.0151238764 -0.321533606  0.5116016847
 [288,] -0.5992147093 -0.151274446 -0.1084788181
 [289,]  0.4976561570 -0.632858501  0.7639074431
 [290,] -0.4547181974 -0.067447146 -0.0050207963
 [291,]  0.7962025629  0.466389301 -0.1318621504
 [292,]  0.4236268970 -0.823020090  0.0518896227
 [293,] -0.3960132093  0.690882686 -0.4887760997
 [294,]  0.0050030322 -0.426079711  0.4467122371
 [295,] -0.5703705078 -0.600268307  0.0707265585
 [296,]  0.2100389072 -0.265073036 -1.1064404760
 [297,] -1.0755521139  0.560303750  0.2438245921
 [298,] -0.7329844867  0.256011810 -0.5519755750
 [299,]  1.0146714025  0.520850053  0.0866824683
 [300,]  0.7638805078 -0.266306595  0.7449709523
 [301,]  0.7840125812 -0.894379926  0.0128147383
 [302,] -0.6775631210  0.572381014  0.0363754928
 [303,]  0.5465160506 -0.036277487  0.2760631875
 [304,] -0.1181942117 -0.259876289 -0.8486589569
 [305,]  0.0756308006 -0.189544014  0.2292230300
 [306,] -0.2135226968 -0.667280322  0.0945339485
 [307,] -0.5579860670 -0.729518032 -0.0815803080
 [308,] -0.2711475602  0.546160403 -0.4174914795
 [309,] -0.9011354872 -0.090484900 -0.4651551456
 [310,]  0.5733718766 -0.875989981 -0.6106288669
 [311,]  0.7140626812  0.345107828  0.5452878912
 [312,]  0.0697028059  0.384871234  0.7948615285
 [313,] -0.2842087086  0.003747997  0.4322277417
 [314,] -0.1683379263 -0.137725770 -0.0420680559
 [315,]  0.3016993768 -0.354408460 -0.4941318040
 [316,] -0.1676000760  0.294802325  0.4023276926
 [317,]  0.6760265300  0.167556901 -0.0241270005
 [318,] -0.5597893162 -0.206430834  0.3253945011
 [319,]  0.1918882456  0.333946407 -0.2467519913
 [320,]  1.2341317754 -0.045786306  0.0994923912
 [321,] -0.9619659304  0.074238505  0.3357692497
 [322,] -0.1928561040  0.090631701 -0.0677755126
 [323,]  0.1692120802 -0.646046941  0.2600142006
 [324,] -1.1668098741  0.305790225 -0.3254437889
 [325,]  1.0369955195  0.028766318 -0.2248353539
 [326,]  0.0131901911  0.701587436  0.7075816235
 [327,] -0.4574348181  0.090232799  0.1624854905
 [328,]  0.3479840085  0.153219236  0.0166396717
 [329,]  0.4161925252 -0.433771861 -0.7179682688
 [330,] -0.3897437628 -0.510762046 -0.1521181991
 [331,]  0.2158873367  0.070553145 -0.0417501477
 [332,]  0.2906037607  0.290337874 -0.0280481782
 [333,] -0.3665029738 -0.506955843  0.4062034857
 [334,] -0.4290284544  0.130751225  0.8536709005
 [335,] -0.3913321028 -0.030700966  0.8520724403
 [336,] -0.9000502935 -0.755297831  0.5648389984
 [337,]  0.1256962672  0.198532480 -0.3675439107
 [338,]  0.1417586271  0.192186486  0.5272266269
 [339,] -0.5217872710  0.860657738 -0.2243543356
 [340,]  0.1508652761  0.323544172 -0.4498152330
 [341,] -1.1639026724 -0.865969900  0.2816032644
 [342,]  1.4126511409 -0.479900256  0.8578249288
 [343,]  0.5453319281  0.069053953 -0.7724004505
 [344,]  0.6675700416 -0.448576011 -0.4576577968
 [345,]  0.1238090651 -0.872983250 -0.2172455019
 [346,] -0.2909623278 -0.191141677  0.2963576428
 [347,]  0.5632473020  0.314156753  0.2532647898
 [348,]  0.0259701427 -0.506000923  0.2792031046
 [349,]  0.0621669172 -0.178796117 -0.2640877601
 [350,]  0.1730979045  0.432789314  0.6567602181
 [351,] -0.4954639511  0.362935885 -0.1481191684
 [352,]  0.2681620986 -0.906573139 -0.2757923539
 [353,] -0.0605625070 -0.618209906  1.3189983946
 [354,] -0.7163394200  0.653137232  0.1671448261
 [355,]  0.4572629725 -0.383768374  0.3607912851
 [356,] -0.7808727808 -0.456666372  0.3670450757
 [357,]  0.6099426305  0.030628757 -1.0614643268
 [358,] -0.1720915120 -0.230906720 -0.1413696334
 [359,]  0.7805520748 -0.355809093  0.3103596846
 [360,]  0.0824614693  0.177463210  0.0872721435
 [361,]  0.1894363414 -0.110498063 -0.5482521136
 [362,]  0.4714967510 -0.474916344  0.4090275800
 [363,]  0.3497939626  0.421506883 -0.4914580132
 [364,]  0.1825699824 -0.375496185 -0.0494927066
 [365,]  0.1595271331 -0.607069464  0.1215868744
 [366,] -1.0510873500  0.790760145 -0.5710784065
 [367,] -0.5788614451  0.490028476 -0.4555873837
 [368,] -0.8724932762  0.288449057 -0.1332258043
 [369,]  0.2217306763  0.577235270 -0.8676969163
 [370,] -0.5018951367 -0.351975455 -0.2860294765
 [371,] -0.4178145162  0.096980399  0.0786215119
 [372,]  0.4403164914 -0.246158020 -0.7125494236
 [373,]  0.2113728081  0.705990254  0.3109562773
 [374,] -0.0489084717 -0.640557928 -0.1763842420
 [375,] -0.0044685327  0.165113588 -0.3837495432
 [376,] -0.3799725001 -0.130606871  0.4803405550
 [377,]  0.3121829409  0.159808791 -0.1329915596
 [378,] -0.3258161226  0.237210202 -0.2031868646
 [379,]  0.5748951633 -0.753451558 -0.1358412874
 [380,] -0.2311154150 -0.505805033  0.3759156137
 [381,] -0.4472428356  0.347393792 -0.3208092510
 [382,] -0.0664850482  0.958180641  0.2673116145
 [383,]  0.0155826301 -0.286630087  0.3190691840
 [384,] -0.5620810738 -0.560706706  0.0925495186
 [385,] -0.4437251600 -0.971626190  1.4742650730
 [386,]  0.4668895054 -0.095157737 -0.4186825606
 [387,]  0.7435349044  0.546291810 -0.0002096101
 [388,] -0.7467536058  0.423576509 -0.5367925899
 [389,]  0.6176628017 -0.315439682 -0.1355202978
 [390,] -0.4475456637  0.472716340 -0.4779459990
 [391,]  0.2359502963  0.264724220 -0.9820629522
 [392,] -0.9134599153 -0.356262996  0.2664644230
 [393,]  0.2516453657 -0.259668339 -0.0504299113
 [394,] -0.7856862307 -0.311806361 -0.4861751870
 [395,] -0.5020683464  0.374171191  0.8497290242
 [396,] -0.4754906976  0.760401345  0.2355817073
 [397,]  0.5779233039  0.274536111 -0.5321215770
 [398,]  0.5549098475  0.868246788 -0.6279842511
 [399,] -0.6423863365 -0.015663429 -0.5296597343
 [400,]  0.8829340369 -0.802365065  0.6981887128
 [401,] -0.0848617512  0.395070920 -0.0055765910
 [402,] -0.0963718644 -0.016048507 -0.6190413979
 [403,]  0.3131387190 -0.241968630  1.0114108580
 [404,]  0.5886080166  0.589465287  0.5802065979
 [405,] -0.3076040051  0.766680545  0.2537736363
 [406,]  0.6728694235  0.679353634 -0.1713516486
 [407,]  0.5180199822  0.708320108 -0.0338418927
 [408,]  0.4033208125 -0.144787234  0.0346906313
 [409,]  0.3924255651  0.146013332 -0.1500709677
 [410,] -0.4416283762  1.053776447  0.6159567510
 [411,] -0.0571673004  0.140921355  0.8276690306
 [412,]  0.4027065934  0.268938283 -0.7903388142
 [413,]  0.0416088884 -0.569624238  0.3075939346
 [414,]  0.5431657341  0.387010282  0.2734565677
 [415,]  1.3054464917 -0.374817374 -0.3179006810
 [416,]  0.6194531213  0.424463434 -0.1892033413
 [417,]  0.2347529185 -0.426744051 -0.1907356733
 [418,]  0.3320105199  0.355393428 -0.5293347597
 [419,]  0.0755591439  0.289342829 -0.6515588803
 [420,]  0.5500372844 -0.274763614 -0.2717030355
 [421,] -0.0793241034 -0.045158279  0.0030995632
 [422,]  0.5367195745  0.362339043  0.2393712557
 [423,]  1.1090888985 -0.775371743 -0.0811150693
 [424,]  0.3397159618  1.092244866  0.3881138142
 [425,]  0.9462699376  0.137284388 -0.5476452177
 [426,]  0.8502274886 -1.288827175  0.2550155274
 [427,] -0.0404949637 -1.462840079 -0.2164211544
 [428,] -0.1783813666 -0.245010419  0.7326594186
 [429,]  0.8141186703  0.412484391 -0.0401605370
 [430,]  0.2129025920 -0.016589639  0.6423581190
 [431,]  0.7758382212  1.003075786 -0.7682408390
 [432,] -0.4465914234  0.150086420  0.1663935744
 [433,]  0.0997611914  1.082162198  0.8275725567
 [434,]  0.8914667150 -0.158207679 -0.2324235352
 [435,]  0.0982900091 -0.155040049 -0.2172133820
 [436,]  0.3554647551 -0.456887526  0.2555204753
 [437,]  0.5926305700 -0.470479182  0.0068006507
 [438,] -0.0590059516  1.118044551  0.9921087006
 [439,] -0.0759388245  0.441958415  0.2709769484
 [440,]  0.7208834107  0.192344557 -0.7729573244
 [441,]  0.1650600113 -0.274036767  0.1110471124
 [442,]  0.5338896372  1.372336725  0.6285752477
 [443,] -0.0581225770  0.351185408  0.4519228651
 [444,] -0.1700376447 -0.362592891  1.1187076347
 [445,] -0.6985779304 -0.701744280  0.6535570094
 [446,] -0.1543609445 -0.416196624  0.4303272218
 [447,] -0.3984831441  0.700687429  0.9565495745
 [448,]  0.8638473565 -0.391506901 -0.3295699262
 [449,]  0.0606819866 -0.169660986 -0.3211563512
 [450,]  0.3283996939 -0.727754626 -0.5121845394
 [451,]  0.2341482153 -0.357922013 -0.5676353396
 [452,]  0.1940739352 -0.503632971  0.7700148683
 [453,] -0.5006997849 -0.143574736 -0.4768088728
 [454,]  0.6209570387 -0.148365146  0.8660902835
 [455,]  1.3737540438  0.153702996  0.0276671255
 [456,]  1.1268806762  0.108308576 -0.9020103150
 [457,]  0.8952728608  0.119958377  0.2299147138
 [458,]  0.2462377878 -0.528439699  0.5662980297
 [459,]  1.2310002141  0.152300306  0.4602683478
 [460,] -0.2045269869  0.830513143  0.6785948871
 [461,] -0.2360621236  0.080177520  0.1308173162
 [462,] -0.1557454393 -0.140934171 -0.5698238900
 [463,]  0.0167494775 -0.817636896 -0.5254959699
 [464,]  0.4490620610 -0.385440975 -0.0894366988
 [465,] -0.0434566013 -0.338790464 -0.0209021001
 [466,]  0.0529804051  0.662871570 -0.0306297660
 [467,]  0.8550998500  0.151404710  0.5910397921
 [468,] -0.6976707726  0.098382298 -0.0293962967
 [469,] -0.2070295407 -0.354895373  0.6266489457
 [470,] -0.5014842528 -0.074075913  0.1679397834
 [471,] -0.1177855979 -0.101972860  0.0860450204
 [472,] -0.3474397141  0.388843205  0.2373145775
 [473,] -0.7217630917 -0.624770994  0.0910337919
 [474,]  0.1823597120 -0.333285520  0.4199057845
 [475,] -0.8858067782 -0.375465147  0.7465885552
 [476,] -0.4075059763 -0.143297180  0.6396548432
 [477,] -0.2319243397 -0.353060508 -0.9454494145
 [478,]  0.3328498444 -0.150767937 -0.1017896171
 [479,]  1.0781060277  0.798841197  0.5720934580
 [480,] -1.0137724123  0.423051432  0.3522222802
 [481,] -0.0552321614 -0.442242335  0.2113772117
 [482,] -0.6802091469 -0.164078997 -0.0745884650
 [483,]  0.5690306467 -0.555197283 -0.2481882004
 [484,] -0.2310607798 -0.586092561  1.1777934323
 [485,]  0.1288515818 -0.431250237  0.2100053065
 [486,]  0.1363547357 -0.395700056 -0.3654798297
 [487,]  0.4998837569 -1.623671486  0.1778128848
 [488,] -0.1535656700  0.164182246  0.3420310824
 [489,]  0.2583610404 -0.395509352  0.2767890486
 [490,]  0.0826007466 -0.681644875  0.5457749488
 [491,] -0.3538362606 -0.512740567  0.4374990763
 [492,] -0.7646596768 -0.371439277 -0.3515447116
 [493,]  0.4063296202  0.147853545  0.5536607697
 [494,]  0.1557031310 -0.392335625  0.4712866381
 [495,] -0.0995289865 -0.201513626  0.2936871836
 [496,] -0.0615692603 -0.050276853  0.3561596546
 [497,]  1.1080697897 -0.055543888 -0.1539095047
 [498,]  0.0129676636 -0.696024566  0.3542842651
 [499,] -0.4195198179  0.818579655 -0.5815295361
 [500,]  0.5762899447  0.035489897 -0.1287320372
 [501,]  0.0636377931 -0.620603369 -0.2796964124
 [502,] -0.4263764360  0.262455337 -0.8118321131
 [503,] -1.2357606142  0.356260834  0.2010065730
 [504,]  0.3987838763  0.042114057 -0.9303779676
 [505,]  0.6451598905 -0.137543558 -0.7885060692
 [506,] -0.2880296613  0.354407258  1.0482587491
 [507,]  0.7599508566 -0.230167797 -0.3197652314
 [508,] -0.2368137833 -0.176567590  0.3994373194
 [509,]  0.6297564723 -0.371149534  0.3146607285
 [510,]  1.0940024228 -0.112126956  0.0067157098
 [511,] -0.2464517898  0.210419958  0.4036244108
 [512,]  0.4486198667  0.248572418  0.6922897976
 [513,] -0.2474676384  0.153576936  0.1866328167
 [514,] -0.0074332870 -0.545307179 -0.1024240235
 [515,] -0.0908650401 -0.149013277 -0.6568315137
 [516,] -0.4997723591 -0.488445573 -0.2754201173
 [517,] -1.2129403289 -0.909811018 -0.1846301525
 [518,] -0.3227470546 -0.849907046  0.2241089872
 [519,]  0.6059875461 -0.287990409  0.1487606568
 [520,]  0.0204905342 -0.164997352  0.1503245395
 [521,]  0.0699236821 -0.027057468  0.4444423067
 [522,]  0.6422255163 -0.376440413 -0.7619171890
 [523,] -0.5222355599  0.733115383  0.3987278763
 [524,]  0.2157189080 -0.133124966 -0.0035408801
 [525,]  0.1928947859 -0.553633985  0.3149545285
 [526,] -0.2696156100 -0.459130157 -0.0427200352
 [527,]  0.1725991623  0.304063715 -0.0043866956
 [528,]  0.1581402845 -0.114642940  0.2870170569
 [529,] -0.2887049217 -0.208734949 -0.1525292131
 [530,]  0.7020269241  0.905207110  0.4150129292
 [531,]  0.1886247772 -0.305127051  0.1220692393
 [532,] -1.0515731194  0.224513330 -0.1535575961
 [533,]  0.0111681109 -0.344803256  0.3677169346
 [534,]  0.4295314038 -0.109493780 -0.4392788510
 [535,] -0.6541508259  0.490864116  0.5136503848
 [536,] -0.0071389242  0.878446564 -0.6222290399
 [537,] -0.0235741435 -0.741091260  0.1941402595
 [538,] -0.7281127536  0.222213580  0.0007695724
 [539,]  0.5354306418 -0.174711537  0.8164336863
 [540,] -0.5971034317  0.142978614 -1.3962038254
 [541,]  1.0018449409 -1.360132974  0.3621637262
 [542,] -0.4645953056 -0.634363161  0.4816495688
 [543,] -0.2463477203 -0.169933964  0.0061730358
 [544,] -0.9004421193  0.840887712  0.2971643470
 [545,]  0.8049006038  0.074330087  0.5480957032
 [546,] -0.1843693860  0.282233465 -0.5494742370
 [547,]  0.0614070122  1.331422617 -0.2349804281
 [548,] -0.4434698096  0.790772105 -1.0389398389
 [549,]  0.4650123084 -0.774470185 -0.0174616636
 [550,]  0.6103491995  0.523682604  0.5773793080
 [551,] -0.2501187408  0.111523215 -0.7504369457
 [552,]  0.4462281406  0.677863880  0.2070276290
 [553,]  0.2296996172 -0.291380385 -0.0859470533
 [554,]  0.6983397548  0.740804879 -0.2195446815
 [555,]  0.3123226497  0.529618939 -0.0596909895
 [556,]  0.3525766993 -0.312915602 -0.5447732708
 [557,]  0.0510021159  0.256237589  0.5829469475
 [558,]  0.7060148947 -0.056883336  0.3572614917
 [559,]  0.0702807178 -0.441670828 -0.1605176842
 [560,]  0.6553725771 -0.629154832  0.4758192305
 [561,]  0.8675267275  0.873460618 -0.5851929147
 [562,] -0.3118798116  0.451415825 -0.5565749686
 [563,]  0.2066102417 -0.150653069  0.2912022863
 [564,] -0.1083340479  0.053636782  0.5379259698
 [565,]  0.5634637330 -0.767812588  0.4931840649
 [566,]  0.6284603963 -0.181154775 -0.7758168363
 [567,]  0.4468055398 -0.024446198 -0.6101261655
 [568,] -0.3075806365  0.758989796  0.5407908333
 [569,]  0.6084945729  0.331241820  0.0048146259
 [570,]  0.5091509925  0.898759849  0.9519956615
 [571,]  0.7957916354 -0.114772841 -0.3447484169
 [572,]  0.1910564371  0.121930982 -0.3500996559
 [573,] -0.2625678400  0.644922998 -0.0946812604
 [574,] -0.1901245395 -0.096255963 -0.2112744144
 [575,] -0.1701377791 -0.008233083  0.2625940560
 [576,]  0.0727135077 -0.748160473 -0.3670748325
 [577,] -0.3608368842  0.356246215 -0.5125828023
 [578,] -0.1543262075 -0.240761895  0.6359561033
 [579,] -0.6359103992  0.139667228 -0.9448659636
 [580,]  0.0690865684  0.552323955 -0.5226278476
 [581,]  0.3824757379 -0.484682582  0.3587098452
 [582,]  0.4011665772  0.029851992  0.4850860219
 [583,]  0.6725905566  0.011023232  0.3517693441
 [584,]  0.0762274076  0.230901434  0.3396993977
 [585,]  0.2694650797  0.010387384  0.2664135323
 [586,]  0.1558199569 -0.077829159  0.3956331517
 [587,] -0.0127143676 -0.161568447  0.7572955642
 [588,] -0.2502186242  0.092663749 -0.1388737452
 [589,] -0.1375694947  0.130200395 -0.8295265862
 [590,] -0.3950892725  0.023523345  0.8819622585
 [591,]  0.4767861964 -0.337416911 -0.8938031626
 [592,] -0.3795989029  0.622898298  0.7531427275
 [593,]  0.6147799383  0.450013977  0.4033656986
 [594,] -0.8450403847  0.889839609  0.3630392175
 [595,] -0.9442545823  0.752694951  0.1278914460
 [596,]  1.1127941829 -0.651813196 -0.0796643471
 [597,]  0.0207854493  0.183491210 -0.5567627777
 [598,]  0.6604277924 -0.121013007  0.5090456523
 [599,]  0.5400829177 -0.301940762 -0.0884002534
 [600,]  0.6835657583 -0.137382684  0.9151991323
 [601,]  0.5717901075 -0.488584428 -0.5668563386
 [602,]  0.4747945644  0.829596367 -0.6039066140
 [603,]  0.3742732793  0.291969113 -0.5997697142
 [604,] -0.0163464459 -0.527099369  0.0870025609
 [605,]  0.2489828281 -0.843020805  0.3563902133
 [606,]  1.0394186427 -0.047257597  0.1734418815
 [607,]  0.3129346696 -0.370123364  0.8906538331
 [608,]  0.1190224500  0.698964300 -0.2986920241
 [609,] -0.7059796283  0.448117976  0.4237609801
 [610,]  1.4343837454 -0.768658094 -0.5131352933
 [611,]  0.2339194304 -0.067223070 -0.7001116902
 [612,]  0.1350818360 -0.078260311  0.2491709507
 [613,]  0.0333187830  0.007770136  0.9808267521
 [614,]  0.4428332079  0.409818746  0.1324771672
 [615,] -0.1016398143 -0.328939334 -0.2697347854
 [616,]  0.3725439192  1.267315306 -0.1254110743
 [617,] -0.4613454656 -0.915123710  0.0400401758
 [618,] -0.1764145299  1.210847990  0.0209118841
 [619,]  0.7800401367 -0.443157725  0.8035682783
 [620,]  0.7602957897 -0.360946638  1.1206157849
 [621,]  0.5884350988 -0.413730169  0.4229307337
 [622,] -0.4413268704  0.031382438 -0.6293093304
 [623,]  1.0123880248 -0.858869159  0.7735130048
 [624,]  0.1570530707  0.110360245  0.4368208006
 [625,]  0.0145505802  0.245638859 -0.2293225083
 [626,] -1.2069847544 -0.423435824 -0.5127871478
 [627,] -0.2089863525 -0.646023853  0.5251880062
 [628,] -0.7721079090 -0.710051768 -0.0478243518
 [629,] -0.9894008749  0.670560083 -0.1506248902
 [630,] -0.3859672249 -0.306902875 -0.3711956818
 [631,]  0.0699330254 -0.139907680  0.1974017523
 [632,] -0.5172897110  0.317908215 -0.2529533390
 [633,]  0.2135935979  0.283790687 -0.6875711912
 [634,] -0.6801490631 -0.559607683 -0.7615938867
 [635,] -0.3513663613  0.255264908  0.0825345819
 [636,]  0.0827393027  0.374385129  0.8403762359
 [637,] -0.4512143262 -0.140251915  1.0714930746
 [638,]  0.7964441480  0.089599160  0.1921271656
 [639,] -0.4968824883 -1.541540976  0.4852758648
 [640,] -1.1715226752 -0.205572156  0.9650588064
 [641,] -0.2558450304 -0.700108214  0.2974143168
 [642,] -0.2197724790  0.190118348 -0.1502760929
 [643,] -0.0207554219 -0.528222917  0.1298147540
 [644,] -0.2676364917  0.129126655 -1.1038935478
 [645,] -0.0041462705 -0.290573903 -0.1316571855
 [646,]  0.0969259727  0.320867516  0.5167565626
 [647,] -0.3009884306 -1.053505052 -0.0047399807
 [648,] -0.0568607490 -0.578248313  0.4573234648
 [649,]  0.5715570481  0.406480926 -0.1064476297
 [650,]  0.7134985504  0.736685150 -0.2343149839
 [651,]  0.5239798826 -0.911260179 -0.7145248092
 [652,] -0.0859363632 -0.098568510  0.5355562762
 [653,] -0.0410084255  0.509929635  0.5111200616
 [654,] -0.8344608655  0.326537928  0.1190606823
 [655,] -0.1204607248 -0.225641507 -0.5283644922
 [656,]  0.1173753631  0.373540353  0.1594913933
 [657,]  0.3727405331  0.287677448  0.0744618465
 [658,]  0.4809733376 -0.846463229 -0.1109098689
 [659,] -0.1723777562  0.186829811 -0.4961252989
 [660,]  0.4383825107  0.066992847  0.8878438877
 [661,]  0.5713738645 -0.288434640 -0.4030184418
 [662,] -0.2152171195  0.566836720 -0.3987282812
 [663,]  0.1966827046  0.330544573 -0.4006123809
 [664,]  0.0013455953 -0.107135811 -0.1459158902
 [665,]  0.8264830850 -0.622942834  0.6446572188
 [666,] -0.3737663667  0.194360808 -0.0841104761
 [667,] -0.0424288857  0.805138322  0.3155889580
 [668,] -0.6967484272  0.673340053 -0.0582661758
 [669,]  0.1441978325 -0.033061976  0.5021153544
 [670,]  0.4315338685 -0.152800421  0.7020971809
 [671,] -0.9098478124 -0.393192952  0.4630080495
 [672,]  0.4534256354  0.126372863 -0.3061231627
 [673,]  0.5141106792 -0.076029563 -1.1743691696
 [674,] -0.4160682571  0.339326832 -0.0955017670
 [675,] -0.1475569235  0.645441971 -0.6499417470
 [676,]  0.8220149051 -0.021420846  0.2841826049
 [677,]  0.3345656187  0.646550516 -0.2840218094
 [678,] -0.6267726921  0.167765674 -0.1920221807
 [679,] -0.3437964511  0.334772381  0.7655234505
 [680,] -0.9930270795 -0.582979252  0.4312128562
 [681,] -0.4565933252 -0.284893718 -0.3221594593
 [682,] -0.3237662051 -0.269519364  0.3349473311
 [683,] -0.7063254075 -0.412174788  1.0166775931
 [684,] -0.0602974319 -0.412015992 -0.1808116970
 [685,] -0.5690865283 -0.569790567 -0.1033398394
 [686,]  0.3872394294 -0.142213819  0.0443895599
 [687,] -1.3637864824  0.946750362  0.3351141038
 [688,]  0.0891541868  0.538974179  0.1891667184
 [689,]  0.6743669919 -0.616639578  0.0394734465
 [690,]  0.7214501590 -0.207600274 -0.1263339114
 [691,]  0.0631709436  0.142397070 -0.1850451783
 [692,]  0.1060401829  0.089713246 -0.4398986505
 [693,]  0.5372442856 -0.683000025  0.5780180267
 [694,] -0.7805830871 -0.545948733  0.1983699674
 [695,] -0.7085506033 -0.696432208 -0.9630396395
 [696,]  0.6990138922 -0.484586189  0.4585584893
 [697,] -0.7582309324  0.663641906 -0.4442940334
 [698,] -0.7898787625 -0.603136073 -0.0937704576
 [699,]  0.8648365481 -0.126785895  0.0885816695
 [700,] -0.7807268729  0.667913484  0.2255679674
 [701,]  0.1163897303  0.582386183  0.3143143304
 [702,] -0.1176375383  0.057909528 -0.0731123471
 [703,] -0.3327484498 -0.446507541  0.0293903764
 [704,]  0.1817830904  0.136374875 -0.0971356169
 [705,]  0.8150942446  0.250776543  0.5279400304
 [706,]  0.9469992130  0.523549908  0.7326700007
 [707,]  0.0663113992 -0.439925393  0.0167211332
 [708,] -0.3207050552  0.874003144  0.2229305804
 [709,]  1.0888381297 -0.810628535  0.6195123255
 [710,] -0.9306624905 -0.251549631  0.7011113055
 [711,]  0.0601773574  0.005267486  0.3307594856
 [712,]  0.8334752679 -0.000776999  0.2608274072
 [713,]  0.2615785317 -0.067157735 -0.4043792440
 [714,]  0.2562529448  0.129666440 -0.8557041486
 [715,]  0.4336187437  0.148726048  0.3812526150
 [716,] -0.2020863718  0.125103083 -0.4083056211
 [717,] -0.8663415034 -0.300870579  0.3869230524
 [718,]  0.7727237488  0.860187434 -0.5043902513
 [719,] -0.4925648189  0.182305759  0.0306708155
 [720,]  0.7702388681  0.077168695 -0.3715526745
 [721,]  0.1479896970  0.147298684 -0.3146897491
 [722,]  0.2844243416 -0.894746402 -0.1036690447
 [723,]  0.3818413670  0.476210089 -0.0196971729
 [724,] -0.1243698924 -0.199005723  0.2746164663
 [725,] -0.3793770997  0.290033111  0.0245547000
 [726,] -0.1614848664 -0.150325770  0.8603175397
 [727,] -0.2363828287  0.241393238 -0.2199738499
 [728,]  0.5802981493  0.619258993  0.1766888450
 [729,] -0.0393844289 -0.145320374  1.1972448797
 [730,] -0.8252913207 -0.108699561  0.2293369560
 [731,]  0.3537173113  0.510516848 -0.1632755185
 [732,] -0.1130433153 -0.035622953 -0.0294714648
 [733,]  0.2022429099 -0.582928049 -0.1730979213
 [734,]  0.0089152440 -0.170457789  0.0496696243
 [735,] -0.1040842577 -0.011740760 -0.9083775264
 [736,] -0.2243158990 -0.041431370  0.0035323032
 [737,]  0.2519390062 -0.525432002 -0.0929423193
 [738,] -0.1008694143  0.727131065  0.2163017583
 [739,] -0.3194551154 -0.196447015 -0.4112906213
 [740,]  0.1820062309 -0.022696679 -0.3459583170
 [741,]  0.5964461880 -0.017465944  0.1506641141
 [742,] -0.1617848272 -0.196369564  0.1018561113
 [743,]  1.0473336808  0.261379165 -0.2620919541
 [744,]  0.4489187102  0.123545768 -0.3502260660
 [745,] -0.1143137735  0.314193207  0.2849358376
 [746,]  0.1848668724  0.509308858 -0.5014386836
 [747,] -0.4349179409  0.151453058  0.6572369267
 [748,]  1.5205000197 -0.242442419  0.5276489225
 [749,]  1.0963703718  0.364386136 -0.1860086021
 [750,] -0.6992951311 -0.272729843 -0.0414512027
 [751,] -0.0567039405  0.147582750  0.6233866852
 [752,]  0.0864669083  0.325553799 -0.0898529561
 [753,]  0.2628404035 -0.922001690  0.1239015509
 [754,]  0.7440658023 -0.668529108  0.2946894803
 [755,] -0.8934441148  0.136246540  0.1054510041
 [756,]  0.3640512841 -0.134162804 -0.3436585752
 [757,] -0.4549831690 -0.381356393 -0.3265416385
 [758,] -1.2910614360  0.225617199 -0.7460668151
 [759,] -1.0518833826 -0.296711411  0.2271761289
 [760,] -0.7376549989  0.194371100  0.3850670713
 [761,]  0.5678140861 -0.582526227  0.2796921983
 [762,]  0.8871643945 -0.964922555 -0.0944258563
 [763,] -0.7740010170  0.819328864 -1.1499174032
 [764,]  0.8363454514  0.053143005 -0.0912787983
 [765,]  0.0227651421  0.057396041  1.2702204245
 [766,] -0.5494523049 -0.196209047 -0.9924560631
 [767,]  0.9174735106 -1.195692692 -0.6166288621
 [768,]  0.1314705444  0.317863956  0.2137647719
 [769,]  1.2238256246  0.523158275 -0.9733872943
 [770,]  0.1961772748 -0.146335544 -0.3401792773
 [771,]  0.0531704370 -0.528585263  0.4133002307
 [772,]  0.1003110887 -0.049679705 -0.2434845031
 [773,]  0.1018323678  0.264160948  0.6581158662
 [774,] -0.4454818692 -0.148278498 -0.0536365887
 [775,]  1.1711026181 -0.785646668  0.4133029273
 [776,] -0.3012246999  0.082460967  0.1301638372
 [777,] -0.3625795382 -0.096018153 -0.3301887807
 [778,]  0.1846775561 -0.054107853  0.0348477651
 [779,] -0.4398133729 -0.875166637  0.5533256713
 [780,] -0.1393796675 -0.013573435  0.4060433660
 [781,] -0.9323294168 -0.107397979 -0.6691548024
 [782,] -0.4073602861 -1.046954445 -0.3311160543
 [783,] -0.9188156961 -0.068510725  0.0259130587
 [784,]  0.7959293873  0.472730021  0.7636370849
 [785,] -0.0720665283 -0.771984594  0.2028161815
 [786,]  0.1437980222 -0.758562348 -0.0730678503
 [787,] -0.2807712296  0.098549391  0.2173852208
 [788,]  0.8432345451 -0.198227506  0.4119424862
 [789,]  0.1890353398  0.219437880  0.0183475518
 [790,] -0.3011813070  0.178263402 -0.4355501134
 [791,]  0.3056645291  0.158911328  0.3270167261
 [792,] -0.0308257696  0.234036967 -0.0834096889
 [793,] -0.3412383253 -0.228264032  0.6358478182
 [794,] -0.2832341690 -0.007290634 -0.2897491103
 [795,]  0.2479188899  0.682754790  0.1554997870
 [796,] -0.4489218680 -0.145591329 -0.0444780076
 [797,] -0.2265748049 -0.891449031  0.1177441816
 [798,] -0.7821292260  0.206229846  0.3273482663
 [799,]  0.1985453067 -0.488000271  0.0617934538
 [800,] -0.6396350829  0.232912203 -0.4977362563
 [801,] -0.1052343862  0.374669059  0.4042545695
 [802,]  0.4118640178 -0.737362463 -0.0489851373
 [803,]  0.8242754700  0.405298119 -0.7681473837
 [804,]  0.9353717701 -0.418784522 -0.1589870245
 [805,]  0.0612082705  0.040147146  0.6590681528
 [806,]  0.6051467391 -0.822814938  0.3862842103
 [807,] -0.3581754207 -0.673809663  0.6233658428
 [808,]  0.4883905897  0.707809877 -0.3048308491
 [809,]  0.7618333010 -0.475350274 -0.5208178226
 [810,]  0.7662357730  0.513530578 -0.4020278257
 [811,] -0.4134605556 -0.024003870 -0.4031134714
 [812,] -1.0139476467  0.622108806 -0.5692094122
 [813,]  0.0447713075  0.205808243 -0.2618655453
 [814,] -0.4200502843 -0.112419945 -0.6115134370
 [815,] -0.2891952524 -0.583166835  0.9003191921
 [816,]  0.1956572896 -0.164582201 -0.1048182900
 [817,]  0.1869308661 -0.093374862  0.5168982515
 [818,] -0.1879679085  1.019935173  0.1459334118
 [819,]  0.1136031238 -0.075055237 -0.5034052420
 [820,] -0.5959788223 -0.793633824  0.6560343218
 [821,] -0.5248895667  0.420397640 -1.0411698943
 [822,]  0.3436346839  0.257448412  0.7489446035
 [823,]  0.1958386172 -0.090218096 -0.1120572090
 [824,] -0.3412091365 -0.120663997 -0.6533618332
 [825,]  0.0780754333  0.120432413 -0.0244935549
 [826,] -0.1981183621  0.292682763 -0.2415711497
 [827,] -0.6622265742  0.875836214 -0.4113532216
 [828,]  0.2798887493 -0.512033616  0.7073773024
 [829,]  0.5371585304 -0.530448512 -0.4923663743
 [830,]  0.3871549680  0.001030570 -0.2067045047
 [831,] -0.5273377879  1.091744379  0.3415366186
 [832,] -0.6464578083 -0.470749567  0.4373913023
 [833,]  0.0325375540 -1.105509658 -0.0859666119
 [834,] -0.0979267473 -0.658471133 -0.1032739565
 [835,] -0.7078129218 -0.514968538  0.4493846996
 [836,]  0.2741663799 -0.756350277  0.2912526540
 [837,] -0.8981167348  0.073644977 -0.2381309797
 [838,] -0.2872466667  1.393053121 -0.1998590514
 [839,]  0.0675001012  0.234907998 -0.2225748869
 [840,]  0.3250457917  0.599637084 -0.4902957919
 [841,] -0.0780967119 -0.182295969  1.1956637570
 [842,] -0.3292906304  0.435186781 -0.1840698934
 [843,] -0.3016166221 -0.403482614  0.0456932509
 [844,]  1.8274864752 -0.413930978  0.0002682293
 [845,]  0.3264718803 -1.018595242  0.8171710179
 [846,]  0.3913421839  0.347793076 -0.2266562195
 [847,]  0.6734519892 -0.027728947  0.3145802527
 [848,]  0.1169115854  0.093870224  0.5390209429
 [849,]  0.2321196160  0.960949706 -0.6437961702
 [850,]  0.6833012668 -0.252462878 -0.0903441926
 [851,]  0.4771191443 -0.335787065  0.8195260217
 [852,] -0.7130648573  0.043198462 -0.5306399518
 [853,]  0.9556961307 -0.763570672  0.2652210678
 [854,]  0.0416855576  0.607991216 -0.5861245522
 [855,]  0.3626180752 -0.158839643 -0.0655275520
 [856,] -0.7485699276  0.480800210  0.1940551656
 [857,]  0.4085624116 -0.669567700 -0.8074512575
 [858,] -0.0077965117  0.176992873 -0.0328286833
 [859,] -0.0854258012  0.065737452 -0.0311871823
 [860,]  0.5130493103  0.461578027 -0.7550947777
 [861,] -0.5402112663 -0.178233188  0.2163462137
 [862,] -0.5521088068 -0.737671110  0.0241178813
 [863,]  0.3616643893  0.587045161  0.0604766520
 [864,]  0.4482385879 -0.544754555 -0.1344895455
 [865,]  0.4173835165 -0.146970744  0.5958960994
 [866,] -0.8868216621  0.032062792  0.4360275098
 [867,]  0.6387682508 -0.419448608 -0.2640772188
 [868,] -0.6480307044 -0.721709232 -0.3215324816
 [869,] -0.3299048957 -0.140377009 -0.7491095970
 [870,]  0.2281163370 -0.787330230 -0.3584908655
 [871,]  0.0602560428 -0.727148764 -0.4509843839
 [872,] -0.9018134961 -0.270994852 -0.8473637686
 [873,] -0.4170714232 -0.209750142  0.6714284282
 [874,]  1.2887301027  0.119843825  0.0948603966
 [875,]  0.2374405416 -0.010129123  0.0590136473
 [876,] -1.6109409628  0.714502280  0.3276979810
 [877,] -0.5404305351  0.281367955  0.2678678976
 [878,]  0.3443565143 -0.601478252  0.0749151191
 [879,]  0.4619465072  0.203653563 -0.3154894408
 [880,]  0.6248424192 -0.822067047  0.2652681318
 [881,]  0.2000262903  0.434890226 -0.5963984901
 [882,] -0.6249270237  0.081737739 -0.0137776539
 [883,]  0.0413506766 -0.164811377  1.0583398224
 [884,] -0.1420644259 -0.927871708  0.6428965223
 [885,]  0.8361612409  0.166244183 -0.3125876322
 [886,] -0.1372715306 -0.307128726  0.2524245339
 [887,]  0.6861719517 -0.074198176  0.0829336987
 [888,]  0.1882567604  0.236983963  0.0819060455
 [889,]  0.1579334761 -0.040703780  0.0052385994
 [890,] -0.1537391821  0.384287658  0.4038873727
 [891,] -0.6323927909  0.286456742 -0.1680422092
 [892,] -0.3649281184 -0.946769892  0.5529061857
 [893,]  0.3206006553 -0.060779892 -0.1639914749
 [894,]  0.0232784978 -0.704536510 -0.9298731854
 [895,] -0.5404512998 -0.412725933 -0.2664532596
 [896,] -0.8243909874  0.328878141 -0.4405734850
 [897,]  0.1200782631  0.302825889  0.3151278381
 [898,] -0.9907747727 -0.156048693  0.5534583899
 [899,]  1.1393588692  0.153229329  0.1367649857
 [900,] -0.1317759728  0.021716818 -0.2966314471
 [901,] -0.5061868660  0.093395224  0.0146624191
 [902,] -0.4747127870 -0.769498676  1.0493580828
 [903,]  0.3842537046  0.123320186 -0.7329991474
 [904,]  0.4686164038  0.059035031  0.4835756939
 [905,] -0.3198087094 -0.235033729  0.0659340938
 [906,]  0.2258541649  0.371904229  0.3521501226
 [907,]  0.5896845156 -0.530540438 -0.3719257749
 [908,] -0.3816698962 -0.089534516  0.6920276635
 [909,] -0.2504781075 -0.429628182  0.3800595496
 [910,]  0.7601521955 -0.654720273  0.2650464808
 [911,] -0.1340053792  0.393256605 -0.3333571013
 [912,]  0.0621883375 -0.202534552 -1.3796883426
 [913,] -1.0582201859 -0.105359749 -0.7722088543
 [914,]  0.1480567104  0.177242842 -0.0845426264
 [915,] -0.4677482681 -1.083394133 -0.7192706895
 [916,]  0.6867455460  0.797791654 -0.3495869412
 [917,] -0.1775137873 -1.776824653  0.1250375781
 [918,]  0.7232080212 -1.945157914  0.1333558629
 [919,]  0.2237377978 -0.912733962 -0.3057165460
 [920,]  0.5671217812  0.721258694 -0.5776191637
 [921,] -0.2426563221 -0.663105304  0.0159954558
 [922,] -0.3509289583  0.008521376 -0.6543477489
 [923,] -0.4343404998 -0.008341703  0.0040013630
 [924,]  0.2231349623 -0.850948932  0.3584587386
 [925,] -0.6989185196  0.011616870  0.0161731227
 [926,]  0.9463979265 -0.393848936 -0.1668693483
 [927,] -0.0008961253  0.032923921  1.3638179569
 [928,] -0.4025874415  0.506451481 -0.1833483519
 [929,]  0.0329005751 -0.408611916  0.7235531405
 [930,] -0.3880690910 -0.810227461  0.5922696473
 [931,]  0.5316374683  0.481923593 -0.1156259882
 [932,]  0.2901045630 -0.295160661 -0.5615878698
 [933,] -0.0595682025 -0.284956345 -0.0928759791
 [934,]  0.1084848676  0.348755160  0.6292882533
 [935,] -0.4889921795  0.472327863 -0.0533891569
 [936,]  0.1029271316 -0.595882675  0.3812929168
 [937,] -0.9046317209  0.183382558 -0.2495737029
 [938,] -0.5471299354  0.694135860  0.6937517624
 [939,] -0.3757802623 -0.214951760  0.5865074253
 [940,]  0.5134860740 -0.598393267 -0.5712131444
 [941,]  0.4298845724 -0.235685929  0.9939607142
 [942,] -0.8844962151  0.500080281 -0.7236755051
 [943,] -0.3270046805 -1.490316908 -0.1033621284
 [944,] -0.9405871105  0.202775992 -0.0351719198
 [945,] -0.3744545155  0.642353471 -0.7088145956
 [946,]  0.2354164870 -0.468633609  0.1958333516
 [947,] -0.3744600532 -0.915291221  0.2239346128
 [948,] -0.1712893586 -0.864048897  0.3916265137
 [949,] -0.4941022661  0.229316987 -0.4560925193
 [950,] -0.7274006706  0.628625724 -0.2334612890
 [951,] -0.6243160020  0.030006373 -0.0861172468
 [952,] -0.0747826602 -0.023083115 -0.3556982469
 [953,]  0.5562729110 -0.599637276  0.2392805793
 [954,] -0.2757275699 -0.484014861 -0.5622707887
 [955,] -0.6627392764  0.624364126 -0.4987253607
 [956,]  0.3494596759 -0.092796042 -0.4591443925
 [957,] -0.8067556492 -0.888008247  0.6733709709
 [958,] -0.3613842902  0.055582565 -0.3263739180
 [959,] -0.3098636604  0.292939764  0.6804027392
 [960,]  0.1422998332  0.792554484  0.2495343374
 [961,]  0.3905050025  0.700899273 -0.2147937044
 [962,] -0.4872984152 -0.195362302  0.5724414379
 [963,]  0.7336257688 -0.571664880  0.3135166264
 [964,] -0.7072047497  0.207595698  0.7656326067
 [965,]  0.4064335117  0.986974368 -0.5623123874
 [966,] -0.5029105765 -0.456272991 -0.5144123425
 [967,] -0.2116961761 -0.282368493 -0.2919931241
 [968,] -0.2536859413  0.303580646  0.9555710405
 [969,] -0.7113849143  0.684408064  0.5499622159
 [970,] -0.6952030457 -0.413128537  0.7061848051
 [971,] -0.4553438812  1.321809685  0.0968476652
 [972,] -0.2817051823 -1.736199798 -0.9149700881
 [973,]  0.3113600367  0.362212902 -0.0783172964
 [974,] -0.0826741295 -0.358400915  0.3286766186
 [975,] -0.2308162314  1.108270879 -0.7637478722
 [976,]  0.1224871262  0.505474050 -0.4915498032
 [977,] -0.7758964508  0.437491902  0.8354117756
 [978,]  0.7823626536  0.609073985 -0.2494535373
 [979,] -0.0484508004 -0.490466953  0.7774395072
 [980,]  0.2221950578 -0.645260494  0.8685664316
 [981,]  0.0586446413  0.279225997 -0.1553194472
 [982,]  1.0514383787 -0.061502500 -0.6585004756
 [983,] -0.2410693426  0.433307585 -0.0531758937
 [984,] -0.9429270185  0.261044789  0.4710349214
 [985,] -0.6868646349  0.092530257  0.8508520643
 [986,] -0.7079805249 -0.174136186 -0.0535432749
 [987,]  0.4044741140  0.011138109  0.0672759658
 [988,] -0.0515493659  0.196404352  0.4699676211
 [989,]  0.1109492101 -0.076971216  0.3679792649
 [990,]  0.3274521622  0.854330447 -1.0730744006
 [991,]  0.8685815837  0.278229593  0.2843040866
 [992,]  0.0478355124 -0.195240970  0.2246067629
 [993,]  0.4183841911 -0.252817853  0.6448871875
 [994,]  0.9177579764 -0.381475460  0.5264663229
 [995,] -0.1038204845 -0.319664814 -0.2038830690
 [996,] -0.4870372383 -0.917769901 -0.8429596196
 [997,] -0.3529329876 -0.550815148  1.0355940187
 [998,] -0.1810121324  0.290209367  0.6466705567
 [999,] -0.6467942762  0.448439980 -0.4737166136
[1000,]  1.3257876214  0.310583653 -0.8177449763</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>ols <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">lm</span>(y <span class="sc">~</span> X <span class="sc">+</span> P <span class="sc">%*%</span> X[, <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)] <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># var &lt;- vcov(lm(y ~ X + P %*% X[, c(2, 3, 4)] - 1))</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># lm(y ~ X + P %*% X[, c(2, 3)] - 1)</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># t(h %*% ols) %*% solve(h %*% var %*% t(h)) %*% (h %*% ols) / 2</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(ivreg(y ~ x2 + x3 + x4 | z2 + z3 + z4 , data = model$observed_data), diagnostics = T)$diagnostics[3,3]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let’s plot the simulated test statistics.</p>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-31_19abfdb7e3f72e941998fd7762341e77">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># results %&gt;% </span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(stat, fill = as.factor(version))) +</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_histogram(alpha = 0.4, position = "identity")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ll replicate section 1.5 from <span class="citation" data-cites="chmelarova2007hausman">Chmelarova (<a href="#ref-chmelarova2007hausman" role="doc-biblioref">2007</a>)</span> which uses data from <span class="citation" data-cites="mroz">Mroz (<a href="#ref-mroz" role="doc-biblioref">1987</a>)</span> and is inspired by Example 9.5 from <span class="citation" data-cites="wooldridge2010econometric">Wooldridge (<a href="#ref-wooldridge2010econometric" role="doc-biblioref">2010</a>)</span>.</p>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-32_d6f8e92a787b214d0d6aa4a79307f3b6">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># data("mroz")</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co"># mroz &lt;- mroz %&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   as_tibble() %&gt;%</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(hours &gt; 0)</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co"># y &lt;- mroz$hours</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co"># X &lt;- mroz %&gt;%</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(int = 1, lwage, educ, age, kidslt6, kidsge6, nwifeinc) %&gt;%</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   as.matrix()</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Z &lt;- mroz %&gt;%</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(int = 1, exper, educ, age, kidslt6, kidsge6, nwifeinc) %&gt;%</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   as.matrix()</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="co"># rho1 </span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="co"># rho2 </span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="co"># rho3 </span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="co"># rho4 </span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="co"># sim_endog_linear_model(</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   beta = c(0,1),</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   n = 1e2,</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   dist_vec = c(rmvnorm),</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   dist_params_list = list(</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a><span class="co">#     list(</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a><span class="co">#       mean = c(0, 0, 0, 0),</span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a><span class="co">#       sigma = matrix(</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a><span class="co">#         c(1, 5, 0, 5,</span></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a><span class="co">#           20, 0, 0, 0,</span></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a><span class="co">#           3, 0, 1, 0,</span></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a><span class="co">#           0, 0, 0, 1</span></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a><span class="co">#           ), nrow = 3)</span></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a><span class="co">#     )</span></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Another means of testing for exogeneity is due to <span class="citation" data-cites="wu1973alternative">Wu (<a href="#ref-wu1973alternative" role="doc-biblioref">1973</a>)</span> and <span class="citation" data-cites="durbin1954errors">(<a href="#ref-durbin1954errors" role="doc-biblioref"><strong>durbin1954errors?</strong></a>)</span>. Begin by performing the first step of 2SLS on the possible endogenous regressors. <span class="math display">\[ \mathbb{X}_\text{end} =  \mathbb{Z}\boldsymbol \delta + \mathbb V\]</span> The residuals now form a matrix, because we have multiple dependent variables <span class="math inline">\(\mathbf{X}_\text{end}\)</span>. Using the estimated projection coefficient <span class="math inline">\(\hat{\boldsymbol \delta}\)</span>, we calculated the residual values <span class="math inline">\(\hat{\mathbb V}\)</span>. Finally we augment the original linear model by including <span class="math inline">\(\hat{\mathbb V}\)</span>.</p>
<p><span class="math display">\[\mathbf{y}= \mathbb{X}\boldsymbol{\beta}+ \hat{\mathbb V}\boldsymbol\gamma + \boldsymbol{\varepsilon}^* = \begin{bmatrix} \mathbb{X}_\text{exo} &amp; \mathbb{X}_\text{end}\end{bmatrix}\begin{bmatrix} \boldsymbol{\beta}_\text{exo} \\ \boldsymbol{\beta}_\text{end}\end{bmatrix} + \underbrace{\hat{\mathbb V}\gamma + \boldsymbol {\boldsymbol{\varepsilon}}^*}_{\boldsymbol{\varepsilon}}\]</span> Consider the hypothesis <span class="math inline">\(H_0:\boldsymbol\gamma = \mathbf{0}\)</span>, and how that may related to whether <span class="math inline">\(\mathbb{X}_\text{end}\)</span> is endogenous or exogenous. When we perform the first step of this process (regressing <span class="math inline">\(\mathbb{X}_\text{end}\)</span> on <span class="math inline">\(\mathbb{Z}\)</span>) we break variation in <span class="math inline">\(\mathbb{X}_\text{end}\)</span> into two parts: the exogenous portion explained through <span class="math inline">\(\mathbb{Z}\)</span>,<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>, and unexplained part <span class="math inline">\(\boldsymbol \nu\)</span> which we capture through <span class="math inline">\(\hat{\mathbb V}\)</span>. If <span class="math inline">\(\boldsymbol \gamma \neq \mathbf{0}\)</span>, then the structural error <span class="math inline">\(\boldsymbol{\varepsilon}\)</span> includes the unexplained part of the variation in <span class="math inline">\(\mathbf{X}_\text{end}\)</span>, which is another way of saying <span class="math inline">\(\text{Cov}\left(\mathbf{X}_\text{end}, \varepsilon\right)\neq 0\)</span>.</p>
<p>So do we use the Hausman test, or this new test which uses artificial regressions? Well it turns out, we don’t need to make a choice because they’re equivalent if we are attentive about which residuals we use to calculate asymptotic variance! It also turns out that we could perform the artificial regression test using the fitted values <span class="math inline">\(\hat{\mathbb{X}}_\text{end}\)</span> instead of <span class="math inline">\(\hat{\mathbb V}\)</span>.</p>
</section>
<section id="sarganhansen-test" class="level3" data-number="8.5.2">
<h3 data-number="8.5.2" class="anchored" data-anchor-id="sarganhansen-test"><span class="header-section-number">8.5.2</span> Sargan–Hansen Test</h3>
</section>
</section>
<section id="examplereplication" class="level2" data-number="8.6">
<h2 data-number="8.6" class="anchored" data-anchor-id="examplereplication"><span class="header-section-number">8.6</span> Example/Replication</h2>
<p>Let’s replicate <span class="citation" data-cites="card1995using">Card (<a href="#ref-card1995using" role="doc-biblioref">1995</a>)</span>, a <em>classic</em> paper which has provided a textbook example of instrumental variables. To make sure our results are correct, we can compare them to the tables in the original paper which is found <a href="https://www.nber.org/system/files/working_papers/w4483/w4483.pdf">here</a>. The data is available on David Card’s <a href="https://davidcard.berkeley.edu/data_sets.html">website</a>.</p>
<p><span class="citation" data-cites="card1995using">Card (<a href="#ref-card1995using" role="doc-biblioref">1995</a>)</span> is concerned with estimating the returns to schooling with respect to wages. We tend to think that better educated workers earn higher wages, but to what extent does this relationship hold? Denote years of schooling as <span class="math inline">\(S_i\)</span>, log wages as <span class="math inline">\(Y_i\)</span>, and <span class="math inline">\(\mathbf{X}_i\)</span> as a collection of attributes associated with a worker. The linear model of interest is <span class="math display">\[ Y_i = \mathbf{X}_i\boldsymbol\alpha + S_i\beta + u_i,\]</span> where <span class="math inline">\(u_i\)</span> are unobserved components which affect earnings. We’re assuming that <span class="math inline">\(\text{E}\left[\mathbf{X}_iu_i\right] = 0\)</span> for all <span class="math inline">\(i\)</span> (<span class="math inline">\(\mathbf{X}_i\)</span> is exogenous), but we suspect that <span class="math inline">\(\text{E}\left[S_iu_i\right] = 0\)</span> (see Example @ref(exm:ex1)). The parameter <span class="math inline">\(\beta\)</span> is the returns of education on earnings, and is what we’re primarly interested in. Let’s just ignore this endogeneity for now and attempt to estimate <span class="math inline">\(\beta\)</span> with OLS. We can do this with data from the National Longitudinal Survey of Young Men (NLSYM) conducted in 1976. This survey contains information about agents’ wages in 1976, along with demographic information about family background, residence in 1976, and past residence (in 1966). The details of this survey, in particular how respondents were sampled, can be found in <span class="citation" data-cites="card1995using">Card (<a href="#ref-card1995using" role="doc-biblioref">1995</a>)</span>.</p>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-33_49e913b123ca132f544ac3eb41ad8f11">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>card_95 <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"data/nls.dat"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>.zip</code> file containing the data also contains a <code>.sas</code> file which processes and cleans the raw data. Each step is readily executed in R:<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a></p>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-34_18c98c8e9b333a2c6978f3608db1ab17">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>card_95 <span class="ot">&lt;-</span> card_95 <span class="sc">%&gt;%</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#assign the appropriate names to each variable</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> V1,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">nearc2 =</span> V2,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">nearc4 =</span> V3,</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">nearc4a =</span> V4,</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">nearc4b =</span> V5,</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">ed76 =</span> V6,</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">ed66 =</span> V7,</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">age76 =</span> V8,</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">daded =</span> V9,</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">nodaded =</span> V10,</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">momed =</span> V11,</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">nomomed =</span> V12,</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight =</span> V13,</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">momdad14  =</span> V14,</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">sinmom14  =</span> V15,</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">step14 =</span> V16,</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">reg661 =</span> V17,</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">reg662 =</span> V18,</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">reg663 =</span> V19,</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">reg664 =</span> V20,</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">reg665 =</span> V21,</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">reg666 =</span> V22,</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">reg667 =</span> V23,</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">reg668 =</span> V24,</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">reg669 =</span> V25,</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">south66 =</span> V26,</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">work76 =</span> V27,</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">work78 =</span> V28,</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">lwage76 =</span> V29,</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">lwage78 =</span> V30,</span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">famed =</span> V31,</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">black =</span> V32,</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">smsa76r =</span> V33,</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">smsa78r =</span> V34,</span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">south76 =</span> V35,</span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">reg78r =</span> V36,</span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">reg80r =</span> V37,</span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">smsa66r =</span> V38,</span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">wage76 =</span> V39,</span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">wage78 =</span> V40,</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">wage80 =</span> V41,</span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">noint78 =</span> V42,</span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">noint80 =</span> V43,</span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">enroll76 =</span> V44,</span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">enroll78 =</span> V45,</span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">enroll80 =</span> V46,</span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">kww =</span> V47,</span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">iq =</span> V48,</span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">marsta76 =</span> V49,</span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">marsta78 =</span> V50,</span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">marsta80 =</span> V51,</span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">libcrd1 =</span> V52</span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># missing values in SAS are ".", replace those with NAs</span></span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">replace</span>(., . <span class="sc">==</span>  <span class="st">"."</span> , <span class="cn">NA</span>)),</span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># any column that had a "." was loaded as a string, convert them</span></span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">where</span>(is.character), as.numeric),</span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true" tabindex="-1"></a>    <span class="co">#create variables corresponding to work experience</span></span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp76 =</span> age76 <span class="sc">-</span> ed76 <span class="sc">-</span> <span class="dv">6</span>,</span>
<span id="cb39-64"><a href="#cb39-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp76_sq =</span> exp76<span class="sc">*</span>exp76,</span>
<span id="cb39-65"><a href="#cb39-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp76_sq_100 =</span> (exp76<span class="sc">*</span>exp76)<span class="sc">/</span><span class="dv">100</span>,</span>
<span id="cb39-66"><a href="#cb39-66" aria-hidden="true" tabindex="-1"></a>    <span class="co">#create a series of indicators for parents' level of education</span></span>
<span id="cb39-67"><a href="#cb39-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">f1 =</span> (momed <span class="sc">&gt;</span> <span class="dv">12</span> <span class="sc">&amp;</span> daded <span class="sc">&gt;</span> <span class="dv">12</span>),</span>
<span id="cb39-68"><a href="#cb39-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">f2 =</span> (momed <span class="sc">&gt;=</span> <span class="dv">12</span> <span class="sc">&amp;</span> daded <span class="sc">&gt;=</span> <span class="dv">12</span> <span class="sc">&amp;</span> (momed <span class="sc">!=</span> <span class="dv">12</span> <span class="sc">|</span> daded <span class="sc">!=</span> <span class="dv">12</span>)),</span>
<span id="cb39-69"><a href="#cb39-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">f3 =</span> (momed <span class="sc">==</span> <span class="dv">12</span> <span class="sc">&amp;</span> daded <span class="sc">==</span> <span class="dv">12</span>),</span>
<span id="cb39-70"><a href="#cb39-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">f4 =</span> (momed <span class="sc">&gt;=</span> <span class="dv">12</span> <span class="sc">&amp;</span> nodaded <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb39-71"><a href="#cb39-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">f5 =</span> (daded <span class="sc">&gt;=</span> <span class="dv">12</span> <span class="sc">&amp;</span> momed <span class="sc">&lt;</span> <span class="dv">12</span>),</span>
<span id="cb39-72"><a href="#cb39-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">f6 =</span> (momed <span class="sc">&gt;=</span> <span class="dv">12</span> <span class="sc">&amp;</span> nodaded <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb39-73"><a href="#cb39-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">f7 =</span> (momed <span class="sc">&gt;=</span> <span class="dv">9</span> <span class="sc">&amp;</span> daded <span class="sc">&gt;=</span> <span class="dv">9</span>),</span>
<span id="cb39-74"><a href="#cb39-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">f8 =</span> (nomomed <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> nodaded <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb39-75"><a href="#cb39-75" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-76"><a href="#cb39-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-77"><a href="#cb39-77" aria-hidden="true" tabindex="-1"></a><span class="co">#Gather mutually exclusive region66 indicators into categorical </span></span>
<span id="cb39-78"><a href="#cb39-78" aria-hidden="true" tabindex="-1"></a>card_95 <span class="ot">&lt;-</span> card_95 <span class="sc">%&gt;%</span> </span>
<span id="cb39-79"><a href="#cb39-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, <span class="fu">contains</span>(<span class="st">"reg66"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb39-80"><a href="#cb39-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(region66, count, <span class="sc">-</span>id) <span class="sc">%&gt;%</span> </span>
<span id="cb39-81"><a href="#cb39-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(count <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb39-82"><a href="#cb39-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb39-83"><a href="#cb39-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">region66 =</span> <span class="fu">str_remove</span>(region66,<span class="st">"reg66"</span>),</span>
<span id="cb39-84"><a href="#cb39-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">region66 =</span> <span class="fu">as.factor</span>(region66)</span>
<span id="cb39-85"><a href="#cb39-85" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb39-86"><a href="#cb39-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(card_95)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The dependent variable of interest if <span class="math inline">\(\log wage_i\)</span> (<code>lwage76</code>). Our baseline linear model is <span class="math display">\[ \log( wage_i) = \alpha_0 + \beta\cdot educ_i + \alpha_1\cdot exper_i + \frac{\alpha_2}{100}\cdot exper_i^2 + \alpha_3 \cdot black_i + \alpha_4\cdot south_i + \alpha_5\cdot SMSA_i + \varepsilon_i,\]</span> where <span class="math inline">\(educ_i\)</span> (<code>ed76</code>) is level of education, <span class="math inline">\(exper_i\)</span> (<code>exp76</code>) is amount of work experiance, <span class="math inline">\(black_i\)</span> (<code>black</code>) indicated if respondent <span class="math inline">\(i\)</span> is Black, <span class="math inline">\(south_i\)</span> (<code>south76</code>) indicated whether the respondent lives in the South (in 1976), and <span class="math inline">\(SMSA_i\)</span> (<code>smsa76r</code>) indicates whether a respondent lives in the South and in a metropolitan area.<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a> Along with estimating this model, we will estimate similar models which include various controls for family education, family structure, and where respondents lived in 1966.</p>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-35_612887266693355d7f150914313c0d13">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>linear_model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(lwage76 <span class="sc">~</span> ed76 <span class="sc">+</span> exp76 <span class="sc">+</span> exp76_sq_100 <span class="sc">+</span> black <span class="sc">+</span> south76 <span class="sc">+</span> smsa76r, <span class="at">data =</span> card_95)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>linear_model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(lwage76 <span class="sc">~</span> ed76 <span class="sc">+</span> exp76 <span class="sc">+</span> exp76_sq_100 <span class="sc">+</span> black <span class="sc">+</span> south76 <span class="sc">+</span> smsa76r <span class="sc">+</span> smsa66r <span class="sc">+</span> region66, <span class="at">data =</span> card_95)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>linear_model3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(lwage76 <span class="sc">~</span> ed76 <span class="sc">+</span> exp76 <span class="sc">+</span> exp76_sq_100 <span class="sc">+</span> black <span class="sc">+</span> south76 <span class="sc">+</span> smsa76r <span class="sc">+</span> smsa66r <span class="sc">+</span> region66 <span class="sc">+</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>                      daded <span class="sc">+</span> momed <span class="sc">+</span> nodaded <span class="sc">+</span> nomomed, <span class="at">data =</span> card_95)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>linear_model4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(lwage76 <span class="sc">~</span> ed76 <span class="sc">+</span> exp76 <span class="sc">+</span> exp76_sq_100 <span class="sc">+</span> black <span class="sc">+</span> south76 <span class="sc">+</span> smsa76r <span class="sc">+</span> smsa66r <span class="sc">+</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>                      region66 <span class="sc">+</span> daded <span class="sc">+</span> momed <span class="sc">+</span> nodaded <span class="sc">+</span> nomomed <span class="sc">+</span> f1 <span class="sc">+</span> f2 <span class="sc">+</span> f3 <span class="sc">+</span> f4 <span class="sc">+</span> </span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>                      f5 <span class="sc">+</span> f6 <span class="sc">+</span> f7 <span class="sc">+</span> f8, <span class="at">data =</span> card_95)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>linear_model5 <span class="ot">&lt;-</span> <span class="fu">lm</span>(lwage76 <span class="sc">~</span> ed76 <span class="sc">+</span> exp76 <span class="sc">+</span> exp76_sq_100 <span class="sc">+</span> black <span class="sc">+</span> south76 <span class="sc">+</span> smsa76r <span class="sc">+</span> smsa66r <span class="sc">+</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>                     region66<span class="sc">+</span> daded <span class="sc">+</span> momed <span class="sc">+</span> nodaded <span class="sc">+</span> nomomed <span class="sc">+</span> f1 <span class="sc">+</span> f2 <span class="sc">+</span> f3 <span class="sc">+</span> f4 <span class="sc">+</span> </span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>                      f5 <span class="sc">+</span> f6 <span class="sc">+</span> f7 <span class="sc">+</span> f8 <span class="sc">+</span> momdad14 <span class="sc">+</span> sinmom14, <span class="at">data =</span> card_95)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our results should match Table 2 of <span class="citation" data-cites="card1995using">Card (<a href="#ref-card1995using" role="doc-biblioref">1995</a>)</span>. The <code>stargazer</code> package gives us a flexible means of tabulating regression results.<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a></p>
<p>For each model <span class="math inline">\(\hat\beta_\text{OLS}\in[0.073,0.075]\)</span>, meaning that an additional year of education corresponds to roughly a 7.4% increase in earnings. We should be suspicious of these results though, as it’s likely the case that <span class="math inline">\(educ_i\)</span> is endogenous, so we need some instrument(s) for <span class="math inline">\(educ_i\)</span>. <span class="citation" data-cites="card1995using">Card (<a href="#ref-card1995using" role="doc-biblioref">1995</a>)</span> makes the case for using a variable which indicates whether a respondent grew up in a labor market with an accredited 4-year college, <span class="math inline">\(near_\ college_i\)</span> (<code>nearc4</code>). In other words, the respondent lived near a college in the year 1966. This proximity to a college has no baring on earnings (in theory), but it is likely correlated with <span class="math inline">\(educ_i\)</span>, as the cost of higher education is lower for those who have the option to live at home while attending college. Let’s use <span class="math inline">\(near_\ college_i\)</span> to calculate <span class="math inline">\(\hat\beta_\text{IV}\)</span>. We can do this “by hand” by estimating the following reduced form equations via OLS:<a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a></p>
<p><span class="math display">\[\begin{align*}
educ_i &amp;= \gamma_0 + \gamma_1 \cdot near_\ college_i + \gamma_2\cdot exper_i + \frac{\gamma_3}{100}\cdot exper_i^2 + \gamma_4 \cdot black_i + \gamma_5\cdot region_i + \gamma_6\cdot SMSA_i + \cdots + u_i\\
\log( wage_i) &amp;= \delta_0 + \delta_1 \cdot near_\ college_i + \delta_2\cdot exper_i + \frac{\delta_3}{100}\cdot exper_i^2 + \delta_4 \cdot black_i + \delta_5\cdot region_i + \delta_6\cdot SMSA_i + \cdots + \nu_i\\
\end{align*}\]</span></p>
<p>We could also directly estimate the structural model via <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span> and not worry about messing up the standard errors. If we have done everything correctly we should see: <span class="math display">\[ \frac{\hat \delta_{\text{OLS},1}}{\hat \gamma_{\text{OLS},1}} = \hat\beta_\text{IV}.\]</span></p>
<div class="cell" data-layout-align="center" data-fig.asp="0.5" data-hash="endog_cache/html/unnamed-chunk-37_024fc6d260688fd5a5b6a56b67f4d96b">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/card_dag.png" class="img-fluid figure-img" width="500"></p>
<figcaption>test</figcaption>
</figure>
</div>
</div>
</div>
<p>We will estimate the models with and without family controls, and restrict our attention to respondents where <code>lwage76</code> is not missing.</p>
<div class="cell" data-hash="endog_cache/html/unnamed-chunk-38_0c4e30c2d149c688d06a836ef8a2e15d">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>card_95 <span class="ot">&lt;-</span> card_95 <span class="sc">%&gt;%</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(lwage76))</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Without family controls </span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>reduced_form1_stage1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(ed76 <span class="sc">~</span> nearc4 <span class="sc">+</span> exp76 <span class="sc">+</span> exp76_sq_100 <span class="sc">+</span> black <span class="sc">+</span> south76 <span class="sc">+</span> smsa76r <span class="sc">+</span> smsa66r <span class="sc">+</span> region66, <span class="at">data =</span> card_95)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>reduced_form1_stage2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(lwage76 <span class="sc">~</span> nearc4 <span class="sc">+</span> exp76 <span class="sc">+</span> exp76_sq_100 <span class="sc">+</span> black <span class="sc">+</span> south76 <span class="sc">+</span> smsa76r <span class="sc">+</span> smsa66r <span class="sc">+</span> region66, <span class="at">data =</span> card_95)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>IV_model1 <span class="ot">&lt;-</span> <span class="fu">ivreg</span>(lwage76 <span class="sc">~</span> ed76 <span class="sc">+</span> exp76 <span class="sc">+</span> exp76_sq_100 <span class="sc">+</span> black <span class="sc">+</span> south76 <span class="sc">+</span> smsa76r <span class="sc">+</span> smsa66r <span class="sc">+</span> region66 <span class="sc">|</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>                     nearc4 <span class="sc">+</span> exp76 <span class="sc">+</span> exp76_sq_100 <span class="sc">+</span> black <span class="sc">+</span> south76 <span class="sc">+</span> smsa76r <span class="sc">+</span> smsa66r <span class="sc">+</span> region66, <span class="at">data =</span> card_95)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co">#With family controls</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>reduced_form2_stage1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(ed76 <span class="sc">~</span> nearc4 <span class="sc">+</span> exp76 <span class="sc">+</span> exp76_sq_100 <span class="sc">+</span> black <span class="sc">+</span> south76 <span class="sc">+</span> smsa76r <span class="sc">+</span> smsa66r <span class="sc">+</span> </span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>                             region66 <span class="sc">+</span> daded <span class="sc">+</span> momed <span class="sc">+</span> nodaded <span class="sc">+</span> nomomed <span class="sc">+</span> f1 <span class="sc">+</span> f2 <span class="sc">+</span> f3 <span class="sc">+</span> f4 <span class="sc">+</span> </span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>                             f5 <span class="sc">+</span> f6 <span class="sc">+</span> f7 <span class="sc">+</span> f8 <span class="sc">+</span> momdad14 <span class="sc">+</span> sinmom14, <span class="at">data =</span> card_95)</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>reduced_form2_stage2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(lwage76 <span class="sc">~</span> nearc4 <span class="sc">+</span> exp76 <span class="sc">+</span> exp76_sq_100 <span class="sc">+</span> black <span class="sc">+</span> south76 <span class="sc">+</span> smsa76r <span class="sc">+</span> smsa66r <span class="sc">+</span> region66 <span class="sc">+</span> </span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>                             daded <span class="sc">+</span> momed <span class="sc">+</span> nodaded <span class="sc">+</span> nomomed <span class="sc">+</span> f1 <span class="sc">+</span> f2 <span class="sc">+</span> f3 <span class="sc">+</span> f4 <span class="sc">+</span> f5 <span class="sc">+</span> f6 <span class="sc">+</span> f7 <span class="sc">+</span> f8 <span class="sc">+</span> </span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>                             momdad14 <span class="sc">+</span> sinmom14, <span class="at">data =</span> card_95)</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>IV_model2 <span class="ot">&lt;-</span> <span class="fu">ivreg</span>(lwage76 <span class="sc">~</span> ed76 <span class="sc">+</span> exp76 <span class="sc">+</span> exp76_sq_100 <span class="sc">+</span> black <span class="sc">+</span> south76 <span class="sc">+</span> smsa76r <span class="sc">+</span> smsa66r <span class="sc">+</span> region66 <span class="sc">+</span> daded <span class="sc">+</span> momed <span class="sc">+</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>                     nodaded <span class="sc">+</span> nomomed <span class="sc">+</span> f1 <span class="sc">+</span> f2 <span class="sc">+</span> f3 <span class="sc">+</span> f4 <span class="sc">+</span>  f5 <span class="sc">+</span> f6 <span class="sc">+</span> f7 <span class="sc">+</span> f8 <span class="sc">+</span> momdad14 <span class="sc">+</span> sinmom14 <span class="sc">|</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>                     nearc4 <span class="sc">+</span> exp76 <span class="sc">+</span> exp76_sq_100 <span class="sc">+</span> black <span class="sc">+</span> south76 <span class="sc">+</span> smsa76r <span class="sc">+</span> smsa66r <span class="sc">+</span> region66 <span class="sc">+</span> daded <span class="sc">+</span> momed <span class="sc">+</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>                     nodaded <span class="sc">+</span> nomomed <span class="sc">+</span> f1 <span class="sc">+</span> f2 <span class="sc">+</span> f3 <span class="sc">+</span> f4 <span class="sc">+</span> f5 <span class="sc">+</span> f6 <span class="sc">+</span> f7 <span class="sc">+</span> f8 <span class="sc">+</span> momdad14 <span class="sc">+</span> sinmom14, <span class="at">data =</span> card_95)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Compare this to panel A of Table 3 in <span class="citation" data-cites="card1995using">Card (<a href="#ref-card1995using" role="doc-biblioref">1995</a>)</span>. Note that the ratio of our reduced form estimates do equal our IV estimates. Between our original OLS estimates (of the structural model), and our IV estimates, we have seven estimates for <span class="math inline">\(\beta\)</span>. We can plot these along with the corresponding 95% confidence intervals.</p>
<div class="cell" data-layout-align="center" data-fig.asp="0.7" data-hash="endog_cache/html/unnamed-chunk-40_ef0ffaf77e26631d51d1704a32cbc48b">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="endog_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption>test</figcaption>
</figure>
</div>
</div>
</div>
<p>While our IV estimates are larger, all of our OLS estimates fall within the 95% confidence intervals for the IV estimates. As such, we’re not able to conclude that our IV estimates are significantly larger than our OLS estimates.</p>
</section>
<section id="further-reading" class="level2" data-number="8.7">
<h2 data-number="8.7" class="anchored" data-anchor-id="further-reading"><span class="header-section-number">8.7</span> Further Reading</h2>
<p><strong><em>Technical treatment of IV/2SLS</em></strong>: Chapter 5 of <span class="citation" data-cites="wooldridge2010econometric">Wooldridge (<a href="#ref-wooldridge2010econometric" role="doc-biblioref">2010</a>)</span>, Chapter 8 of <span class="citation" data-cites="greene2003econometric">Greene (<a href="#ref-greene2003econometric" role="doc-biblioref">2018</a>)</span>, Chapter 12 of <span class="citation" data-cites="hansen2022econometrics">Hansen (<a href="#ref-hansen2022econometrics" role="doc-biblioref">2022</a>)</span></p>
<p><strong><em>Testing for Endogeneity</em></strong>: Section 8.7 of <span class="citation" data-cites="davidson2004econometric">Davidson, MacKinnon, et al. (<a href="#ref-davidson2004econometric" role="doc-biblioref">2004</a>)</span>, <span class="citation" data-cites="ruud1984tests">Ruud (<a href="#ref-ruud1984tests" role="doc-biblioref">1984</a>)</span>, <span class="citation" data-cites="wu1973alternative">Wu (<a href="#ref-wu1973alternative" role="doc-biblioref">1973</a>)</span>, <span class="citation" data-cites="durbin54">Durbin (<a href="#ref-durbin54" role="doc-biblioref">1954</a>)</span>, <span class="citation" data-cites="hausman1978specification">Hausman (<a href="#ref-hausman1978specification" role="doc-biblioref">1978</a>)</span>, <span class="citation" data-cites="davidson1990specification">Davidson and MacKinnon (<a href="#ref-davidson1990specification" role="doc-biblioref">1990</a>)</span>, <span class="citation" data-cites="nakamura1981relationships">Nakamura and Nakamura (<a href="#ref-nakamura1981relationships" role="doc-biblioref">1981</a>)</span>, <span class="citation" data-cites="chmelarova2007hausman">Chmelarova (<a href="#ref-chmelarova2007hausman" role="doc-biblioref">2007</a>)</span>, <span class="citation" data-cites="baum2003instrumental">Baum, Schaffer, and Stillman (<a href="#ref-baum2003instrumental" role="doc-biblioref">2003</a>)</span></p>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-baum2003instrumental" class="csl-entry" role="listitem">
Baum, Christopher F, Mark E Schaffer, and Steven Stillman. 2003. <span>“Instrumental Variables and GMM: Estimation and Testing.”</span> <em>The Stata Journal</em> 3 (1): 1–31.
</div>
<div id="ref-cameron2005microeconometrics" class="csl-entry" role="listitem">
Cameron, A Colin, and Pravin K Trivedi. 2005. <em>Microeconometrics: Methods and Applications</em>. Cambridge university press.
</div>
<div id="ref-card1995using" class="csl-entry" role="listitem">
Card, David. 1995. <span>“Using Geographic Variation in College Proximity to Estimate the Return to Schooling.”</span> National Bureau of Economic Research Cambridge, Mass., USA.
</div>
<div id="ref-chmelarova2007hausman" class="csl-entry" role="listitem">
Chmelarova, Viera. 2007. <span>“The Hausman Test, and Some Alternatives, with Heteroskedastic Data.”</span>
</div>
<div id="ref-davidson1990specification" class="csl-entry" role="listitem">
Davidson, Russell, and James G MacKinnon. 1990. <span>“Specification Tests Based on Artificial Regressions.”</span> <em>Journal of the American Statistical Association</em> 85 (409): 220–27.
</div>
<div id="ref-davidson2004econometric" class="csl-entry" role="listitem">
Davidson, Russell, James G MacKinnon, et al. 2004. <em>Econometric Theory and Methods</em>. Vol. 5. Oxford University Press New York.
</div>
<div id="ref-durbin54" class="csl-entry" role="listitem">
Durbin, James. 1954. <span>“Errors in Variables.”</span> <em>Review of the International Statistical Institute</em> 22: 23–32.
</div>
<div id="ref-greene2003econometric" class="csl-entry" role="listitem">
Greene, William H. 2018. <em>Econometric Analysis</em>. 8th ed. Pearson Education.
</div>
<div id="ref-hansen2022econometrics" class="csl-entry" role="listitem">
Hansen, Bruce. 2022. <em>Econometrics</em>. Princeton University Press.
</div>
<div id="ref-hausman1978specification" class="csl-entry" role="listitem">
Hausman, Jerry A. 1978. <span>“Specification Tests in Econometrics.”</span> <em>Econometrica: Journal of the Econometric Society</em>, 1251–71.
</div>
<div id="ref-mroz" class="csl-entry" role="listitem">
Mroz, Thomas A. 1987. <span>“The Sensitivity of an Empirical Model of Married Women’s Hours of Work to Economic and Statistical Assumptions.”</span> <em>Econometrica</em> 55 (4): 765–99. <a href="http://www.jstor.org/stable/1911029">http://www.jstor.org/stable/1911029</a>.
</div>
<div id="ref-nakamura1981relationships" class="csl-entry" role="listitem">
Nakamura, Alice, and Masao Nakamura. 1981. <span>“On the Relationships Among Several Specification Error Tests Presented by Durbin, Wu, and Hausman.”</span> <em>Econometrica</em> 49 (6): 1583–88.
</div>
<div id="ref-pearl2009causality" class="csl-entry" role="listitem">
Pearl, Judea. 2009. <em>Causality</em>. Cambridge university press.
</div>
<div id="ref-ruud1984tests" class="csl-entry" role="listitem">
Ruud, Paul A. 1984. <span>“Tests of Specification in Econometrics.”</span> <em>Econometric Reviews</em> 3 (2): 211–42.
</div>
<div id="ref-wooldridge2010econometric" class="csl-entry" role="listitem">
Wooldridge, Jeffrey M. 2010. <em>Econometric Analysis of Cross Section and Panel Data</em>. MIT press.
</div>
<div id="ref-wu1973alternative" class="csl-entry" role="listitem">
Wu, De-Min. 1973. <span>“Alternative Tests of Independence Between Stochastic Regressors and Disturbances.”</span> <em>Econometrica: Journal of the Econometric Society</em>, 733–50.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Are there situations where these assumptions may not hold?<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>It’s important to emphasize that these are linear projections, not structural linear models. There is no structural relationship between <span class="math inline">\(\mathbf{Z}\)</span> and <span class="math inline">\(X_j\)</span> or <span class="math inline">\(\mathbf{Z}\)</span> and <span class="math inline">\(Y\)</span>! This is really important, and we’ll introduce a definition related to this in the context of 2SLS.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Intuitively, this matrix must be PSD in the same way the sum of squared numbers cannot be negative.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>This happens to be one of the most cited papers in all of economics.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>In Example @ref(exm:ref3) we saw that <span class="math inline">\(\hat{\boldsymbol\beta}_\text{OLS} \)</span> is more efficient than <span class="math inline">\(\hat{\boldsymbol\beta}_\text{IV} \)</span> in the event that our regressors are exogenous. This was formalized in Theorem @ref(thm:eff2), because in the event that all regressors <span class="math inline">\(\mathbf{X}\)</span> are exogenous and we have non-trivial instruments <span class="math inline">\(\mathbf{Z}\)</span>, then <span class="math inline">\(\hat{\boldsymbol\beta}_\text{2SLS} \)</span> “picks” the optimal trivial instruments <span class="math inline">\(\mathbf{X}\)</span> and our estimator reduces to <span class="math inline">\(\hat{\boldsymbol\beta}_\text{OLS} \)</span>.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>We know it’s exogenous because <span class="math inline">\(\mathbb{Z}\)</span> is a valid instrument and is exogenous<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>I did this to the best of my ability, as I have no experience with <code>.sas</code>, and I could have misinterpreted the accompanying documentation and commentary in the code.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>The abbreviation “MSA” comes up a lot when dealing with surbey data. It stands for “metropolitan statistical area”, and are used by the Census Bureau to designate areas with a high population density.<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9"><p>Right now, the table is formatted in html and automatically included when this Rmarkdown file is knit, but you <code>stargazer</code> is also capable of outputting very nice tables in <span class="math inline">\(\LaTeX\)</span>.<a href="#fnref9" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn10"><p>While we’re prone to make mistakes involving standard errors here, it’s sort of the equivelent of “showing your work” on a math test.<a href="#fnref10" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./ols.html" class="pagination-link" aria-label="The Classical Linear Model">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">The Classical Linear Model</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./gls.html" class="pagination-link" aria-label="Generalized Least Squares">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Generalized Least Squares</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb42" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>\DeclareMathOperator{\plim}{plim}</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>\DeclareMathOperator{\argmin}{argmin}</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>\DeclareMathOperator{\argmax}{argmax}</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>\newcommand{\var}<span class="co">[</span><span class="ot">1</span><span class="co">]</span>{\text{Var}\left(#1\right)}</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>\newcommand{\avar}<span class="co">[</span><span class="ot">1</span><span class="co">]</span>{\text{Avar}\left(#1\right)}</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>\newcommand{\E}<span class="co">[</span><span class="ot">1</span><span class="co">]</span>{\text{E}\left<span class="co">[</span><span class="ot">#1\right</span><span class="co">]</span>}</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>\newcommand{\cov}<span class="co">[</span><span class="ot">1</span><span class="co">]</span>{\text{Cov}\left(#1\right)}</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>\newcommand{\mse}<span class="co">[</span><span class="ot">1</span><span class="co">]</span>{\text{MSE}\left(#1\right)}</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>\newcommand{\se}<span class="co">[</span><span class="ot">1</span><span class="co">]</span>{\text{se}\left(#1\right)}</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>\newcommand{\limfunc}{lim} </span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>\newcommand{\X}{\mathbf{X}}</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>\newcommand{\Xm}{\mathbb{X}}</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>\newcommand{\EER}{\bar{\thet}_\text{EE}}</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>\newcommand{\NLS}{\hat{\bet}_\text{NLLS}}</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>\newcommand{\z}{\mathbf{z}}</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>\newcommand{\rr}{\mathbf{r}}</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>\newcommand{\C}{\mathbf{C}}</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>\newcommand{\Pe}{\mathbf{P}}</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>\newcommand{\y}{\mathbf{y}}</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>\newcommand{\Y}{\mathbf{Y}}</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>\newcommand{\uu}{\mathbf{u}}</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>\newcommand{\e}{\mathbf{e}}</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>\newcommand{\D}{\mathbf{D}}</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>\newcommand{\x}{\mathbf{x}}</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>\newcommand{\xm}{\mathbb{x}}</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>\newcommand{\Zm}{\mathbb{Z}}</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>\newcommand{\Wm}{\mathbb{W}}</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>\newcommand{\Hm}{\mathbb{H}}</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>\newcommand{\W}{\mathbf{W}}</span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>\newcommand{\Z}{\mathbf{Z}}</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>\newcommand{\Hess}{\mathbf{H}(\mathbf{\Z\mid\thet})}</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>\newcommand{\Score}{\mathbf{S}(\mathbf{\Z\mid\thet})}</span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>\newcommand{\A}{\mathbf{A}}</span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>\newcommand{\h}{\mathbf{h}}</span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>\newcommand{\Q}{\mathbf{Q}}</span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>\newcommand{\F}{\mathbf{F}}</span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a>\newcommand{\G}{\mathbf{G}}</span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>\newcommand{\I}{\mathbf{I}}</span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>\renewcommand{\D}{\mathbf{D}}</span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>\renewcommand{\C}{\mathbf{C}}</span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a>\newcommand{\zer}{\mathbf{0}}</span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a>\newcommand{\OLS}{\hat{\boldsymbol\beta}_\text{OLS} }</span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a>\newcommand{\OLSOV}{\hat{\boldsymbol\beta}_\text{OLS,OV} }</span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a>\newcommand{\OLSME}{\hat{\boldsymbol\beta}_\text{OLS,ME} }</span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a>\newcommand{\EE}{\hat{\boldsymbol\theta}_\text{EX} }</span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a>\newcommand{\ME}{\hat{\boldsymbol\theta}_\text{M} }</span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a>\newcommand{\MDE}{\hat{\boldsymbol\theta}_\text{MDE} }</span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a>\newcommand{\IV}{\hat{\boldsymbol\beta}_\text{IV} }</span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true" tabindex="-1"></a>\newcommand{\TSLS}{\hat{\boldsymbol\beta}_\text{2SLS} }</span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true" tabindex="-1"></a>\newcommand{\thet}{\boldsymbol{\theta}}</span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true" tabindex="-1"></a>\newcommand{\et}{\boldsymbol{\eta}}</span>
<span id="cb42-52"><a href="#cb42-52" aria-hidden="true" tabindex="-1"></a>\newcommand{\R}{\mathbb{R}}</span>
<span id="cb42-53"><a href="#cb42-53" aria-hidden="true" tabindex="-1"></a>\newcommand{\Sig}{\boldsymbol{\Sigma}}</span>
<span id="cb42-54"><a href="#cb42-54" aria-hidden="true" tabindex="-1"></a>\newcommand{\ep}{\boldsymbol{\varepsilon}}</span>
<span id="cb42-55"><a href="#cb42-55" aria-hidden="true" tabindex="-1"></a>\newcommand{\Omeg}{\boldsymbol{\Omega}}</span>
<span id="cb42-56"><a href="#cb42-56" aria-hidden="true" tabindex="-1"></a>\newcommand{\Thet}{\boldsymbol{\Theta}}</span>
<span id="cb42-57"><a href="#cb42-57" aria-hidden="true" tabindex="-1"></a>\newcommand{\bet}{\boldsymbol{\beta}}</span>
<span id="cb42-58"><a href="#cb42-58" aria-hidden="true" tabindex="-1"></a>\newcommand{\rk}{rank}</span>
<span id="cb42-59"><a href="#cb42-59" aria-hidden="true" tabindex="-1"></a>\newcommand{\tsum}{\sum}</span>
<span id="cb42-60"><a href="#cb42-60" aria-hidden="true" tabindex="-1"></a>\newcommand{\tr}{tr}</span>
<span id="cb42-61"><a href="#cb42-61" aria-hidden="true" tabindex="-1"></a>\newcommand{\norm}<span class="co">[</span><span class="ot">1</span><span class="co">]</span>{\left\lVert#1\right\rVert}</span>
<span id="cb42-62"><a href="#cb42-62" aria-hidden="true" tabindex="-1"></a>\newcommand{\abs}<span class="co">[</span><span class="ot">1</span><span class="co">]</span>{\left\lvert#1\right\rvert}</span>
<span id="cb42-63"><a href="#cb42-63" aria-hidden="true" tabindex="-1"></a>\newcommand{\ms}{\overset{ms}{\to}}</span>
<span id="cb42-64"><a href="#cb42-64" aria-hidden="true" tabindex="-1"></a>\newcommand{\pto}{\overset{p}{\to}}</span>
<span id="cb42-65"><a href="#cb42-65" aria-hidden="true" tabindex="-1"></a>\newcommand{\iid}{\overset{iid}{\sim}}</span>
<span id="cb42-66"><a href="#cb42-66" aria-hidden="true" tabindex="-1"></a>\newcommand{\dto}{\overset{d}{\to}}</span>
<span id="cb42-67"><a href="#cb42-67" aria-hidden="true" tabindex="-1"></a>\newcommand{\asim}{\overset{a}{\sim}}</span>
<span id="cb42-68"><a href="#cb42-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-69"><a href="#cb42-69" aria-hidden="true" tabindex="-1"></a><span class="fu"># Endogeniety I: IV and 2SLS</span></span>
<span id="cb42-70"><a href="#cb42-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-73"><a href="#cb42-73" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-74"><a href="#cb42-74" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb42-75"><a href="#cb42-75" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb42-76"><a href="#cb42-76" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb42-77"><a href="#cb42-77" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pracma)</span>
<span id="cb42-78"><a href="#cb42-78" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm)</span>
<span id="cb42-79"><a href="#cb42-79" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stargazer)</span>
<span id="cb42-80"><a href="#cb42-80" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ivreg)</span>
<span id="cb42-81"><a href="#cb42-81" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AER)</span>
<span id="cb42-82"><a href="#cb42-82" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb42-83"><a href="#cb42-83" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(wooldridge)</span>
<span id="cb42-84"><a href="#cb42-84" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-85"><a href="#cb42-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-86"><a href="#cb42-86" aria-hidden="true" tabindex="-1"></a>Our first departure from the classical linear model $\mathcal P_\text{LM}$ will come in the form of dropping the assumption that $\E{\X'\ep} = \zer$, i.e our regressors are endogenous. This situation is rather serious, as it prevents the linear model from being identified. Furthermore, the problem is common in applications. There are three main sources of endogeneity:</span>
<span id="cb42-87"><a href="#cb42-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-88"><a href="#cb42-88" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Omitted variables</span>
<span id="cb42-89"><a href="#cb42-89" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Measurement error</span>
<span id="cb42-90"><a href="#cb42-90" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Simultaneity </span>
<span id="cb42-91"><a href="#cb42-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-92"><a href="#cb42-92" aria-hidden="true" tabindex="-1"></a>For now we'll consider the first two, and discuss the third on in Section \@ref(endogeniety-ii-simultaneous-equation-models). Fortunately, we can address endogeneity with the instrumental variables estimator (a special case of which is the two-stage least squares estimator).</span>
<span id="cb42-93"><a href="#cb42-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-94"><a href="#cb42-94" aria-hidden="true" tabindex="-1"></a><span class="fu">## Omitted Variables and Measurement Error</span></span>
<span id="cb42-95"><a href="#cb42-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-96"><a href="#cb42-96" aria-hidden="true" tabindex="-1"></a>:::{#exm-ex1}</span>
<span id="cb42-97"><a href="#cb42-97" aria-hidden="true" tabindex="-1"></a>Recall the Example \@ref(exm:endogex) where we considered a model relating income to education and other determinants of salary. Suppose the true model is </span>
<span id="cb42-98"><a href="#cb42-98" aria-hidden="true" tabindex="-1"></a>$$ \log(income_i) = \beta_1 + \beta_2\cdot educ_i + \beta_3 \cdot experiance_i + \varepsilon_i,$$ where $\varepsilon_i$ are the unobserved factors impacting salary, $educ_i$ measure years of post-secondary education, $experiance_i$ measures years of work experience, and $\cov{educ, experiance} &lt; 0$ (the longer you go to school, the less work experience you tend to have). Now suppose we incorrectly specify the model $$ \log(income_i) = \gamma_1 + \gamma_2\cdot educ_i + u_i,$$ where $u_i$ are all other factors impacting salary. We've omitted $experiance_i$ as a regressor, so it's implicitly included in $u_i$:</span>
<span id="cb42-99"><a href="#cb42-99" aria-hidden="true" tabindex="-1"></a>$$ u_i =  \beta_3 \cdot experiance_i + \varepsilon_i.$$ We no longer satisfy the assumption $\E{\X'\ep} = \zer$, as $\cov{educ_i, u_i} \neq 0$ because $\cov{educ, experiance} &lt; 0$. What happens if we go ahead and attempt to estimate $\beta_1$ and $\beta_2$ anyway? Set $\bet = <span class="co">[</span><span class="ot">1,3,2</span><span class="co">]</span>'$, and $\varepsilon_i \iid N(0,1)$. </span>
<span id="cb42-100"><a href="#cb42-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-103"><a href="#cb42-103" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-104"><a href="#cb42-104" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb42-105"><a href="#cb42-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-106"><a href="#cb42-106" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"functions/sim_linear_model.r"</span>)</span>
<span id="cb42-107"><a href="#cb42-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-108"><a href="#cb42-108" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">10</span>)</span>
<span id="cb42-109"><a href="#cb42-109" aria-hidden="true" tabindex="-1"></a>Sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="sc">-</span><span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.5</span>, <span class="dv">5</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb42-110"><a href="#cb42-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-111"><a href="#cb42-111" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">sim_linear_model</span>(</span>
<span id="cb42-112"><a href="#cb42-112" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>),</span>
<span id="cb42-113"><a href="#cb42-113" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">1000</span>,</span>
<span id="cb42-114"><a href="#cb42-114" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_vec =</span> <span class="fu">c</span>(rmvnorm, rnorm),</span>
<span id="cb42-115"><a href="#cb42-115" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_params_list =</span> <span class="fu">list</span>(<span class="fu">list</span>(mu, Sigma), <span class="fu">list</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb42-116"><a href="#cb42-116" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-117"><a href="#cb42-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-118"><a href="#cb42-118" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x2, <span class="at">data =</span> results<span class="sc">$</span>observed_data) <span class="sc">%&gt;%</span> </span>
<span id="cb42-119"><a href="#cb42-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span>
<span id="cb42-120"><a href="#cb42-120" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-121"><a href="#cb42-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-124"><a href="#cb42-124" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-125"><a href="#cb42-125" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb42-126"><a href="#cb42-126" aria-hidden="true" tabindex="-1"></a>model <span class="sc">%&gt;%</span> </span>
<span id="cb42-127"><a href="#cb42-127" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span>
<span id="cb42-128"><a href="#cb42-128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-129"><a href="#cb42-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-130"><a href="#cb42-130" aria-hidden="true" tabindex="-1"></a>The true parameters don't even fall within the 95% confidence intervals centered at our estimates.</span>
<span id="cb42-131"><a href="#cb42-131" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-132"><a href="#cb42-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-133"><a href="#cb42-133" aria-hidden="true" tabindex="-1"></a>In general, suppose $$\Y = <span class="co">[</span><span class="ot">\Xm,\Zm</span><span class="co">][\bet, \boldsymbol \delta]</span>' + \ep = \Xm\bet + \Zm\boldsymbol \delta + \ep,$$ where we attempt to estimate $\bet$ via $\OLS$ despite omitting regressors $\mathbf Z$ from our model, and all our Gauss-Markov assumptions are met. Note that $\bet$ is still identified, as $\E{\X'\ep} = \zer$.</span>
<span id="cb42-134"><a href="#cb42-134" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-135"><a href="#cb42-135" aria-hidden="true" tabindex="-1"></a>\OLSOV &amp; = (\Xm'\Xm)^{-1}\Xm'\Y<span class="sc">\\</span></span>
<span id="cb42-136"><a href="#cb42-136" aria-hidden="true" tabindex="-1"></a>&amp; = (\Xm'\Xm)^{-1}\Xm'(\Xm\bet + \Zm\boldsymbol \delta + \ep)<span class="sc">\\</span></span>
<span id="cb42-137"><a href="#cb42-137" aria-hidden="true" tabindex="-1"></a>&amp; = \bet + (\Xm'\Xm)^{-1}\Xm'\Zm\boldsymbol\delta  + (\Xm'\Xm)^{-1}\Xm'\ep.</span>
<span id="cb42-138"><a href="#cb42-138" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-139"><a href="#cb42-139" aria-hidden="true" tabindex="-1"></a>Our estimator is now inconsistent: </span>
<span id="cb42-140"><a href="#cb42-140" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-141"><a href="#cb42-141" aria-hidden="true" tabindex="-1"></a>\plim \OLSOV &amp; = \bet + \plim\left<span class="co">[</span><span class="ot">(\Xm'\Xm)^{-1}\Xm'\Zm\boldsymbol\delta\right</span><span class="co">]</span> + \plim\left<span class="co">[</span><span class="ot">(\Xm'\Xm)^{-1}\right</span><span class="co">]</span>\underbrace{\plim\left<span class="co">[</span><span class="ot">\Xm'\ep\right</span><span class="co">]</span>}_\zer<span class="sc">\\</span></span>
<span id="cb42-142"><a href="#cb42-142" aria-hidden="true" tabindex="-1"></a>&amp; =  \bet + \plim\left<span class="co">[</span><span class="ot">(\Xm'\Xm)^{-1}\Xm'\Zm\boldsymbol\delta\right</span><span class="co">]</span>.</span>
<span id="cb42-143"><a href="#cb42-143" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-144"><a href="#cb42-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-145"><a href="#cb42-145" aria-hidden="true" tabindex="-1"></a>This phenomenon is referred to as **_omitted variable bias (OVB)_**. The use of the word "bias" here is a bit misleading, but follows from an interpretation of inconsistency as a persistent bias despite $n\to\infty$</span>
<span id="cb42-146"><a href="#cb42-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-147"><a href="#cb42-147" aria-hidden="true" tabindex="-1"></a>:::{#exm-}</span>
<span id="cb42-148"><a href="#cb42-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-149"><a href="#cb42-149" aria-hidden="true" tabindex="-1"></a><span class="fu">## OVB with a Simple Linear Model</span></span>
<span id="cb42-150"><a href="#cb42-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-151"><a href="#cb42-151" aria-hidden="true" tabindex="-1"></a>Suppose our linear model is $Y = \alpha + \beta X+ \gamma Z + \varepsilon$, and we attempt to estimate $(\beta_0,\beta_1)$ with $\OLSOV$. In this case,</span>
<span id="cb42-152"><a href="#cb42-152" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-153"><a href="#cb42-153" aria-hidden="true" tabindex="-1"></a>\hat \beta_\text{OLS,OV} &amp; =\frac{\sum_{i=1}^n (X_i -\bar X)(Y_i - \bar Y)}{\sum_{i=1}^n (X_i -\bar X)^2}<span class="sc">\\</span> &amp; = \frac{\sum_{i=1}^n (X_i -\bar X)<span class="co">[</span><span class="ot">(\alpha + \beta X+ \gamma Z + \varepsilon) - \bar Y</span><span class="co">]</span>}{\sum_{i=1}^n (X_i -\bar X)^2}<span class="sc">\\</span> &amp; = \beta + \frac{\sum_{i=1}^n (X_i -\bar X)(Z_i - \bar Z)}{\sum_{i=1}^n (X_i -\bar X)^2}<span class="sc">\\</span> &amp; = \beta + \gamma \cdot \frac{\sum_{i=1}^n (X_i -\bar X)(Z_i-\bar Z)}{\sum_{i=1}^n (X_i -\bar X)^2}.</span>
<span id="cb42-154"><a href="#cb42-154" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-155"><a href="#cb42-155" aria-hidden="true" tabindex="-1"></a>The expectation of this is</span>
<span id="cb42-156"><a href="#cb42-156" aria-hidden="true" tabindex="-1"></a>$$\hat\beta_\text{OLS,OV} \pto \beta + \gamma \cdot \plim\frac{n^{-1}\sum_{i=1}^n (X_i -\bar X)(Z_i-\bar Z)}{n^{-1}\sum_{i=1}^n (X_i -\bar X)^2} =\bet + \gamma \frac{\cov{X,Z}}{\var{X}} .$$</span>
<span id="cb42-157"><a href="#cb42-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-158"><a href="#cb42-158" aria-hidden="true" tabindex="-1"></a>If we let $\alpha = 1$, $\beta = 2$, $\gamma = 3$, and $\var{X} = 1$, then $$\plim \hat\beta_\text{OLS,OV} = 2 + 3\cov{X,Z}.$$ If we simulate this estimator for different values of $\cov{X,Z}$, taking $n$ to be very large, then we should see our estimates approximately follow the line $2 + 3\cov{X,Z}$ when plotted against $\cov{X,Z}$.</span>
<span id="cb42-159"><a href="#cb42-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-160"><a href="#cb42-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-161"><a href="#cb42-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-162"><a href="#cb42-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-165"><a href="#cb42-165" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-166"><a href="#cb42-166" aria-hidden="true" tabindex="-1"></a>iter <span class="ot">&lt;-</span> <span class="cf">function</span>(cov_xz, var_x, var_z, beta, gamma, n, mu){</span>
<span id="cb42-167"><a href="#cb42-167" aria-hidden="true" tabindex="-1"></a>  Sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(var_x, cov_xz, cov_xz, var_z), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb42-168"><a href="#cb42-168" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">sim_linear_model</span>(</span>
<span id="cb42-169"><a href="#cb42-169" aria-hidden="true" tabindex="-1"></a>    <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">1</span>, beta, gamma),</span>
<span id="cb42-170"><a href="#cb42-170" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> n,</span>
<span id="cb42-171"><a href="#cb42-171" aria-hidden="true" tabindex="-1"></a>    <span class="at">dist_vec =</span> <span class="fu">c</span>(rmvnorm, rnorm),</span>
<span id="cb42-172"><a href="#cb42-172" aria-hidden="true" tabindex="-1"></a>    <span class="at">dist_params_list =</span> <span class="fu">list</span>(<span class="fu">list</span>(mu, Sigma), <span class="fu">list</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb42-173"><a href="#cb42-173" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-174"><a href="#cb42-174" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x2, <span class="at">data =</span> results<span class="sc">$</span>observed_data) <span class="sc">%&gt;%</span> </span>
<span id="cb42-175"><a href="#cb42-175" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb42-176"><a href="#cb42-176" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">'x2'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-177"><a href="#cb42-177" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb42-178"><a href="#cb42-178" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cov_xz =</span> cov_xz)</span>
<span id="cb42-179"><a href="#cb42-179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb42-180"><a href="#cb42-180" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-181"><a href="#cb42-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-182"><a href="#cb42-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-183"><a href="#cb42-183" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="cf">function</span>(cov_xz_vals, var_x, var_z, beta, gamma, n, mu){</span>
<span id="cb42-184"><a href="#cb42-184" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> cov_xz_vals <span class="sc">%&gt;%</span> </span>
<span id="cb42-185"><a href="#cb42-185" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(iter, <span class="at">var_x =</span> var_x, <span class="at">var_z =</span> var_z, <span class="at">beta =</span> beta, <span class="at">gamma =</span> gamma, <span class="at">n =</span> n, <span class="at">mu =</span> mu) <span class="sc">%&gt;%</span> </span>
<span id="cb42-186"><a href="#cb42-186" aria-hidden="true" tabindex="-1"></a>    bind_rows</span>
<span id="cb42-187"><a href="#cb42-187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb42-188"><a href="#cb42-188" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-189"><a href="#cb42-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-190"><a href="#cb42-190" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">sim</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)<span class="sc">/</span><span class="dv">50</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="fl">1e6</span>, <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">10</span>))</span>
<span id="cb42-191"><a href="#cb42-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-192"><a href="#cb42-192" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-193"><a href="#cb42-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-196"><a href="#cb42-196" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-197"><a href="#cb42-197" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb42-198"><a href="#cb42-198" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb42-199"><a href="#cb42-199" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-plot701</span></span>
<span id="cb42-200"><a href="#cb42-200" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb42-201"><a href="#cb42-201" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb42-202"><a href="#cb42-202" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-asp: 0.7</span></span>
<span id="cb42-203"><a href="#cb42-203" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb42-204"><a href="#cb42-204" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: " f"</span></span>
<span id="cb42-205"><a href="#cb42-205" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show code which generates figure"</span></span>
<span id="cb42-206"><a href="#cb42-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-207"><a href="#cb42-207" aria-hidden="true" tabindex="-1"></a>results <span class="sc">%&gt;%</span> </span>
<span id="cb42-208"><a href="#cb42-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(cov_xz, estimate)) <span class="sc">+</span> </span>
<span id="cb42-209"><a href="#cb42-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb42-210"><a href="#cb42-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Cov(X,Z)"</span>, <span class="at">y =</span> <span class="st">"Estimated β"</span>) <span class="sc">+</span> </span>
<span id="cb42-211"><a href="#cb42-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() </span>
<span id="cb42-212"><a href="#cb42-212" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-213"><a href="#cb42-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-214"><a href="#cb42-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-215"><a href="#cb42-215" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-216"><a href="#cb42-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-217"><a href="#cb42-217" aria-hidden="true" tabindex="-1"></a>What happens if instead of omitting a variable from a model, our variables happen to be prone to some degree of measurement error? This is a common scenario in the social sciences where collected data is subject to human error, rounding errors, etc. Suppose a true linear model is specified as $\Y = \Xm^*\bet + \ep$ for regressors $\X^*$ where $\E{\X^{*\prime}\ep} = \zer$. Much like how we do not observe realizations of $\ep$, we do not observe realizations of $\X^*$, instead observing  $\X = \X^* + \mathbf u$ where $\mathbf u$ corresponds to **_measurement error_**. We'll assume that this measurement error is independent of $\ep$, independent of $\X^*$, and is mean zero.^<span class="co">[</span><span class="ot">Are there situations where these assumptions may not hold?</span><span class="co">]</span> Our model can be rewritten as </span>
<span id="cb42-218"><a href="#cb42-218" aria-hidden="true" tabindex="-1"></a>$$ \Y = \Xm^*\bet + \ep = (\X - \mathbf u)\bet + \ep = \X\bet + \underbrace{(\ep - \mathbf u\bet)}_{\boldsymbol \nu}.$$ In this case $$\E{\X\boldsymbol \nu} = \E{(\X^* + \mathbf u)(\ep - \mathbf u\bet)} = -\bet\E{\mathbf u'\mathbf u} = -\bet \var{\mathbf u}.$$ Much like in the case of OVB, $\OLS$ will be inconsistent.</span>
<span id="cb42-219"><a href="#cb42-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-220"><a href="#cb42-220" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-221"><a href="#cb42-221" aria-hidden="true" tabindex="-1"></a>\OLSME &amp;= \bet + (\Xm'\Xm)^{-1}\Xm'\ep <span class="sc">\\</span></span>
<span id="cb42-222"><a href="#cb42-222" aria-hidden="true" tabindex="-1"></a>     &amp; = \bet + (\Xm'\Xm)^{-1}\Xm'(\ep - \mathbf u\bet)<span class="sc">\\</span></span>
<span id="cb42-223"><a href="#cb42-223" aria-hidden="true" tabindex="-1"></a>     &amp; = \bet + (\Xm'\Xm)^{-1}\Xm'\ep - (\Xm'\Xm)^{-1}\Xm'\mathbf u\bet<span class="sc">\\</span></span>
<span id="cb42-224"><a href="#cb42-224" aria-hidden="true" tabindex="-1"></a>\plim \OLSME &amp; = \bet + \plim  (\Xm'\Xm)^{-1}\Xm'\ep + \plim (\Xm'\Xm)^{-1}\Xm'\mathbf u\bet<span class="sc">\\</span></span>
<span id="cb42-225"><a href="#cb42-225" aria-hidden="true" tabindex="-1"></a>  &amp; = \bet + \plim (\Xm'\Xm)^{-1}\Xm'\mathbf u\bet &amp; (\plim \Xm'\ep = \zer)</span>
<span id="cb42-226"><a href="#cb42-226" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-227"><a href="#cb42-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-228"><a href="#cb42-228" aria-hidden="true" tabindex="-1"></a>For $j\neq 1$ (there won't be measurement error when $j=1$, as this is just the regressor of 1 which gives the intercept) this simplifies to</span>
<span id="cb42-229"><a href="#cb42-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-230"><a href="#cb42-230" aria-hidden="true" tabindex="-1"></a>$$ \plim \hat \beta_{\text{OLS,ME},j} = \beta_j \left(\frac{\var{X_j^*}}{\var{X_j^*} + \var{u_j^*}}\right).$$ This phenomenon is known as **_attenuation bias_**. The term in parentheses will always fall in the interval $(0,1)$, so $\abs{\plim \hat \beta_{\text{OLS,ME},j}} &lt; \abs{\bet_j}$, hence the name attentuation bias. </span>
<span id="cb42-231"><a href="#cb42-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-232"><a href="#cb42-232" aria-hidden="true" tabindex="-1"></a><span class="fu">## An Updated Linear Model, Identification, and the IV estimator</span></span>
<span id="cb42-233"><a href="#cb42-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-234"><a href="#cb42-234" aria-hidden="true" tabindex="-1"></a>In general, if $\E{\X'\ep} \neq \zer$, then $\bet$ is not identified for the linear model $\mathcal P_\text{LM}$. Estimation is a non-starter in this case. Even if we had the "perfect" estimate for $\bet,$ the parameter may map to multiple elements $P_{\bet,\sigma^2}\in  \mathcal P_\text{LM}$, so it is impossible to determine which model value our data was drawn from. If we drop the assumption $\E{\X'\ep} \neq \zer$ from the linear model, then we'll need to replace it with some additional assumptions/structure. </span>
<span id="cb42-235"><a href="#cb42-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-236"><a href="#cb42-236" aria-hidden="true" tabindex="-1"></a>While $\E{\X'\ep} \neq \zer$, *perhaps* it is the case that there exists some other random vector $\Z$ which does satisfy $\E{\Z'\ep} = \zer$. Is this helpful -- no. For a given model with some structural error $\ep$, there are nearly infinite candidates for $\Z$ which satisfy this. Consider the model $$\log(income_i) = \beta_0 + \beta_1\cdot educ_i + \varepsilon_i,$$ where $\varepsilon$ are unobserved factors impacting income. What are some random variables $Z$ which are uncorrelated with $\varepsilon$. A ton! Weather during $i$'s tenth birthday, $i$'s first concert, $i$'s favorite flavor of ice cream, etc. There is an endless list of random variables that are so completely irrelevant to someone's income, that they are uncorrelated with $\varepsilon$. This is why $\E{\Z'\ep} = \zer$ is sometimes read as "$\Z$ is orthogonal to $\ep$." Not only does it hold in the mathematical sense of the word, but it also holds in the colloquial sense of the word meaning "has nothing to do with." What we want is $\Z$ to also be correlated with $\X$, such that $\Z$ is a sort of proxy/surrogate for $\X$ with no direct impact on $\Y$. We'll now generalize the linear model to introduce this set of variables $\Z$ in lieu of the assumption $\E{\X'\ep} \neq \zer$.</span>
<span id="cb42-237"><a href="#cb42-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-238"><a href="#cb42-238" aria-hidden="true" tabindex="-1"></a>:::{#def-}</span>
<span id="cb42-239"><a href="#cb42-239" aria-hidden="true" tabindex="-1"></a>The &lt;span style="color:red"&gt;**_(linear) instrumental variables (IV) model_**&lt;/span&gt; is defined as $\mathcal P_\text{IV} = <span class="sc">\{</span>P_{\bet,\sigma^2} \mid \bet \in \mathbb R^{K}, \sigma^2\in\mathbb R<span class="sc">\}</span>$, where </span>
<span id="cb42-240"><a href="#cb42-240" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-241"><a href="#cb42-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-242"><a href="#cb42-242" aria-hidden="true" tabindex="-1"></a>P_{\bet,\sigma^2} &amp;= \left<span class="sc">\{</span>F_{\Xm,\Zm,\ep} \middle|  \begin{matrix}Y= \Xm\bet +\ep, \ \E{\ep'\ep\mid \X}=\sigma^2\mathbf I,\ f_{(\Xm,\Zm)}=\textstyle\prod_{i=1}^n f_{(\X_i,\Z_i)},<span class="sc">\\</span> \text{rank}\left(\E{\Z'\X}\right) = K,\ \E{\ep\mid \Xm} =\boldsymbol \eta,\  \E{\ep\mid \Zm} = \zer,\ \E{\Z'\X} \neq \zer \end{matrix} \right<span class="sc">\}</span>,<span class="sc">\\</span></span>
<span id="cb42-243"><a href="#cb42-243" aria-hidden="true" tabindex="-1"></a>\Xm &amp; = <span class="co">[</span><span class="ot">\X_1, \cdots, \X_j, \cdots \X_K</span><span class="co">]</span> = <span class="co">[</span><span class="ot">\X_1, \cdots, \X_i, \cdots \X_n</span><span class="co">]</span>',<span class="sc">\\</span></span>
<span id="cb42-244"><a href="#cb42-244" aria-hidden="true" tabindex="-1"></a>\Zm &amp; = <span class="co">[</span><span class="ot">\Z_1, \cdots, \Z_j, \cdots \Z_K</span><span class="co">]</span> = <span class="co">[</span><span class="ot">\Z_1, \cdots, \Z_i, \cdots \Z_n</span><span class="co">]</span>',<span class="sc">\\</span></span>
<span id="cb42-245"><a href="#cb42-245" aria-hidden="true" tabindex="-1"></a>\dim(\Z) &amp; = \dim(\X) = K<span class="sc">\\</span></span>
<span id="cb42-246"><a href="#cb42-246" aria-hidden="true" tabindex="-1"></a>\Y &amp; = <span class="co">[</span><span class="ot">Y_1, \ldots, Y_n</span><span class="co">]</span>.</span>
<span id="cb42-247"><a href="#cb42-247" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-248"><a href="#cb42-248" aria-hidden="true" tabindex="-1"></a>We refer to the random vector $\Z$ as &lt;span style="color:red"&gt;**_instrumental variables (IVs)_**&lt;/span&gt;. We have assumed that $\E{\ep\mid \Zm} = \zer$, which subsumes the assumption that $\E{\Z'\ep} = \zer$. The assumption that $\Z$ is (weakly) exogenous (uncorrelated with $\ep$) is known as &lt;span style="color:red"&gt;**_instrumental validity_**&lt;/span&gt;, while the assumption that $\E{\X'\Z} \neq \zer$ ($\Z$ and $\X$ are correlated) is known as the &lt;span style="color:red"&gt;**_relevance condition_**&lt;/span&gt;. The assumption that $\E{\Z'\ep} = \zer$ is also sometimes known as the  &lt;span style="color:red"&gt;**_exclusion restriction_**&lt;/span&gt; ($\Z$ is excluded from the determinants of $Y$). Finally, we sometimes refer to $\text{rank}\left(\E{\Z'\X}\right) = K$ as the &lt;span style="color:red"&gt;**_rank condition_**&lt;/span&gt;.</span>
<span id="cb42-249"><a href="#cb42-249" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-250"><a href="#cb42-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-251"><a href="#cb42-251" aria-hidden="true" tabindex="-1"></a>Instrumental validity and the relevance condition are usually written as:</span>
<span id="cb42-252"><a href="#cb42-252" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-253"><a href="#cb42-253" aria-hidden="true" tabindex="-1"></a>\cov{\Z,\ep}&amp; = \zer,<span class="sc">\\</span></span>
<span id="cb42-254"><a href="#cb42-254" aria-hidden="true" tabindex="-1"></a>\cov{\X, \Z} &amp;\neq \zer.</span>
<span id="cb42-255"><a href="#cb42-255" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-256"><a href="#cb42-256" aria-hidden="true" tabindex="-1"></a>*Technically*, this is not 100% accurate. The relevance condition is actually a combination of $\text{rank}\left(\E{\Z'\X}\right) = K$ and $\cov{\X, \Z}\neq \zer$. As highlighted by @wooldridge2010econometric, the relevance condition is not "regressors and instruments are uncorrelated". Instead, it is "instruments and endogenous regressors are partially correlated holding the exogenous regressors fixed." In other words, the linear projection of the instruments onto all regressors has nontrivial coefficients for endogenous regressors. This is equivalent to $\text{rank}\left(\E{\Z'\X}\right) = K$ and $\cov{\X, \Z}\neq \zer$.</span>
<span id="cb42-257"><a href="#cb42-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-258"><a href="#cb42-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-259"><a href="#cb42-259" aria-hidden="true" tabindex="-1"></a>Even if one regressor is endogenous, $\E{X_j\ep} \neq \zer$ for some $j$, then $\E{\X'\ep} \neq \zer$. If this is the case, we can simply define a portion of $\Z$ to be the exogenous regressors. Formally, if $<span class="co">[</span><span class="ot">X_1,\ldots, X_J</span><span class="co">]</span>$ are weakly exogenous while $<span class="co">[</span><span class="ot">X_{J+1}, \ldots, X_K</span><span class="co">]</span>$ are endogenous, then define $Z_1 = X_1,\ldots ,Z_J=X_j$. </span>
<span id="cb42-260"><a href="#cb42-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-261"><a href="#cb42-261" aria-hidden="true" tabindex="-1"></a>:::{#exm-spec1}</span>
<span id="cb42-262"><a href="#cb42-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-263"><a href="#cb42-263" aria-hidden="true" tabindex="-1"></a><span class="fu">## Linear Model as Special Case of IV Model</span></span>
<span id="cb42-264"><a href="#cb42-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-265"><a href="#cb42-265" aria-hidden="true" tabindex="-1"></a>A special case of the linear IV model is the classical linear model. Just let $\boldsymbol\eta = \zer$ and $\X = \Z$. This fact can be written as $\mathcal P_\text{LM}\subset \mathcal P_\text{IV}$.</span>
<span id="cb42-266"><a href="#cb42-266" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-267"><a href="#cb42-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-268"><a href="#cb42-268" aria-hidden="true" tabindex="-1"></a>Whenever we define a new model, we need to make sure our parameters are identified. </span>
<span id="cb42-269"><a href="#cb42-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-270"><a href="#cb42-270" aria-hidden="true" tabindex="-1"></a>:::{#thm-}</span>
<span id="cb42-271"><a href="#cb42-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-272"><a href="#cb42-272" aria-hidden="true" tabindex="-1"></a><span class="fu">## Identification of Linear IV Model</span></span>
<span id="cb42-273"><a href="#cb42-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-274"><a href="#cb42-274" aria-hidden="true" tabindex="-1"></a>The linear IV model is identified as a result of the following assumptions: $\E{\Z'\ep} = \zer$, $\E{\X'\Z} \neq \zer$, and $\text{rank}\left(\E{\Z'\X}\right) = K$.</span>
<span id="cb42-275"><a href="#cb42-275" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-276"><a href="#cb42-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-277"><a href="#cb42-277" aria-hidden="true" tabindex="-1"></a>:::{.proof}</span>
<span id="cb42-278"><a href="#cb42-278" aria-hidden="true" tabindex="-1"></a>First we will show $\bet$ is identified. Let $P_{\bet,\sigma^2} = P_{\bet^*,\sigma^2}$ for two elements of $\mathcal P_\text{IV}$, and suppose for a contradiction that $\bet\neq\bet^*$. We can begin by writing $\bet$:</span>
<span id="cb42-279"><a href="#cb42-279" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-280"><a href="#cb42-280" aria-hidden="true" tabindex="-1"></a>&amp;\E{\Z'\ep} = \zer<span class="sc">\\</span></span>
<span id="cb42-281"><a href="#cb42-281" aria-hidden="true" tabindex="-1"></a>\implies &amp; \E{\Z'(Y-\X\bet)} = \zer &amp; (\ep = (Y-\X\bet))<span class="sc">\\</span></span>
<span id="cb42-282"><a href="#cb42-282" aria-hidden="true" tabindex="-1"></a>\implies &amp; \E{\Z'Y}-\bet\E{\Z'\X}= \zer<span class="sc">\\</span></span>
<span id="cb42-283"><a href="#cb42-283" aria-hidden="true" tabindex="-1"></a>\implies &amp; \E{\Z'Y} = \bet\E{\Z'\X}<span class="sc">\\</span></span>
<span id="cb42-284"><a href="#cb42-284" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-285"><a href="#cb42-285" aria-hidden="true" tabindex="-1"></a>By the definition of $\mathcal P_\text{IV}$, the moments $\E{\Z'\X}$ and $\E{\Z'Y}$ are the same for the model values $P_{\bet,\sigma^2}$ and  $P_{\bet^*,\sigma^2}$, so $\bet^*$ must also satisfy $\E{\Z'Y} = \bet\E{\Z'\X}$. This contradicts the assumption that $\text{rank}\left(\E{\Z'\X}\right) = K$. If $\bet$ is identified, then $\sigma^2$ is as well because we can write it in terms of $\bet$: </span>
<span id="cb42-286"><a href="#cb42-286" aria-hidden="true" tabindex="-1"></a>$$ \E{(\Y-\Xm\bet)'(\Y-\Xm\bet)\mid \X}=\sigma^2\mathbf I.$$</span>
<span id="cb42-287"><a href="#cb42-287" aria-hidden="true" tabindex="-1"></a>&lt;span style="color:white"&gt;space&lt;/span&gt;</span>
<span id="cb42-288"><a href="#cb42-288" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-289"><a href="#cb42-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-290"><a href="#cb42-290" aria-hidden="true" tabindex="-1"></a>So how do we estimate $\bet$ for the model $\mathcal P_\text{IV}$? If it wasn't clear from the examples dealing with OVB and measurement error, the answer is not with $\OLS$. </span>
<span id="cb42-291"><a href="#cb42-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-292"><a href="#cb42-292" aria-hidden="true" tabindex="-1"></a>:::{#prp-}</span>
<span id="cb42-293"><a href="#cb42-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-294"><a href="#cb42-294" aria-hidden="true" tabindex="-1"></a><span class="fu">## Inconsisteny of OLS</span></span>
<span id="cb42-295"><a href="#cb42-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-296"><a href="#cb42-296" aria-hidden="true" tabindex="-1"></a>If $P_{\bet,\sigma^2} \in \mathcal P_\text{IV}$, then $\OLS$ is biased and inconsistent. In particular, </span>
<span id="cb42-297"><a href="#cb42-297" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-298"><a href="#cb42-298" aria-hidden="true" tabindex="-1"></a>\E{\OLS\mid \X} &amp; = \bet + (\Xm'\Xm)^{-1}\Xm\boldsymbol \eta \neq \bet,<span class="sc">\\</span></span>
<span id="cb42-299"><a href="#cb42-299" aria-hidden="true" tabindex="-1"></a>\plim \OLS &amp; = \bet + \E{\X'\X}^{-1}\boldsymbol \gamma \neq \bet,<span class="sc">\\</span></span>
<span id="cb42-300"><a href="#cb42-300" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-301"><a href="#cb42-301" aria-hidden="true" tabindex="-1"></a>where $\E{\ep\mid \Xm} =\boldsymbol \eta$ and $\E{\X'\ep} = \boldsymbol \gamma$.</span>
<span id="cb42-302"><a href="#cb42-302" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-303"><a href="#cb42-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-304"><a href="#cb42-304" aria-hidden="true" tabindex="-1"></a>:::{.proof}</span>
<span id="cb42-305"><a href="#cb42-305" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-306"><a href="#cb42-306" aria-hidden="true" tabindex="-1"></a>\E{\OLS\mid \Xm} &amp; = \E{\bet +(\Xm'\Xm)^{-1}\Xm'\ep \mid \Xm}<span class="sc">\\</span></span>
<span id="cb42-307"><a href="#cb42-307" aria-hidden="true" tabindex="-1"></a>&amp; = \bet + (\Xm'\Xm)^{-1}\Xm'\E{\ep \mid \Xm}<span class="sc">\\</span></span>
<span id="cb42-308"><a href="#cb42-308" aria-hidden="true" tabindex="-1"></a>&amp; = \bet + (\Xm'\Xm)^{-1}\Xm'\boldsymbol \eta<span class="sc">\\</span></span>
<span id="cb42-309"><a href="#cb42-309" aria-hidden="true" tabindex="-1"></a>\plim \OLS &amp; = \bet + \plim\left<span class="co">[</span><span class="ot">\left(\frac{1}{n}\sum_{i=1}^n\X_i'\X_i\right)^{-1}\left(\frac{1}{n}\sum_{i=1}^n\X_i'\varepsilon_i\right)\right</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb42-310"><a href="#cb42-310" aria-hidden="true" tabindex="-1"></a>&amp; = \bet + \plim\left(\frac{1}{n}\sum_{i=1}^n\X_i'\X_i\right)^{-1}\plim \left(\frac{1}{n}\sum_{i=1}^n\X_i'\varepsilon_i\right) &amp; (\text{Slutsky's Theorem})<span class="sc">\\</span></span>
<span id="cb42-311"><a href="#cb42-311" aria-hidden="true" tabindex="-1"></a>&amp; = \bet + \E{\X'\X}^{-1}\E{\X'\ep} &amp; (\text{LLN})<span class="sc">\\</span></span>
<span id="cb42-312"><a href="#cb42-312" aria-hidden="true" tabindex="-1"></a>&amp; = \bet + \E{\X'\X}^{-1}\boldsymbol \gamma</span>
<span id="cb42-313"><a href="#cb42-313" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-314"><a href="#cb42-314" aria-hidden="true" tabindex="-1"></a>&lt;span style="color:white"&gt;space&lt;/span&gt;</span>
<span id="cb42-315"><a href="#cb42-315" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-316"><a href="#cb42-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-317"><a href="#cb42-317" aria-hidden="true" tabindex="-1"></a>:::{#exm-}</span>
<span id="cb42-318"><a href="#cb42-318" aria-hidden="true" tabindex="-1"></a>Let's verify that $\OLS$ is inconsistent. Suppose $\Xm = (\mathbf 1, X)$ where $(X,\varepsilon)\iid N(\boldsymbol \mu, \Sig)$ for $\boldsymbol \mu = <span class="co">[</span><span class="ot">0,1</span><span class="co">]</span>'$</span>
<span id="cb42-319"><a href="#cb42-319" aria-hidden="true" tabindex="-1"></a>$$\Sig = \begin{bmatrix}5&amp;2<span class="sc">\\</span>2&amp;1  \end{bmatrix}.$$</span>
<span id="cb42-320"><a href="#cb42-320" aria-hidden="true" tabindex="-1"></a>We have</span>
<span id="cb42-321"><a href="#cb42-321" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-322"><a href="#cb42-322" aria-hidden="true" tabindex="-1"></a>\E{X\varepsilon} &amp;= \cov{X,\varepsilon} + \underbrace{\E{X}}_0\underbrace{\E{\varepsilon}}_1 = 2.</span>
<span id="cb42-323"><a href="#cb42-323" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-324"><a href="#cb42-324" aria-hidden="true" tabindex="-1"></a>Therefore</span>
<span id="cb42-325"><a href="#cb42-325" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-326"><a href="#cb42-326" aria-hidden="true" tabindex="-1"></a>\boldsymbol \gamma &amp;= \E{\Xm'\ep} = \begin{bmatrix}\E{1\ep}<span class="sc">\\</span>\E{X\ep} \end{bmatrix} = \begin{bmatrix}1<span class="sc">\\</span>2 \end{bmatrix}</span>
<span id="cb42-327"><a href="#cb42-327" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-328"><a href="#cb42-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-329"><a href="#cb42-329" aria-hidden="true" tabindex="-1"></a>If we draw realizations <span class="in">```x```</span> and <span class="in">```e```</span> of $(X,\varepsilon)$, we should find that ```colMeans(X*e)``` should be approximately $<span class="co">[</span><span class="ot">1,2</span><span class="co">]</span>'$ by the LLN.</span>
<span id="cb42-330"><a href="#cb42-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-333"><a href="#cb42-333" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-334"><a href="#cb42-334" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"functions/sim_endog_linear_model.r"</span>)</span>
<span id="cb42-335"><a href="#cb42-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-336"><a href="#cb42-336" aria-hidden="true" tabindex="-1"></a>Sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb42-337"><a href="#cb42-337" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb42-338"><a href="#cb42-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-339"><a href="#cb42-339" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">sim_endog_linear_model</span>(</span>
<span id="cb42-340"><a href="#cb42-340" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb42-341"><a href="#cb42-341" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fl">1e5</span>,</span>
<span id="cb42-342"><a href="#cb42-342" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_vec =</span> <span class="fu">c</span>(rmvnorm),</span>
<span id="cb42-343"><a href="#cb42-343" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_params_list =</span> <span class="fu">list</span>(<span class="fu">list</span>(mu, Sigma))</span>
<span id="cb42-344"><a href="#cb42-344" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-345"><a href="#cb42-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-346"><a href="#cb42-346" aria-hidden="true" tabindex="-1"></a><span class="fu">colMeans</span>(results<span class="sc">$</span>X<span class="sc">*</span>results<span class="sc">$</span>e)</span>
<span id="cb42-347"><a href="#cb42-347" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-348"><a href="#cb42-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-349"><a href="#cb42-349" aria-hidden="true" tabindex="-1"></a>Let's now calculate $\plim \OLS$. </span>
<span id="cb42-350"><a href="#cb42-350" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-351"><a href="#cb42-351" aria-hidden="true" tabindex="-1"></a>\E{\X'\X}^{-1} &amp;= \begin{bmatrix}\E{1} &amp; \E{X} <span class="sc">\\</span> \E{X} &amp; \E{X^2} \end{bmatrix}^{-1} = \begin{bmatrix}1 &amp; 0 <span class="sc">\\</span> 0 &amp; \var{X} \end{bmatrix}^{-1} = \begin{bmatrix}1 &amp; 0 <span class="sc">\\</span> 0 &amp; 5 \end{bmatrix}^{-1}  =  \begin{bmatrix}1 &amp; 0 <span class="sc">\\</span> 0 &amp; 0.2 \end{bmatrix}<span class="sc">\\</span></span>
<span id="cb42-352"><a href="#cb42-352" aria-hidden="true" tabindex="-1"></a>\plim \OLS &amp; = \bet + \E{\X'\X}^{-1}\boldsymbol \gamma= \bet + \begin{bmatrix}1 &amp; 0 <span class="sc">\\</span> 0 &amp; 0.2 \end{bmatrix}\begin{bmatrix}1<span class="sc">\\</span>2 \end{bmatrix}= \bet + \begin{bmatrix}1<span class="sc">\\</span>0.4 \end{bmatrix}</span>
<span id="cb42-353"><a href="#cb42-353" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-354"><a href="#cb42-354" aria-hidden="true" tabindex="-1"></a>If we let $\bet = <span class="co">[</span><span class="ot">1,2'</span><span class="co">]</span>$ we should see our estimates converge to $<span class="co">[</span><span class="ot">2, 2.4</span><span class="co">]</span>'$ as $n\to\infty$.</span>
<span id="cb42-355"><a href="#cb42-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-358"><a href="#cb42-358" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-359"><a href="#cb42-359" aria-hidden="true" tabindex="-1"></a>iter <span class="ot">&lt;-</span> <span class="cf">function</span>(k, model){</span>
<span id="cb42-360"><a href="#cb42-360" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> model<span class="sc">$</span>observed_data <span class="sc">%&gt;%</span> </span>
<span id="cb42-361"><a href="#cb42-361" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">&lt;=</span> k) <span class="sc">%&gt;%</span> </span>
<span id="cb42-362"><a href="#cb42-362" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x2, <span class="at">data =</span> .) <span class="sc">%&gt;%</span> </span>
<span id="cb42-363"><a href="#cb42-363" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb42-364"><a href="#cb42-364" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb42-365"><a href="#cb42-365" aria-hidden="true" tabindex="-1"></a>      term, </span>
<span id="cb42-366"><a href="#cb42-366" aria-hidden="true" tabindex="-1"></a>      estimate</span>
<span id="cb42-367"><a href="#cb42-367" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb42-368"><a href="#cb42-368" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">sample_size =</span> k) <span class="sc">%&gt;%</span>  </span>
<span id="cb42-369"><a href="#cb42-369" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb42-370"><a href="#cb42-370" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-371"><a href="#cb42-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-372"><a href="#cb42-372" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="cf">function</span>(n_vals, n, beta, dist_vec, dist_params_list, t){</span>
<span id="cb42-373"><a href="#cb42-373" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">sim_endog_linear_model</span>(beta, n, dist_vec, dist_params_list)</span>
<span id="cb42-374"><a href="#cb42-374" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> n_vals <span class="sc">%&gt;%</span> </span>
<span id="cb42-375"><a href="#cb42-375" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(iter, <span class="at">model =</span> model) <span class="sc">%&gt;%</span> </span>
<span id="cb42-376"><a href="#cb42-376" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb42-377"><a href="#cb42-377" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">iter_num =</span> t) </span>
<span id="cb42-378"><a href="#cb42-378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb42-379"><a href="#cb42-379" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-380"><a href="#cb42-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-381"><a href="#cb42-381" aria-hidden="true" tabindex="-1"></a>outer_sim <span class="ot">&lt;-</span> <span class="cf">function</span>(N, n_vals, n, beta, dist_vec, dist_params_list){</span>
<span id="cb42-382"><a href="#cb42-382" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>N <span class="sc">%&gt;%</span> </span>
<span id="cb42-383"><a href="#cb42-383" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(sim, <span class="at">n_vals =</span> n_vals, <span class="at">n =</span> n, <span class="at">beta =</span> beta, <span class="at">dist_vec =</span> dist_vec, <span class="at">dist_params_list =</span> dist_params_list) <span class="sc">%&gt;%</span> </span>
<span id="cb42-384"><a href="#cb42-384" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb42-385"><a href="#cb42-385" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb42-386"><a href="#cb42-386" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-387"><a href="#cb42-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-388"><a href="#cb42-388" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">outer_sim</span>(</span>
<span id="cb42-389"><a href="#cb42-389" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fl">1e3</span>, </span>
<span id="cb42-390"><a href="#cb42-390" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_vals =</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>)<span class="sc">*</span><span class="dv">20</span>, </span>
<span id="cb42-391"><a href="#cb42-391" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fl">1e3</span>, </span>
<span id="cb42-392"><a href="#cb42-392" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb42-393"><a href="#cb42-393" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_vec =</span> <span class="fu">c</span>(rmvnorm),</span>
<span id="cb42-394"><a href="#cb42-394" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_params_list =</span> <span class="fu">list</span>(<span class="fu">list</span>(mu, Sigma))</span>
<span id="cb42-395"><a href="#cb42-395" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-396"><a href="#cb42-396" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-397"><a href="#cb42-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-400"><a href="#cb42-400" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-401"><a href="#cb42-401" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb42-402"><a href="#cb42-402" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb42-403"><a href="#cb42-403" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-plot702</span></span>
<span id="cb42-404"><a href="#cb42-404" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb42-405"><a href="#cb42-405" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb42-406"><a href="#cb42-406" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-asp: 0.7</span></span>
<span id="cb42-407"><a href="#cb42-407" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb42-408"><a href="#cb42-408" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: " f"</span></span>
<span id="cb42-409"><a href="#cb42-409" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show code which generates figure"</span></span>
<span id="cb42-410"><a href="#cb42-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-411"><a href="#cb42-411" aria-hidden="true" tabindex="-1"></a>results <span class="sc">%&gt;%</span></span>
<span id="cb42-412"><a href="#cb42-412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-413"><a href="#cb42-413" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">True Value</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">case_when</span>(</span>
<span id="cb42-414"><a href="#cb42-414" aria-hidden="true" tabindex="-1"></a>      term <span class="sc">==</span> <span class="st">"(Intercept)"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb42-415"><a href="#cb42-415" aria-hidden="true" tabindex="-1"></a>      term <span class="sc">==</span> <span class="st">"x2"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb42-416"><a href="#cb42-416" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb42-417"><a href="#cb42-417" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Limit</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">case_when</span>(</span>
<span id="cb42-418"><a href="#cb42-418" aria-hidden="true" tabindex="-1"></a>      term <span class="sc">==</span> <span class="st">"(Intercept)"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb42-419"><a href="#cb42-419" aria-hidden="true" tabindex="-1"></a>      term <span class="sc">==</span> <span class="st">"x2"</span> <span class="sc">~</span> <span class="fl">2.4</span>,</span>
<span id="cb42-420"><a href="#cb42-420" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb42-421"><a href="#cb42-421" aria-hidden="true" tabindex="-1"></a>    <span class="at">term =</span> <span class="fu">case_when</span>(</span>
<span id="cb42-422"><a href="#cb42-422" aria-hidden="true" tabindex="-1"></a>      term <span class="sc">==</span> <span class="st">"(Intercept)"</span> <span class="sc">~</span> <span class="st">"β1"</span>,</span>
<span id="cb42-423"><a href="#cb42-423" aria-hidden="true" tabindex="-1"></a>      term <span class="sc">==</span> <span class="st">"x2"</span> <span class="sc">~</span> <span class="st">"β2"</span>,</span>
<span id="cb42-424"><a href="#cb42-424" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb42-425"><a href="#cb42-425" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb42-426"><a href="#cb42-426" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Estimate =</span> estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb42-427"><a href="#cb42-427" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">!</span><span class="fu">c</span>(term, sample_size, iter_num)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-428"><a href="#cb42-428" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">line_group =</span> <span class="fu">paste0</span>(iter_num, name)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-429"><a href="#cb42-429" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(sample_size, value, <span class="at">color =</span> name)) <span class="sc">+</span> </span>
<span id="cb42-430"><a href="#cb42-430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> line_group, <span class="at">size =</span> name)) <span class="sc">+</span> </span>
<span id="cb42-431"><a href="#cb42-431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>term) <span class="sc">+</span></span>
<span id="cb42-432"><a href="#cb42-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb42-433"><a href="#cb42-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Sample Size, n"</span>, <span class="at">y =</span> <span class="st">"Estimates"</span>, <span class="at">color =</span><span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb42-434"><a href="#cb42-434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb42-435"><a href="#cb42-435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb42-436"><a href="#cb42-436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span> </span>
<span id="cb42-437"><a href="#cb42-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">size=</span><span class="st">"none"</span>)</span>
<span id="cb42-438"><a href="#cb42-438" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-439"><a href="#cb42-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-440"><a href="#cb42-440" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-441"><a href="#cb42-441" aria-hidden="true" tabindex="-1"></a>An interesting feature of this problem is that our estimator for the intercept term $\beta_1$ was inconsistent even though the corresponding regressor (the trivial random variable $X_1 = 1$) is exogenous. In general, the inconsistency of $\OLS$ in the presence of endogeneity is not limited to the parameters associated with endogenous variables, and will impact each parameter $\beta_j$.  </span>
<span id="cb42-442"><a href="#cb42-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-443"><a href="#cb42-443" aria-hidden="true" tabindex="-1"></a>Instead of using $\OLS$, we need an estimator which makes use of the exogenous variables $\Z$. There are several different ways to motivate this estimator, so we'll go over four particularly approaches which reach the same conclusion. </span>
<span id="cb42-444"><a href="#cb42-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-445"><a href="#cb42-445" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>For $\mathcal P_\text{IV}$ we can write the true population parameter as $\bet = \E{\Z'\X}^{-1}\E{\Z'Y}$. We can appeal to the analogy-principle here just like we did when deriving $\OLS$. It stands to reason that the estimator defined by the analogous samples will provide consistent estimates of $\bet$ by the LLN. This estimator is </span>
<span id="cb42-446"><a href="#cb42-446" aria-hidden="true" tabindex="-1"></a>$$\hat {\bet}= \left(\frac{1}{n}\sum_{i=1}^n\Z_i'\X_i\right)^{-1}\left(\frac{1}{n}\sum_{i=1}^n\Z_iY_i\right) = (\Zm'\Xm)^{-1}\Zm'\Y.$$</span>
<span id="cb42-447"><a href="#cb42-447" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Another way of tackling the problem relates to marginal effects and is presented by @cameron2005microeconometrics. This will be a little informal and is only to build intuition. In an abuse of notation, we'll write marginal effects as $\frac{\partial Y}{\partial \X}$. Ideally, we want $\beta_j = \frac{\partial Y}{\partial X_j}$ for each $j$. This way, when we estimate $\bet$, we estimate the marginal effect of $\X$ on $Y$. Unfortunately, we cannot estimate this directly with $\X$ as </span>
<span id="cb42-448"><a href="#cb42-448" aria-hidden="true" tabindex="-1"></a>$$ \frac{\partial Y}{\partial X_j} = \beta_j + \frac{\partial \varepsilon}{\partial X_j} \implies \beta_j \neq \frac{\partial Y}{\partial X_j}.$$</span>
<span id="cb42-449"><a href="#cb42-449" aria-hidden="true" tabindex="-1"></a>If we appeal to the chain rule, we can vary $X_j$ via our instruments $\Z$:</span>
<span id="cb42-450"><a href="#cb42-450" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-451"><a href="#cb42-451" aria-hidden="true" tabindex="-1"></a>&amp;\frac{\partial Y}{\partial \Z} = \frac{\partial Y}{\partial X_j} \frac{\partial X_j}{\partial \Z} <span class="sc">\\</span></span>
<span id="cb42-452"><a href="#cb42-452" aria-hidden="true" tabindex="-1"></a>\implies &amp; \frac{\partial Y}{\partial X_j} = \frac{\partial Y/\partial \Z}{\partial X_j/\partial \Z}</span>
<span id="cb42-453"><a href="#cb42-453" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-454"><a href="#cb42-454" aria-hidden="true" tabindex="-1"></a>where $\frac{\partial Y}{\partial \Z}$ holds $\varepsilon$ constant as $\cov{\Z, \ep} = \zer$. The marginal effects $\frac{\partial X_j}{\partial \Z}$ and $\frac{\partial Y}{\partial \Z}$ correspond to the parameters in the linear projection models of $\Z$ on $X_j$ and $Y$.^<span class="co">[</span><span class="ot">It's important to emphasize that these are linear projections, not structural linear models. There is no structural relationship between $\Z$ and $X_j$ or $\Z$ and $Y$! This is really important, and we'll introduce a definition related to this in the context of 2SLS.</span><span class="co">]</span> These parameters are given by OLS estimates $(\Zm'\Zm)^{-1}\Zm\X_j$ and $(\Zm'\Zm)^{-1}\Zm\Y$, respectively, so</span>
<span id="cb42-455"><a href="#cb42-455" aria-hidden="true" tabindex="-1"></a>$$ \hat\beta_j = \frac{(\Zm'\Zm)^{-1}\Zm'\Y}{(\Zm'\Zm)^{-1}\Zm\X_j}.$$ If we do this for all regressors $\X$, then </span>
<span id="cb42-456"><a href="#cb42-456" aria-hidden="true" tabindex="-1"></a>$$ \hat{\bet} = \frac{(\Zm'\Zm)^{-1}\Zm'\Y}{(\Zm'\Zm)^{-1}\Zm\Xm} =  (\Zm'\Xm)^{-1}\Zm'\Y$$</span>
<span id="cb42-457"><a href="#cb42-457" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>We can take a graphical approach given by @pearl2009causality with the simple IV model with one endogenous regressor $X$ and one instrument $Z$. Suppose we have $Y = \beta_1 + \beta_2 X + \varepsilon$, where $\cov{X,\varepsilon} \neq 0$, along with $\cov{Z,X} \neq 0$ and $\cov{Z,\varepsilon} = 0$ for some instrument $Z$. These relationships can be illustrated in the form of a directed acyclic graph (DAG).</span>
<span id="cb42-458"><a href="#cb42-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-461"><a href="#cb42-461" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-462"><a href="#cb42-462" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb42-463"><a href="#cb42-463" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb42-464"><a href="#cb42-464" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-plot703</span></span>
<span id="cb42-465"><a href="#cb42-465" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb42-466"><a href="#cb42-466" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb42-467"><a href="#cb42-467" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-asp: 0.5</span></span>
<span id="cb42-468"><a href="#cb42-468" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 1</span></span>
<span id="cb42-469"><a href="#cb42-469" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: " f"</span></span>
<span id="cb42-470"><a href="#cb42-470" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show code which generates figure"</span></span>
<span id="cb42-471"><a href="#cb42-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-472"><a href="#cb42-472" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"figures/iv_dag.png"</span>)</span>
<span id="cb42-473"><a href="#cb42-473" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-474"><a href="#cb42-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-475"><a href="#cb42-475" aria-hidden="true" tabindex="-1"></a>We can think of the paths which illustrate causation as being multiplicative in the sense that $\cov{Z,X}\cdot \beta_2 = \cov{Z,Y}$, where $\beta_2$ is a "conversion rate" between changes in $X$ via $Z$ and changes in $Y$ via $Z$ (just like the chain rule approach). This implies $\beta_2 = \cov{Z,Y}/\cov{Z,X}$, so </span>
<span id="cb42-476"><a href="#cb42-476" aria-hidden="true" tabindex="-1"></a>$$ \hat\beta_2 = \frac{\widehat{\text{Cov}}(Z,Y)}{\widehat{\text{Cov}}(Z,X)}.$$ This happens to be a special case of $\hat{\bet}=  (\Zm'\Xm)^{-1}\Zm'\Y$.</span>
<span id="cb42-477"><a href="#cb42-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-478"><a href="#cb42-478" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Another approach in the context of the simple linear model takes advantage of a simple substitution. </span>
<span id="cb42-479"><a href="#cb42-479" aria-hidden="true" tabindex="-1"></a>$$ \cov{Y,Z} = \cov{\beta_1 + \beta_2 X + \varepsilon, Z} = \underbrace{\cov{\beta_1, Z}}_0 + \beta_2\cov{X,Z} + \underbrace{\cov{Z,\varepsilon}}_0 = \beta_2\cov{X,Z}.$$ This is the same result we arrived at using the DAG.</span>
<span id="cb42-480"><a href="#cb42-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-481"><a href="#cb42-481" aria-hidden="true" tabindex="-1"></a>With all roads leading to Rome, we can define this estimator. </span>
<span id="cb42-482"><a href="#cb42-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-483"><a href="#cb42-483" aria-hidden="true" tabindex="-1"></a>:::{#def-}</span>
<span id="cb42-484"><a href="#cb42-484" aria-hidden="true" tabindex="-1"></a>The &lt;span style="color:red"&gt;**_instrumental variables (IV) estimator_**&lt;/span&gt; is defined as </span>
<span id="cb42-485"><a href="#cb42-485" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-486"><a href="#cb42-486" aria-hidden="true" tabindex="-1"></a>\IV(\Xm,\Zm,\Y)= (\Zm'\Xm)^{-1}(\Zm'\Y)= \left(\frac{1}{n}\sum_{i=1}^n\Z_i'\X_i\right)^{-1}\left(\frac{1}{n}\sum_{i=1}^n\Z_iY_i\right)</span>
<span id="cb42-487"><a href="#cb42-487" aria-hidden="true" tabindex="-1"></a>\end{align*} An realization of this estimator (an estimate) is </span>
<span id="cb42-488"><a href="#cb42-488" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-489"><a href="#cb42-489" aria-hidden="true" tabindex="-1"></a>\hat{\mathbf b}_\text{IV} = \hat{\bet}_\text{IV}(\X,\Z,\y) &amp;= (\Z'\X)^{-1}(\Z'\y)= \left(\frac{1}{n}\sum_{i=1}^n\z_i'\z_i\right)^{-1}\left(\frac{1}{n}\sum_{i=1}^n\z_iy_i\right)</span>
<span id="cb42-490"><a href="#cb42-490" aria-hidden="true" tabindex="-1"></a>\end{align*} </span>
<span id="cb42-491"><a href="#cb42-491" aria-hidden="true" tabindex="-1"></a>and will exist when the inverse $(\Z'\X)^{-1}$ exists.</span>
<span id="cb42-492"><a href="#cb42-492" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-493"><a href="#cb42-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-494"><a href="#cb42-494" aria-hidden="true" tabindex="-1"></a>:::{#exm-refex}</span>
<span id="cb42-495"><a href="#cb42-495" aria-hidden="true" tabindex="-1"></a>Suppose $(X, Z, \varepsilon) \sim N(\boldsymbol \mu,\Sig)$ where</span>
<span id="cb42-496"><a href="#cb42-496" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-497"><a href="#cb42-497" aria-hidden="true" tabindex="-1"></a>\boldsymbol \mu &amp; = <span class="co">[</span><span class="ot">10,10,0</span><span class="co">]</span>',<span class="sc">\\</span></span>
<span id="cb42-498"><a href="#cb42-498" aria-hidden="true" tabindex="-1"></a>\Sig &amp; = \begin{bmatrix}20 &amp; 5 &amp; 1<span class="sc">\\</span>5&amp;20&amp;0<span class="sc">\\</span>1&amp;0&amp;1 \end{bmatrix},</span>
<span id="cb42-499"><a href="#cb42-499" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-500"><a href="#cb42-500" aria-hidden="true" tabindex="-1"></a>and $Y = 1 + 3X + \varepsilon$. Let's simulate a sample of size $n=1000$ from this model $P_{\bet,\sigma^2} \in \mathcal P_\text{IV}$, and then calculate $\IV$.</span>
<span id="cb42-501"><a href="#cb42-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-504"><a href="#cb42-504" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-505"><a href="#cb42-505" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">sim_endog_linear_model</span>(</span>
<span id="cb42-506"><a href="#cb42-506" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>),</span>
<span id="cb42-507"><a href="#cb42-507" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">1000</span>,</span>
<span id="cb42-508"><a href="#cb42-508" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_vec =</span> <span class="fu">c</span>(rmvnorm),</span>
<span id="cb42-509"><a href="#cb42-509" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_params_list =</span> <span class="fu">list</span>(</span>
<span id="cb42-510"><a href="#cb42-510" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb42-511"><a href="#cb42-511" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">0</span>), </span>
<span id="cb42-512"><a href="#cb42-512" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">5</span>,<span class="dv">1</span>, <span class="dv">5</span>,<span class="dv">20</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb42-513"><a href="#cb42-513" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb42-514"><a href="#cb42-514" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-515"><a href="#cb42-515" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-516"><a href="#cb42-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-517"><a href="#cb42-517" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-518"><a href="#cb42-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-519"><a href="#cb42-519" aria-hidden="true" tabindex="-1"></a>We should confirm that our drawn sample satisfies the assumptions of the IV model. </span>
<span id="cb42-520"><a href="#cb42-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-523"><a href="#cb42-523" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-524"><a href="#cb42-524" aria-hidden="true" tabindex="-1"></a>results<span class="sc">$</span>sim_draws <span class="sc">%&gt;%</span> </span>
<span id="cb42-525"><a href="#cb42-525" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>x1, <span class="sc">-</span>z1) <span class="sc">%&gt;%</span> </span>
<span id="cb42-526"><a href="#cb42-526" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cov</span>()</span>
<span id="cb42-527"><a href="#cb42-527" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-528"><a href="#cb42-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-529"><a href="#cb42-529" aria-hidden="true" tabindex="-1"></a>Now let's calculate $\IV$, keeping in mind that $\Zm$ is comprised of the instrument $Z$ *and* the exogenous random variable $1$ which gives the intercept term. </span>
<span id="cb42-530"><a href="#cb42-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-533"><a href="#cb42-533" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-534"><a href="#cb42-534" aria-hidden="true" tabindex="-1"></a>IV <span class="ot">&lt;-</span> <span class="cf">function</span>(y, X, Z){</span>
<span id="cb42-535"><a href="#cb42-535" aria-hidden="true" tabindex="-1"></a>  K <span class="ot">&lt;-</span> <span class="fu">ncol</span>(X)</span>
<span id="cb42-536"><a href="#cb42-536" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">ncol</span>(Z) <span class="sc">!=</span> K) {<span class="fu">stop</span>(<span class="st">"K instruments required"</span>)}</span>
<span id="cb42-537"><a href="#cb42-537" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">det</span>(<span class="fu">t</span>(Z) <span class="sc">%*%</span> X) <span class="sc">==</span> <span class="dv">0</span>) {<span class="fu">stop</span>(<span class="st">"rank(Z'X) &lt; K"</span>)}</span>
<span id="cb42-538"><a href="#cb42-538" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-539"><a href="#cb42-539" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb42-540"><a href="#cb42-540" aria-hidden="true" tabindex="-1"></a>    <span class="at">parameter =</span> <span class="fu">paste</span>(<span class="st">"β"</span>, <span class="dv">1</span><span class="sc">:</span>K, <span class="st">" estimate"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb42-541"><a href="#cb42-541" aria-hidden="true" tabindex="-1"></a>    <span class="at">estimate =</span> <span class="fu">as.numeric</span>(<span class="fu">solve</span>(<span class="fu">t</span>(Z) <span class="sc">%*%</span> X) <span class="sc">%*%</span> <span class="fu">t</span>(Z) <span class="sc">%*%</span> y)</span>
<span id="cb42-542"><a href="#cb42-542" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-543"><a href="#cb42-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-544"><a href="#cb42-544" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb42-545"><a href="#cb42-545" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-546"><a href="#cb42-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-547"><a href="#cb42-547" aria-hidden="true" tabindex="-1"></a><span class="fu">IV</span>(results<span class="sc">$</span>y, results<span class="sc">$</span>X, results<span class="sc">$</span>Z) <span class="sc">%&gt;%</span> </span>
<span id="cb42-548"><a href="#cb42-548" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span>
<span id="cb42-549"><a href="#cb42-549" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-550"><a href="#cb42-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-551"><a href="#cb42-551" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-552"><a href="#cb42-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-553"><a href="#cb42-553" aria-hidden="true" tabindex="-1"></a>:::{#exm-spec2}</span>
<span id="cb42-554"><a href="#cb42-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-555"><a href="#cb42-555" aria-hidden="true" tabindex="-1"></a><span class="fu">## OLS is a Special Case of IV</span></span>
<span id="cb42-556"><a href="#cb42-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-557"><a href="#cb42-557" aria-hidden="true" tabindex="-1"></a>In Example \@ref(exm:spec1) we saw that $\mathcal P_\text{LM}\subset\mathcal P_\text{IV}$. In the event $P_{\bet,\sigma^2} \in \mathcal P_\text{LM}$, i.e $\Zm = \Xm$ and , then </span>
<span id="cb42-558"><a href="#cb42-558" aria-hidden="true" tabindex="-1"></a>$$ \IV = (\Zm'\Xm)^{-1}(\Zm'\Y) = (\Xm'\Xm)^{-1}(\Xm'\Y) = \OLS.$$</span>
<span id="cb42-559"><a href="#cb42-559" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-560"><a href="#cb42-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-561"><a href="#cb42-561" aria-hidden="true" tabindex="-1"></a><span class="fu">## Properties of the IV Estimator</span></span>
<span id="cb42-562"><a href="#cb42-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-563"><a href="#cb42-563" aria-hidden="true" tabindex="-1"></a>One of the reasons OLS is so special is because we're able to characterize its finite sample properties with the Gauss-Markov theorem. This is the exception rather than the rule when assessing estimators. In most cases, we can only arrive at tractable results in the form of an estimator's asymptotic properties. Is this the case with $\IV$? Let's see if $\IV$ satisfies our "baseline" finite sample property of unbiasedness. </span>
<span id="cb42-564"><a href="#cb42-564" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-565"><a href="#cb42-565" aria-hidden="true" tabindex="-1"></a>\E{\IV} &amp;= \E{\E{\IV \mid \Xm, \Zm}}<span class="sc">\\</span></span>
<span id="cb42-566"><a href="#cb42-566" aria-hidden="true" tabindex="-1"></a>        &amp; =  \E{\E{(\Zm'\Xm)^{-1}(\Zm'\Y) \mid \Xm, \Zm}}<span class="sc">\\</span></span>
<span id="cb42-567"><a href="#cb42-567" aria-hidden="true" tabindex="-1"></a>        &amp;=\E{\E{(\Zm'\Xm)^{-1}(\Zm'(\Xm\bet + \ep)) \mid \Xm, \Zm}}<span class="sc">\\</span></span>
<span id="cb42-568"><a href="#cb42-568" aria-hidden="true" tabindex="-1"></a>        &amp;=\bet + \E{(\Zm'\Xm)^{-1}\Zm'\E{\ep \mid \Xm, \Zm}}<span class="sc">\\</span></span>
<span id="cb42-569"><a href="#cb42-569" aria-hidden="true" tabindex="-1"></a>        &amp; \neq \bet</span>
<span id="cb42-570"><a href="#cb42-570" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-571"><a href="#cb42-571" aria-hidden="true" tabindex="-1"></a>In general, $\E{\ep \mid \Xm, \Zm} \neq \zer$, so $\IV$ has a bias. </span>
<span id="cb42-572"><a href="#cb42-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-573"><a href="#cb42-573" aria-hidden="true" tabindex="-1"></a>:::{#exm-}</span>
<span id="cb42-574"><a href="#cb42-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-575"><a href="#cb42-575" aria-hidden="true" tabindex="-1"></a><span class="fu">## IV Estimator is Biased</span></span>
<span id="cb42-576"><a href="#cb42-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-577"><a href="#cb42-577" aria-hidden="true" tabindex="-1"></a>Return to the model from Example \@ref(exm:refex), but let $n = 10$. If we simulate the bias of $\IV$ using 10,000 simulations, we can confirm that $\IV$ is biased.  </span>
<span id="cb42-578"><a href="#cb42-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-581"><a href="#cb42-581" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-582"><a href="#cb42-582" aria-hidden="true" tabindex="-1"></a>iter <span class="ot">&lt;-</span> <span class="cf">function</span>(beta, n, dist_vec, dist_params_list, t){</span>
<span id="cb42-583"><a href="#cb42-583" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">sim_endog_linear_model</span>(beta, n, dist_vec, dist_params_list)</span>
<span id="cb42-584"><a href="#cb42-584" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">IV</span>(results<span class="sc">$</span>y, results<span class="sc">$</span>X, results<span class="sc">$</span>Z) <span class="sc">%&gt;%</span></span>
<span id="cb42-585"><a href="#cb42-585" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">iter_num =</span> t) <span class="sc">%&gt;%</span></span>
<span id="cb42-586"><a href="#cb42-586" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cbind</span>(<span class="at">true_value =</span> beta)</span>
<span id="cb42-587"><a href="#cb42-587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb42-588"><a href="#cb42-588" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-589"><a href="#cb42-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-590"><a href="#cb42-590" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="cf">function</span>(N, beta, n, dist_vec, dist_params_list){</span>
<span id="cb42-591"><a href="#cb42-591" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>N <span class="sc">%&gt;%</span></span>
<span id="cb42-592"><a href="#cb42-592" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(iter, <span class="at">beta =</span> beta, <span class="at">n =</span> n, <span class="at">dist_vec =</span> dist_vec, <span class="at">dist_params_list =</span> dist_params_list) <span class="sc">%&gt;%</span></span>
<span id="cb42-593"><a href="#cb42-593" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb42-594"><a href="#cb42-594" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb42-595"><a href="#cb42-595" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-596"><a href="#cb42-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-597"><a href="#cb42-597" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">sim</span>(</span>
<span id="cb42-598"><a href="#cb42-598" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fl">1e4</span>,</span>
<span id="cb42-599"><a href="#cb42-599" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>),</span>
<span id="cb42-600"><a href="#cb42-600" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">10</span>,</span>
<span id="cb42-601"><a href="#cb42-601" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_vec =</span> <span class="fu">c</span>(rmvnorm),</span>
<span id="cb42-602"><a href="#cb42-602" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_params_list =</span> <span class="fu">list</span>(</span>
<span id="cb42-603"><a href="#cb42-603" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb42-604"><a href="#cb42-604" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">0</span>),</span>
<span id="cb42-605"><a href="#cb42-605" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">5</span>,<span class="dv">1</span>, <span class="dv">5</span>,<span class="dv">20</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb42-606"><a href="#cb42-606" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb42-607"><a href="#cb42-607" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-608"><a href="#cb42-608" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-609"><a href="#cb42-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-610"><a href="#cb42-610" aria-hidden="true" tabindex="-1"></a>results <span class="sc">%&gt;%</span></span>
<span id="cb42-611"><a href="#cb42-611" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(parameter) <span class="sc">%&gt;%</span></span>
<span id="cb42-612"><a href="#cb42-612" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">bias =</span> <span class="fu">mean</span>(<span class="fu">abs</span>(estimate <span class="sc">-</span> true_value)))</span>
<span id="cb42-613"><a href="#cb42-613" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-614"><a href="#cb42-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-615"><a href="#cb42-615" aria-hidden="true" tabindex="-1"></a>Okay, but is this really an issue? In most settings we would have a sample size much larger than $n = 10$. Let's repeat this experiment with $n = 1000$ and see what happens to our estimator's bias.</span>
<span id="cb42-616"><a href="#cb42-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-619"><a href="#cb42-619" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-620"><a href="#cb42-620" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">sim</span>(</span>
<span id="cb42-621"><a href="#cb42-621" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fl">1e4</span>,</span>
<span id="cb42-622"><a href="#cb42-622" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>),</span>
<span id="cb42-623"><a href="#cb42-623" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fl">1e3</span>,</span>
<span id="cb42-624"><a href="#cb42-624" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_vec =</span> <span class="fu">c</span>(rmvnorm),</span>
<span id="cb42-625"><a href="#cb42-625" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_params_list =</span> <span class="fu">list</span>(</span>
<span id="cb42-626"><a href="#cb42-626" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb42-627"><a href="#cb42-627" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">0</span>),</span>
<span id="cb42-628"><a href="#cb42-628" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">5</span>,<span class="dv">1</span>, <span class="dv">5</span>,<span class="dv">20</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb42-629"><a href="#cb42-629" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb42-630"><a href="#cb42-630" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-631"><a href="#cb42-631" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-632"><a href="#cb42-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-633"><a href="#cb42-633" aria-hidden="true" tabindex="-1"></a>results <span class="sc">%&gt;%</span></span>
<span id="cb42-634"><a href="#cb42-634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(parameter) <span class="sc">%&gt;%</span></span>
<span id="cb42-635"><a href="#cb42-635" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">bias =</span> <span class="fu">mean</span>(<span class="fu">abs</span>(estimate <span class="sc">-</span> true_value))) <span class="sc">%&gt;%</span> </span>
<span id="cb42-636"><a href="#cb42-636" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span>
<span id="cb42-637"><a href="#cb42-637" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-638"><a href="#cb42-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-639"><a href="#cb42-639" aria-hidden="true" tabindex="-1"></a>The bias has been reduced dramatically.</span>
<span id="cb42-640"><a href="#cb42-640" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-641"><a href="#cb42-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-642"><a href="#cb42-642" aria-hidden="true" tabindex="-1"></a>While $\IV$ is biased, it seems as if it is asymptotically unbiased. Instead of proving this directly, we'll actually show that $\IV$ is root-N CAN, a sufficient condition for asymptotic unbiasedness. Before tackling that, let's prove that $\IV$ is consistent directly. One of the reasons we opted to not estimate $\bet$ via $\OLS$ was that $\OLS$ is not consistent for $\mathcal P_\text{IV}$, so it shouldn't be a surprise that $\IV$ is consistent. </span>
<span id="cb42-643"><a href="#cb42-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-644"><a href="#cb42-644" aria-hidden="true" tabindex="-1"></a>:::{#prp-}</span>
<span id="cb42-645"><a href="#cb42-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-646"><a href="#cb42-646" aria-hidden="true" tabindex="-1"></a><span class="fu">## IV Estimator is Consistent</span></span>
<span id="cb42-647"><a href="#cb42-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-648"><a href="#cb42-648" aria-hidden="true" tabindex="-1"></a>If $P_{\bet,\sigma^2}\in \mathcal P_\text{IV}$, then $\IV\pto \bet$.</span>
<span id="cb42-649"><a href="#cb42-649" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-650"><a href="#cb42-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-651"><a href="#cb42-651" aria-hidden="true" tabindex="-1"></a>:::{.proof}</span>
<span id="cb42-652"><a href="#cb42-652" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-653"><a href="#cb42-653" aria-hidden="true" tabindex="-1"></a>\IV &amp;= \left(\frac{1}{n}\sum_{i=1}^n\Z_i'\X_i\right)^{-1}\left(\frac{1}{n}\sum_{i=1}^n\Z_iY_i\right)<span class="sc">\\</span></span>
<span id="cb42-654"><a href="#cb42-654" aria-hidden="true" tabindex="-1"></a>    &amp; = \left(\frac{1}{n}\sum_{i=1}^n\Z_i'\X_i\right)^{-1}\left(\frac{1}{n}\sum_{i=1}^n\Z_i<span class="co">[</span><span class="ot">\X_i\bet + \varepsilon_i</span><span class="co">]</span>\right)<span class="sc">\\</span></span>
<span id="cb42-655"><a href="#cb42-655" aria-hidden="true" tabindex="-1"></a>    &amp; = \underbrace{\left(\frac{1}{n}\sum_{i=1}^n\Z_i'\X_i\right)^{-1}\left(\frac{1}{n}\sum_{i=1}^n\Z_i'\X_i\right)}_1\bet + \left(\frac{1}{n}\sum_{i=1}^n\Z_i'\X_i\right)^{-1}\left(\frac{1}{n}\sum_{i=1}^n\Z_i'\varepsilon_i\right)<span class="sc">\\</span></span>
<span id="cb42-656"><a href="#cb42-656" aria-hidden="true" tabindex="-1"></a>    &amp; = \bet + \left(\frac{1}{n}\sum_{i=1}^n\Z_i'\X_i\right)^{-1}\left(\frac{1}{n}\sum_{i=1}^n\Z_i'\varepsilon_i\right)<span class="sc">\\</span></span>
<span id="cb42-657"><a href="#cb42-657" aria-hidden="true" tabindex="-1"></a>\plim \IV &amp; = \bet + \plim \left(\frac{1}{n}\sum_{i=1}^n\Z_i'\X_i\right)^{-1}\cdot \plim \left(\frac{1}{n}\sum_{i=1}^n\Z_i'\varepsilon_i\right) &amp; (\text{Slutsky's theorem})<span class="sc">\\</span></span>
<span id="cb42-658"><a href="#cb42-658" aria-hidden="true" tabindex="-1"></a>&amp; = \bet + \plim \left(\frac{1}{n}\sum_{i=1}^n\Z_i'\X_i\right)^{-1}\cdot \E{\Z'\ep} &amp; (\text{LLN})<span class="sc">\\</span></span>
<span id="cb42-659"><a href="#cb42-659" aria-hidden="true" tabindex="-1"></a>&amp; = \bet + \plim \left(\frac{1}{n}\sum_{i=1}^n\Z_i'\X_i\right)^{-1}\cdot \zer &amp; (\E{\Z'\ep} = \zer)<span class="sc">\\</span></span>
<span id="cb42-660"><a href="#cb42-660" aria-hidden="true" tabindex="-1"></a>&amp; = \bet</span>
<span id="cb42-661"><a href="#cb42-661" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-662"><a href="#cb42-662" aria-hidden="true" tabindex="-1"></a>&lt;span style="color:white"&gt;space&lt;/span&gt;</span>
<span id="cb42-663"><a href="#cb42-663" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-664"><a href="#cb42-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-665"><a href="#cb42-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-666"><a href="#cb42-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-667"><a href="#cb42-667" aria-hidden="true" tabindex="-1"></a>:::{#thm-}</span>
<span id="cb42-668"><a href="#cb42-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-669"><a href="#cb42-669" aria-hidden="true" tabindex="-1"></a><span class="fu">## IV Estimator is Root-n CAN</span></span>
<span id="cb42-670"><a href="#cb42-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-671"><a href="#cb42-671" aria-hidden="true" tabindex="-1"></a>If $P_{\bet, \sigma^2} \in \mathcal P_\text{IV}$, then</span>
<span id="cb42-672"><a href="#cb42-672" aria-hidden="true" tabindex="-1"></a>$$\IV \asim N\left(\bet, \sigma^2\E{\Zm'\Xm}^{-1}\E{\Zm'\Zm}\E{\Xm'\Zm}^{-1}\right) =  N\left(\bet, \frac{\sigma^2}{n}\E{\Z'\X}^{-1}\E{\Z'\Z}\E{\X'\Z}^{-1} \right)$$</span>
<span id="cb42-673"><a href="#cb42-673" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-674"><a href="#cb42-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-675"><a href="#cb42-675" aria-hidden="true" tabindex="-1"></a>:::{.proof}</span>
<span id="cb42-676"><a href="#cb42-676" aria-hidden="true" tabindex="-1"></a>The proof is almost identical to that of Theorem \@ref(thm:asymols).</span>
<span id="cb42-677"><a href="#cb42-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-678"><a href="#cb42-678" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-679"><a href="#cb42-679" aria-hidden="true" tabindex="-1"></a>\sqrt n(\IV - \bet) &amp; = \sqrt{n}\left<span class="co">[</span><span class="ot">\bet + \left(\frac{1}{n}\sum_{i=1}^n\Z_i'\X_i\right)^{-1}\left(\frac{1}{n}\sum_{i=1}^n\Z_i'\varepsilon_i\right) - \bet\right</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb42-680"><a href="#cb42-680" aria-hidden="true" tabindex="-1"></a>&amp; = \left(\frac{1}{n}\sum_{i=1}^n\Z_i'\X_i\right)^{-1}\sqrt{n}\left(\frac{1}{n}\sum_{i=1}^n\Z_i'\varepsilon_i - \zer \right)<span class="sc">\\</span></span>
<span id="cb42-681"><a href="#cb42-681" aria-hidden="true" tabindex="-1"></a>&amp; =\left(\frac{1}{n}\sum_{i=1}^n\Z_i'\X_i\right)^{-1}\sqrt{n}\left(\frac{1}{n}\sum_{i=1}^n\Z_i'\varepsilon_i - \E{\Z_i\varepsilon_i} \right) &amp; (\E{\Z'\varepsilon} = \zer ) <span class="sc">\\</span></span>
<span id="cb42-682"><a href="#cb42-682" aria-hidden="true" tabindex="-1"></a>&amp; = \underbrace{\left(\frac{1}{n}\sum_{i=1}^n\Z_i'\X_i\right)^{-1}}_{\pto \E{\Z'\X}^{-1}} \underbrace{\sqrt{n}\left(\frac{1}{n}\sum_{i=1}^n\Z_i'\varepsilon_i - \E{\Z_i\varepsilon_i} \right)}_{\dto N\left(\E{\Z_i\varepsilon_i}, \var{\textstyle \sum \X_i\varepsilon_i}/n\right)} &amp; (\text{LLN and CLT})<span class="sc">\\</span></span>
<span id="cb42-683"><a href="#cb42-683" aria-hidden="true" tabindex="-1"></a>&amp;\dto \E{\Z'\X}^{-1}\cdot N\left(\E{\Z_i\varepsilon_i}, \var{\textstyle \sum \Z_i\varepsilon_i}/n\right) &amp; (\text{Slutsky's Theorem})<span class="sc">\\</span></span>
<span id="cb42-684"><a href="#cb42-684" aria-hidden="true" tabindex="-1"></a>&amp; = \E{\Z'\X}^{-1}\cdot N\left(\zer, \sigma^2\E{\Z'\Z}\right) <span class="sc">\\</span></span>
<span id="cb42-685"><a href="#cb42-685" aria-hidden="true" tabindex="-1"></a>&amp; = \E{\Z'\X}^{-1}\cdot N\left(\zer, \sigma^2\E{\Z'\Z}\right)<span class="sc">\\</span></span>
<span id="cb42-686"><a href="#cb42-686" aria-hidden="true" tabindex="-1"></a>&amp; = N\left(\zer, \E{\Z'\X}^{-1}\sigma^2\E{\Z'\Z}\left<span class="co">[</span><span class="ot">\E{\Z'\X}^{-1}\right</span><span class="co">]</span>'\right)<span class="sc">\\</span></span>
<span id="cb42-687"><a href="#cb42-687" aria-hidden="true" tabindex="-1"></a>&amp; = N\left(\zer, \E{\Z'\X}^{-1}\sigma^2\E{\Z'\Z}\E{\X'\Z}^{-1}\right).</span>
<span id="cb42-688"><a href="#cb42-688" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-689"><a href="#cb42-689" aria-hidden="true" tabindex="-1"></a>This implies that </span>
<span id="cb42-690"><a href="#cb42-690" aria-hidden="true" tabindex="-1"></a>$$\IV\asim N\left(\bet, \frac{\sigma^2}{n}\E{\Z'\X}^{-1}\E{\Z'\Z}\E{\X'\Z}^{-1} \right).$$ </span>
<span id="cb42-691"><a href="#cb42-691" aria-hidden="true" tabindex="-1"></a>If desired, we can write the asymptotic variance in terms of matrices $\Xm$ and $\Zm$:</span>
<span id="cb42-692"><a href="#cb42-692" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-693"><a href="#cb42-693" aria-hidden="true" tabindex="-1"></a>\avar{\IV} &amp; = \frac{\sigma^2}{n}\E{\Z'\X}^{-1}\E{\Z'\Z}\E{\X'\Z}^{-1}<span class="sc">\\</span></span>
<span id="cb42-694"><a href="#cb42-694" aria-hidden="true" tabindex="-1"></a>&amp; = \frac{\sigma^2}{n}\left<span class="co">[</span><span class="ot">\frac{\E{\Zm'\Xm}}{n}\right</span><span class="co">]</span>^{-1}\left<span class="co">[</span><span class="ot">\frac{\E{\Zm'\Zm}}{n}\right</span><span class="co">]</span>\left<span class="co">[</span><span class="ot">\frac{\E{\Xm'\Zm}}{n}\right</span><span class="co">]</span>^{-1} <span class="sc">\\</span></span>
<span id="cb42-695"><a href="#cb42-695" aria-hidden="true" tabindex="-1"></a>&amp; = n^2\cdot\frac{1}{n}\cdot\frac{\sigma^2}{n}\E{\Zm'\Xm}^{-1}\E{\Zm'\Zm}\E{\Xm'\Zm}^{-1}<span class="sc">\\</span></span>
<span id="cb42-696"><a href="#cb42-696" aria-hidden="true" tabindex="-1"></a>&amp; = \sigma^2\E{\Zm'\Xm}^{-1}\E{\Zm'\Zm}\E{\Xm'\Zm}^{-1}</span>
<span id="cb42-697"><a href="#cb42-697" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-698"><a href="#cb42-698" aria-hidden="true" tabindex="-1"></a>&lt;span style="color:white"&gt;space&lt;/span&gt;</span>
<span id="cb42-699"><a href="#cb42-699" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-700"><a href="#cb42-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-701"><a href="#cb42-701" aria-hidden="true" tabindex="-1"></a>:::{#cor-}</span>
<span id="cb42-702"><a href="#cb42-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-703"><a href="#cb42-703" aria-hidden="true" tabindex="-1"></a><span class="fu">## IV Estimator is Asymptotically Unbiased</span></span>
<span id="cb42-704"><a href="#cb42-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-705"><a href="#cb42-705" aria-hidden="true" tabindex="-1"></a>If $P_{\bet, \sigma^2} \in \mathcal P_\text{IV}$, then </span>
<span id="cb42-706"><a href="#cb42-706" aria-hidden="true" tabindex="-1"></a>$$ \lim_{n\to\infty}\text{Bias}(\IV) = 0.$$</span>
<span id="cb42-707"><a href="#cb42-707" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-708"><a href="#cb42-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-709"><a href="#cb42-709" aria-hidden="true" tabindex="-1"></a>In order to appeal to the asymptotic distribution of $\IV$ to perform inference, we need a consistent estimator of the asymptotic variance. Fortunately, we can take nearly the same exact approach we took with $\OLS$. </span>
<span id="cb42-710"><a href="#cb42-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-711"><a href="#cb42-711" aria-hidden="true" tabindex="-1"></a>:::{#prp-}</span>
<span id="cb42-712"><a href="#cb42-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-713"><a href="#cb42-713" aria-hidden="true" tabindex="-1"></a><span class="fu">## Estimation of IV Variance</span></span>
<span id="cb42-714"><a href="#cb42-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-715"><a href="#cb42-715" aria-hidden="true" tabindex="-1"></a>Define the estimator </span>
<span id="cb42-716"><a href="#cb42-716" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-717"><a href="#cb42-717" aria-hidden="true" tabindex="-1"></a>S^2 &amp;=  \frac{\hat{\e}'\hat{\e}}{n-K}<span class="sc">\\</span></span>
<span id="cb42-718"><a href="#cb42-718" aria-hidden="true" tabindex="-1"></a>\hat{\e} &amp;= \Y - \Xm\IV</span>
<span id="cb42-719"><a href="#cb42-719" aria-hidden="true" tabindex="-1"></a>\end{align*} in the context of the linear IV model. Then:</span>
<span id="cb42-720"><a href="#cb42-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-721"><a href="#cb42-721" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>$S^2$ is an unbiased for $\var{\ep\mid\X} = \sigma^2$.</span>
<span id="cb42-722"><a href="#cb42-722" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>$S^2$ is a consistent estimator $\var{\ep\mid\X} = \sigma^2$.</span>
<span id="cb42-723"><a href="#cb42-723" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>The estimator $\widehat{\text{Avar}}(\IV) = S^2(\Zm'\Xm)^{-1}(\Zm'\Zm)(\Xm'\Zm)^{-1}$ is a consistent estimator for </span>
<span id="cb42-724"><a href="#cb42-724" aria-hidden="true" tabindex="-1"></a>${\text{Avar}}(\IV)$.</span>
<span id="cb42-725"><a href="#cb42-725" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-726"><a href="#cb42-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-727"><a href="#cb42-727" aria-hidden="true" tabindex="-1"></a>:::{.proof}</span>
<span id="cb42-728"><a href="#cb42-728" aria-hidden="true" tabindex="-1"></a>The proof is nearly identical to that of Proposition \@ref(prp:olsvar).</span>
<span id="cb42-729"><a href="#cb42-729" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-730"><a href="#cb42-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-731"><a href="#cb42-731" aria-hidden="true" tabindex="-1"></a>:::{#exm-}</span>
<span id="cb42-732"><a href="#cb42-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-733"><a href="#cb42-733" aria-hidden="true" tabindex="-1"></a><span class="fu">## Coding Exercise</span></span>
<span id="cb42-734"><a href="#cb42-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-735"><a href="#cb42-735" aria-hidden="true" tabindex="-1"></a>R has no base function which implements $\IV$, so let's write our own. For reference, we can compare our results with those given by ```ivreg()``` from the ```AER``` (applied econometrics in R) package.</span>
<span id="cb42-736"><a href="#cb42-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-739"><a href="#cb42-739" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-740"><a href="#cb42-740" aria-hidden="true" tabindex="-1"></a>IV <span class="ot">&lt;-</span> <span class="cf">function</span>(y, X, Z){</span>
<span id="cb42-741"><a href="#cb42-741" aria-hidden="true" tabindex="-1"></a>  <span class="co">#determine dimensions, perform IV</span></span>
<span id="cb42-742"><a href="#cb42-742" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(y)</span>
<span id="cb42-743"><a href="#cb42-743" aria-hidden="true" tabindex="-1"></a>  K <span class="ot">&lt;-</span> <span class="fu">coalesce</span>(<span class="fu">ncol</span>(X), <span class="dv">1</span>)</span>
<span id="cb42-744"><a href="#cb42-744" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">coalesce</span>(<span class="fu">ncol</span>(Z), <span class="dv">1</span>) <span class="sc">!=</span> K) {<span class="fu">stop</span>(<span class="st">"K instruments required"</span>)}</span>
<span id="cb42-745"><a href="#cb42-745" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">det</span>(<span class="fu">t</span>(Z) <span class="sc">%*%</span> X) <span class="sc">==</span> <span class="dv">0</span>) {<span class="fu">stop</span>(<span class="st">"rank(Z'X) &lt; K"</span>)}</span>
<span id="cb42-746"><a href="#cb42-746" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-747"><a href="#cb42-747" aria-hidden="true" tabindex="-1"></a>  hat_beta <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">t</span>(Z) <span class="sc">%*%</span> X) <span class="sc">%*%</span> <span class="fu">t</span>(Z) <span class="sc">%*%</span> y </span>
<span id="cb42-748"><a href="#cb42-748" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-749"><a href="#cb42-749" aria-hidden="true" tabindex="-1"></a>  <span class="co">#use IV estimates to calculate residuals and estimate SEs</span></span>
<span id="cb42-750"><a href="#cb42-750" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> (y<span class="sc">-</span>X <span class="sc">%*%</span> hat_beta)</span>
<span id="cb42-751"><a href="#cb42-751" aria-hidden="true" tabindex="-1"></a>  S2 <span class="ot">&lt;-</span> ((<span class="fu">t</span>(res) <span class="sc">%*%</span> res)<span class="sc">/</span>(n <span class="sc">-</span> K)) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>() </span>
<span id="cb42-752"><a href="#cb42-752" aria-hidden="true" tabindex="-1"></a>  var_hat <span class="ot">&lt;-</span> (S2) <span class="sc">*</span>  <span class="fu">solve</span>(<span class="fu">t</span>(Z) <span class="sc">%*%</span> X) <span class="sc">%*%</span> (<span class="fu">t</span>(Z) <span class="sc">%*%</span> Z) <span class="sc">%*%</span> <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> Z) </span>
<span id="cb42-753"><a href="#cb42-753" aria-hidden="true" tabindex="-1"></a>  se_hat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(var_hat))</span>
<span id="cb42-754"><a href="#cb42-754" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-755"><a href="#cb42-755" aria-hidden="true" tabindex="-1"></a>  <span class="co">#t-stat, confidence intervals, p values</span></span>
<span id="cb42-756"><a href="#cb42-756" aria-hidden="true" tabindex="-1"></a>  t <span class="ot">&lt;-</span> hat_beta<span class="sc">/</span>se_hat</span>
<span id="cb42-757"><a href="#cb42-757" aria-hidden="true" tabindex="-1"></a>  lower_CI <span class="ot">&lt;-</span> hat_beta <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>)<span class="sc">*</span>se_hat</span>
<span id="cb42-758"><a href="#cb42-758" aria-hidden="true" tabindex="-1"></a>  upper_CI <span class="ot">&lt;-</span> hat_beta <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>)<span class="sc">*</span>se_hat</span>
<span id="cb42-759"><a href="#cb42-759" aria-hidden="true" tabindex="-1"></a>  p_val <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pt</span>(t, n<span class="sc">-</span>K))</span>
<span id="cb42-760"><a href="#cb42-760" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-761"><a href="#cb42-761" aria-hidden="true" tabindex="-1"></a>  <span class="co">#combine everything into one table to return</span></span>
<span id="cb42-762"><a href="#cb42-762" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb42-763"><a href="#cb42-763" aria-hidden="true" tabindex="-1"></a>    <span class="at">parameter =</span> <span class="fu">paste0</span>(<span class="st">"β"</span>, <span class="dv">1</span><span class="sc">:</span>K),</span>
<span id="cb42-764"><a href="#cb42-764" aria-hidden="true" tabindex="-1"></a>    <span class="at">estimate =</span> hat_beta,</span>
<span id="cb42-765"><a href="#cb42-765" aria-hidden="true" tabindex="-1"></a>    <span class="at">std_error =</span> se_hat,</span>
<span id="cb42-766"><a href="#cb42-766" aria-hidden="true" tabindex="-1"></a>    <span class="at">t_stat =</span> t,</span>
<span id="cb42-767"><a href="#cb42-767" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower_95_CI =</span> lower_CI,</span>
<span id="cb42-768"><a href="#cb42-768" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper_95_CI =</span> upper_CI,</span>
<span id="cb42-769"><a href="#cb42-769" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_value =</span> p_val</span>
<span id="cb42-770"><a href="#cb42-770" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-771"><a href="#cb42-771" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb42-772"><a href="#cb42-772" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-773"><a href="#cb42-773" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-774"><a href="#cb42-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-775"><a href="#cb42-775" aria-hidden="true" tabindex="-1"></a>Let's estimate the model from Example \@ref(exm:refex) using ```ivreg()```.</span>
<span id="cb42-776"><a href="#cb42-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-779"><a href="#cb42-779" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-780"><a href="#cb42-780" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">sim_endog_linear_model</span>(</span>
<span id="cb42-781"><a href="#cb42-781" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>),</span>
<span id="cb42-782"><a href="#cb42-782" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">1000</span>,</span>
<span id="cb42-783"><a href="#cb42-783" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_vec =</span> <span class="fu">c</span>(rmvnorm),</span>
<span id="cb42-784"><a href="#cb42-784" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_params_list =</span> <span class="fu">list</span>(</span>
<span id="cb42-785"><a href="#cb42-785" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb42-786"><a href="#cb42-786" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">0</span>), </span>
<span id="cb42-787"><a href="#cb42-787" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">5</span>,<span class="dv">1</span>, <span class="dv">5</span>,<span class="dv">20</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb42-788"><a href="#cb42-788" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb42-789"><a href="#cb42-789" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-790"><a href="#cb42-790" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-791"><a href="#cb42-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-792"><a href="#cb42-792" aria-hidden="true" tabindex="-1"></a><span class="fu">ivreg</span>(y <span class="sc">~</span> x2 <span class="sc">|</span> z2, <span class="at">data =</span> results<span class="sc">$</span>observed_data) <span class="sc">%&gt;%</span> </span>
<span id="cb42-793"><a href="#cb42-793" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb42-794"><a href="#cb42-794" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span>
<span id="cb42-795"><a href="#cb42-795" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-796"><a href="#cb42-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-797"><a href="#cb42-797" aria-hidden="true" tabindex="-1"></a>Now we can use our function and verify that the outputs are the same. </span>
<span id="cb42-798"><a href="#cb42-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-801"><a href="#cb42-801" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-802"><a href="#cb42-802" aria-hidden="true" tabindex="-1"></a><span class="fu">IV</span>(results<span class="sc">$</span>y, results<span class="sc">$</span>X, results<span class="sc">$</span>Z) <span class="sc">%&gt;%</span> </span>
<span id="cb42-803"><a href="#cb42-803" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span>
<span id="cb42-804"><a href="#cb42-804" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-805"><a href="#cb42-805" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-806"><a href="#cb42-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-807"><a href="#cb42-807" aria-hidden="true" tabindex="-1"></a>:::{#exm-}</span>
<span id="cb42-808"><a href="#cb42-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-809"><a href="#cb42-809" aria-hidden="true" tabindex="-1"></a><span class="fu">## Intuition behind Asymptotic Variance</span></span>
<span id="cb42-810"><a href="#cb42-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-811"><a href="#cb42-811" aria-hidden="true" tabindex="-1"></a>In Example \@ref(exm:csvarols) we provided some intuition as to how $\var{\OLS} = \frac{\sigma^2}{n} \E{\X'\X}^{-1}$ changed in response to changes in $\sigma^2$, $n$, and components of $\E{\X'\X}$. The variance of $\OLS$ is smaller for large samples and when the error term $\ep$ has a small variance. The more variance we have in our regressors (which is related to $\E{\X'\X}^{-1}$), the more efficient our estimator. So what is the intuition behind $\avar{\IV} =\frac{\sigma^2}{n}\E{\Z'\X}^{-1}\E{\Z'\Z}\E{\X'\Z}^{-1}$? Three things should look familiar. The variance increases with increases in $\sigma^2$ and decreases with increases in $n$. Consider the model $Y = X\beta + \varepsilon$ when we instrument for $X$ with $Z$, such that </span>
<span id="cb42-812"><a href="#cb42-812" aria-hidden="true" tabindex="-1"></a>$$\avar{\IV} =\frac{\sigma^2}{n}\frac{\E{Z^2}}{\E{ZX}^2} = \frac{\var{Z} + \E{Z}^2}{<span class="co">[</span><span class="ot">\cov{X,Z} + \E{Z}\E{X}</span><span class="co">]</span>^2}.$$ Holding the average of $Z$ and $X$ fixed, we see that the asymptotic variance of our estimator increases with linearly with $\var{Z}$, and decreases quadratically as $\cov{X,Z}$. The latter of these facts shouldn't be surprising. The larger $\cov{X,Z}$, the more relevant ("stronger") our instrument $Z$ is, and the better our estimates. If we simplify this example even further by assuming $\E{X}=\E{Z}=0$ and $\var{X} = \var{Z}=1$, then</span>
<span id="cb42-813"><a href="#cb42-813" aria-hidden="true" tabindex="-1"></a>$$\avar{\IV} = \frac{1}{\cov{X,Z}^2} = \left(\frac{\cov{X,Z}}{1\cdot 1} \right)^{-2} = \left(\frac{\cov{X,Z}}{\sigma_Y\cdot \sigma_X} \right)^{-2} = \rho_{X,Z}^{-2}.$$</span>
<span id="cb42-814"><a href="#cb42-814" aria-hidden="true" tabindex="-1"></a>The asympotitc variance of our estimator is inversely proportional to the correlation of $X$ and $Z$. </span>
<span id="cb42-815"><a href="#cb42-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-816"><a href="#cb42-816" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-817"><a href="#cb42-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-818"><a href="#cb42-818" aria-hidden="true" tabindex="-1"></a><span class="fu">## Many Instruments, 2SLS</span></span>
<span id="cb42-819"><a href="#cb42-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-820"><a href="#cb42-820" aria-hidden="true" tabindex="-1"></a>When defining $\mathcal P_\text{IV}$, we assumed $\dim(\Z) = \dim(\X) = K$. What happens if we have $L = \dim(\Z) &gt; \dim(\X) = K$? Let's consider a special case first.</span>
<span id="cb42-821"><a href="#cb42-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-822"><a href="#cb42-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-823"><a href="#cb42-823" aria-hidden="true" tabindex="-1"></a>:::{#exm-ref3}</span>
<span id="cb42-824"><a href="#cb42-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-825"><a href="#cb42-825" aria-hidden="true" tabindex="-1"></a><span class="fu">## OLS vs. IV</span></span>
<span id="cb42-826"><a href="#cb42-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-827"><a href="#cb42-827" aria-hidden="true" tabindex="-1"></a>Consider a model $\Y = \Xm \bet + \ep$ which satisfies the Gauss-Markov assumption, *but* also specifies the existence of $K$ separate instrumental variables $\Z$. In other words, we have $2K$ instruments in the form of $\X$ and $\Z$. Should we estimate $\bet$ via OLS (equivalent to IV using $\X$ as instruments for $\X$), or should we estimate $\bet$ via IV using $\Z$? It may be tempting to pick the latter. What if we are confident that $\Z$ are valid instruments, but aren't positive that $\X$ is exogenous. If we estimated $\bet$ with $\IV = (\Zm'\Xm)^{-1}\Zm'\Y$, then we would be playing it safe and not risk inconsistent estimates via $\IV'=(\Xm'\Xm)^{-1}\Xm'\Y = \OLS$. Unfortunately this approach has a cost in the form of variance/standard errors. </span>
<span id="cb42-828"><a href="#cb42-828" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-829"><a href="#cb42-829" aria-hidden="true" tabindex="-1"></a>\text{Avar}(\IV) &amp;= \sigma^2\E{\Zm'\Xm}^{-1}\E{\Zm'\Zm}\E{\Xm'\Zm}^{-1}<span class="sc">\\</span></span>
<span id="cb42-830"><a href="#cb42-830" aria-hidden="true" tabindex="-1"></a>\text{Avar}(\IV') &amp;= \text{Avar}(\OLS) = \sigma^2\E{\Xm'\Xm}^{-1} &amp; (\Xm = \Zm)</span>
<span id="cb42-831"><a href="#cb42-831" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-832"><a href="#cb42-832" aria-hidden="true" tabindex="-1"></a>The difference $\text{Avar}(\IV) - \text{Avar}(\OLS)$ is PSD, so </span>
<span id="cb42-833"><a href="#cb42-833" aria-hidden="true" tabindex="-1"></a>$$ \se{\hat\beta_{\text{IV},j}'} = \se{\hat\beta_{\text{OLS},j}} &lt; \se{\hat\beta_{\text{IV},j}}.$$</span>
<span id="cb42-834"><a href="#cb42-834" aria-hidden="true" tabindex="-1"></a>As the next simulation shows, this difference can be fairly large.</span>
<span id="cb42-835"><a href="#cb42-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-838"><a href="#cb42-838" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-839"><a href="#cb42-839" aria-hidden="true" tabindex="-1"></a>iter <span class="ot">&lt;-</span> <span class="cf">function</span>(beta, n, dist_vec, dist_params_list, t){</span>
<span id="cb42-840"><a href="#cb42-840" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">sim_endog_linear_model</span>(beta, n, dist_vec, dist_params_list)</span>
<span id="cb42-841"><a href="#cb42-841" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-842"><a href="#cb42-842" aria-hidden="true" tabindex="-1"></a>  OLS_results <span class="ot">&lt;-</span> <span class="fu">IV</span>(model<span class="sc">$</span>y, model<span class="sc">$</span>X, model<span class="sc">$</span>X) <span class="sc">%&gt;%</span> </span>
<span id="cb42-843"><a href="#cb42-843" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb42-844"><a href="#cb42-844" aria-hidden="true" tabindex="-1"></a>      parameter, </span>
<span id="cb42-845"><a href="#cb42-845" aria-hidden="true" tabindex="-1"></a>      estimate</span>
<span id="cb42-846"><a href="#cb42-846" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb42-847"><a href="#cb42-847" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">estimator =</span> <span class="st">"OLS"</span>)</span>
<span id="cb42-848"><a href="#cb42-848" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-849"><a href="#cb42-849" aria-hidden="true" tabindex="-1"></a>  IV_results <span class="ot">&lt;-</span> <span class="fu">IV</span>(model<span class="sc">$</span>y, model<span class="sc">$</span>X, model<span class="sc">$</span>Z) <span class="sc">%&gt;%</span> </span>
<span id="cb42-850"><a href="#cb42-850" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb42-851"><a href="#cb42-851" aria-hidden="true" tabindex="-1"></a>      parameter, </span>
<span id="cb42-852"><a href="#cb42-852" aria-hidden="true" tabindex="-1"></a>      estimate</span>
<span id="cb42-853"><a href="#cb42-853" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb42-854"><a href="#cb42-854" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">estimator =</span> <span class="st">"IV"</span>)</span>
<span id="cb42-855"><a href="#cb42-855" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-856"><a href="#cb42-856" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> OLS_results <span class="sc">%&gt;%</span> </span>
<span id="cb42-857"><a href="#cb42-857" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(IV_results) <span class="sc">%&gt;%</span> </span>
<span id="cb42-858"><a href="#cb42-858" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">iter_num =</span> t)</span>
<span id="cb42-859"><a href="#cb42-859" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-860"><a href="#cb42-860" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb42-861"><a href="#cb42-861" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-862"><a href="#cb42-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-863"><a href="#cb42-863" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="cf">function</span>(N, beta, n, dist_vec, dist_params_list){</span>
<span id="cb42-864"><a href="#cb42-864" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>N <span class="sc">%&gt;%</span> </span>
<span id="cb42-865"><a href="#cb42-865" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(iter, <span class="at">beta =</span> beta, <span class="at">n =</span> n, <span class="at">dist_vec =</span> dist_vec, <span class="at">dist_params_list =</span> dist_params_list) <span class="sc">%&gt;%</span> </span>
<span id="cb42-866"><a href="#cb42-866" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb42-867"><a href="#cb42-867" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb42-868"><a href="#cb42-868" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-869"><a href="#cb42-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-870"><a href="#cb42-870" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">sim</span>(</span>
<span id="cb42-871"><a href="#cb42-871" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fl">1e5</span>,</span>
<span id="cb42-872"><a href="#cb42-872" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb42-873"><a href="#cb42-873" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">100</span>,</span>
<span id="cb42-874"><a href="#cb42-874" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_vec =</span> <span class="fu">c</span>(rmvnorm),</span>
<span id="cb42-875"><a href="#cb42-875" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_params_list =</span> <span class="fu">list</span>(</span>
<span id="cb42-876"><a href="#cb42-876" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb42-877"><a href="#cb42-877" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">0</span>), </span>
<span id="cb42-878"><a href="#cb42-878" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">5</span>,<span class="dv">0</span>, <span class="dv">5</span>,<span class="dv">20</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb42-879"><a href="#cb42-879" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb42-880"><a href="#cb42-880" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-881"><a href="#cb42-881" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb42-882"><a href="#cb42-882" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-883"><a href="#cb42-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-886"><a href="#cb42-886" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-887"><a href="#cb42-887" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb42-888"><a href="#cb42-888" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb42-889"><a href="#cb42-889" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-plot704</span></span>
<span id="cb42-890"><a href="#cb42-890" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb42-891"><a href="#cb42-891" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb42-892"><a href="#cb42-892" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-asp: 0.7</span></span>
<span id="cb42-893"><a href="#cb42-893" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb42-894"><a href="#cb42-894" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: " f"</span></span>
<span id="cb42-895"><a href="#cb42-895" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show code which generates figure"</span></span>
<span id="cb42-896"><a href="#cb42-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-897"><a href="#cb42-897" aria-hidden="true" tabindex="-1"></a>results <span class="sc">%&gt;%</span> </span>
<span id="cb42-898"><a href="#cb42-898" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(estimate)) <span class="sc">+</span> </span>
<span id="cb42-899"><a href="#cb42-899" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..), <span class="at">bins =</span> <span class="dv">70</span>, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb42-900"><a href="#cb42-900" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="fu">vars</span>(estimator), <span class="fu">vars</span>(parameter)) <span class="sc">+</span></span>
<span id="cb42-901"><a href="#cb42-901" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb42-902"><a href="#cb42-902" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="fl">0.5</span>,<span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb42-903"><a href="#cb42-903" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Estimates"</span>, <span class="at">y =</span> <span class="st">"Density"</span>)</span>
<span id="cb42-904"><a href="#cb42-904" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-905"><a href="#cb42-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-906"><a href="#cb42-906" aria-hidden="true" tabindex="-1"></a>If we calculate the simulated standard errors of our estimators, we find that using $\IV$ results in nearly a four fold decrease in standard error.</span>
<span id="cb42-907"><a href="#cb42-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-910"><a href="#cb42-910" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-911"><a href="#cb42-911" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb42-912"><a href="#cb42-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-913"><a href="#cb42-913" aria-hidden="true" tabindex="-1"></a>results <span class="sc">%&gt;%</span> </span>
<span id="cb42-914"><a href="#cb42-914" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(estimator, parameter) <span class="sc">%&gt;%</span> </span>
<span id="cb42-915"><a href="#cb42-915" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">std =</span> <span class="fu">sd</span>(estimate)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-916"><a href="#cb42-916" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb42-917"><a href="#cb42-917" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> parameter, <span class="at">values_from =</span> std) <span class="sc">%&gt;%</span> </span>
<span id="cb42-918"><a href="#cb42-918" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span>
<span id="cb42-919"><a href="#cb42-919" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-920"><a href="#cb42-920" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-921"><a href="#cb42-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-922"><a href="#cb42-922" aria-hidden="true" tabindex="-1"></a>:::{#exm-ex4}</span>
<span id="cb42-923"><a href="#cb42-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-924"><a href="#cb42-924" aria-hidden="true" tabindex="-1"></a><span class="fu">## IV vs... IV?</span></span>
<span id="cb42-925"><a href="#cb42-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-926"><a href="#cb42-926" aria-hidden="true" tabindex="-1"></a>Suppose $Y = X + \varepsilon$ for an endogenous $X$. Fortunately, we have two instruments $Z_1$ and $Z_2$. Which instrument do we use to estimate $\beta = 1$. At first the answer seems simple -- just estimate the model using each instrument separately, and then pick the estimates with the lower standard error. </span>
<span id="cb42-929"><a href="#cb42-929" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-930"><a href="#cb42-930" aria-hidden="true" tabindex="-1"></a>compare_two_ivs <span class="ot">&lt;-</span> <span class="cf">function</span>(beta, n, dist_vec, dist_params_list){</span>
<span id="cb42-931"><a href="#cb42-931" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">sim_endog_linear_model</span>(beta, n, dist_vec, dist_params_list)</span>
<span id="cb42-932"><a href="#cb42-932" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Exclude intercepts </span></span>
<span id="cb42-933"><a href="#cb42-933" aria-hidden="true" tabindex="-1"></a>  first_iv <span class="ot">&lt;-</span> <span class="fu">IV</span>(model<span class="sc">$</span>y, model<span class="sc">$</span>X[,<span class="sc">-</span><span class="dv">1</span>], model<span class="sc">$</span>Z[,<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb42-934"><a href="#cb42-934" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb42-935"><a href="#cb42-935" aria-hidden="true" tabindex="-1"></a>      parameter,</span>
<span id="cb42-936"><a href="#cb42-936" aria-hidden="true" tabindex="-1"></a>      std_error</span>
<span id="cb42-937"><a href="#cb42-937" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb42-938"><a href="#cb42-938" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb42-939"><a href="#cb42-939" aria-hidden="true" tabindex="-1"></a>      <span class="at">instrument =</span> <span class="st">"Z1"</span>,</span>
<span id="cb42-940"><a href="#cb42-940" aria-hidden="true" tabindex="-1"></a>      <span class="at">parameter =</span> <span class="st">"β"</span>)</span>
<span id="cb42-941"><a href="#cb42-941" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Exclude intercepts </span></span>
<span id="cb42-942"><a href="#cb42-942" aria-hidden="true" tabindex="-1"></a>  second_iv <span class="ot">&lt;-</span> <span class="fu">IV</span>(model<span class="sc">$</span>y, model<span class="sc">$</span>X[,<span class="sc">-</span><span class="dv">1</span>], model<span class="sc">$</span>Z[,<span class="dv">3</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb42-943"><a href="#cb42-943" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb42-944"><a href="#cb42-944" aria-hidden="true" tabindex="-1"></a>      parameter,</span>
<span id="cb42-945"><a href="#cb42-945" aria-hidden="true" tabindex="-1"></a>      std_error</span>
<span id="cb42-946"><a href="#cb42-946" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb42-947"><a href="#cb42-947" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb42-948"><a href="#cb42-948" aria-hidden="true" tabindex="-1"></a>      <span class="at">instrument =</span> <span class="st">"Z2"</span>,</span>
<span id="cb42-949"><a href="#cb42-949" aria-hidden="true" tabindex="-1"></a>      <span class="at">parameter =</span> <span class="st">"β"</span>)</span>
<span id="cb42-950"><a href="#cb42-950" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(first_iv, second_iv)</span>
<span id="cb42-951"><a href="#cb42-951" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb42-952"><a href="#cb42-952" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-953"><a href="#cb42-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-954"><a href="#cb42-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-955"><a href="#cb42-955" aria-hidden="true" tabindex="-1"></a><span class="fu">compare_two_ivs</span>(</span>
<span id="cb42-956"><a href="#cb42-956" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb42-957"><a href="#cb42-957" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">50</span>,</span>
<span id="cb42-958"><a href="#cb42-958" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_vec =</span> <span class="fu">c</span>(rmvnorm),</span>
<span id="cb42-959"><a href="#cb42-959" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_params_list =</span> <span class="fu">list</span>(</span>
<span id="cb42-960"><a href="#cb42-960" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb42-961"><a href="#cb42-961" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb42-962"><a href="#cb42-962" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="fl">0.3</span>, <span class="dv">0</span>, <span class="fl">0.5</span>, <span class="fl">0.3</span>, <span class="dv">1</span>, <span class="dv">0</span>,<span class="fl">0.5</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">4</span>)</span>
<span id="cb42-963"><a href="#cb42-963" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb42-964"><a href="#cb42-964" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-965"><a href="#cb42-965" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb42-966"><a href="#cb42-966" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span>
<span id="cb42-967"><a href="#cb42-967" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-968"><a href="#cb42-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-969"><a href="#cb42-969" aria-hidden="true" tabindex="-1"></a>So we should use the instrument $Z_2$! Or are we forgetting some other instruments? Consider $Z_3 = aZ_1 + bZ_2$. </span>
<span id="cb42-970"><a href="#cb42-970" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-971"><a href="#cb42-971" aria-hidden="true" tabindex="-1"></a>\E{Z_3\varepsilon} &amp; = \E{(aZ_1 + bZ_2)\varepsilon} = a\underbrace{\E{Z_1\varepsilon}}_0 + b\underbrace{\E{Z_2\varepsilon}}_0 = 0<span class="sc">\\</span></span>
<span id="cb42-972"><a href="#cb42-972" aria-hidden="true" tabindex="-1"></a>\E{Z_3X} &amp; = \E{(aZ_1 + bZ_2)X} = a\underbrace{\E{Z_1X}}_{\neq 0} + b\underbrace{\E{Z_2X}}_{\neq 0} \neq 0</span>
<span id="cb42-973"><a href="#cb42-973" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-974"><a href="#cb42-974" aria-hidden="true" tabindex="-1"></a>It turns out that *any* linear combination of instruments is a valid instrument. There are an infinite number of candidates for instruments, so what do we do? Let's simulate some standard errors and see if we can notice patterns between them and the choice of instruments. We'll restrict our attention to instruments in the set $<span class="sc">\{</span>aZ_1 + (1-a)Z_2\mid a\in\R<span class="sc">\}</span>$ to simplify visualizations. We will calculate the $\var{\IV \mid \Xm,\ \Zm}$ for a fixed sample drawn from $(X,Z_1,Z_2,\varepsilon)\iid N(\boldsymbol \mu, \Sig)$ where</span>
<span id="cb42-975"><a href="#cb42-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-976"><a href="#cb42-976" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-977"><a href="#cb42-977" aria-hidden="true" tabindex="-1"></a>\boldsymbol \mu &amp; = <span class="co">[</span><span class="ot">0,0,0,0</span><span class="co">]</span>',<span class="sc">\\</span></span>
<span id="cb42-978"><a href="#cb42-978" aria-hidden="true" tabindex="-1"></a>\Sig &amp; = \begin{bmatrix}1 &amp; 0.5 &amp; 0.5 &amp; 0.5<span class="sc">\\</span>0.5&amp;1&amp;0.3&amp;0<span class="sc">\\</span>0.5&amp;0.3&amp;1&amp;0<span class="sc">\\</span>0.5&amp;0&amp;0&amp;1 \end{bmatrix}.</span>
<span id="cb42-979"><a href="#cb42-979" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-980"><a href="#cb42-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-983"><a href="#cb42-983" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-984"><a href="#cb42-984" aria-hidden="true" tabindex="-1"></a>iter <span class="ot">&lt;-</span> <span class="cf">function</span>(model, a){</span>
<span id="cb42-985"><a href="#cb42-985" aria-hidden="true" tabindex="-1"></a>  model<span class="sc">$</span>Z[,<span class="dv">2</span>] <span class="ot">&lt;-</span> a<span class="sc">*</span>model<span class="sc">$</span>Z[,<span class="dv">2</span>] <span class="sc">+</span> (<span class="dv">1</span><span class="sc">-</span>a)<span class="sc">*</span>model<span class="sc">$</span>Z[,<span class="dv">3</span>]</span>
<span id="cb42-986"><a href="#cb42-986" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">IV</span>(model<span class="sc">$</span>y, model<span class="sc">$</span>X[,<span class="sc">-</span><span class="dv">1</span>], model<span class="sc">$</span>Z[,<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb42-987"><a href="#cb42-987" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb42-988"><a href="#cb42-988" aria-hidden="true" tabindex="-1"></a>      parameter,</span>
<span id="cb42-989"><a href="#cb42-989" aria-hidden="true" tabindex="-1"></a>      std_error</span>
<span id="cb42-990"><a href="#cb42-990" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb42-991"><a href="#cb42-991" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">a =</span> a)</span>
<span id="cb42-992"><a href="#cb42-992" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb42-993"><a href="#cb42-993" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-994"><a href="#cb42-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-995"><a href="#cb42-995" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="cf">function</span>(a_vals, beta, n, dist_vec, dist_params_list){</span>
<span id="cb42-996"><a href="#cb42-996" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">sim_endog_linear_model</span>(beta, n, dist_vec, dist_params_list)</span>
<span id="cb42-997"><a href="#cb42-997" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> a_vals <span class="sc">%&gt;%</span> </span>
<span id="cb42-998"><a href="#cb42-998" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(iter, <span class="at">model =</span> model) <span class="sc">%&gt;%</span> </span>
<span id="cb42-999"><a href="#cb42-999" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb42-1000"><a href="#cb42-1000" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb42-1001"><a href="#cb42-1001" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-1002"><a href="#cb42-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1003"><a href="#cb42-1003" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">sim</span>(</span>
<span id="cb42-1004"><a href="#cb42-1004" aria-hidden="true" tabindex="-1"></a>  <span class="at">a_vals =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="at">length =</span> <span class="dv">500</span>),</span>
<span id="cb42-1005"><a href="#cb42-1005" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb42-1006"><a href="#cb42-1006" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">50</span>,</span>
<span id="cb42-1007"><a href="#cb42-1007" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_vec =</span> <span class="fu">c</span>(rmvnorm),</span>
<span id="cb42-1008"><a href="#cb42-1008" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_params_list =</span> <span class="fu">list</span>(</span>
<span id="cb42-1009"><a href="#cb42-1009" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb42-1010"><a href="#cb42-1010" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb42-1011"><a href="#cb42-1011" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="fl">0.3</span>, <span class="dv">0</span>, <span class="fl">0.5</span>, <span class="fl">0.3</span>, <span class="dv">1</span>, <span class="dv">0</span>,<span class="fl">0.5</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">4</span>)</span>
<span id="cb42-1012"><a href="#cb42-1012" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb42-1013"><a href="#cb42-1013" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-1014"><a href="#cb42-1014" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-1015"><a href="#cb42-1015" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1016"><a href="#cb42-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1017"><a href="#cb42-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1020"><a href="#cb42-1020" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1021"><a href="#cb42-1021" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb42-1022"><a href="#cb42-1022" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb42-1023"><a href="#cb42-1023" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-plot705</span></span>
<span id="cb42-1024"><a href="#cb42-1024" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb42-1025"><a href="#cb42-1025" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb42-1026"><a href="#cb42-1026" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-asp: 0.7</span></span>
<span id="cb42-1027"><a href="#cb42-1027" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb42-1028"><a href="#cb42-1028" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: " f"</span></span>
<span id="cb42-1029"><a href="#cb42-1029" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show code which generates figure"</span></span>
<span id="cb42-1030"><a href="#cb42-1030" aria-hidden="true" tabindex="-1"></a>results <span class="sc">%&gt;%</span> </span>
<span id="cb42-1031"><a href="#cb42-1031" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(a, std_error)) <span class="sc">+</span></span>
<span id="cb42-1032"><a href="#cb42-1032" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb42-1033"><a href="#cb42-1033" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb42-1034"><a href="#cb42-1034" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"a"</span>, <span class="at">y =</span> <span class="st">"Standard Error of IV Estimator with Z = a*Z1+(1-a)Z2"</span>)</span>
<span id="cb42-1035"><a href="#cb42-1035" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1036"><a href="#cb42-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1037"><a href="#cb42-1037" aria-hidden="true" tabindex="-1"></a>Certain linear combinations have lower standard errors than others, so we'll need to think of some method of finding the best possible instruments given a set. </span>
<span id="cb42-1038"><a href="#cb42-1038" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-1039"><a href="#cb42-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1040"><a href="#cb42-1040" aria-hidden="true" tabindex="-1"></a>Before considering this problem in general, let's extend the IV model to allow for more instruments than regressors. </span>
<span id="cb42-1041"><a href="#cb42-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1042"><a href="#cb42-1042" aria-hidden="true" tabindex="-1"></a>:::{#def-}</span>
<span id="cb42-1043"><a href="#cb42-1043" aria-hidden="true" tabindex="-1"></a>The &lt;span style="color:red"&gt;**_(linear) instrumental variables (IV) model_**&lt;/span&gt; is defined as $\mathcal P_\text{IV} = <span class="sc">\{</span>P_{\bet,\sigma^2} \mid \bet \in \mathbb R^{K}, \sigma^2\in\mathbb R<span class="sc">\}</span>$, where </span>
<span id="cb42-1044"><a href="#cb42-1044" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-1045"><a href="#cb42-1045" aria-hidden="true" tabindex="-1"></a>P_{\bet,\sigma^2} &amp;= <span class="sc">\{</span>F_{\Xm,\Zm,\ep} \mid\ \text{rank}\left(\E{\Z'\Z}\right) = L,\ \text{rank}\left(\E{\Z'\X}\right) = K, \ldots  <span class="sc">\}</span>,<span class="sc">\\</span></span>
<span id="cb42-1046"><a href="#cb42-1046" aria-hidden="true" tabindex="-1"></a>\Xm &amp; = <span class="co">[</span><span class="ot">\X_1, \cdots, \X_j, \cdots \X_K</span><span class="co">]</span> = <span class="co">[</span><span class="ot">\X_1, \cdots, \X_i, \cdots \X_n</span><span class="co">]</span>',<span class="sc">\\</span></span>
<span id="cb42-1047"><a href="#cb42-1047" aria-hidden="true" tabindex="-1"></a>\Zm &amp; = <span class="co">[</span><span class="ot">\Z_1, \cdots, \Z_j, \cdots \Z_L</span><span class="co">]</span> = <span class="co">[</span><span class="ot">\Z_1, \cdots, \Z_i, \cdots \Z_n</span><span class="co">]</span>',<span class="sc">\\</span></span>
<span id="cb42-1048"><a href="#cb42-1048" aria-hidden="true" tabindex="-1"></a>\dim(\Z) &amp; = L,<span class="sc">\\</span> </span>
<span id="cb42-1049"><a href="#cb42-1049" aria-hidden="true" tabindex="-1"></a>\dim(\X) &amp;= K,<span class="sc">\\</span></span>
<span id="cb42-1050"><a href="#cb42-1050" aria-hidden="true" tabindex="-1"></a>\Y &amp; = <span class="co">[</span><span class="ot">Y_1, \ldots, Y_n</span><span class="co">]</span>.</span>
<span id="cb42-1051"><a href="#cb42-1051" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-1052"><a href="#cb42-1052" aria-hidden="true" tabindex="-1"></a>A necessary condition for the rank condition $\text{rank}\left(\E{\Z'\X}\right) = K$ is the &lt;span style="color:red"&gt;**_order condition_**&lt;/span&gt;, $L\ge K$. In the event $L = K$ we say the model is &lt;span style="color:red"&gt;**_exactly identified_**&lt;/span&gt;. If $L &gt; K$, the model is &lt;span style="color:red"&gt;**_over-identified_**&lt;/span&gt;.</span>
<span id="cb42-1053"><a href="#cb42-1053" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-1054"><a href="#cb42-1054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1055"><a href="#cb42-1055" aria-hidden="true" tabindex="-1"></a>When $L=K$ this is just the original IV model, and we know how to estimate this with $\IV$. In the event $L &gt; K$, the model is still identified, as we haven't modified the identifying assumptions that $\E{\Z'\ep} = \zer$, $\E{\X'\Z} \neq \zer$, and $\text{rank}\left(\E{\Z'\X}\right) = K$. In fact, our model would still be identified if we discarded $L - K$ instruments! This is where the term "over-identified" comes from, and as far as "problems" go, it's not a bad problem to have. We have so many instruments, that we have an infinite number of ways to estimate the model! </span>
<span id="cb42-1056"><a href="#cb42-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1057"><a href="#cb42-1057" aria-hidden="true" tabindex="-1"></a>In general, any linear combination of instruments $Z_1,\ldots, Z_L$ is also an instrument. We can only use $K$ instruments with the estimator $\IV$, so we want to find the $K$ linear combinations of our instruments (some of which could reduce to a single $Z_j$) which give us the most efficient estimator. The $K$ linear combinations of the $L$ instruments can be expressed as a $L\times K$ matrix $\F$ which gives instruments $\Z\F$. If we elect to use the new instruments $\Z\F$, the IV estimator becomes $$\IV = <span class="co">[</span><span class="ot">(\Zm\F)'\Xm</span><span class="co">]</span>^{-1}<span class="co">[</span><span class="ot">(\Zm\F)'\Y</span><span class="co">]</span>.$$ The problem of selecting $\F$ such that we maximize the efficiency of $\IV$ is given as:  </span>
<span id="cb42-1058"><a href="#cb42-1058" aria-hidden="true" tabindex="-1"></a>$$\argmin_{\F}\ \text{Avar}(\IV) = \argmin_{\F}\ \sigma^2\E{(\Zm\F)'\Xm}^{-1}\E{(\Zm\F)'(\Zm\F)}\E{\Xm'(\Zm\F)}^{-1}.$$ Solving this looks like a miserable time, so let's stop appealing directly to math and consider what we're *actually* doing here. We're looking for the "best" instruments. It stands to reason that "good" instruments will be those that have more explanatory power with respect to the endogenous regressors $\X$ than others. So given draws of $(\Z,\X)$, how can we determine the best way to predict/explain $\X$ given $\Y$ --- by estimating the linear projection associated with $(\Z,\X)$ via OLS! For each $j = 1,\ldots,K$ we have </span>
<span id="cb42-1059"><a href="#cb42-1059" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-1060"><a href="#cb42-1060" aria-hidden="true" tabindex="-1"></a>\OLS^j &amp;= (\Zm'\Zm)^{-1}\Zm'\X_j &amp; (j = 1,\ldots, K)</span>
<span id="cb42-1061"><a href="#cb42-1061" aria-hidden="true" tabindex="-1"></a>\end{align*} where $\OLS^j$ define the instrument formed from linear combinations of $Z_1,\ldots, Z_L$ which has the most predictive power for $X_j$:</span>
<span id="cb42-1062"><a href="#cb42-1062" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-1063"><a href="#cb42-1063" aria-hidden="true" tabindex="-1"></a>\hat X_j &amp;= \Z \OLS^j = \hat\beta_1^jZ_1 + \hat\beta_2^jZ_2 + \cdots + \hat\beta_L^jZ_L &amp; (j = 1,\ldots, K)</span>
<span id="cb42-1064"><a href="#cb42-1064" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-1065"><a href="#cb42-1065" aria-hidden="true" tabindex="-1"></a>Written compactly using matrices, we have </span>
<span id="cb42-1066"><a href="#cb42-1066" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-1067"><a href="#cb42-1067" aria-hidden="true" tabindex="-1"></a>\hat{\X} &amp;=  \Z(\Zm'\Zm)^{-1}\Zm'\Xm,<span class="sc">\\</span></span>
<span id="cb42-1068"><a href="#cb42-1068" aria-hidden="true" tabindex="-1"></a>\hat{\Xm} &amp;=  \Zm(\Zm'\Zm)^{-1}\Zm'\Xm,</span>
<span id="cb42-1069"><a href="#cb42-1069" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-1070"><a href="#cb42-1070" aria-hidden="true" tabindex="-1"></a>where $\hat{\X}$ is a random vector of instruments, and $\hat{\Xm}$ is $n$ random vectors $\hat{\X}$ "stacked" to form a random matrix. If we elect to use these instruments to estimate our model, then </span>
<span id="cb42-1071"><a href="#cb42-1071" aria-hidden="true" tabindex="-1"></a>$$ \IV = <span class="co">[</span><span class="ot">(\Zm(\Zm'\Zm)^{-1}\Zm'\Xm)'\Xm</span><span class="co">]</span>^{-1}<span class="co">[</span><span class="ot">(\Zm(\Zm'\Zm)^{-1}\Zm'\Xm)'\Y</span><span class="co">]</span>.$$</span>
<span id="cb42-1072"><a href="#cb42-1072" aria-hidden="true" tabindex="-1"></a>This estimator is a special case of $\IV$ where we have determined the $K$ instruments via linear projection, and is known as two-stage least squares.</span>
<span id="cb42-1073"><a href="#cb42-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1074"><a href="#cb42-1074" aria-hidden="true" tabindex="-1"></a>:::{#def-}</span>
<span id="cb42-1075"><a href="#cb42-1075" aria-hidden="true" tabindex="-1"></a>The &lt;span style="color:red"&gt;**_two-stage least squares (2SLS) estimator_**&lt;/span&gt; is defined as </span>
<span id="cb42-1076"><a href="#cb42-1076" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-1077"><a href="#cb42-1077" aria-hidden="true" tabindex="-1"></a>\TSLS(\Xm, \Zm, \Y) &amp;= <span class="co">[</span><span class="ot">\Xm'\Zm(\Zm'\Zm)^{-1}\Zm'\Xm</span><span class="co">]</span>^{-1}\Xm'\Zm(\Zm'\Zm)^{-1}\Zm'\Y= <span class="co">[</span><span class="ot">\hat{\Xm}'\Xm</span><span class="co">]</span>^{-1}\hat{\Xm}'\Y,<span class="sc">\\</span></span>
<span id="cb42-1078"><a href="#cb42-1078" aria-hidden="true" tabindex="-1"></a>                 \hat{\Xm} &amp;=  \Zm(\Zm'\Zm)^{-1}\Zm'\Xm.   </span>
<span id="cb42-1079"><a href="#cb42-1079" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-1080"><a href="#cb42-1080" aria-hidden="true" tabindex="-1"></a>Calculating $\hat{\Xm}$ via OLS is referred to as the &lt;span style="color:red"&gt;**_first stage_**&lt;/span&gt;, while calculating $\IV$ using $\hat{\Xm}$ is the &lt;span style="color:red"&gt;**_second stage_**&lt;/span&gt;. It can be useful to define the projection matrix associated with the first stage, </span>
<span id="cb42-1081"><a href="#cb42-1081" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-1082"><a href="#cb42-1082" aria-hidden="true" tabindex="-1"></a>\mathbb P_{\Zm} &amp;= \Zm(\Zm'\Zm)^{-1}\Zm'<span class="sc">\\</span></span>
<span id="cb42-1083"><a href="#cb42-1083" aria-hidden="true" tabindex="-1"></a> \hat{\Xm} &amp; = \mathbb P_{\Zm}\Xm.</span>
<span id="cb42-1084"><a href="#cb42-1084" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-1085"><a href="#cb42-1085" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-1086"><a href="#cb42-1086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1087"><a href="#cb42-1087" aria-hidden="true" tabindex="-1"></a>The name "two-stage least squares" can be a bit misleading depending on how it is presented. It's very common to think of each stage of 2SLS as an application of OLS. In the first stage we perform OLS to calculate the instruments $\hat{\X}$, and then regress $Y$ on $\hat{\X}$ via OLS in the second stage. At first these seems at odds with our definition, because the second stage relies on the IV estimator, but it is equivalent in a sense. We'll explore this in depth in Example \@ref(exm:se).</span>
<span id="cb42-1088"><a href="#cb42-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1089"><a href="#cb42-1089" aria-hidden="true" tabindex="-1"></a>:::{#exm-}</span>
<span id="cb42-1090"><a href="#cb42-1090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1091"><a href="#cb42-1091" aria-hidden="true" tabindex="-1"></a><span class="fu">## OLS as 2SLS</span></span>
<span id="cb42-1092"><a href="#cb42-1092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1093"><a href="#cb42-1093" aria-hidden="true" tabindex="-1"></a>Consider the situation from Example \@ref(exm:ref3) where $\X$ is comprised of entirely exogenous regressors. In this case our vector of instruments is actually a $L+K$ vector $<span class="co">[</span><span class="ot">\X,\Z</span><span class="co">]</span>$. Instead of directly calculating</span>
<span id="cb42-1094"><a href="#cb42-1094" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-1095"><a href="#cb42-1095" aria-hidden="true" tabindex="-1"></a>\hat{\Xm} &amp;= <span class="co">[</span><span class="ot">\Xm, \Zm</span><span class="co">]([\Xm, \Zm]'[\Xm, \Zm])</span>^{-1}<span class="co">[</span><span class="ot">\Xm, \Zm</span><span class="co">]</span>'\Xm,<span class="sc">\\</span></span>
<span id="cb42-1096"><a href="#cb42-1096" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-1097"><a href="#cb42-1097" aria-hidden="true" tabindex="-1"></a>we can intuit the result of the first stage. If we regress $X_j$ on $X_1,\ldots, X_j,\ldots,Z_1,\ldots,Z_L$, then all coefficients should be zero except that associated with the independent variable $X_j$ which will be 1. Therefore the OLS estimates from stage one should be a $L \times K$ matrix where the first $K$ rows are a diagonal matrix of $1$'s and the bottom $L - K$ rows are 0. If we multiply $<span class="co">[</span><span class="ot">\Xm, \Zm</span><span class="co">]</span>$ by this, then we have </span>
<span id="cb42-1098"><a href="#cb42-1098" aria-hidden="true" tabindex="-1"></a>$$ \hat{\Xm} = \mathbf 1\Xm + \zer \Zm = \Xm.$$</span>
<span id="cb42-1099"><a href="#cb42-1099" aria-hidden="true" tabindex="-1"></a>This gives </span>
<span id="cb42-1100"><a href="#cb42-1100" aria-hidden="true" tabindex="-1"></a>$$ \TSLS = <span class="co">[</span><span class="ot">\hat{\Xm}'\Xm</span><span class="co">]</span>^{-1}\hat{\Xm}'\Y = <span class="co">[</span><span class="ot">{\Xm}'\Xm</span><span class="co">]</span>^{-1}{\Xm}'\Y = \OLS.$$</span>
<span id="cb42-1101"><a href="#cb42-1101" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-1102"><a href="#cb42-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1103"><a href="#cb42-1103" aria-hidden="true" tabindex="-1"></a>:::{#exm-}</span>
<span id="cb42-1104"><a href="#cb42-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1105"><a href="#cb42-1105" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exactly Identified Case</span></span>
<span id="cb42-1106"><a href="#cb42-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1107"><a href="#cb42-1107" aria-hidden="true" tabindex="-1"></a>In the event that $L = K$, there is no </span>
<span id="cb42-1108"><a href="#cb42-1108" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-1109"><a href="#cb42-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1110"><a href="#cb42-1110" aria-hidden="true" tabindex="-1"></a>Because $\TSLS$ is just a special case of $\IV$ using instruments $\hat{\Xm}$, the properties of $\TSLS$ follow directly from those of $\IV$. </span>
<span id="cb42-1111"><a href="#cb42-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1112"><a href="#cb42-1112" aria-hidden="true" tabindex="-1"></a>:::{#thm-}</span>
<span id="cb42-1113"><a href="#cb42-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1114"><a href="#cb42-1114" aria-hidden="true" tabindex="-1"></a><span class="fu">## IV Estimator is Root-n CAN</span></span>
<span id="cb42-1115"><a href="#cb42-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1116"><a href="#cb42-1116" aria-hidden="true" tabindex="-1"></a>If $P_{\bet, \sigma^2} \in \mathcal P_\text{IV}$, then $\TSLS \pto \bet$ and </span>
<span id="cb42-1117"><a href="#cb42-1117" aria-hidden="true" tabindex="-1"></a>$$\TSLS \asim N\left(\bet, \sigma^2\E{\hat{\Xm}'\hat{\Xm}}^{-1}\right) =  N\left(\bet, \frac{\sigma^2}{n}\E{\hat{\X}'\hat{\X}}^{-1}\right).$$ </span>
<span id="cb42-1118"><a href="#cb42-1118" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-1119"><a href="#cb42-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1120"><a href="#cb42-1120" aria-hidden="true" tabindex="-1"></a>:::{.proof}</span>
<span id="cb42-1121"><a href="#cb42-1121" aria-hidden="true" tabindex="-1"></a>We know that $\TSLS$ is Root-n CAN because $\IV$ is. All we need to show is that the asymptotic variance simplifies to the given expression when using instruments $\hat{\X}$.</span>
<span id="cb42-1122"><a href="#cb42-1122" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-1123"><a href="#cb42-1123" aria-hidden="true" tabindex="-1"></a>\text{Avar}(\TSLS) &amp;= \sigma^2\E{\hat{\Xm}\Xm}^{-1}\E{\hat{\Xm}\hat{\Xm}}\E{\Xm'\hat{\Xm}}^{-1}<span class="sc">\\</span></span>
<span id="cb42-1124"><a href="#cb42-1124" aria-hidden="true" tabindex="-1"></a>&amp; = \sigma^2\E{<span class="co">[</span><span class="ot">\Zm(\Zm'\Zm)^{-1}\Zm'\Xm</span><span class="co">]</span>'\Xm}^{-1}\E{<span class="co">[</span><span class="ot">\Zm(\Zm'\Zm)^{-1}\Zm'\Xm</span><span class="co">]</span>'<span class="co">[</span><span class="ot">\Zm(\Zm'\Zm)^{-1}\Zm'\Xm</span><span class="co">]</span>}\E{\Xm'<span class="co">[</span><span class="ot">\Zm(\Zm'\Zm)^{-1}\Zm'\Xm</span><span class="co">]</span>}^{-1}<span class="sc">\\</span></span>
<span id="cb42-1125"><a href="#cb42-1125" aria-hidden="true" tabindex="-1"></a>&amp; = \sigma^2\E{\Xm'\Zm(\Zm'\Zm)^{-1}\Zm'\Xm}^{-1}\text{E}<span class="co">[</span><span class="ot">\Xm'\Zm\underbrace{(\Zm'\Zm)^{-1}\Zm'\Zm}_{\mathbf I}(\Zm'\Zm)^{-1}\Zm'\Xm</span><span class="co">]</span>\E{\Xm'\Zm(\Zm'\Zm)^{-1}\Zm'\Xm}^{-1}<span class="sc">\\</span></span>
<span id="cb42-1126"><a href="#cb42-1126" aria-hidden="true" tabindex="-1"></a> &amp; = \sigma^2\text{E}<span class="co">[</span><span class="ot">\Xm'\underbrace{\Zm\Zm^{-1}}_{\mathbf I}\underbrace{(\Zm')^{-1}\Zm'}_{\mathbf I}\Xm</span><span class="co">]</span>^{-1}\text{E}<span class="co">[</span><span class="ot">\Xm'\underbrace{\Zm\Zm^{-1}}_{\mathbf I}\underbrace{(\Zm')^{-1}\Zm'}_{\mathbf I}\Xm</span><span class="co">]</span>\E{\Xm'\Zm(\Zm'\Zm)^{-1}\Zm'\Xm}^{-1}<span class="sc">\\</span></span>
<span id="cb42-1127"><a href="#cb42-1127" aria-hidden="true" tabindex="-1"></a> &amp; = \sigma^2\underbrace{\text{E}<span class="co">[</span><span class="ot">\Xm'\Xm</span><span class="co">]</span>^{-1}\text{E}<span class="co">[</span><span class="ot">\Xm'\Xm</span><span class="co">]</span>}_{\mathbf I}\E{\Xm'\Zm(\Zm'\Zm)^{-1}\Zm'\Xm}^{-1}<span class="sc">\\</span></span>
<span id="cb42-1128"><a href="#cb42-1128" aria-hidden="true" tabindex="-1"></a> &amp; = \sigma^2\E{\Xm'<span class="co">[</span><span class="ot">\Zm(\Zm'\Zm)^{-1}\Zm'</span><span class="co">]</span>'\Zm(\Zm'\Zm)^{-1}\Zm'\Xm}^{-1} &amp; (\Zm (\Zm'\Zm)^{-1}\Zm'\text{ sym. and idem.}) <span class="sc">\\</span></span>
<span id="cb42-1129"><a href="#cb42-1129" aria-hidden="true" tabindex="-1"></a> &amp; = \sigma^2\E{<span class="co">[</span><span class="ot">\Zm(\Zm'\Zm)^{-1}\Zm'\Xm</span><span class="co">]</span>'<span class="co">[</span><span class="ot">\Zm(\Zm'\Zm)^{-1}\Zm'\Xm</span><span class="co">]</span>}^{-1}<span class="sc">\\</span></span>
<span id="cb42-1130"><a href="#cb42-1130" aria-hidden="true" tabindex="-1"></a>&amp; = \sigma^2\E{\hat{\Xm}'\hat{\Xm}}^{-1} &amp; (\hat{\Xm} = \Zm(\Zm'\Zm)^{-1}\Zm'\Xm)</span>
<span id="cb42-1131"><a href="#cb42-1131" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-1132"><a href="#cb42-1132" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-1133"><a href="#cb42-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1134"><a href="#cb42-1134" aria-hidden="true" tabindex="-1"></a>The motivation for introducing $\TSLS$ was not all choices of instruments being equal with respect to efficiency, and perhaps the instruments which result from projecting $\X$ onto $\Z$ result in an IV estimator which is more efficient than most others. This IV estimator is not just more efficient that most others, it is *the* most efficient IV estimator. The proof of this is adapted from @wooldridge2010econometric.  </span>
<span id="cb42-1135"><a href="#cb42-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1136"><a href="#cb42-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1137"><a href="#cb42-1137" aria-hidden="true" tabindex="-1"></a>:::{#thm-eff2}</span>
<span id="cb42-1138"><a href="#cb42-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1139"><a href="#cb42-1139" aria-hidden="true" tabindex="-1"></a><span class="fu">## 2SLS is Asymptotically Efficient</span></span>
<span id="cb42-1140"><a href="#cb42-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1141"><a href="#cb42-1141" aria-hidden="true" tabindex="-1"></a>If $P_{\bet, \sigma^2} \in \mathcal P_\text{IV}$, then $\TSLS$ is efficient in the class of $\IV$ estimators calculated using instruments linear in $\Z$. </span>
<span id="cb42-1142"><a href="#cb42-1142" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-1143"><a href="#cb42-1143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1144"><a href="#cb42-1144" aria-hidden="true" tabindex="-1"></a>:::{.proof}</span>
<span id="cb42-1145"><a href="#cb42-1145" aria-hidden="true" tabindex="-1"></a>Suppose $\tilde{\bet}$ is some arbitrary IV estimator which is linear in instruments $\Z$. The instruments for this estimator can be written as $\tilde{\X} = \Z\F$ for some $L\times K$ matrix $\F$. We want to show that $\avar{\TSLS}$ is "less than" $\avar{\tilde{\bet}}$. Both of these objects are matrices, so "less" than translates to the difference being PSD. This difference is </span>
<span id="cb42-1146"><a href="#cb42-1146" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-1147"><a href="#cb42-1147" aria-hidden="true" tabindex="-1"></a>\avar{\tilde{\bet}} - \avar{\TSLS} &amp; =\frac{\sigma^2}{n}\E{\tilde{\X}'\X}^{-1}\E{\tilde{\X}'\tilde{\X}}\E{\X'\tilde{\X}}^{-1} -  \frac{\sigma^2}{n}\E{\hat{\X}'\hat{\X}}^{-1}<span class="sc">\\</span>&amp; = \frac{\sigma^2}{n}\left<span class="co">[</span><span class="ot">\E{\tilde{\X}'\X}^{-1}\E{\tilde{\X}'\tilde{\X}}\E{\X'\tilde{\X}}^{-1} - \E{\hat{\X}'\hat{\X}}^{-1}\right</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb42-1148"><a href="#cb42-1148" aria-hidden="true" tabindex="-1"></a>&amp; = \frac{\sigma^2}{n}\left<span class="co">[</span><span class="ot">\left[\E{\tilde{\X}'\X}\E{\tilde{\X}'\tilde{\X}}^{-1}\E{\X'\tilde{\X}}\right]^{-1} - \E{\hat{\X}'\hat{\X}}^{-1}\right</span><span class="co">]</span> &amp; (\text{properties of inversion})</span>
<span id="cb42-1149"><a href="#cb42-1149" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-1150"><a href="#cb42-1150" aria-hidden="true" tabindex="-1"></a>Accounting for the bracketed term being the difference of two inverted matrices, this matrix will be PSD if and only if the following is PSD: </span>
<span id="cb42-1151"><a href="#cb42-1151" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb42-1152"><a href="#cb42-1152" aria-hidden="true" tabindex="-1"></a>\E{\hat{\X}'\hat{\X}} - \E{\tilde{\X}'\X}\E{\tilde{\X}'\tilde{\X}}^{-1}\E{\X'\tilde{\X}}  (<span class="sc">\#</span>eq:diff).</span>
<span id="cb42-1153"><a href="#cb42-1153" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb42-1154"><a href="#cb42-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1155"><a href="#cb42-1155" aria-hidden="true" tabindex="-1"></a>We can show this by relying on a certain "trick". Define the difference between the regressors $\X$ and 2SLS instruments $\hat{\X}$ as $\mathbf r = \hat{\X} -  \X$. This remainder term $\mathbf r$ is uncorrelated with $\Z$:</span>
<span id="cb42-1156"><a href="#cb42-1156" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-1157"><a href="#cb42-1157" aria-hidden="true" tabindex="-1"></a>\E{\Z'\mathbf r} &amp; = \E{\Z'\hat{\X}} - \E{\Z'\X}<span class="sc">\\</span></span>
<span id="cb42-1158"><a href="#cb42-1158" aria-hidden="true" tabindex="-1"></a>&amp; = \E{\Z'\Z(\Z'\Z)^{-1}\Z'\X} - \E{\Z'\X} &amp; (\hat{\X} = \Z(\Z'\Z)^{-1}\Z'\X)<span class="sc">\\</span></span>
<span id="cb42-1159"><a href="#cb42-1159" aria-hidden="true" tabindex="-1"></a>&amp; = \E{\Z'\X} - \E{\Z'\X}<span class="sc">\\</span></span>
<span id="cb42-1160"><a href="#cb42-1160" aria-hidden="true" tabindex="-1"></a>&amp; = \zer</span>
<span id="cb42-1161"><a href="#cb42-1161" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-1162"><a href="#cb42-1162" aria-hidden="true" tabindex="-1"></a>As a result, $\tilde{ \X}$ and $\mathbf r$ are uncorrelated. $$\E{\tilde{ \X}'\mathbf r} = \E{(\Z\F')\mathbf r}= \mathbf F'\underbrace{\E{\Z'\mathbf r}}_\zer = \zer$$ Now we use these expectations and the definition of $\mathbf r$ to arrive at our "trick".</span>
<span id="cb42-1163"><a href="#cb42-1163" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-1164"><a href="#cb42-1164" aria-hidden="true" tabindex="-1"></a>&amp;\E{\tilde{ \X}'\mathbf r} = \zer <span class="sc">\\</span></span>
<span id="cb42-1165"><a href="#cb42-1165" aria-hidden="true" tabindex="-1"></a>\implies &amp; \E{\tilde{ \X}'(\hat{\X} -  \X)} = \zer &amp; (\mathbf r = \hat{\X} -  \X)<span class="sc">\\</span></span>
<span id="cb42-1166"><a href="#cb42-1166" aria-hidden="true" tabindex="-1"></a>\implies &amp; \E{\tilde{ \X}'\hat{\X}} - \E{\tilde{ \X}'\X} = \zer<span class="sc">\\</span></span>
<span id="cb42-1167"><a href="#cb42-1167" aria-hidden="true" tabindex="-1"></a>\implies &amp; \E{\tilde{ \X}'\hat{\X}} = \E{\tilde{ \X}'\X}</span>
<span id="cb42-1168"><a href="#cb42-1168" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-1169"><a href="#cb42-1169" aria-hidden="true" tabindex="-1"></a>Using this equality, we can rewrite the difference in Equation \@ref(eq:diff) in terms of $\tilde{\X}$ and $\hat{\X}$ only.</span>
<span id="cb42-1170"><a href="#cb42-1170" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb42-1171"><a href="#cb42-1171" aria-hidden="true" tabindex="-1"></a>\E{\hat{\X}'\hat{\X}} - \E{\hat{\X}'\tilde{\X}}\E{\tilde{\X}'\tilde{\X}}^{-1}\E{\tilde{\X}'\hat{\X}}  (<span class="sc">\#</span>eq:diff2).</span>
<span id="cb42-1172"><a href="#cb42-1172" aria-hidden="true" tabindex="-1"></a>\end{equation} This may seem like a random equation, but it's very special if you consider the linear projection of $\hat{\X}$ onto $\tilde{\X}$. This projection is given by the coefficient $\boldsymbol\gamma = \E{\tilde{\X}'\tilde{\X}}^{-1}\E{\tilde{\X}'\hat{\X}},$ which happens to show up in \@ref(eq:diff2). The errors associated with this linear projection are given as $\boldsymbol \nu = \hat{\X} - \tilde{\X}\boldsymbol\gamma$, and have an expected value of $\zer$ by the definition of $\boldsymbol\gamma$ and linear projection. But what is the expected value of these errors squared? </span>
<span id="cb42-1173"><a href="#cb42-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1174"><a href="#cb42-1174" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-1175"><a href="#cb42-1175" aria-hidden="true" tabindex="-1"></a> \boldsymbol \nu' \boldsymbol \nu&amp; = <span class="co">[</span><span class="ot">\hat{\X} - \tilde{\X}\boldsymbol\gamma</span><span class="co">]</span>'<span class="co">[</span><span class="ot">\hat{\X} - \tilde{\X}\boldsymbol\gamma</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb42-1176"><a href="#cb42-1176" aria-hidden="true" tabindex="-1"></a>&amp; = \hat{\X}'\hat{\X} - 2\boldsymbol\gamma'\tilde{\X}'\hat{\X} + \boldsymbol\gamma'\tilde{\X}'\tilde{\X}\boldsymbol\gamma<span class="sc">\\</span></span>
<span id="cb42-1177"><a href="#cb42-1177" aria-hidden="true" tabindex="-1"></a>\E{ \boldsymbol \nu' \boldsymbol \nu} &amp; = \E{\hat{\X}'\hat{\X}} - 2\boldsymbol\gamma'\E{\tilde{\X}'\hat{\X}} + \boldsymbol\gamma'\E{\tilde{\X}'\tilde{\X}}\boldsymbol\gamma &amp; (\boldsymbol\gamma \text{ is a constant})<span class="sc">\\</span></span>
<span id="cb42-1178"><a href="#cb42-1178" aria-hidden="true" tabindex="-1"></a>&amp; = \E{\hat{\X}'\hat{\X}} - 2\left<span class="co">[</span><span class="ot">\E{\tilde{\X}'\tilde{\X}}^{-1}\E{\tilde{\X}'\hat{\X}}\right</span><span class="co">]</span>'\E{\tilde{\X}'\hat{\X}} + \left<span class="co">[</span><span class="ot">\E{\tilde{\X}'\tilde{\X}}^{-1}\E{\tilde{\X}'\hat{\X}}\right</span><span class="co">]</span>'\E{\tilde{\X}'\tilde{\X}} \left<span class="co">[</span><span class="ot">\E{\tilde{\X}'\tilde{\X}}^{-1}\E{\tilde{\X}'\hat{\X}}\right</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb42-1179"><a href="#cb42-1179" aria-hidden="true" tabindex="-1"></a>&amp; = \E{\hat{\X}'\hat{\X}} - 2\E{\tilde{\X}\hat{\X}'}\E{\tilde{\X}'\tilde{\X}}^{-1}\E{\tilde{\X}'\hat{\X}} + \E{\tilde{\X}\hat{\X}'}\underbrace{\E{\tilde{\X}'\tilde{\X}}^{-1}\E{\tilde{\X}'\tilde{\X}}}_{\mathbf I} \E{\tilde{\X}'\tilde{\X}}^{-1}\E{\tilde{\X}'\hat{\X}}<span class="sc">\\</span></span>
<span id="cb42-1180"><a href="#cb42-1180" aria-hidden="true" tabindex="-1"></a>&amp; = \E{\hat{\X}'\hat{\X}} - (2-1)\E{\tilde{\X}\hat{\X}'}\E{\tilde{\X}'\tilde{\X}}^{-1}\E{\tilde{\X}'\hat{\X}} <span class="sc">\\</span></span>
<span id="cb42-1181"><a href="#cb42-1181" aria-hidden="true" tabindex="-1"></a>&amp; = \E{\hat{\X}'\hat{\X}} - \E{\hat{\X}'\tilde{\X}}\E{\tilde{\X}'\tilde{\X}}^{-1}\E{\tilde{\X}'\hat{\X}}</span>
<span id="cb42-1182"><a href="#cb42-1182" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-1183"><a href="#cb42-1183" aria-hidden="true" tabindex="-1"></a>Equations \@ref(eq:diff) and \@ref(eq:diff2) are the expectation of the sum of squared errors associated with the linear projection of $\hat{\X}$ onto $\tilde{\X}$, meaning the matrix in question must be PSD!^<span class="co">[</span><span class="ot">Intuitively, this matrix must be PSD in the same way the sum of squared numbers cannot be negative.</span><span class="co">]</span> This gives the desired result.</span>
<span id="cb42-1184"><a href="#cb42-1184" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-1185"><a href="#cb42-1185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1186"><a href="#cb42-1186" aria-hidden="true" tabindex="-1"></a>In Section \@ref(generalized-method-of-moments) we'll see another way to show this result that is a bit more intuitive. </span>
<span id="cb42-1187"><a href="#cb42-1187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1188"><a href="#cb42-1188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1189"><a href="#cb42-1189" aria-hidden="true" tabindex="-1"></a>:::{#exm-se}</span>
<span id="cb42-1190"><a href="#cb42-1190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1191"><a href="#cb42-1191" aria-hidden="true" tabindex="-1"></a><span class="fu">## What's in A Name?</span></span>
<span id="cb42-1192"><a href="#cb42-1192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1193"><a href="#cb42-1193" aria-hidden="true" tabindex="-1"></a>Let's estimate the model from \@ref(exm:ex4) via 2SLS. We already have defined a function ```IV()``` to calculate $\IV$, so we can just use pass the instruments $\hat {\X}$ to this function to perform 2SLS.</span>
<span id="cb42-1194"><a href="#cb42-1194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1197"><a href="#cb42-1197" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1198"><a href="#cb42-1198" aria-hidden="true" tabindex="-1"></a>TSLS <span class="ot">&lt;-</span> <span class="cf">function</span>(y,X,Z){</span>
<span id="cb42-1199"><a href="#cb42-1199" aria-hidden="true" tabindex="-1"></a>  X_hat <span class="ot">&lt;-</span> Z <span class="sc">%*%</span> <span class="fu">solve</span>(<span class="fu">t</span>(Z) <span class="sc">%*%</span> Z) <span class="sc">%*%</span> <span class="fu">t</span>(Z) <span class="sc">%*%</span> X</span>
<span id="cb42-1200"><a href="#cb42-1200" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">IV</span>(y, X, X_hat)</span>
<span id="cb42-1201"><a href="#cb42-1201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb42-1202"><a href="#cb42-1202" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-1203"><a href="#cb42-1203" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1204"><a href="#cb42-1204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1205"><a href="#cb42-1205" aria-hidden="true" tabindex="-1"></a>For a simulated sample of size $n=50$ let's estimate the model using ```TSLS()```.  </span>
<span id="cb42-1206"><a href="#cb42-1206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1209"><a href="#cb42-1209" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1210"><a href="#cb42-1210" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">sim_endog_linear_model</span>(<span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb42-1211"><a href="#cb42-1211" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">50</span>,</span>
<span id="cb42-1212"><a href="#cb42-1212" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_vec =</span> <span class="fu">c</span>(rmvnorm),</span>
<span id="cb42-1213"><a href="#cb42-1213" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_params_list =</span> <span class="fu">list</span>(</span>
<span id="cb42-1214"><a href="#cb42-1214" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb42-1215"><a href="#cb42-1215" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">0</span>),</span>
<span id="cb42-1216"><a href="#cb42-1216" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">30</span>,<span class="dv">7</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">7</span>,<span class="dv">50</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">4</span>)</span>
<span id="cb42-1217"><a href="#cb42-1217" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb42-1218"><a href="#cb42-1218" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-1219"><a href="#cb42-1219" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-1220"><a href="#cb42-1220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1221"><a href="#cb42-1221" aria-hidden="true" tabindex="-1"></a><span class="fu">TSLS</span>(model<span class="sc">$</span>y, model<span class="sc">$</span>X, model<span class="sc">$</span>Z) <span class="sc">%&gt;%</span> </span>
<span id="cb42-1222"><a href="#cb42-1222" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span>
<span id="cb42-1223"><a href="#cb42-1223" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1224"><a href="#cb42-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1225"><a href="#cb42-1225" aria-hidden="true" tabindex="-1"></a>This is not the only way we could calculate $\TSLS$. Note that $\Zm(\Zm'\Zm)^{-1}\Zm'$ is symmetric and idempotent, so </span>
<span id="cb42-1226"><a href="#cb42-1226" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-1227"><a href="#cb42-1227" aria-hidden="true" tabindex="-1"></a>\TSLS &amp; = \IV(\Xm, \hat{\Xm}, \Y)<span class="sc">\\</span></span>
<span id="cb42-1228"><a href="#cb42-1228" aria-hidden="true" tabindex="-1"></a>&amp; = <span class="co">[</span><span class="ot">\hat{\Xm}'{\Xm}</span><span class="co">]</span>^{-1}\hat{\Xm}'\Y<span class="sc">\\</span></span>
<span id="cb42-1229"><a href="#cb42-1229" aria-hidden="true" tabindex="-1"></a>&amp; = <span class="co">[</span><span class="ot">\Xm'\Zm(\Zm'\Zm)^{-1}\Zm'\Xm</span><span class="co">]</span>^{-1}\Xm'\Zm(\Zm'\Zm)^{-1}\Zm'\Y<span class="sc">\\</span></span>
<span id="cb42-1230"><a href="#cb42-1230" aria-hidden="true" tabindex="-1"></a>&amp; = <span class="co">[</span><span class="ot">\Xm'[\Zm(\Zm'\Zm)^{-1}\Zm']\Zm(\Zm'\Zm)^{-1}\Zm'\Xm</span><span class="co">]</span>^{-1}\Xm'\Zm(\Zm'\Zm)^{-1}\Zm'\Y<span class="sc">\\</span></span>
<span id="cb42-1231"><a href="#cb42-1231" aria-hidden="true" tabindex="-1"></a>&amp; = [<span class="co">[</span><span class="ot">\Zm(\Zm'\Zm)^{-1}\Zm'\Xm</span><span class="co">]</span>'<span class="co">[</span><span class="ot">\Zm(\Zm'\Zm)^{-1}\Zm'\Xm</span><span class="co">]</span>]^{-1}\Xm'\Zm(\Zm'\Zm)^{-1}\Zm'\Y<span class="sc">\\</span></span>
<span id="cb42-1232"><a href="#cb42-1232" aria-hidden="true" tabindex="-1"></a>&amp; = <span class="co">[</span><span class="ot">\hat{\Xm}'\hat{\Xm}</span><span class="co">]</span>^{-1}\hat{\Xm}'\Y<span class="sc">\\</span></span>
<span id="cb42-1233"><a href="#cb42-1233" aria-hidden="true" tabindex="-1"></a>&amp; = \OLS(\hat{\Xm}, \Y).</span>
<span id="cb42-1234"><a href="#cb42-1234" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-1235"><a href="#cb42-1235" aria-hidden="true" tabindex="-1"></a>So we can interpret $\TSLS$ in one of two ways:</span>
<span id="cb42-1236"><a href="#cb42-1236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1237"><a href="#cb42-1237" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Use $\OLS(\Zm, \Xm)$ to calculate $\hat{\Xm} = \Zm\OLS(\Zm, \Xm)$ (stage 1), followed by $\IV(\Xm, \hat{\Xm}, \Y)$ (stage 2). This is how our ```TSLS()``` function works.</span>
<span id="cb42-1238"><a href="#cb42-1238" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Use $\OLS(\Zm, \Xm)$ to calculate $\hat{\Xm} = \Zm\OLS(\Zm, \Xm)$ (stage 1), followed by $\OLS(\hat{\Xm}, \Y)$ (stage 2).</span>
<span id="cb42-1239"><a href="#cb42-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1240"><a href="#cb42-1240" aria-hidden="true" tabindex="-1"></a>The second interpretation is where 2SLS gets its name -- we run OLS twice. But what happens when we implement $\TSLS$ this way?</span>
<span id="cb42-1241"><a href="#cb42-1241" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb42-1244"><a href="#cb42-1244" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1245"><a href="#cb42-1245" aria-hidden="true" tabindex="-1"></a>stage1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(x2 <span class="sc">~</span> z2 <span class="sc">+</span> z3, <span class="at">data =</span> model<span class="sc">$</span>observed_data)</span>
<span id="cb42-1246"><a href="#cb42-1246" aria-hidden="true" tabindex="-1"></a>X_hat <span class="ot">&lt;-</span> stage1<span class="sc">$</span>fitted.values</span>
<span id="cb42-1247"><a href="#cb42-1247" aria-hidden="true" tabindex="-1"></a>stage2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(model<span class="sc">$</span>y <span class="sc">~</span> X_hat) </span>
<span id="cb42-1248"><a href="#cb42-1248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1249"><a href="#cb42-1249" aria-hidden="true" tabindex="-1"></a>stage2 <span class="sc">%&gt;%</span> </span>
<span id="cb42-1250"><a href="#cb42-1250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb42-1251"><a href="#cb42-1251" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span>
<span id="cb42-1252"><a href="#cb42-1252" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1253"><a href="#cb42-1253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1254"><a href="#cb42-1254" aria-hidden="true" tabindex="-1"></a>We get the same exact estimates (which we already showed would be the case), but our standard errors don't coincide with those given by ```TSLS()```. What is happening here? </span>
<span id="cb42-1255"><a href="#cb42-1255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1256"><a href="#cb42-1256" aria-hidden="true" tabindex="-1"></a>When we run ```lm(y ~ X_hat)```, we are estimating the model associated with linear projection model $Y = \hat{\X}\boldsymbol \delta + \nu$. The function ```lm()``` has no way of knowing that this is the second step in an estimation process aimed at estimating the structural linear model $Y = \X\bet + \varepsilon$. It just happens that $\hat{\X}$ is defined such that the population parameters satisfy $\boldsymbol \delta = \bet$. When ```lm()``` goes to calculate the standard errors, it calculates the residuals associated with the model $Y = \hat{\X}\boldsymbol \delta + \nu$. These errors have no structural/economic meaning, and we don't care about them at all (for this purpose). We really want the residuals associated with the error $\varepsilon$ in the actual IV model $Y = \X\bet + \varepsilon$, and these residuals are not the same!</span>
<span id="cb42-1257"><a href="#cb42-1257" aria-hidden="true" tabindex="-1"></a>$$ \hat{\mathbf u} = \Y - \hat{\Xm}\OLS(\hat{\Xm}, \Y) \neq \Y - \Xm\OLS(\hat{\Xm}, \Y) = \Y- \Xm\IV(\Xm, \hat{\Xm}, \Y) = \hat{\e}$$</span>
<span id="cb42-1258"><a href="#cb42-1258" aria-hidden="true" tabindex="-1"></a>The moral of the story is that when we are calculating the residuals we need to be very deliberate and remember the actual model we are estimating. Fortunately, any statistical software with an implementation for $\TSLS$ will calculate the correct standard errors, which is why it's best to not do each step "by hand" if you favor the interpretation of $\TSLS$ as two OLS regressions.</span>
<span id="cb42-1259"><a href="#cb42-1259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1262"><a href="#cb42-1262" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1263"><a href="#cb42-1263" aria-hidden="true" tabindex="-1"></a><span class="fu">ivreg</span>(y <span class="sc">~</span> x2 <span class="sc">|</span> z2 <span class="sc">+</span> z3, <span class="at">data =</span> model<span class="sc">$</span>observed_data) <span class="sc">%&gt;%</span> </span>
<span id="cb42-1264"><a href="#cb42-1264" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb42-1265"><a href="#cb42-1265" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span>
<span id="cb42-1266"><a href="#cb42-1266" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1267"><a href="#cb42-1267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1268"><a href="#cb42-1268" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-1269"><a href="#cb42-1269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1270"><a href="#cb42-1270" aria-hidden="true" tabindex="-1"></a>The example emphasizes something that has been mentioned in passing before. The models estimated in the first and second stage, $\X = \Z\boldsymbol + \gamma$ and  $Y = \hat{\X}\boldsymbol \delta + \nu$, are entirely void of structural meaning. Nevertheless it is useful to us because it expresses the outcome of interest in terms of exogenous variables $\hat{\X}$ and $\Z$. We refer to such an equation as the **_reduced form_** of the structural model $Y = \X\bet + \ep$. We'll talk about this term much more in Section \@ref(endogeniety-ii-simultaneous-equation-models).</span>
<span id="cb42-1271"><a href="#cb42-1271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1272"><a href="#cb42-1272" aria-hidden="true" tabindex="-1"></a><span class="fu">## Testing Hypotheses</span></span>
<span id="cb42-1273"><a href="#cb42-1273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1274"><a href="#cb42-1274" aria-hidden="true" tabindex="-1"></a>At this point, we have just assumed we know how to select between the classical linear model $\mathcal P_\text{LM}$ and the linear IV model $\mathcal P_\text{IV}$, but in practice we want to be able to form hypothesis tests that inform our selection between the two models. In particular we want to be able to test: </span>
<span id="cb42-1275"><a href="#cb42-1275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1276"><a href="#cb42-1276" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Are our regressors exogenous, i.e $H_0: \E{\X'\ep} = \zer$?</span>
<span id="cb42-1277"><a href="#cb42-1277" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Are our instruments valid, i.e...</span>
<span id="cb42-1278"><a href="#cb42-1278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1279"><a href="#cb42-1279" aria-hidden="true" tabindex="-1"></a><span class="fu">### Durbin–Wu–Hausman Test</span></span>
<span id="cb42-1280"><a href="#cb42-1280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1281"><a href="#cb42-1281" aria-hidden="true" tabindex="-1"></a>We'll start with considering tests for exogenous/endogenous regressors. One sign that our model contains endogenous regressors is if there is a significant difference between $\OLS$ and $\IV$. This is why it's always a good idea to estimate a model with $\OLS$ even if you think regressors are endogenous. It provides a good reference to compare IV estimates with. In fact, comparing $\OLS$ and $\IV$ serve as the basis for one of the most common tests for endogeneity as formalized by @hausman1978specification.^<span class="co">[</span><span class="ot">This happens to be one of the most cited papers in all of economics.</span><span class="co">]</span> </span>
<span id="cb42-1282"><a href="#cb42-1282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1283"><a href="#cb42-1283" aria-hidden="true" tabindex="-1"></a>In the face of endogeneity, $\OLS$ is an abject failure in light of its inconsistency. Fortunately, $\IV$ is consistent when $\X$ is endogenous. Furthermore, $\IV$ is also consistent when $\X$ is exogenous, as the instruments $\Z$ are still valid and relevant. In other words, if $\X$ is exogenous, then $\OLS\pto \bet$ *and* $\IV\pto\bet$, so </span>
<span id="cb42-1284"><a href="#cb42-1284" aria-hidden="true" tabindex="-1"></a>$$ \OLS - \IV \pto \zer.$$ This suggests the following: </span>
<span id="cb42-1285"><a href="#cb42-1285" aria-hidden="true" tabindex="-1"></a>$$ H_0: \X \text{ exogenous} \iff H_0:\plim\left(\OLS - \IV\right) = \zer.$$ We can construct a Wald test statistic</span>
<span id="cb42-1286"><a href="#cb42-1286" aria-hidden="true" tabindex="-1"></a>$$ W = (\OLS - \IV)' \left<span class="co">[</span><span class="ot">\widehat{\text{Avar}}(\OLS - \IV) \right</span><span class="co">]</span>^{-1}(\OLS - \IV),$$ but we will run into a roadblock in the form of $\avar{\OLS - \IV}$. If we expand this, we have </span>
<span id="cb42-1287"><a href="#cb42-1287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1288"><a href="#cb42-1288" aria-hidden="true" tabindex="-1"></a>$$ \avar{\OLS - \IV} = \avar{\IV} + \avar{\OLS} - 2\text{Acov}\left(\IV,\OLS\right),$$ as $\IV$ and $\OLS$ are presumably correlated. We don't have a formula for the covariance of these estimators handy, and deriving one would be a pain. Fortunately, we don't have to, because Lemma 2.1 of @hausman1978specification asserts that the covariance term is such that </span>
<span id="cb42-1289"><a href="#cb42-1289" aria-hidden="true" tabindex="-1"></a>$$  \avar{\OLS - \IV} =  \avar{\IV} - \avar{\OLS}$$</span>
<span id="cb42-1290"><a href="#cb42-1290" aria-hidden="true" tabindex="-1"></a>due to $\OLS$ being efficient relative to $\IV$.^<span class="co">[</span><span class="ot">In Example \@ref(exm:ref3) we saw that $\OLS$ is more efficient than $\IV$ in the event that our regressors are exogenous. This was formalized in Theorem \@ref(thm:eff2), because in the event that all regressors $\X$ are exogenous and we have non-trivial instruments $\Z$, then $\TSLS$ "picks" the optimal trivial instruments $\X$ and our estimator reduces to $\OLS$.</span><span class="co">]</span> This is a particular useful equality, and interesting result in it's own right. @hansen2022econometrics refers to it as the "Hausman equality", and gives details about it in Section 8.11. This gives the test statistic</span>
<span id="cb42-1291"><a href="#cb42-1291" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-1292"><a href="#cb42-1292" aria-hidden="true" tabindex="-1"></a>W &amp;= (\OLS - \IV)'\left<span class="co">[</span><span class="ot">\widehat{\text{Avar}}(\IV) - \widehat{\text{Avar}}(\OLS)\right</span><span class="co">]</span>^{-1} (\OLS - \IV).</span>
<span id="cb42-1293"><a href="#cb42-1293" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-1294"><a href="#cb42-1294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1295"><a href="#cb42-1295" aria-hidden="true" tabindex="-1"></a>Unfortunately, the term corresponding to the asymptotic variance will likely fail to be invertible. Unless $\X$ and $\Z$ contain no common variables, some column of  $(\hat{\Xm}'\hat{\Xm})^{-1} - (\Xm'\Xm)^{-1}$ will be a linear combination of other columns. For example, if our model contains an intercept, than we cannot use this statistic, as $\X$ and $\Z$ will both contain a column of 1's. This rules out just about every single situation we would ever want to consider. To address this shortcoming, we can take the <span class="co">[</span><span class="ot">pseudo-inverse</span><span class="co">](https://mathworld.wolfram.com/Moore-PenroseMatrixInverse.html)</span> of this matrix.</span>
<span id="cb42-1296"><a href="#cb42-1296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1297"><a href="#cb42-1297" aria-hidden="true" tabindex="-1"></a>$$W = (\OLS - \IV)'\left<span class="co">[</span><span class="ot">\widehat{\text{Avar}}(\IV) - \widehat{\text{Avar}}(\OLS)\right</span><span class="co">]</span>^+ (\OLS - \IV)$$</span>
<span id="cb42-1298"><a href="#cb42-1298" aria-hidden="true" tabindex="-1"></a>The hypothesis $\OLS - \IV\pto \zer$ is comprised of $K$ separate hypotheses, so it's tempting to conclude  $W\sim \chi_K^2$. Unfortunately, this will only be the case when $\avar{\IV} - \avar{\OLS}$ is invertible, otherwise we will have $W\sim \chi_q^2$ where $q = \text{rank} \left<span class="co">[</span><span class="ot"> \avar{\IV} - \avar{\OLS} \right</span><span class="co">]</span>$.</span>
<span id="cb42-1299"><a href="#cb42-1299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1300"><a href="#cb42-1300" aria-hidden="true" tabindex="-1"></a>:::{#thm-}</span>
<span id="cb42-1301"><a href="#cb42-1301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1302"><a href="#cb42-1302" aria-hidden="true" tabindex="-1"></a><span class="fu">## Hausman Specification Test</span></span>
<span id="cb42-1303"><a href="#cb42-1303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1304"><a href="#cb42-1304" aria-hidden="true" tabindex="-1"></a>Given the hypothesis $H_0:\hat{\thet}_e\pto\thet, \hat{\thet}\pto\thet$ for some asymptotically efficient estimator $\hat{\thet}_e$, the &lt;span style="color:red"&gt;**_Hausman statistic_**&lt;/span&gt; is defined as </span>
<span id="cb42-1305"><a href="#cb42-1305" aria-hidden="true" tabindex="-1"></a>$$H = (\hat{\thet} - \hat{\thet}_e)'\left<span class="co">[</span><span class="ot">\widehat{\text{Avar}}(\hat{\thet}) - \widehat{\text{Avar}}(\hat{\thet}_e)\right</span><span class="co">]</span>^+ (\hat{\thet} - \hat{\thet}_e).$$ Under $H_0$,</span>
<span id="cb42-1306"><a href="#cb42-1306" aria-hidden="true" tabindex="-1"></a>$$ H\sim \chi_q^2$$</span>
<span id="cb42-1307"><a href="#cb42-1307" aria-hidden="true" tabindex="-1"></a>where $q = \text{rank}\left<span class="co">[</span><span class="ot">\avar{ \hat{\thet}} - \avar{ \hat{\thet}_e}\right</span><span class="co">]</span>$. The test associated with this statistic is known as the &lt;span style="color:red"&gt;**_Hausman specification test_**&lt;/span&gt;. </span>
<span id="cb42-1308"><a href="#cb42-1308" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-1309"><a href="#cb42-1309" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb42-1310"><a href="#cb42-1310" aria-hidden="true" tabindex="-1"></a>The Hausman test is far more general that testing for endogeneity, it just happens that testing for endogeneity is a great application of it. That being said, actually calculating $H$ in the context of $\OLS$ and $\IV$ isn't cut and dried. There are a handful of approaches to this, many of which predate @hausman1978specification in fact. @durbin54 and @wu1973alternative independently proposed methods of testing $H_0: \X \text{ exogenous}$ based on the idea of contrasting $\OLS$ with $\IV$. The different flavors in test arise from choices about the estimate of $S^2$ used to calculate $\widehat{\text{Avar}}(\IV)$ and $\widehat{\text{Avar}}(\OLS)$, along with whether the intercept term is included in $\X$ and $\Z$.   </span>
<span id="cb42-1311"><a href="#cb42-1311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1312"><a href="#cb42-1312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1313"><a href="#cb42-1313" aria-hidden="true" tabindex="-1"></a>:::{#exm-}</span>
<span id="cb42-1314"><a href="#cb42-1314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1315"><a href="#cb42-1315" aria-hidden="true" tabindex="-1"></a>test </span>
<span id="cb42-1316"><a href="#cb42-1316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1319"><a href="#cb42-1319" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1320"><a href="#cb42-1320" aria-hidden="true" tabindex="-1"></a>compare_s2 <span class="ot">&lt;-</span> <span class="cf">function</span>(beta, n, dist_vec, dist_params_list, t){</span>
<span id="cb42-1321"><a href="#cb42-1321" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">sim_endog_linear_model</span>(beta, n, dist_vec, dist_params_list)</span>
<span id="cb42-1322"><a href="#cb42-1322" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-1323"><a href="#cb42-1323" aria-hidden="true" tabindex="-1"></a>  K <span class="ot">&lt;-</span> <span class="fu">ncol</span>(model<span class="sc">$</span>X)</span>
<span id="cb42-1324"><a href="#cb42-1324" aria-hidden="true" tabindex="-1"></a>  OLS <span class="ot">&lt;-</span> <span class="fu">lm</span>(model<span class="sc">$</span>y <span class="sc">~</span> model<span class="sc">$</span>X <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb42-1325"><a href="#cb42-1325" aria-hidden="true" tabindex="-1"></a>  IV <span class="ot">&lt;-</span> <span class="fu">ivreg</span>(model<span class="sc">$</span>y <span class="sc">~</span> model<span class="sc">$</span>X <span class="sc">-</span> <span class="dv">1</span> <span class="sc">|</span> model<span class="sc">$</span>Z <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb42-1326"><a href="#cb42-1326" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-1327"><a href="#cb42-1327" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb42-1328"><a href="#cb42-1328" aria-hidden="true" tabindex="-1"></a>    <span class="at">S2_IV =</span> <span class="fu">sum</span>(<span class="fu">residuals</span>(IV)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (n <span class="sc">-</span> K),</span>
<span id="cb42-1329"><a href="#cb42-1329" aria-hidden="true" tabindex="-1"></a>    <span class="at">S2_OLS =</span> <span class="fu">sum</span>(<span class="fu">residuals</span>(OLS)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (n <span class="sc">-</span> K),</span>
<span id="cb42-1330"><a href="#cb42-1330" aria-hidden="true" tabindex="-1"></a>    <span class="at">S2_MLE =</span> <span class="fu">sum</span>(<span class="fu">residuals</span>(OLS)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> n,</span>
<span id="cb42-1331"><a href="#cb42-1331" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter_num =</span> t</span>
<span id="cb42-1332"><a href="#cb42-1332" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-1333"><a href="#cb42-1333" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-1334"><a href="#cb42-1334" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb42-1335"><a href="#cb42-1335" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-1336"><a href="#cb42-1336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1337"><a href="#cb42-1337" aria-hidden="true" tabindex="-1"></a>compare_s2_N_times <span class="ot">&lt;-</span> <span class="cf">function</span>(N, beta, n, dist_vec, dist_params_list){</span>
<span id="cb42-1338"><a href="#cb42-1338" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>N <span class="sc">%&gt;%</span> </span>
<span id="cb42-1339"><a href="#cb42-1339" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(compare_s2, <span class="at">beta =</span> beta, <span class="at">n =</span> n, <span class="at">dist_vec =</span> dist_vec, <span class="at">dist_params_list =</span> dist_params_list) <span class="sc">%&gt;%</span> </span>
<span id="cb42-1340"><a href="#cb42-1340" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb42-1341"><a href="#cb42-1341" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb42-1342"><a href="#cb42-1342" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-1343"><a href="#cb42-1343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1344"><a href="#cb42-1344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1345"><a href="#cb42-1345" aria-hidden="true" tabindex="-1"></a><span class="co"># xz_1 &lt;- 0.5</span></span>
<span id="cb42-1346"><a href="#cb42-1346" aria-hidden="true" tabindex="-1"></a><span class="co"># xz_2 &lt;- 0.5</span></span>
<span id="cb42-1347"><a href="#cb42-1347" aria-hidden="true" tabindex="-1"></a><span class="co"># zz &lt;- 0</span></span>
<span id="cb42-1348"><a href="#cb42-1348" aria-hidden="true" tabindex="-1"></a><span class="co"># xe &lt;- 0</span></span>
<span id="cb42-1349"><a href="#cb42-1349" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-1350"><a href="#cb42-1350" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-1351"><a href="#cb42-1351" aria-hidden="true" tabindex="-1"></a><span class="co"># matrix(c(1, xz_1, xz_2, xe, </span></span>
<span id="cb42-1352"><a href="#cb42-1352" aria-hidden="true" tabindex="-1"></a><span class="co">#          xz_1, 1, zz, 0,</span></span>
<span id="cb42-1353"><a href="#cb42-1353" aria-hidden="true" tabindex="-1"></a><span class="co">#          xz_2, zz, 1, 0,</span></span>
<span id="cb42-1354"><a href="#cb42-1354" aria-hidden="true" tabindex="-1"></a><span class="co">#          xe, 0, 0, 1), nrow = 4)</span></span>
<span id="cb42-1355"><a href="#cb42-1355" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1356"><a href="#cb42-1356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1357"><a href="#cb42-1357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1360"><a href="#cb42-1360" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1361"><a href="#cb42-1361" aria-hidden="true" tabindex="-1"></a><span class="co"># results %&gt;%</span></span>
<span id="cb42-1362"><a href="#cb42-1362" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_longer(!iter_num) %&gt;%</span></span>
<span id="cb42-1363"><a href="#cb42-1363" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(name) %&gt;%</span></span>
<span id="cb42-1364"><a href="#cb42-1364" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(</span></span>
<span id="cb42-1365"><a href="#cb42-1365" aria-hidden="true" tabindex="-1"></a><span class="co">#     variance = sd(value)</span></span>
<span id="cb42-1366"><a href="#cb42-1366" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;% </span></span>
<span id="cb42-1367"><a href="#cb42-1367" aria-hidden="true" tabindex="-1"></a><span class="co">#   knitr::kable()</span></span>
<span id="cb42-1368"><a href="#cb42-1368" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1369"><a href="#cb42-1369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1370"><a href="#cb42-1370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1371"><a href="#cb42-1371" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-1372"><a href="#cb42-1372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1373"><a href="#cb42-1373" aria-hidden="true" tabindex="-1"></a>:::{#cor-hausend}</span>
<span id="cb42-1374"><a href="#cb42-1374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1375"><a href="#cb42-1375" aria-hidden="true" tabindex="-1"></a><span class="fu">## Hausman Test for Endogeneity</span></span>
<span id="cb42-1376"><a href="#cb42-1376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1377"><a href="#cb42-1377" aria-hidden="true" tabindex="-1"></a>Given the hypothesis $H_0:\E{\X'\ep} = \zer$ where regressors are partitioned as $\X = <span class="co">[</span><span class="ot">\X_\text{exo},\X_\text{end}</span><span class="co">]</span>$, the &lt;span style="color:red"&gt;**_Hausman statistic_**&lt;/span&gt; simplifies to</span>
<span id="cb42-1378"><a href="#cb42-1378" aria-hidden="true" tabindex="-1"></a>$$H = (\hat{\boldsymbol\beta}_\text{OLS,end} - \hat{\boldsymbol\beta}_\text{IV,end})'\left[\widehat{\text{Avar}}(\hat{\boldsymbol\beta}_\text{IV,end}) - \widehat{\text{Avar}}(\hat{\boldsymbol\beta}_\text{OLS,end})\right]^{-1} (\hat{\boldsymbol\beta}_\text{OLS,end} - \hat{\boldsymbol\beta}_\text{IV,end}).$$ Under $H_0$,</span>
<span id="cb42-1379"><a href="#cb42-1379" aria-hidden="true" tabindex="-1"></a>$$ H\sim \chi_q^2$$</span>
<span id="cb42-1380"><a href="#cb42-1380" aria-hidden="true" tabindex="-1"></a>where $q = \dim(\X_\text{end})$. I will call the test associated with this statistic is known as the &lt;span style="color:red"&gt;**_Hausman test for endogeneity_**&lt;/span&gt;. </span>
<span id="cb42-1381"><a href="#cb42-1381" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-1382"><a href="#cb42-1382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1383"><a href="#cb42-1383" aria-hidden="true" tabindex="-1"></a>:::{#exm-}</span>
<span id="cb42-1384"><a href="#cb42-1384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1385"><a href="#cb42-1385" aria-hidden="true" tabindex="-1"></a>Suppose $(X, Z, \varepsilon) \sim N(\boldsymbol \mu,\Sig)$ where</span>
<span id="cb42-1386"><a href="#cb42-1386" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-1387"><a href="#cb42-1387" aria-hidden="true" tabindex="-1"></a>\boldsymbol \mu &amp; = <span class="co">[</span><span class="ot">10,10,0</span><span class="co">]</span>',<span class="sc">\\</span></span>
<span id="cb42-1388"><a href="#cb42-1388" aria-hidden="true" tabindex="-1"></a>\Sig &amp; = \begin{bmatrix}20 &amp; 5 &amp; 0<span class="sc">\\</span>5&amp;20&amp;0<span class="sc">\\</span>0&amp;0&amp;1 \end{bmatrix},</span>
<span id="cb42-1389"><a href="#cb42-1389" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-1390"><a href="#cb42-1390" aria-hidden="true" tabindex="-1"></a>and $Y = 1 + 3X + \varepsilon$. We have $\cov{X,\varepsilon} = 0$, so $\E{X\varepsilon} = 0$ and our model meets the assumptions of the classical linear model ($P_{\bet,\sigma^2} \in \mathcal P_\text{LM}\subset\mathcal P_\text{IV}$). If we draw a sample of size $n = 1,00$, we can test $H_0:\E{X\varepsilon} = 0$ using the Hausman statistic calculated using only $\beta_2$ (the slope coefficient). If we repeat this simulation many times, then the distribution of our test statistic should approach $\chi_1^2$, as $H_0$ is true for our model. </span>
<span id="cb42-1391"><a href="#cb42-1391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1394"><a href="#cb42-1394" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1395"><a href="#cb42-1395" aria-hidden="true" tabindex="-1"></a>DWH_test <span class="ot">&lt;-</span> <span class="cf">function</span>(y, X, Z, end_col){</span>
<span id="cb42-1396"><a href="#cb42-1396" aria-hidden="true" tabindex="-1"></a>  P <span class="ot">&lt;-</span> Z <span class="sc">%*%</span> <span class="fu">solve</span>(<span class="fu">t</span>(Z) <span class="sc">%*%</span> Z) <span class="sc">%*%</span> <span class="fu">t</span>(Z)</span>
<span id="cb42-1397"><a href="#cb42-1397" aria-hidden="true" tabindex="-1"></a>  X_hat <span class="ot">&lt;-</span> P <span class="sc">%*%</span> X</span>
<span id="cb42-1398"><a href="#cb42-1398" aria-hidden="true" tabindex="-1"></a>  OLS <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X) <span class="sc">%*%</span> <span class="fu">t</span>(X) <span class="sc">%*%</span> y</span>
<span id="cb42-1399"><a href="#cb42-1399" aria-hidden="true" tabindex="-1"></a>  IV <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">t</span>(X_hat) <span class="sc">%*%</span> X) <span class="sc">%*%</span> <span class="fu">t</span>(X_hat) <span class="sc">%*%</span> y</span>
<span id="cb42-1400"><a href="#cb42-1400" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-1401"><a href="#cb42-1401" aria-hidden="true" tabindex="-1"></a>  S2_OLS <span class="ot">&lt;-</span> <span class="fu">sum</span>((y <span class="sc">-</span> X <span class="sc">%*%</span> OLS)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (<span class="fu">nrow</span>(X) <span class="sc">-</span> <span class="fu">ncol</span>(X))</span>
<span id="cb42-1402"><a href="#cb42-1402" aria-hidden="true" tabindex="-1"></a>  S2_IV <span class="ot">&lt;-</span> <span class="fu">sum</span>((y <span class="sc">-</span> X <span class="sc">%*%</span> IV)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (<span class="fu">nrow</span>(X) <span class="sc">-</span> <span class="fu">ncol</span>(X))</span>
<span id="cb42-1403"><a href="#cb42-1403" aria-hidden="true" tabindex="-1"></a>  S2_eff <span class="ot">&lt;-</span> <span class="fu">sum</span>((y <span class="sc">-</span> X <span class="sc">%*%</span> OLS)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="fu">nrow</span>(X)</span>
<span id="cb42-1404"><a href="#cb42-1404" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-1405"><a href="#cb42-1405" aria-hidden="true" tabindex="-1"></a>  V_OLS <span class="ot">&lt;-</span> S2_OLS<span class="sc">*</span><span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X)</span>
<span id="cb42-1406"><a href="#cb42-1406" aria-hidden="true" tabindex="-1"></a>  V_IV <span class="ot">&lt;-</span> S2_IV<span class="sc">*</span><span class="fu">solve</span>(<span class="fu">t</span>(X_hat) <span class="sc">%*%</span> X_hat)</span>
<span id="cb42-1407"><a href="#cb42-1407" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-1408"><a href="#cb42-1408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1409"><a href="#cb42-1409" aria-hidden="true" tabindex="-1"></a>  H1 <span class="ot">&lt;-</span> <span class="fu">t</span>(IV[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> OLS[<span class="sc">-</span><span class="dv">1</span>]) <span class="sc">%*%</span> <span class="fu">pinv</span>(<span class="fu">as.matrix</span>(V_IV[<span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> V_OLS[<span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>])) <span class="sc">%*%</span> (IV[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> OLS[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb42-1410"><a href="#cb42-1410" aria-hidden="true" tabindex="-1"></a>  H2 <span class="ot">&lt;-</span> <span class="fu">t</span>(IV <span class="sc">-</span> OLS) <span class="sc">%*%</span> <span class="fu">pinv</span>(V_IV <span class="sc">-</span> V_OLS) <span class="sc">%*%</span> (IV <span class="sc">-</span> OLS)</span>
<span id="cb42-1411"><a href="#cb42-1411" aria-hidden="true" tabindex="-1"></a>  H3 <span class="ot">&lt;-</span> (<span class="fu">t</span>(IV <span class="sc">-</span> OLS) <span class="sc">%*%</span> <span class="fu">pinv</span>(<span class="fu">solve</span>(<span class="fu">t</span>(X_hat) <span class="sc">%*%</span> X_hat) <span class="sc">-</span> <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X)) <span class="sc">%*%</span> (IV <span class="sc">-</span> OLS))<span class="sc">/</span>S2_OLS</span>
<span id="cb42-1412"><a href="#cb42-1412" aria-hidden="true" tabindex="-1"></a>  H4 <span class="ot">&lt;-</span> (<span class="fu">t</span>(IV <span class="sc">-</span> OLS) <span class="sc">%*%</span> <span class="fu">pinv</span>(<span class="fu">solve</span>(<span class="fu">t</span>(X_hat) <span class="sc">%*%</span> X_hat) <span class="sc">-</span> <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X)) <span class="sc">%*%</span> (IV <span class="sc">-</span> OLS))<span class="sc">/</span>S2_IV</span>
<span id="cb42-1413"><a href="#cb42-1413" aria-hidden="true" tabindex="-1"></a>  H5 <span class="ot">&lt;-</span> (<span class="fu">t</span>(IV <span class="sc">-</span> OLS) <span class="sc">%*%</span> <span class="fu">pinv</span>(<span class="fu">solve</span>(<span class="fu">t</span>(X_hat) <span class="sc">%*%</span> X_hat) <span class="sc">-</span> <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X)) <span class="sc">%*%</span> (IV <span class="sc">-</span> OLS))<span class="sc">/</span>S2_eff</span>
<span id="cb42-1414"><a href="#cb42-1414" aria-hidden="true" tabindex="-1"></a>  H6 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> X <span class="sc">+</span> P <span class="sc">%*%</span> X[,end_col] <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-1415"><a href="#cb42-1415" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb42-1416"><a href="#cb42-1416" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="fu">ncol</span>(X) <span class="sc">-</span> <span class="dv">1</span> <span class="sc">+</span> end_col) <span class="sc">%&gt;%</span> </span>
<span id="cb42-1417"><a href="#cb42-1417" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">statistic =</span> statistic<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-1418"><a href="#cb42-1418" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(statistic) <span class="sc">%&gt;%</span> </span>
<span id="cb42-1419"><a href="#cb42-1419" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>()</span>
<span id="cb42-1420"><a href="#cb42-1420" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-1421"><a href="#cb42-1421" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb42-1422"><a href="#cb42-1422" aria-hidden="true" tabindex="-1"></a>    <span class="at">stat =</span> <span class="fu">c</span>(H1, H2, H3, H4, H5, H6),</span>
<span id="cb42-1423"><a href="#cb42-1423" aria-hidden="true" tabindex="-1"></a>    <span class="at">include_constant =</span> <span class="fu">c</span>(F, T, T, T, T, <span class="cn">NA</span>),</span>
<span id="cb42-1424"><a href="#cb42-1424" aria-hidden="true" tabindex="-1"></a>    <span class="at">common_S2_value =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">"OLS"</span>, <span class="st">"IV"</span>, <span class="st">"MVE"</span>, <span class="cn">NA</span>),</span>
<span id="cb42-1425"><a href="#cb42-1425" aria-hidden="true" tabindex="-1"></a>    <span class="at">version =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb42-1426"><a href="#cb42-1426" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-1427"><a href="#cb42-1427" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-1428"><a href="#cb42-1428" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb42-1429"><a href="#cb42-1429" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-1430"><a href="#cb42-1430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1431"><a href="#cb42-1431" aria-hidden="true" tabindex="-1"></a>draw_DWH_test <span class="ot">&lt;-</span> <span class="cf">function</span>(end_col, beta, n, dist_vec, dist_params_list, t){</span>
<span id="cb42-1432"><a href="#cb42-1432" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">sim_endog_linear_model</span>(beta, n, dist_vec, dist_params_list)</span>
<span id="cb42-1433"><a href="#cb42-1433" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">DWH_test</span>(model<span class="sc">$</span>y, model<span class="sc">$</span>X, model<span class="sc">$</span>Z, end_col) <span class="sc">%&gt;%</span> </span>
<span id="cb42-1434"><a href="#cb42-1434" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">iter_num =</span> t)</span>
<span id="cb42-1435"><a href="#cb42-1435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb42-1436"><a href="#cb42-1436" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-1437"><a href="#cb42-1437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1438"><a href="#cb42-1438" aria-hidden="true" tabindex="-1"></a>draw_N_DWH_test <span class="ot">&lt;-</span> <span class="cf">function</span>(N, end_col, beta, n, dist_vec, dist_params_list){</span>
<span id="cb42-1439"><a href="#cb42-1439" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>N <span class="sc">%&gt;%</span> </span>
<span id="cb42-1440"><a href="#cb42-1440" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(draw_DWH_test, <span class="at">end_col =</span> end_col, <span class="at">beta =</span> beta, <span class="at">n =</span> n, <span class="at">dist_vec =</span> dist_vec, <span class="at">dist_params_list =</span> dist_params_list) <span class="sc">%&gt;%</span> </span>
<span id="cb42-1441"><a href="#cb42-1441" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb42-1442"><a href="#cb42-1442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb42-1443"><a href="#cb42-1443" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-1444"><a href="#cb42-1444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1445"><a href="#cb42-1445" aria-hidden="true" tabindex="-1"></a><span class="co"># results &lt;- draw_N_DWH_test(</span></span>
<span id="cb42-1446"><a href="#cb42-1446" aria-hidden="true" tabindex="-1"></a><span class="co">#   N = 1e3,</span></span>
<span id="cb42-1447"><a href="#cb42-1447" aria-hidden="true" tabindex="-1"></a><span class="co">#   end_col = 2,</span></span>
<span id="cb42-1448"><a href="#cb42-1448" aria-hidden="true" tabindex="-1"></a><span class="co">#   beta = c(0,3),</span></span>
<span id="cb42-1449"><a href="#cb42-1449" aria-hidden="true" tabindex="-1"></a><span class="co">#   n = 1e3,</span></span>
<span id="cb42-1450"><a href="#cb42-1450" aria-hidden="true" tabindex="-1"></a><span class="co">#   dist_vec = c(rmvnorm),</span></span>
<span id="cb42-1451"><a href="#cb42-1451" aria-hidden="true" tabindex="-1"></a><span class="co">#   dist_params_list = list(</span></span>
<span id="cb42-1452"><a href="#cb42-1452" aria-hidden="true" tabindex="-1"></a><span class="co">#     list(</span></span>
<span id="cb42-1453"><a href="#cb42-1453" aria-hidden="true" tabindex="-1"></a><span class="co">#       mean = c(10, 10, 0),</span></span>
<span id="cb42-1454"><a href="#cb42-1454" aria-hidden="true" tabindex="-1"></a><span class="co">#       sigma = matrix(c(20,5,0, 5,20,0,0,0,3), nrow = 3)</span></span>
<span id="cb42-1455"><a href="#cb42-1455" aria-hidden="true" tabindex="-1"></a><span class="co">#     )</span></span>
<span id="cb42-1456"><a href="#cb42-1456" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb42-1457"><a href="#cb42-1457" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb42-1458"><a href="#cb42-1458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1459"><a href="#cb42-1459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1460"><a href="#cb42-1460" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb42-1461"><a href="#cb42-1461" aria-hidden="true" tabindex="-1"></a>S <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">2</span><span class="sc">*</span>k<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb42-1462"><a href="#cb42-1462" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k) {</span>
<span id="cb42-1463"><a href="#cb42-1463" aria-hidden="true" tabindex="-1"></a>  S[i, <span class="dv">2</span><span class="sc">*</span>k<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> S[<span class="dv">2</span><span class="sc">*</span>k<span class="sc">+</span><span class="dv">1</span>, i] <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb42-1464"><a href="#cb42-1464" aria-hidden="true" tabindex="-1"></a>  S[i<span class="sc">+</span>k,i] <span class="ot">&lt;-</span> S[i,i<span class="sc">+</span>k] <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb42-1465"><a href="#cb42-1465" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-1466"><a href="#cb42-1466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1467"><a href="#cb42-1467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1468"><a href="#cb42-1468" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">sim_endog_linear_model</span>(</span>
<span id="cb42-1469"><a href="#cb42-1469" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb42-1470"><a href="#cb42-1470" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fl">1e3</span>,</span>
<span id="cb42-1471"><a href="#cb42-1471" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_vec =</span> <span class="fu">c</span>(rmvnorm),</span>
<span id="cb42-1472"><a href="#cb42-1472" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_params_list =</span> <span class="fu">list</span>(</span>
<span id="cb42-1473"><a href="#cb42-1473" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb42-1474"><a href="#cb42-1474" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb42-1475"><a href="#cb42-1475" aria-hidden="true" tabindex="-1"></a>      <span class="at">sigma =</span> S</span>
<span id="cb42-1476"><a href="#cb42-1476" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb42-1477"><a href="#cb42-1477" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-1478"><a href="#cb42-1478" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-1479"><a href="#cb42-1479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1480"><a href="#cb42-1480" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> model<span class="sc">$</span>y</span>
<span id="cb42-1481"><a href="#cb42-1481" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> model<span class="sc">$</span>X</span>
<span id="cb42-1482"><a href="#cb42-1482" aria-hidden="true" tabindex="-1"></a>Z <span class="ot">&lt;-</span> model<span class="sc">$</span>Z</span>
<span id="cb42-1483"><a href="#cb42-1483" aria-hidden="true" tabindex="-1"></a>P <span class="ot">&lt;-</span> Z <span class="sc">%*%</span> <span class="fu">solve</span>(<span class="fu">t</span>(Z) <span class="sc">%*%</span> Z) <span class="sc">%*%</span> <span class="fu">t</span>(Z)</span>
<span id="cb42-1484"><a href="#cb42-1484" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb42-1485"><a href="#cb42-1485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1486"><a href="#cb42-1486" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(y <span class="sc">~</span> X <span class="sc">+</span> P <span class="sc">%*%</span> X[, <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)] <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb42-1487"><a href="#cb42-1487" aria-hidden="true" tabindex="-1"></a>P <span class="sc">%*%</span> X[, <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)]</span>
<span id="cb42-1488"><a href="#cb42-1488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1489"><a href="#cb42-1489" aria-hidden="true" tabindex="-1"></a>ols <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">lm</span>(y <span class="sc">~</span> X <span class="sc">+</span> P <span class="sc">%*%</span> X[, <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)] <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb42-1490"><a href="#cb42-1490" aria-hidden="true" tabindex="-1"></a><span class="co"># var &lt;- vcov(lm(y ~ X + P %*% X[, c(2, 3, 4)] - 1))</span></span>
<span id="cb42-1491"><a href="#cb42-1491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1492"><a href="#cb42-1492" aria-hidden="true" tabindex="-1"></a><span class="co"># lm(y ~ X + P %*% X[, c(2, 3)] - 1)</span></span>
<span id="cb42-1493"><a href="#cb42-1493" aria-hidden="true" tabindex="-1"></a><span class="co"># t(h %*% ols) %*% solve(h %*% var %*% t(h)) %*% (h %*% ols) / 2</span></span>
<span id="cb42-1494"><a href="#cb42-1494" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(ivreg(y ~ x2 + x3 + x4 | z2 + z3 + z4 , data = model$observed_data), diagnostics = T)$diagnostics[3,3]</span></span>
<span id="cb42-1495"><a href="#cb42-1495" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1496"><a href="#cb42-1496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1497"><a href="#cb42-1497" aria-hidden="true" tabindex="-1"></a>Now let's plot the simulated test statistics.</span>
<span id="cb42-1498"><a href="#cb42-1498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1501"><a href="#cb42-1501" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1502"><a href="#cb42-1502" aria-hidden="true" tabindex="-1"></a><span class="co"># results %&gt;% </span></span>
<span id="cb42-1503"><a href="#cb42-1503" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(stat, fill = as.factor(version))) +</span></span>
<span id="cb42-1504"><a href="#cb42-1504" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_histogram(alpha = 0.4, position = "identity")</span></span>
<span id="cb42-1505"><a href="#cb42-1505" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1506"><a href="#cb42-1506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1507"><a href="#cb42-1507" aria-hidden="true" tabindex="-1"></a>We'll replicate section 1.5 from @chmelarova2007hausman which uses data from @mroz and is inspired by Example 9.5 from @wooldridge2010econometric. </span>
<span id="cb42-1508"><a href="#cb42-1508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1511"><a href="#cb42-1511" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1512"><a href="#cb42-1512" aria-hidden="true" tabindex="-1"></a><span class="co"># data("mroz")</span></span>
<span id="cb42-1513"><a href="#cb42-1513" aria-hidden="true" tabindex="-1"></a><span class="co"># mroz &lt;- mroz %&gt;%</span></span>
<span id="cb42-1514"><a href="#cb42-1514" aria-hidden="true" tabindex="-1"></a><span class="co">#   as_tibble() %&gt;%</span></span>
<span id="cb42-1515"><a href="#cb42-1515" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(hours &gt; 0)</span></span>
<span id="cb42-1516"><a href="#cb42-1516" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-1517"><a href="#cb42-1517" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-1518"><a href="#cb42-1518" aria-hidden="true" tabindex="-1"></a><span class="co"># y &lt;- mroz$hours</span></span>
<span id="cb42-1519"><a href="#cb42-1519" aria-hidden="true" tabindex="-1"></a><span class="co"># X &lt;- mroz %&gt;%</span></span>
<span id="cb42-1520"><a href="#cb42-1520" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(int = 1, lwage, educ, age, kidslt6, kidsge6, nwifeinc) %&gt;%</span></span>
<span id="cb42-1521"><a href="#cb42-1521" aria-hidden="true" tabindex="-1"></a><span class="co">#   as.matrix()</span></span>
<span id="cb42-1522"><a href="#cb42-1522" aria-hidden="true" tabindex="-1"></a><span class="co"># Z &lt;- mroz %&gt;%</span></span>
<span id="cb42-1523"><a href="#cb42-1523" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(int = 1, exper, educ, age, kidslt6, kidsge6, nwifeinc) %&gt;%</span></span>
<span id="cb42-1524"><a href="#cb42-1524" aria-hidden="true" tabindex="-1"></a><span class="co">#   as.matrix()</span></span>
<span id="cb42-1525"><a href="#cb42-1525" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-1526"><a href="#cb42-1526" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-1527"><a href="#cb42-1527" aria-hidden="true" tabindex="-1"></a><span class="co"># rho1 </span></span>
<span id="cb42-1528"><a href="#cb42-1528" aria-hidden="true" tabindex="-1"></a><span class="co"># rho2 </span></span>
<span id="cb42-1529"><a href="#cb42-1529" aria-hidden="true" tabindex="-1"></a><span class="co"># rho3 </span></span>
<span id="cb42-1530"><a href="#cb42-1530" aria-hidden="true" tabindex="-1"></a><span class="co"># rho4 </span></span>
<span id="cb42-1531"><a href="#cb42-1531" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-1532"><a href="#cb42-1532" aria-hidden="true" tabindex="-1"></a><span class="co"># sim_endog_linear_model(</span></span>
<span id="cb42-1533"><a href="#cb42-1533" aria-hidden="true" tabindex="-1"></a><span class="co">#   beta = c(0,1),</span></span>
<span id="cb42-1534"><a href="#cb42-1534" aria-hidden="true" tabindex="-1"></a><span class="co">#   n = 1e2,</span></span>
<span id="cb42-1535"><a href="#cb42-1535" aria-hidden="true" tabindex="-1"></a><span class="co">#   dist_vec = c(rmvnorm),</span></span>
<span id="cb42-1536"><a href="#cb42-1536" aria-hidden="true" tabindex="-1"></a><span class="co">#   dist_params_list = list(</span></span>
<span id="cb42-1537"><a href="#cb42-1537" aria-hidden="true" tabindex="-1"></a><span class="co">#     list(</span></span>
<span id="cb42-1538"><a href="#cb42-1538" aria-hidden="true" tabindex="-1"></a><span class="co">#       mean = c(0, 0, 0, 0),</span></span>
<span id="cb42-1539"><a href="#cb42-1539" aria-hidden="true" tabindex="-1"></a><span class="co">#       sigma = matrix(</span></span>
<span id="cb42-1540"><a href="#cb42-1540" aria-hidden="true" tabindex="-1"></a><span class="co">#         c(1, 5, 0, 5,</span></span>
<span id="cb42-1541"><a href="#cb42-1541" aria-hidden="true" tabindex="-1"></a><span class="co">#           20, 0, 0, 0,</span></span>
<span id="cb42-1542"><a href="#cb42-1542" aria-hidden="true" tabindex="-1"></a><span class="co">#           3, 0, 1, 0,</span></span>
<span id="cb42-1543"><a href="#cb42-1543" aria-hidden="true" tabindex="-1"></a><span class="co">#           0, 0, 0, 1</span></span>
<span id="cb42-1544"><a href="#cb42-1544" aria-hidden="true" tabindex="-1"></a><span class="co">#           ), nrow = 3)</span></span>
<span id="cb42-1545"><a href="#cb42-1545" aria-hidden="true" tabindex="-1"></a><span class="co">#     )</span></span>
<span id="cb42-1546"><a href="#cb42-1546" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb42-1547"><a href="#cb42-1547" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb42-1548"><a href="#cb42-1548" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1549"><a href="#cb42-1549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1550"><a href="#cb42-1550" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb42-1551"><a href="#cb42-1551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1552"><a href="#cb42-1552" aria-hidden="true" tabindex="-1"></a>Another means of testing for exogeneity is due to  @wu1973alternative and @durbin1954errors. Begin by performing the first step of 2SLS on the possible endogenous regressors.</span>
<span id="cb42-1553"><a href="#cb42-1553" aria-hidden="true" tabindex="-1"></a>$$ \Xm_\text{end} =  \Zm \boldsymbol \delta + \mathbb V$$ The residuals now form a matrix, because we have multiple dependent variables $\X_\text{end}$.</span>
<span id="cb42-1554"><a href="#cb42-1554" aria-hidden="true" tabindex="-1"></a>Using the estimated projection coefficient $\hat{\boldsymbol \delta}$, we calculated the residual values $\hat{\mathbb V}$. Finally we augment the original linear model by including $\hat{\mathbb V}$.</span>
<span id="cb42-1555"><a href="#cb42-1555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1556"><a href="#cb42-1556" aria-hidden="true" tabindex="-1"></a>$$\y = \Xm\bet + \hat{\mathbb V}\boldsymbol\gamma + \ep^* = \begin{bmatrix} \Xm_\text{exo} &amp; \Xm_\text{end}\end{bmatrix}\begin{bmatrix} \bet_\text{exo} <span class="sc">\\</span> \bet_\text{end}\end{bmatrix} + \underbrace{\hat{\mathbb V}\gamma + \boldsymbol {\ep}^*}_{\ep}$$ Consider the hypothesis $H_0:\boldsymbol\gamma = \zer$, and how that may related to whether $\Xm_\text{end}$ is endogenous or exogenous. When we perform the first step of this process (regressing $\Xm_\text{end}$ on $\Zm$) we break variation in $\Xm_\text{end}$ into two parts: the exogenous portion explained through $\Zm$,^[We know it's exogenous because $\Zm$ is a valid instrument and is exogenous], and unexplained part $\boldsymbol \nu$ which we capture through $\hat{\mathbb V}$. If $\boldsymbol \gamma \neq \zer$, then the structural error $\ep$ includes the unexplained part of the variation in $\X_\text{end}$, which is another way of saying $\cov{\X_\text{end}, \varepsilon}\neq 0$. </span>
<span id="cb42-1557"><a href="#cb42-1557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1558"><a href="#cb42-1558" aria-hidden="true" tabindex="-1"></a>So do we use the Hausman test, or this new test which uses artificial regressions? Well it turns out, we don't need to make a choice because they're equivalent if we are attentive about which residuals we use to calculate asymptotic variance! It also turns out that we could perform the artificial regression test using the fitted values $\hat{\Xm}_\text{end}$ instead of $\hat{\mathbb V}$. </span>
<span id="cb42-1559"><a href="#cb42-1559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1560"><a href="#cb42-1560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1561"><a href="#cb42-1561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1562"><a href="#cb42-1562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1563"><a href="#cb42-1563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1564"><a href="#cb42-1564" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sargan–Hansen Test</span></span>
<span id="cb42-1565"><a href="#cb42-1565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1566"><a href="#cb42-1566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1567"><a href="#cb42-1567" aria-hidden="true" tabindex="-1"></a><span class="fu">## Example/Replication</span></span>
<span id="cb42-1568"><a href="#cb42-1568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1569"><a href="#cb42-1569" aria-hidden="true" tabindex="-1"></a>Let's replicate @card1995using, a *classic* paper which has provided a textbook example of instrumental variables. To make sure our results are correct, we can compare them to the tables in the original paper which is found <span class="co">[</span><span class="ot">here</span><span class="co">](https://www.nber.org/system/files/working_papers/w4483/w4483.pdf)</span>. The data is available on David Card's <span class="co">[</span><span class="ot">website</span><span class="co">](https://davidcard.berkeley.edu/data_sets.html)</span>.</span>
<span id="cb42-1570"><a href="#cb42-1570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1571"><a href="#cb42-1571" aria-hidden="true" tabindex="-1"></a>@card1995using is concerned with estimating the returns to schooling with respect to wages. We tend to think that better educated workers earn higher wages, but to what extent does this relationship hold? Denote years of schooling as $S_i$, log wages as $Y_i$, and $\X_i$ as a collection of attributes associated with a worker. The linear model of interest is </span>
<span id="cb42-1572"><a href="#cb42-1572" aria-hidden="true" tabindex="-1"></a>$$ Y_i = \X_i\boldsymbol\alpha + S_i\beta + u_i,$$ where $u_i$ are unobserved components which affect earnings. We're assuming that $\E{\X_iu_i} = 0$ for all $i$ ($\X_i$ is exogenous), but we suspect that $\E{S_iu_i} = 0$ (see Example \@ref(exm:ex1)). The parameter $\beta$ is the returns of education on earnings, and is what we're primarly interested in. Let's just ignore this endogeneity for now and attempt to estimate $\beta$ with OLS. We can do this with data from the National Longitudinal Survey of Young Men (NLSYM) conducted in 1976. This survey contains information about agents' wages in 1976, along with demographic information about family background, residence in 1976, and past residence (in 1966). The details of this survey, in particular how respondents were sampled, can be found in @card1995using.</span>
<span id="cb42-1573"><a href="#cb42-1573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1574"><a href="#cb42-1574" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE}</span></span>
<span id="cb42-1575"><a href="#cb42-1575" aria-hidden="true" tabindex="-1"></a><span class="in">card_95 &lt;- read.table("data/nls.dat")</span></span>
<span id="cb42-1576"><a href="#cb42-1576" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1577"><a href="#cb42-1577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1578"><a href="#cb42-1578" aria-hidden="true" tabindex="-1"></a>The ```.zip``` file containing the data also contains a ```.sas``` file which processes and cleans the raw data. Each step is readily executed in R:^<span class="co">[</span><span class="ot">I did this to the best of my ability, as I have no experience with ```.sas```, and I could have misinterpreted the accompanying documentation and commentary in the code.</span><span class="co">]</span></span>
<span id="cb42-1579"><a href="#cb42-1579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1580"><a href="#cb42-1580" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE}</span></span>
<span id="cb42-1581"><a href="#cb42-1581" aria-hidden="true" tabindex="-1"></a><span class="in">card_95 &lt;- card_95 %&gt;%</span></span>
<span id="cb42-1582"><a href="#cb42-1582" aria-hidden="true" tabindex="-1"></a><span class="in">  #assign the appropriate names to each variable</span></span>
<span id="cb42-1583"><a href="#cb42-1583" aria-hidden="true" tabindex="-1"></a><span class="in">  rename(</span></span>
<span id="cb42-1584"><a href="#cb42-1584" aria-hidden="true" tabindex="-1"></a><span class="in">    id = V1,</span></span>
<span id="cb42-1585"><a href="#cb42-1585" aria-hidden="true" tabindex="-1"></a><span class="in">    nearc2 = V2,</span></span>
<span id="cb42-1586"><a href="#cb42-1586" aria-hidden="true" tabindex="-1"></a><span class="in">    nearc4 = V3,</span></span>
<span id="cb42-1587"><a href="#cb42-1587" aria-hidden="true" tabindex="-1"></a><span class="in">    nearc4a = V4,</span></span>
<span id="cb42-1588"><a href="#cb42-1588" aria-hidden="true" tabindex="-1"></a><span class="in">    nearc4b = V5,</span></span>
<span id="cb42-1589"><a href="#cb42-1589" aria-hidden="true" tabindex="-1"></a><span class="in">    ed76 = V6,</span></span>
<span id="cb42-1590"><a href="#cb42-1590" aria-hidden="true" tabindex="-1"></a><span class="in">    ed66 = V7,</span></span>
<span id="cb42-1591"><a href="#cb42-1591" aria-hidden="true" tabindex="-1"></a><span class="in">    age76 = V8,</span></span>
<span id="cb42-1592"><a href="#cb42-1592" aria-hidden="true" tabindex="-1"></a><span class="in">    daded = V9,</span></span>
<span id="cb42-1593"><a href="#cb42-1593" aria-hidden="true" tabindex="-1"></a><span class="in">    nodaded = V10,</span></span>
<span id="cb42-1594"><a href="#cb42-1594" aria-hidden="true" tabindex="-1"></a><span class="in">    momed = V11,</span></span>
<span id="cb42-1595"><a href="#cb42-1595" aria-hidden="true" tabindex="-1"></a><span class="in">    nomomed = V12,</span></span>
<span id="cb42-1596"><a href="#cb42-1596" aria-hidden="true" tabindex="-1"></a><span class="in">    weight = V13,</span></span>
<span id="cb42-1597"><a href="#cb42-1597" aria-hidden="true" tabindex="-1"></a><span class="in">    momdad14  = V14,</span></span>
<span id="cb42-1598"><a href="#cb42-1598" aria-hidden="true" tabindex="-1"></a><span class="in">    sinmom14  = V15,</span></span>
<span id="cb42-1599"><a href="#cb42-1599" aria-hidden="true" tabindex="-1"></a><span class="in">    step14 = V16,</span></span>
<span id="cb42-1600"><a href="#cb42-1600" aria-hidden="true" tabindex="-1"></a><span class="in">    reg661 = V17,</span></span>
<span id="cb42-1601"><a href="#cb42-1601" aria-hidden="true" tabindex="-1"></a><span class="in">    reg662 = V18,</span></span>
<span id="cb42-1602"><a href="#cb42-1602" aria-hidden="true" tabindex="-1"></a><span class="in">    reg663 = V19,</span></span>
<span id="cb42-1603"><a href="#cb42-1603" aria-hidden="true" tabindex="-1"></a><span class="in">    reg664 = V20,</span></span>
<span id="cb42-1604"><a href="#cb42-1604" aria-hidden="true" tabindex="-1"></a><span class="in">    reg665 = V21,</span></span>
<span id="cb42-1605"><a href="#cb42-1605" aria-hidden="true" tabindex="-1"></a><span class="in">    reg666 = V22,</span></span>
<span id="cb42-1606"><a href="#cb42-1606" aria-hidden="true" tabindex="-1"></a><span class="in">    reg667 = V23,</span></span>
<span id="cb42-1607"><a href="#cb42-1607" aria-hidden="true" tabindex="-1"></a><span class="in">    reg668 = V24,</span></span>
<span id="cb42-1608"><a href="#cb42-1608" aria-hidden="true" tabindex="-1"></a><span class="in">    reg669 = V25,</span></span>
<span id="cb42-1609"><a href="#cb42-1609" aria-hidden="true" tabindex="-1"></a><span class="in">    south66 = V26,</span></span>
<span id="cb42-1610"><a href="#cb42-1610" aria-hidden="true" tabindex="-1"></a><span class="in">    work76 = V27,</span></span>
<span id="cb42-1611"><a href="#cb42-1611" aria-hidden="true" tabindex="-1"></a><span class="in">    work78 = V28,</span></span>
<span id="cb42-1612"><a href="#cb42-1612" aria-hidden="true" tabindex="-1"></a><span class="in">    lwage76 = V29,</span></span>
<span id="cb42-1613"><a href="#cb42-1613" aria-hidden="true" tabindex="-1"></a><span class="in">    lwage78 = V30,</span></span>
<span id="cb42-1614"><a href="#cb42-1614" aria-hidden="true" tabindex="-1"></a><span class="in">    famed = V31,</span></span>
<span id="cb42-1615"><a href="#cb42-1615" aria-hidden="true" tabindex="-1"></a><span class="in">    black = V32,</span></span>
<span id="cb42-1616"><a href="#cb42-1616" aria-hidden="true" tabindex="-1"></a><span class="in">    smsa76r = V33,</span></span>
<span id="cb42-1617"><a href="#cb42-1617" aria-hidden="true" tabindex="-1"></a><span class="in">    smsa78r = V34,</span></span>
<span id="cb42-1618"><a href="#cb42-1618" aria-hidden="true" tabindex="-1"></a><span class="in">    south76 = V35,</span></span>
<span id="cb42-1619"><a href="#cb42-1619" aria-hidden="true" tabindex="-1"></a><span class="in">    reg78r = V36,</span></span>
<span id="cb42-1620"><a href="#cb42-1620" aria-hidden="true" tabindex="-1"></a><span class="in">    reg80r = V37,</span></span>
<span id="cb42-1621"><a href="#cb42-1621" aria-hidden="true" tabindex="-1"></a><span class="in">    smsa66r = V38,</span></span>
<span id="cb42-1622"><a href="#cb42-1622" aria-hidden="true" tabindex="-1"></a><span class="in">    wage76 = V39,</span></span>
<span id="cb42-1623"><a href="#cb42-1623" aria-hidden="true" tabindex="-1"></a><span class="in">    wage78 = V40,</span></span>
<span id="cb42-1624"><a href="#cb42-1624" aria-hidden="true" tabindex="-1"></a><span class="in">    wage80 = V41,</span></span>
<span id="cb42-1625"><a href="#cb42-1625" aria-hidden="true" tabindex="-1"></a><span class="in">    noint78 = V42,</span></span>
<span id="cb42-1626"><a href="#cb42-1626" aria-hidden="true" tabindex="-1"></a><span class="in">    noint80 = V43,</span></span>
<span id="cb42-1627"><a href="#cb42-1627" aria-hidden="true" tabindex="-1"></a><span class="in">    enroll76 = V44,</span></span>
<span id="cb42-1628"><a href="#cb42-1628" aria-hidden="true" tabindex="-1"></a><span class="in">    enroll78 = V45,</span></span>
<span id="cb42-1629"><a href="#cb42-1629" aria-hidden="true" tabindex="-1"></a><span class="in">    enroll80 = V46,</span></span>
<span id="cb42-1630"><a href="#cb42-1630" aria-hidden="true" tabindex="-1"></a><span class="in">    kww = V47,</span></span>
<span id="cb42-1631"><a href="#cb42-1631" aria-hidden="true" tabindex="-1"></a><span class="in">    iq = V48,</span></span>
<span id="cb42-1632"><a href="#cb42-1632" aria-hidden="true" tabindex="-1"></a><span class="in">    marsta76 = V49,</span></span>
<span id="cb42-1633"><a href="#cb42-1633" aria-hidden="true" tabindex="-1"></a><span class="in">    marsta78 = V50,</span></span>
<span id="cb42-1634"><a href="#cb42-1634" aria-hidden="true" tabindex="-1"></a><span class="in">    marsta80 = V51,</span></span>
<span id="cb42-1635"><a href="#cb42-1635" aria-hidden="true" tabindex="-1"></a><span class="in">    libcrd1 = V52</span></span>
<span id="cb42-1636"><a href="#cb42-1636" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb42-1637"><a href="#cb42-1637" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb42-1638"><a href="#cb42-1638" aria-hidden="true" tabindex="-1"></a><span class="in">    # missing values in SAS are ".", replace those with NAs</span></span>
<span id="cb42-1639"><a href="#cb42-1639" aria-hidden="true" tabindex="-1"></a><span class="in">    across(everything(), ~replace(., . ==  "." , NA)),</span></span>
<span id="cb42-1640"><a href="#cb42-1640" aria-hidden="true" tabindex="-1"></a><span class="in">    # any column that had a "." was loaded as a string, convert them</span></span>
<span id="cb42-1641"><a href="#cb42-1641" aria-hidden="true" tabindex="-1"></a><span class="in">    across(where(is.character), as.numeric),</span></span>
<span id="cb42-1642"><a href="#cb42-1642" aria-hidden="true" tabindex="-1"></a><span class="in">    #create variables corresponding to work experience</span></span>
<span id="cb42-1643"><a href="#cb42-1643" aria-hidden="true" tabindex="-1"></a><span class="in">    exp76 = age76 - ed76 - 6,</span></span>
<span id="cb42-1644"><a href="#cb42-1644" aria-hidden="true" tabindex="-1"></a><span class="in">    exp76_sq = exp76*exp76,</span></span>
<span id="cb42-1645"><a href="#cb42-1645" aria-hidden="true" tabindex="-1"></a><span class="in">    exp76_sq_100 = (exp76*exp76)/100,</span></span>
<span id="cb42-1646"><a href="#cb42-1646" aria-hidden="true" tabindex="-1"></a><span class="in">    #create a series of indicators for parents' level of education</span></span>
<span id="cb42-1647"><a href="#cb42-1647" aria-hidden="true" tabindex="-1"></a><span class="in">    f1 = (momed &gt; 12 &amp; daded &gt; 12),</span></span>
<span id="cb42-1648"><a href="#cb42-1648" aria-hidden="true" tabindex="-1"></a><span class="in">    f2 = (momed &gt;= 12 &amp; daded &gt;= 12 &amp; (momed != 12 | daded != 12)),</span></span>
<span id="cb42-1649"><a href="#cb42-1649" aria-hidden="true" tabindex="-1"></a><span class="in">    f3 = (momed == 12 &amp; daded == 12),</span></span>
<span id="cb42-1650"><a href="#cb42-1650" aria-hidden="true" tabindex="-1"></a><span class="in">    f4 = (momed &gt;= 12 &amp; nodaded == 1),</span></span>
<span id="cb42-1651"><a href="#cb42-1651" aria-hidden="true" tabindex="-1"></a><span class="in">    f5 = (daded &gt;= 12 &amp; momed &lt; 12),</span></span>
<span id="cb42-1652"><a href="#cb42-1652" aria-hidden="true" tabindex="-1"></a><span class="in">    f6 = (momed &gt;= 12 &amp; nodaded == 0),</span></span>
<span id="cb42-1653"><a href="#cb42-1653" aria-hidden="true" tabindex="-1"></a><span class="in">    f7 = (momed &gt;= 9 &amp; daded &gt;= 9),</span></span>
<span id="cb42-1654"><a href="#cb42-1654" aria-hidden="true" tabindex="-1"></a><span class="in">    f8 = (nomomed == 0 &amp; nodaded == 0)</span></span>
<span id="cb42-1655"><a href="#cb42-1655" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb42-1656"><a href="#cb42-1656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1657"><a href="#cb42-1657" aria-hidden="true" tabindex="-1"></a><span class="in">#Gather mutually exclusive region66 indicators into categorical </span></span>
<span id="cb42-1658"><a href="#cb42-1658" aria-hidden="true" tabindex="-1"></a><span class="in">card_95 &lt;- card_95 %&gt;% </span></span>
<span id="cb42-1659"><a href="#cb42-1659" aria-hidden="true" tabindex="-1"></a><span class="in">  select(id, contains("reg66")) %&gt;% </span></span>
<span id="cb42-1660"><a href="#cb42-1660" aria-hidden="true" tabindex="-1"></a><span class="in">  gather(region66, count, -id) %&gt;% </span></span>
<span id="cb42-1661"><a href="#cb42-1661" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(count == 1) %&gt;% </span></span>
<span id="cb42-1662"><a href="#cb42-1662" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb42-1663"><a href="#cb42-1663" aria-hidden="true" tabindex="-1"></a><span class="in">    region66 = str_remove(region66,"reg66"),</span></span>
<span id="cb42-1664"><a href="#cb42-1664" aria-hidden="true" tabindex="-1"></a><span class="in">    region66 = as.factor(region66)</span></span>
<span id="cb42-1665"><a href="#cb42-1665" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb42-1666"><a href="#cb42-1666" aria-hidden="true" tabindex="-1"></a><span class="in">  right_join(card_95)</span></span>
<span id="cb42-1667"><a href="#cb42-1667" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1668"><a href="#cb42-1668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1669"><a href="#cb42-1669" aria-hidden="true" tabindex="-1"></a>The dependent variable of interest if $\log wage_i$ (```lwage76```). Our baseline linear model is</span>
<span id="cb42-1670"><a href="#cb42-1670" aria-hidden="true" tabindex="-1"></a>$$ \log( wage_i) = \alpha_0 + \beta\cdot educ_i + \alpha_1\cdot exper_i + \frac{\alpha_2}{100}\cdot exper_i^2 + \alpha_3 \cdot black_i + \alpha_4\cdot south_i + \alpha_5\cdot SMSA_i + \varepsilon_i,$$ where $educ_i$ (```ed76```) is level of education, $exper_i$ (```exp76```) is amount of work experiance, $black_i$ (```black```) indicated if respondent $i$ is Black, $south_i$ (```south76```) indicated whether the respondent lives in the South (in 1976), and $SMSA_i$ (```smsa76r```) indicates whether a respondent lives in the South and in a metropolitan area.^<span class="co">[</span><span class="ot">The abbreviation "MSA" comes up a lot when dealing with surbey data. It stands for "metropolitan statistical area", and are used by the Census Bureau to designate areas with a high population density.</span><span class="co">]</span> Along with estimating this model, we will estimate similar models which include various controls for family education, family structure, and where respondents lived in 1966. </span>
<span id="cb42-1671"><a href="#cb42-1671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1674"><a href="#cb42-1674" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1675"><a href="#cb42-1675" aria-hidden="true" tabindex="-1"></a>linear_model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(lwage76 <span class="sc">~</span> ed76 <span class="sc">+</span> exp76 <span class="sc">+</span> exp76_sq_100 <span class="sc">+</span> black <span class="sc">+</span> south76 <span class="sc">+</span> smsa76r, <span class="at">data =</span> card_95)</span>
<span id="cb42-1676"><a href="#cb42-1676" aria-hidden="true" tabindex="-1"></a>linear_model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(lwage76 <span class="sc">~</span> ed76 <span class="sc">+</span> exp76 <span class="sc">+</span> exp76_sq_100 <span class="sc">+</span> black <span class="sc">+</span> south76 <span class="sc">+</span> smsa76r <span class="sc">+</span> smsa66r <span class="sc">+</span> region66, <span class="at">data =</span> card_95)</span>
<span id="cb42-1677"><a href="#cb42-1677" aria-hidden="true" tabindex="-1"></a>linear_model3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(lwage76 <span class="sc">~</span> ed76 <span class="sc">+</span> exp76 <span class="sc">+</span> exp76_sq_100 <span class="sc">+</span> black <span class="sc">+</span> south76 <span class="sc">+</span> smsa76r <span class="sc">+</span> smsa66r <span class="sc">+</span> region66 <span class="sc">+</span></span>
<span id="cb42-1678"><a href="#cb42-1678" aria-hidden="true" tabindex="-1"></a>                      daded <span class="sc">+</span> momed <span class="sc">+</span> nodaded <span class="sc">+</span> nomomed, <span class="at">data =</span> card_95)</span>
<span id="cb42-1679"><a href="#cb42-1679" aria-hidden="true" tabindex="-1"></a>linear_model4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(lwage76 <span class="sc">~</span> ed76 <span class="sc">+</span> exp76 <span class="sc">+</span> exp76_sq_100 <span class="sc">+</span> black <span class="sc">+</span> south76 <span class="sc">+</span> smsa76r <span class="sc">+</span> smsa66r <span class="sc">+</span></span>
<span id="cb42-1680"><a href="#cb42-1680" aria-hidden="true" tabindex="-1"></a>                      region66 <span class="sc">+</span> daded <span class="sc">+</span> momed <span class="sc">+</span> nodaded <span class="sc">+</span> nomomed <span class="sc">+</span> f1 <span class="sc">+</span> f2 <span class="sc">+</span> f3 <span class="sc">+</span> f4 <span class="sc">+</span> </span>
<span id="cb42-1681"><a href="#cb42-1681" aria-hidden="true" tabindex="-1"></a>                      f5 <span class="sc">+</span> f6 <span class="sc">+</span> f7 <span class="sc">+</span> f8, <span class="at">data =</span> card_95)</span>
<span id="cb42-1682"><a href="#cb42-1682" aria-hidden="true" tabindex="-1"></a>linear_model5 <span class="ot">&lt;-</span> <span class="fu">lm</span>(lwage76 <span class="sc">~</span> ed76 <span class="sc">+</span> exp76 <span class="sc">+</span> exp76_sq_100 <span class="sc">+</span> black <span class="sc">+</span> south76 <span class="sc">+</span> smsa76r <span class="sc">+</span> smsa66r <span class="sc">+</span></span>
<span id="cb42-1683"><a href="#cb42-1683" aria-hidden="true" tabindex="-1"></a>                     region66<span class="sc">+</span> daded <span class="sc">+</span> momed <span class="sc">+</span> nodaded <span class="sc">+</span> nomomed <span class="sc">+</span> f1 <span class="sc">+</span> f2 <span class="sc">+</span> f3 <span class="sc">+</span> f4 <span class="sc">+</span> </span>
<span id="cb42-1684"><a href="#cb42-1684" aria-hidden="true" tabindex="-1"></a>                      f5 <span class="sc">+</span> f6 <span class="sc">+</span> f7 <span class="sc">+</span> f8 <span class="sc">+</span> momdad14 <span class="sc">+</span> sinmom14, <span class="at">data =</span> card_95)</span>
<span id="cb42-1685"><a href="#cb42-1685" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1686"><a href="#cb42-1686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1687"><a href="#cb42-1687" aria-hidden="true" tabindex="-1"></a>Our results should match Table 2 of @card1995using. The ```stargazer``` package gives us a flexible means of tabulating regression results.^<span class="co">[</span><span class="ot">Right now, the table is formatted in html and automatically included when this Rmarkdown file is knit, but you ```stargazer``` is also capable of outputting very nice tables in $\LaTeX$.</span><span class="co">]</span></span>
<span id="cb42-1688"><a href="#cb42-1688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1689"><a href="#cb42-1689" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='asis', echo=FALSE}</span></span>
<span id="cb42-1690"><a href="#cb42-1690" aria-hidden="true" tabindex="-1"></a><span class="in"># stargazer(linear_model1,</span></span>
<span id="cb42-1691"><a href="#cb42-1691" aria-hidden="true" tabindex="-1"></a><span class="in">#           linear_model2, </span></span>
<span id="cb42-1692"><a href="#cb42-1692" aria-hidden="true" tabindex="-1"></a><span class="in">#           linear_model3, </span></span>
<span id="cb42-1693"><a href="#cb42-1693" aria-hidden="true" tabindex="-1"></a><span class="in">#           linear_model4, </span></span>
<span id="cb42-1694"><a href="#cb42-1694" aria-hidden="true" tabindex="-1"></a><span class="in">#           linear_model5, </span></span>
<span id="cb42-1695"><a href="#cb42-1695" aria-hidden="true" tabindex="-1"></a><span class="in">#           header=FALSE, </span></span>
<span id="cb42-1696"><a href="#cb42-1696" aria-hidden="true" tabindex="-1"></a><span class="in">#           type = 'html',</span></span>
<span id="cb42-1697"><a href="#cb42-1697" aria-hidden="true" tabindex="-1"></a><span class="in">#           omit = c("f", "reg", "momed", "nodaded", "daded", "momdad14", "sinmom14", "Constant", "nomomed", "smsa66"),</span></span>
<span id="cb42-1698"><a href="#cb42-1698" aria-hidden="true" tabindex="-1"></a><span class="in">#           no.space = TRUE,</span></span>
<span id="cb42-1699"><a href="#cb42-1699" aria-hidden="true" tabindex="-1"></a><span class="in">#           add.lines=list(c('Region in 1966', 'No','Yes', "Yes", "Yes", "Yes"),</span></span>
<span id="cb42-1700"><a href="#cb42-1700" aria-hidden="true" tabindex="-1"></a><span class="in">#                          c('SMSA 1966', 'No','Yes', "Yes", "Yes", "Yes"),</span></span>
<span id="cb42-1701"><a href="#cb42-1701" aria-hidden="true" tabindex="-1"></a><span class="in">#                          c('Parental Education', 'No','No', "Yes", "Yes", "Yes"),</span></span>
<span id="cb42-1702"><a href="#cb42-1702" aria-hidden="true" tabindex="-1"></a><span class="in">#                          c('Interacted Parental Education Classes', 'No','No', "No", "Yes", "Yes"),</span></span>
<span id="cb42-1703"><a href="#cb42-1703" aria-hidden="true" tabindex="-1"></a><span class="in">#                          c('Family Structure', 'No','No', "No", "No", "Yes")),</span></span>
<span id="cb42-1704"><a href="#cb42-1704" aria-hidden="true" tabindex="-1"></a><span class="in">#           omit.stat =c("f", "adj.rsq", "ser"),</span></span>
<span id="cb42-1705"><a href="#cb42-1705" aria-hidden="true" tabindex="-1"></a><span class="in">#           notes = NULL,</span></span>
<span id="cb42-1706"><a href="#cb42-1706" aria-hidden="true" tabindex="-1"></a><span class="in">#           covariate.labels =c("Education", "Experiance", "Experiance-Squared/100", "Black indicator", "Live in South", "Live in SMSA"),</span></span>
<span id="cb42-1707"><a href="#cb42-1707" aria-hidden="true" tabindex="-1"></a><span class="in">#           dep.var.labels = c("Log Hourly Earnings")</span></span>
<span id="cb42-1708"><a href="#cb42-1708" aria-hidden="true" tabindex="-1"></a><span class="in">#           )</span></span>
<span id="cb42-1709"><a href="#cb42-1709" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1710"><a href="#cb42-1710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1711"><a href="#cb42-1711" aria-hidden="true" tabindex="-1"></a>For each model $\hat\beta_\text{OLS}\in<span class="co">[</span><span class="ot">0.073,0.075</span><span class="co">]</span>$, meaning that an additional year of education corresponds to roughly a 7.4% increase in earnings. We should be suspicious of these results though, as it's likely the case that $educ_i$ is endogenous, so we need some instrument(s) for $educ_i$.  @card1995using makes the case for using a variable which indicates whether a respondent grew up in a labor market with an accredited 4-year college, $near_\ college_i$ (```nearc4```). In other words, the respondent lived near a college in the year 1966. This proximity to a college has no baring on earnings (in theory), but it is likely correlated with $educ_i$, as the cost of higher education is lower for those who have the option to live at home while attending college. Let's use $near_\ college_i$ to calculate $\hat\beta_\text{IV}$. We can do this "by hand" by estimating the following reduced form equations via OLS:^<span class="co">[</span><span class="ot">While we're prone to make mistakes involving standard errors here, it's sort of the equivelent of "showing your work" on a math test.</span><span class="co">]</span></span>
<span id="cb42-1712"><a href="#cb42-1712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1713"><a href="#cb42-1713" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb42-1714"><a href="#cb42-1714" aria-hidden="true" tabindex="-1"></a>educ_i &amp;= \gamma_0 + \gamma_1 \cdot near_\ college_i + \gamma_2\cdot exper_i + \frac{\gamma_3}{100}\cdot exper_i^2 + \gamma_4 \cdot black_i + \gamma_5\cdot region_i + \gamma_6\cdot SMSA_i + \cdots + u_i<span class="sc">\\</span></span>
<span id="cb42-1715"><a href="#cb42-1715" aria-hidden="true" tabindex="-1"></a>\log( wage_i) &amp;= \delta_0 + \delta_1 \cdot near_\ college_i + \delta_2\cdot exper_i + \frac{\delta_3}{100}\cdot exper_i^2 + \delta_4 \cdot black_i + \delta_5\cdot region_i + \delta_6\cdot SMSA_i + \cdots + \nu_i<span class="sc">\\</span></span>
<span id="cb42-1716"><a href="#cb42-1716" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb42-1717"><a href="#cb42-1717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1718"><a href="#cb42-1718" aria-hidden="true" tabindex="-1"></a>We could also directly estimate the structural model via $\IV$ and not worry about messing up the standard errors. If we have done everything correctly we should see:</span>
<span id="cb42-1719"><a href="#cb42-1719" aria-hidden="true" tabindex="-1"></a>$$ \frac{\hat \delta_{\text{OLS},1}}{\hat \gamma_{\text{OLS},1}} = \hat\beta_\text{IV}.$$</span>
<span id="cb42-1720"><a href="#cb42-1720" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE, fig.align='center', fig.asp = 0.5, fig.width = 1, fig.cap ="test", out.width = "500px"}</span></span>
<span id="cb42-1721"><a href="#cb42-1721" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("figures/card_dag.png")</span></span>
<span id="cb42-1722"><a href="#cb42-1722" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1723"><a href="#cb42-1723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1724"><a href="#cb42-1724" aria-hidden="true" tabindex="-1"></a>We will estimate the models with and without family controls, and restrict our attention to respondents where ```lwage76``` is not missing.</span>
<span id="cb42-1725"><a href="#cb42-1725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1728"><a href="#cb42-1728" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb42-1729"><a href="#cb42-1729" aria-hidden="true" tabindex="-1"></a>card_95 <span class="ot">&lt;-</span> card_95 <span class="sc">%&gt;%</span> </span>
<span id="cb42-1730"><a href="#cb42-1730" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(lwage76))</span>
<span id="cb42-1731"><a href="#cb42-1731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1732"><a href="#cb42-1732" aria-hidden="true" tabindex="-1"></a><span class="co">#Without family controls </span></span>
<span id="cb42-1733"><a href="#cb42-1733" aria-hidden="true" tabindex="-1"></a>reduced_form1_stage1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(ed76 <span class="sc">~</span> nearc4 <span class="sc">+</span> exp76 <span class="sc">+</span> exp76_sq_100 <span class="sc">+</span> black <span class="sc">+</span> south76 <span class="sc">+</span> smsa76r <span class="sc">+</span> smsa66r <span class="sc">+</span> region66, <span class="at">data =</span> card_95)</span>
<span id="cb42-1734"><a href="#cb42-1734" aria-hidden="true" tabindex="-1"></a>reduced_form1_stage2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(lwage76 <span class="sc">~</span> nearc4 <span class="sc">+</span> exp76 <span class="sc">+</span> exp76_sq_100 <span class="sc">+</span> black <span class="sc">+</span> south76 <span class="sc">+</span> smsa76r <span class="sc">+</span> smsa66r <span class="sc">+</span> region66, <span class="at">data =</span> card_95)</span>
<span id="cb42-1735"><a href="#cb42-1735" aria-hidden="true" tabindex="-1"></a>IV_model1 <span class="ot">&lt;-</span> <span class="fu">ivreg</span>(lwage76 <span class="sc">~</span> ed76 <span class="sc">+</span> exp76 <span class="sc">+</span> exp76_sq_100 <span class="sc">+</span> black <span class="sc">+</span> south76 <span class="sc">+</span> smsa76r <span class="sc">+</span> smsa66r <span class="sc">+</span> region66 <span class="sc">|</span></span>
<span id="cb42-1736"><a href="#cb42-1736" aria-hidden="true" tabindex="-1"></a>                     nearc4 <span class="sc">+</span> exp76 <span class="sc">+</span> exp76_sq_100 <span class="sc">+</span> black <span class="sc">+</span> south76 <span class="sc">+</span> smsa76r <span class="sc">+</span> smsa66r <span class="sc">+</span> region66, <span class="at">data =</span> card_95)</span>
<span id="cb42-1737"><a href="#cb42-1737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1738"><a href="#cb42-1738" aria-hidden="true" tabindex="-1"></a><span class="co">#With family controls</span></span>
<span id="cb42-1739"><a href="#cb42-1739" aria-hidden="true" tabindex="-1"></a>reduced_form2_stage1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(ed76 <span class="sc">~</span> nearc4 <span class="sc">+</span> exp76 <span class="sc">+</span> exp76_sq_100 <span class="sc">+</span> black <span class="sc">+</span> south76 <span class="sc">+</span> smsa76r <span class="sc">+</span> smsa66r <span class="sc">+</span> </span>
<span id="cb42-1740"><a href="#cb42-1740" aria-hidden="true" tabindex="-1"></a>                             region66 <span class="sc">+</span> daded <span class="sc">+</span> momed <span class="sc">+</span> nodaded <span class="sc">+</span> nomomed <span class="sc">+</span> f1 <span class="sc">+</span> f2 <span class="sc">+</span> f3 <span class="sc">+</span> f4 <span class="sc">+</span> </span>
<span id="cb42-1741"><a href="#cb42-1741" aria-hidden="true" tabindex="-1"></a>                             f5 <span class="sc">+</span> f6 <span class="sc">+</span> f7 <span class="sc">+</span> f8 <span class="sc">+</span> momdad14 <span class="sc">+</span> sinmom14, <span class="at">data =</span> card_95)</span>
<span id="cb42-1742"><a href="#cb42-1742" aria-hidden="true" tabindex="-1"></a>reduced_form2_stage2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(lwage76 <span class="sc">~</span> nearc4 <span class="sc">+</span> exp76 <span class="sc">+</span> exp76_sq_100 <span class="sc">+</span> black <span class="sc">+</span> south76 <span class="sc">+</span> smsa76r <span class="sc">+</span> smsa66r <span class="sc">+</span> region66 <span class="sc">+</span> </span>
<span id="cb42-1743"><a href="#cb42-1743" aria-hidden="true" tabindex="-1"></a>                             daded <span class="sc">+</span> momed <span class="sc">+</span> nodaded <span class="sc">+</span> nomomed <span class="sc">+</span> f1 <span class="sc">+</span> f2 <span class="sc">+</span> f3 <span class="sc">+</span> f4 <span class="sc">+</span> f5 <span class="sc">+</span> f6 <span class="sc">+</span> f7 <span class="sc">+</span> f8 <span class="sc">+</span> </span>
<span id="cb42-1744"><a href="#cb42-1744" aria-hidden="true" tabindex="-1"></a>                             momdad14 <span class="sc">+</span> sinmom14, <span class="at">data =</span> card_95)</span>
<span id="cb42-1745"><a href="#cb42-1745" aria-hidden="true" tabindex="-1"></a>IV_model2 <span class="ot">&lt;-</span> <span class="fu">ivreg</span>(lwage76 <span class="sc">~</span> ed76 <span class="sc">+</span> exp76 <span class="sc">+</span> exp76_sq_100 <span class="sc">+</span> black <span class="sc">+</span> south76 <span class="sc">+</span> smsa76r <span class="sc">+</span> smsa66r <span class="sc">+</span> region66 <span class="sc">+</span> daded <span class="sc">+</span> momed <span class="sc">+</span></span>
<span id="cb42-1746"><a href="#cb42-1746" aria-hidden="true" tabindex="-1"></a>                     nodaded <span class="sc">+</span> nomomed <span class="sc">+</span> f1 <span class="sc">+</span> f2 <span class="sc">+</span> f3 <span class="sc">+</span> f4 <span class="sc">+</span>  f5 <span class="sc">+</span> f6 <span class="sc">+</span> f7 <span class="sc">+</span> f8 <span class="sc">+</span> momdad14 <span class="sc">+</span> sinmom14 <span class="sc">|</span></span>
<span id="cb42-1747"><a href="#cb42-1747" aria-hidden="true" tabindex="-1"></a>                     nearc4 <span class="sc">+</span> exp76 <span class="sc">+</span> exp76_sq_100 <span class="sc">+</span> black <span class="sc">+</span> south76 <span class="sc">+</span> smsa76r <span class="sc">+</span> smsa66r <span class="sc">+</span> region66 <span class="sc">+</span> daded <span class="sc">+</span> momed <span class="sc">+</span></span>
<span id="cb42-1748"><a href="#cb42-1748" aria-hidden="true" tabindex="-1"></a>                     nodaded <span class="sc">+</span> nomomed <span class="sc">+</span> f1 <span class="sc">+</span> f2 <span class="sc">+</span> f3 <span class="sc">+</span> f4 <span class="sc">+</span> f5 <span class="sc">+</span> f6 <span class="sc">+</span> f7 <span class="sc">+</span> f8 <span class="sc">+</span> momdad14 <span class="sc">+</span> sinmom14, <span class="at">data =</span> card_95)</span>
<span id="cb42-1749"><a href="#cb42-1749" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1750"><a href="#cb42-1750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1751"><a href="#cb42-1751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1752"><a href="#cb42-1752" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='asis', echo=FALSE}</span></span>
<span id="cb42-1753"><a href="#cb42-1753" aria-hidden="true" tabindex="-1"></a><span class="in"># stargazer(reduced_form1_stage1,</span></span>
<span id="cb42-1754"><a href="#cb42-1754" aria-hidden="true" tabindex="-1"></a><span class="in">#           reduced_form2_stage1,</span></span>
<span id="cb42-1755"><a href="#cb42-1755" aria-hidden="true" tabindex="-1"></a><span class="in">#           reduced_form1_stage2,</span></span>
<span id="cb42-1756"><a href="#cb42-1756" aria-hidden="true" tabindex="-1"></a><span class="in">#           reduced_form2_stage2,</span></span>
<span id="cb42-1757"><a href="#cb42-1757" aria-hidden="true" tabindex="-1"></a><span class="in">#           IV_model1,</span></span>
<span id="cb42-1758"><a href="#cb42-1758" aria-hidden="true" tabindex="-1"></a><span class="in">#           IV_model2,</span></span>
<span id="cb42-1759"><a href="#cb42-1759" aria-hidden="true" tabindex="-1"></a><span class="in">#           header=FALSE,</span></span>
<span id="cb42-1760"><a href="#cb42-1760" aria-hidden="true" tabindex="-1"></a><span class="in">#           type = 'html',</span></span>
<span id="cb42-1761"><a href="#cb42-1761" aria-hidden="true" tabindex="-1"></a><span class="in">#           omit = c("f", "reg", "exp76", "smsa", "black", "south", "momed", "nodaded", "daded", "momdad14", "sinmom14", "Constant", "nomomed", "smsa66"),</span></span>
<span id="cb42-1762"><a href="#cb42-1762" aria-hidden="true" tabindex="-1"></a><span class="in">#           no.space = TRUE,</span></span>
<span id="cb42-1763"><a href="#cb42-1763" aria-hidden="true" tabindex="-1"></a><span class="in">#            add.lines=list(c('Family Background Variables', 'No','Yes', "No", "Yes", "No", "Yes")),</span></span>
<span id="cb42-1764"><a href="#cb42-1764" aria-hidden="true" tabindex="-1"></a><span class="in">#           omit.stat =c("f", "adj.rsq", "ser", "rsq"),</span></span>
<span id="cb42-1765"><a href="#cb42-1765" aria-hidden="true" tabindex="-1"></a><span class="in">#           # notes = NULL,</span></span>
<span id="cb42-1766"><a href="#cb42-1766" aria-hidden="true" tabindex="-1"></a><span class="in">#           covariate.labels =c("Live Near College in 1966 ", "Education"),</span></span>
<span id="cb42-1767"><a href="#cb42-1767" aria-hidden="true" tabindex="-1"></a><span class="in">#            dep.var.labels = c("Education", "Log Hourly Earnings"),</span></span>
<span id="cb42-1768"><a href="#cb42-1768" aria-hidden="true" tabindex="-1"></a><span class="in">#           column.labels   = c("Reduced Form (OLS) Estimates", "Strucutral (IV) Estimates"),</span></span>
<span id="cb42-1769"><a href="#cb42-1769" aria-hidden="true" tabindex="-1"></a><span class="in">#           column.separate = c(4, 2),</span></span>
<span id="cb42-1770"><a href="#cb42-1770" aria-hidden="true" tabindex="-1"></a><span class="in">#           model.names = FALSE</span></span>
<span id="cb42-1771"><a href="#cb42-1771" aria-hidden="true" tabindex="-1"></a><span class="in">#           )</span></span>
<span id="cb42-1772"><a href="#cb42-1772" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1773"><a href="#cb42-1773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1774"><a href="#cb42-1774" aria-hidden="true" tabindex="-1"></a>Compare this to panel A of Table 3 in @card1995using. Note that the ratio of our reduced form estimates do equal our IV estimates. Between our original OLS estimates (of the structural model), and our IV estimates, we have seven estimates for $\beta$. We can plot these along with the corresponding 95% confidence intervals.</span>
<span id="cb42-1775"><a href="#cb42-1775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1776"><a href="#cb42-1776" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE, fig.align='center', fig.asp = 0.7, fig.width = 8, fig.cap ="test", warning=FALSE}</span></span>
<span id="cb42-1777"><a href="#cb42-1777" aria-hidden="true" tabindex="-1"></a><span class="in">linear_model1 &lt;- tidy(linear_model1) %&gt;% </span></span>
<span id="cb42-1778"><a href="#cb42-1778" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(model = "Linear Model 1")</span></span>
<span id="cb42-1779"><a href="#cb42-1779" aria-hidden="true" tabindex="-1"></a><span class="in">linear_model2 &lt;- tidy(linear_model2) %&gt;% </span></span>
<span id="cb42-1780"><a href="#cb42-1780" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(model = "Linear Model 2")</span></span>
<span id="cb42-1781"><a href="#cb42-1781" aria-hidden="true" tabindex="-1"></a><span class="in">linear_model3 &lt;- tidy(linear_model3) %&gt;% </span></span>
<span id="cb42-1782"><a href="#cb42-1782" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(model = "Linear Model 3")</span></span>
<span id="cb42-1783"><a href="#cb42-1783" aria-hidden="true" tabindex="-1"></a><span class="in">linear_model4 &lt;- tidy(linear_model4) %&gt;% </span></span>
<span id="cb42-1784"><a href="#cb42-1784" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(model = "Linear Model 4")</span></span>
<span id="cb42-1785"><a href="#cb42-1785" aria-hidden="true" tabindex="-1"></a><span class="in">linear_model5 &lt;- tidy(linear_model5) %&gt;% </span></span>
<span id="cb42-1786"><a href="#cb42-1786" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(model = "Linear Model 5")</span></span>
<span id="cb42-1787"><a href="#cb42-1787" aria-hidden="true" tabindex="-1"></a><span class="in">IV_model1 &lt;- tidy(IV_model1) %&gt;% </span></span>
<span id="cb42-1788"><a href="#cb42-1788" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(model = "IV Model 1")</span></span>
<span id="cb42-1789"><a href="#cb42-1789" aria-hidden="true" tabindex="-1"></a><span class="in">IV_model2 &lt;- tidy(IV_model2) %&gt;% </span></span>
<span id="cb42-1790"><a href="#cb42-1790" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(model = "IV Model 2")</span></span>
<span id="cb42-1791"><a href="#cb42-1791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1792"><a href="#cb42-1792" aria-hidden="true" tabindex="-1"></a><span class="in">bind_rows(linear_model1,</span></span>
<span id="cb42-1793"><a href="#cb42-1793" aria-hidden="true" tabindex="-1"></a><span class="in">          linear_model2,</span></span>
<span id="cb42-1794"><a href="#cb42-1794" aria-hidden="true" tabindex="-1"></a><span class="in">          linear_model3,</span></span>
<span id="cb42-1795"><a href="#cb42-1795" aria-hidden="true" tabindex="-1"></a><span class="in">          linear_model4,</span></span>
<span id="cb42-1796"><a href="#cb42-1796" aria-hidden="true" tabindex="-1"></a><span class="in">          linear_model5,</span></span>
<span id="cb42-1797"><a href="#cb42-1797" aria-hidden="true" tabindex="-1"></a><span class="in">          IV_model1,</span></span>
<span id="cb42-1798"><a href="#cb42-1798" aria-hidden="true" tabindex="-1"></a><span class="in">          IV_model2) %&gt;% </span></span>
<span id="cb42-1799"><a href="#cb42-1799" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(term == "ed76") %&gt;% </span></span>
<span id="cb42-1800"><a href="#cb42-1800" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(upper = estimate + 1.965*std.error,</span></span>
<span id="cb42-1801"><a href="#cb42-1801" aria-hidden="true" tabindex="-1"></a><span class="in">         lower = estimate - 1.965*std.error) %&gt;% </span></span>
<span id="cb42-1802"><a href="#cb42-1802" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(model, estimate)) +</span></span>
<span id="cb42-1803"><a href="#cb42-1803" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb42-1804"><a href="#cb42-1804" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_linerange(aes(ymin = lower, ymax = upper)) +</span></span>
<span id="cb42-1805"><a href="#cb42-1805" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb42-1806"><a href="#cb42-1806" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "", y = "β Estimate, 95% Confidence Interval")</span></span>
<span id="cb42-1807"><a href="#cb42-1807" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb42-1808"><a href="#cb42-1808" aria-hidden="true" tabindex="-1"></a>While our IV estimates are larger, all of our OLS estimates fall within the 95% confidence intervals for the IV estimates. As such, we're not able to conclude that our IV estimates are significantly larger than our OLS estimates.</span>
<span id="cb42-1809"><a href="#cb42-1809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1810"><a href="#cb42-1810" aria-hidden="true" tabindex="-1"></a><span class="fu">## Further Reading</span></span>
<span id="cb42-1811"><a href="#cb42-1811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1812"><a href="#cb42-1812" aria-hidden="true" tabindex="-1"></a>**_Technical treatment of IV/2SLS_**: Chapter 5 of @wooldridge2010econometric, Chapter 8 of @greene2003econometric, Chapter 12 of @hansen2022econometrics</span>
<span id="cb42-1813"><a href="#cb42-1813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1814"><a href="#cb42-1814" aria-hidden="true" tabindex="-1"></a>**_Testing for Endogeneity_**: Section 8.7 of @davidson2004econometric, @ruud1984tests, @wu1973alternative, @durbin54, @hausman1978specification, @davidson1990specification, @nakamura1981relationships, @chmelarova2007hausman, @baum2003instrumental</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>